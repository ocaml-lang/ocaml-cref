<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/middle_end/closure/closure.ml - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/middle_end/closure/closure.ml - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L936">app</a></li>
<li><a href="#L941">app</a></li>
<li><a href="#L537">approx_ulam</a></li>
<li><a href="#L1089">arg</a></li>
<li><a href="#L844">check_constant_result</a></li>
<li><a href="#L1377">clos</a></li>
<li><a href="#L1064">clos_defs</a></li>
<li><a href="#L893">close</a></li>
<li><a href="#L882">close_approx_var</a></li>
<li><a href="#L1212">close_list</a></li>
<li><a href="#L1385">close_one_function</a></li>
<li><a href="#L890">close_var</a></li>
<li><a href="#L1443">collect_exported_structured_constants</a></li>
<li><a href="#L33">compare_key</a></li>
<li><a href="#L1077">cst</a></li>
<li><a href="#L1016">dbg</a></li>
<li><a href="#L1098">dbg</a></li>
<li><a href="#L1103">dbg</a></li>
<li><a href="#L1110">dbg</a></li>
<li><a href="#L1115">dbg</a></li>
<li><a href="#L1121">dbg</a></li>
<li><a href="#L798">direct_apply</a></li>
<li><a href="#L1036">env</a></li>
<li><a href="#L871">excessive_function_nesting_depth</a></li>
<li><a href="#L1093">expr</a></li>
<li><a href="#L964">fenv</a></li>
<li><a href="#L457">field_approx</a></li>
<li><a href="#L949">final_args</a></li>
<li><a href="#L541">find_action</a></li>
<li><a href="#L947">first_args</a></li>
<li><a href="#L1125">fn</a></li>
<li><a href="#L963">funct_var</a></li>
<li><a href="#L870">function_nesting_depth</a></li>
<li><a href="#L1378">fv</a></li>
<li><a href="#L66">getglobal</a></li>
<li><a href="#L866">global_approx</a></li>
<li><a href="#L1090">id</a></li>
<li><a href="#L959">internal_args</a></li>
<li><a href="#L1506">intro</a></li>
<li><a href="#L216">is_pure_prim</a></li>
<li><a href="#L952">iter</a></li>
<li><a href="#L151">lambda_smaller</a></li>
<li><a href="#L237">make_const</a></li>
<li><a href="#L242">make_const_bool</a></li>
<li><a href="#L241">make_const_int</a></li>
<li><a href="#L238">make_const_ref</a></li>
<li><a href="#L255">make_float_comparison</a></li>
<li><a href="#L244">make_integer_comparison</a></li>
<li><a href="#L32">make_key</a></li>
<li><a href="#L931">nargs</a></li>
<li><a href="#L965">new_fun</a></li>
<li><a href="#L41">no_phantom_lets</a></li>
<li><a href="#L71">occurs_var</a></li>
<li><a href="#L1515">opaque</a></li>
<li><a href="#L279">open</a></li>
<li><a href="#L1120">p</a></li>
<li><a href="#L780">params</a></li>
<li><a href="#L781">params</a></li>
<li><a href="#L116">prim_size</a></li>
<li><a href="#L1500">reset</a></li>
<li><a href="#L861">sequence_constant_expr</a></li>
<li><a href="#L513">simplif_prim</a></li>
<li><a href="#L464">simplif_prim_pure</a></li>
<li><a href="#L46">split_list</a></li>
<li><a href="#L900">str</a></li>
<li><a href="#L835">strengthen_approx</a></li>
<li><a href="#L550">subst_debuginfo</a></li>
<li><a href="#L556">substitute</a></li>
<li><a href="#L906">transl</a></li>
<li><a href="#L1157">uarg</a></li>
<li><a href="#L1027">ubody</a></li>
<li><a href="#L1071">ubody</a></li>
<li><a href="#L1173">ubody</a></li>
<li><a href="#L1178">ubody</a></li>
<li><a href="#L1197">ubody</a></li>
<li><a href="#L1202">ubody</a></li>
<li><a href="#L1196">ucond</a></li>
<li><a href="#L1164">ud</a></li>
<li><a href="#L1070">udefs</a></li>
<li><a href="#L1174">uhandler</a></li>
<li><a href="#L1179">uhandler</a></li>
<li><a href="#L1201">uhi</a></li>
<li><a href="#L1188">uifnot</a></li>
<li><a href="#L1187">uifso</a></li>
<li><a href="#L1020">ulam</a></li>
<li><a href="#L1035">ulam</a></li>
<li><a href="#L1102">ulam</a></li>
<li><a href="#L1107">ulam</a></li>
<li><a href="#L1114">ulam</a></li>
<li><a href="#L1205">ulam</a></li>
<li><a href="#L1192">ulam1</a></li>
<li><a href="#L1193">ulam2</a></li>
<li><a href="#L1200">ulo</a></li>
<li><a href="#L1014">umet</a></li>
<li><a href="#L1015">uobj</a></li>
<li><a href="#L1158">usw</a></li>
<li><a href="#L1175">vars</a></li>
<li><a href="#L791">warning_if_forced_inline</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L706">env</a></li>
<li><a href="#L31">key</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">(**************************************************************************)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Introduction of closures, uncurrying, recognition of direct calls *)<br/></li>
<li></span><br/></li>
<li><span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Misc<br/></li>
<li></span><span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Asttypes<br/></li>
<li></span><span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Primitive<br/></li>
<li></span><span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Lambda<br/></li>
<li></span><span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Switch<br/></li>
<li></span><span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Clambda<br/></li>
<li></span><span class="Statement">module</span><span class="PreProc"> P</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Clambda_primitives<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Int</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Numbers.Int<br/></li>
<li></span><span class="Statement">module</span><span class="PreProc"> Storer</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Switch.Store<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlFuncWith">(</span><span class="PreProc">struct<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">t</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">lambda<br/></li>
<li><a id="L31">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">key</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">lambda<br/></li>
<li><a id="L32">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_key</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct">&nbsp; </span><span class="PreProc">Lambda</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">make_key</span><br/></li>
<li><a id="L33">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare_key</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Stdlib</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">compare<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> V</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Backend_var<br/></li>
<li></span><span class="Statement">module</span><span class="PreProc"> VP</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Backend_var.With_provenance<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* The current backend *)<br/></li>
<li></span><br/></li>
<li><a id="L41">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">no_phantom_lets</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Closure does not support phantom let generation&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Auxiliaries for compiling functions *)<br/></li>
<li></span><br/></li>
<li><a id="L46">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">split_list</span></span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier">l</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(</span><span class="Constant">[]</span>, <span class="ocamlLCIdentifier">l</span><span class="Statement">)</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fatal_error</span><span class="ocamlEnd"> </span><span class="Constant">&quot;Closure.<a href="#L46" title="ocaml/middle_end/closure/closure.ml:46">split_list</a>&quot;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">a</span><span class="Statement">::</span><span class="ocamlLCIdentifier">l</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">l1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">l2</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L46" title="ocaml/middle_end/closure/closure.ml:46">split_list</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlEnd"> </span><span class="Statement">in</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">a</span><span class="Statement">::</span><span class="ocamlLCIdentifier">l1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">l2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">build_closure_env</span> <span class="ocamlLCIdentifier">env_param</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">empty<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span>.<span class="Constant">Pfield</span><span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span>, <span class="Constant">Pointer</span>, <span class="Constant">Immutable</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span><span class="Constant">Uvar</span> <span class="ocamlLCIdentifier">env_param</span><span class="Statement">]</span>, <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">none</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">build_closure_env</span> <span class="ocamlLCIdentifier">env_param</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span>+<span class="Constant">1</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Auxiliary for accessing globals.&nbsp; We change the name of the global<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; to the name of the corresponding asm symbol.&nbsp; This is done here<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; and no longer in Cmmgen so that approximations stored in .cmx files<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; contain the right names if the -for-pack option is active. *)<br/></li>
<li></span><br/></li>
<li><a id="L66">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">getglobal</span></span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span>.<span class="Constant">Pread_symbol</span> <span class="Statement">(</span><span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">symbol_for_global</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)</span>, <span class="Constant">[]</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Check if a variable occurs in a [clambda] term. *)<br/></li>
<li></span><br/></li>
<li><a id="L71">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">occurs_var</span></span> <span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier">u</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">occurs</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Uvar</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">var<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Udirect_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_lbl</span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ugeneric_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier">funct</span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">funct</span> <span class="Statement">||</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uclosure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_fundecls</span>, <span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uoffset</span><span class="Statement">(</span><span class="ocamlLCIdentifier">u</span>, <span class="ocamlLCIdentifier">_ofs</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">u<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ulet</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_str</span>, <span class="ocamlLCIdentifier">_kind</span>, <span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier">def</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uphantom_let</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L41" title="ocaml/middle_end/closure/closure.ml:41">no_phantom_lets</a></span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uletrec</span><span class="Statement">(</span><span class="ocamlLCIdentifier">decls</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier">u</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">u</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">decls</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_p</span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>, <span class="ocamlLCIdentifier">s</span>, <span class="ocamlLCIdentifier">_dbg</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span> <span class="Statement">||<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">occurs_array</span> <span class="ocamlLCIdentifier">s</span>.<span class="ocamlLCIdentifier">us_actions_consts</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs_array</span> <span class="ocamlLCIdentifier">s</span>.<span class="ocamlLCIdentifier">us_actions_blocks<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ustringswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>,<span class="ocamlLCIdentifier">sw</span>,<span class="ocamlLCIdentifier">d</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span> <span class="Statement">||<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="Statement">(fun</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">e</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">e</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">||<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(match</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">with</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">false</span> <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">d</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ustaticfail</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">args</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ucatch</span><span class="Statement">(_</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">body</span>, <span class="ocamlLCIdentifier">hdlr</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">hdlr<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Utrywith</span><span class="Statement">(</span><span class="ocamlLCIdentifier">body</span>, <span class="ocamlLCIdentifier">_exn</span>, <span class="ocamlLCIdentifier">hdlr</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">hdlr<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uifthenelse</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span>, <span class="ocamlLCIdentifier">ifso</span>, <span class="ocamlLCIdentifier">ifnot</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">cond</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">ifso</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">ifnot<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Usequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">u1</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">u2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uwhile</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">cond</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ufor</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier">lo</span>, <span class="ocamlLCIdentifier">hi</span>, <span class="ocamlLCIdentifier">_dir</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">lo</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">hi</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uassign</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">u</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">var</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">u<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Usend</span><span class="Statement">(_</span>, <span class="ocamlLCIdentifier">met</span>, <span class="ocamlLCIdentifier">obj</span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">met</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">obj</span> <span class="Statement">||</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uunreachable</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">occurs_array</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">a</span> - <span class="Constant">1</span> <span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">occurs</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlNone">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="Statement">raise</span><span class="ocamlDo"> </span><span class="Constant">Exit<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">with</span> <span class="Constant">Exit</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">in</span> <span class="ocamlLCIdentifier">occurs</span> <span class="ocamlLCIdentifier">u<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Determine whether the estimated size of a clambda term is below<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; some threshold *)<br/></li>
<li></span><br/></li>
<li><a id="L116">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">prim_size</span></span> <span class="ocamlLCIdentifier">prim</span> <span class="ocamlLCIdentifier">args</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Clambda_primitives</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">prim</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pread_symbol</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">1<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pmakeblock</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">5</span> + <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pfield</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">1<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Psetfield</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_f</span>, <span class="ocamlLCIdentifier">isptr</span>, <span class="ocamlLCIdentifier">init</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">init</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Root_initialization</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">1</span><span class="ocamlEnd">&nbsp; </span><span class="Comment">(* never causes a write barrier hit *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Assignment</span><span class="ocamlEnd"> </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Heap_initialization</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">isptr</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pointer</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">4<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Immediate</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">1<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pfloatfield</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">1<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Psetfloatfield</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">1<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pduprecord</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">10</span> + <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pccall</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">prim_alloc</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">10</span> <span class="Statement">else</span> <span class="Constant">4</span><span class="Statement">)</span> + <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Praise</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">4<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pstringlength</span> <span class="Statement">-&gt;</span> <span class="Constant">5<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pbyteslength</span> <span class="Statement">-&gt;</span> <span class="Constant">5<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pstringrefs</span>&nbsp; <span class="Statement">-&gt;</span> <span class="Constant">6<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pbytesrefs</span> <span class="Statement">|</span> <span class="Constant">Pbytessets</span> <span class="Statement">-&gt;</span> <span class="Constant">6<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pmakearray</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">5</span> + <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Parraylength</span> <span class="ocamlLCIdentifier">kind</span> <span class="Statement">-&gt;</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">kind</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">Pgenarray</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">6</span> <span class="Statement">else</span> <span class="Constant">2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Parrayrefu</span> <span class="ocamlLCIdentifier">kind</span> <span class="Statement">-&gt;</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">kind</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">Pgenarray</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">12</span> <span class="Statement">else</span> <span class="Constant">2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Parraysetu</span> <span class="ocamlLCIdentifier">kind</span> <span class="Statement">-&gt;</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">kind</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">Pgenarray</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">16</span> <span class="Statement">else</span> <span class="Constant">4<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Parrayrefs</span> <span class="ocamlLCIdentifier">kind</span> <span class="Statement">-&gt;</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">kind</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">Pgenarray</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">18</span> <span class="Statement">else</span> <span class="Constant">8<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Parraysets</span> <span class="ocamlLCIdentifier">kind</span> <span class="Statement">-&gt;</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">kind</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">Pgenarray</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">22</span> <span class="Statement">else</span> <span class="Constant">10<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pbigarrayref</span><span class="Statement">(_</span>, <span class="ocamlLCIdentifier">ndims</span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="Constant">4</span> + <span class="ocamlLCIdentifier">ndims</span> <span class="Statement">*</span> <span class="Constant">6<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pbigarrayset</span><span class="Statement">(_</span>, <span class="ocamlLCIdentifier">ndims</span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="Constant">4</span> + <span class="ocamlLCIdentifier">ndims</span> <span class="Statement">*</span> <span class="Constant">6<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">2</span> <span class="Comment">(* arithmetic and comparisons *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Very raw approximation of switch cost *)<br/></li>
<li></span><br/></li>
<li><a id="L151">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lambda_smaller</span></span> <span class="ocamlLCIdentifier">lam</span> <span class="ocamlLCIdentifier">threshold</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">size</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">size</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">threshold</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">raise</span> <span class="Constant">Exit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Uvar</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier">size<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Udirect_apply</span><span class="Statement">(_</span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">4</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_list_size</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ugeneric_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1125" title="ocaml/middle_end/closure/closure.ml:1125">fn</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">6</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier"><a href="#L1125" title="ocaml/middle_end/closure/closure.ml:1125">fn</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_list_size</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uclosure</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">raise</span> <span class="Constant">Exit</span> <span class="Comment">(* inlining would duplicate function definitions *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uoffset</span><span class="Statement">(</span><span class="ocamlLCIdentifier">lam</span>, <span class="ocamlLCIdentifier">_ofs</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier">size</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ulet</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_str</span>, <span class="ocamlLCIdentifier">_kind</span>, <span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier">lam</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uphantom_let</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L41" title="ocaml/middle_end/closure/closure.ml:41">no_phantom_lets</a></span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uletrec</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">raise</span> <span class="Constant">Exit</span> <span class="Comment">(* usually too large *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier">prim</span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="ocamlLCIdentifier"><a href="#L116" title="ocaml/middle_end/closure/closure.ml:116">prim_size</a></span> <span class="ocamlLCIdentifier">prim</span> <span class="ocamlLCIdentifier">args</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_list_size</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier">lam</span>, <span class="ocamlLCIdentifier">cases</span>, <span class="ocamlLCIdentifier">_dbg</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cases</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">us_actions_consts</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">5</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cases</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">us_actions_blocks</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">5</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_array_size</span> <span class="ocamlLCIdentifier">cases</span>.<span class="ocamlLCIdentifier">us_actions_consts</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_array_size</span> <span class="ocamlLCIdentifier">cases</span>.<span class="ocamlLCIdentifier">us_actions_blocks<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ustringswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lam</span>,<span class="ocamlLCIdentifier">sw</span>,<span class="ocamlLCIdentifier">d</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* as ifthenelse *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">lam</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span>+<span class="Constant">2</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">d<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ustaticfail</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">args</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">lambda_list_size</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ucatch</span><span class="Statement">(_</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">body</span>, <span class="ocamlLCIdentifier">handler</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier">size</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">body</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">handler<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Utrywith</span><span class="Statement">(</span><span class="ocamlLCIdentifier">body</span>, <span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier">handler</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">8</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">body</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">handler<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uifthenelse</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span>, <span class="ocamlLCIdentifier">ifso</span>, <span class="ocamlLCIdentifier">ifnot</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">2</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">cond</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">ifso</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">ifnot<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Usequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier">lam1</span>, <span class="ocamlLCIdentifier">lam2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam1</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uwhile</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">2</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">cond</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ufor</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier">low</span>, <span class="ocamlLCIdentifier">high</span>, <span class="ocamlLCIdentifier">_dir</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">4</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">low</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">high</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uassign</span><span class="Statement">(</span><span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier">lam</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier">size</span><span class="Statement">;</span>&nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Usend</span><span class="Statement">(_</span>, <span class="ocamlLCIdentifier">met</span>, <span class="ocamlLCIdentifier">obj</span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">size</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> + <span class="Constant">8</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">met</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">obj</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">lambda_list_size</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uunreachable</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">lambda_list_size</span> <span class="ocamlLCIdentifier">l</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">l<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">lambda_array_size</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">lambda_size</span> <span class="ocamlLCIdentifier">lam</span><span class="Statement">;</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">size</span> <span class="Statement">&lt;=</span> <span class="ocamlLCIdentifier">threshold<br/></li>
<li></span>&nbsp; <span class="Statement">with</span> <span class="Constant">Exit</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L216">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">is_pure_prim</span></span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Semantics_of_primitives</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="PreProc">Semantics_of_primitives</span>.<span class="ocamlLCIdentifier">for_primitive</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="Constant">No_effects</span> <span class="Statement">|</span> <span class="Constant">Only_generative_effects</span><span class="Statement">)</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Arbitrary_effects</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Check if a clambda term is ``pure'',<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; that is without side-effects *and* not containing function definitions<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; (Pure terms may still read mutable state) *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">is_pure</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Uvar</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uconst</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L216" title="ocaml/middle_end/closure/closure.ml:216">is_pure_prim</a></span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">&amp;&amp;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">for_all</span> <span class="ocamlLCIdentifier">is_pure</span> <span class="ocamlLCIdentifier">args<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uoffset</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">is_pure</span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ulet</span><span class="Statement">(</span><span class="Constant">Immutable</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">_var</span>, <span class="ocamlLCIdentifier">def</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">is_pure</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier">is_pure</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Simplify primitive operations on known arguments *)<br/></li>
<li></span><br/></li>
<li><a id="L237">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_const</span></span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">=</span> <span class="Statement">(</span><span class="Constant">Uconst</span> <span class="ocamlLCIdentifier">c</span>, <span class="Constant">Value_const</span> <span class="ocamlLCIdentifier">c</span><span class="Statement">)<br/></li>
<li><a id="L238">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_const_ref</span></span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/middle_end/closure/closure.ml:237">make_const</a></span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(</span><span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">new_structured_constant</span> <span class="Statement">~</span><span class="Identifier">shared</span>:<span class="Constant">true</span> <span class="ocamlLCIdentifier">c</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">Some</span> <span class="ocamlLCIdentifier">c</span><span class="Statement">))<br/></li>
<li><a id="L241">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_const_int</span></span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/middle_end/closure/closure.ml:237">make_const</a></span> <span class="Statement">(</span><span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li><a id="L242">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_const_bool</span></span> <span class="ocamlLCIdentifier">b</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">b</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">1</span> <span class="Statement">else</span> <span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L244">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_integer_comparison</span></span> <span class="ocamlLCIdentifier">cmp</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">y</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Clambda_primitives</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(match</span> <span class="ocamlLCIdentifier">cmp</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Ceq</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Cne</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&lt;&gt;</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Clt</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&lt;</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Cgt</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&gt;</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Cle</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&lt;=</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Cge</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&gt;=</span> <span class="ocamlLCIdentifier">y</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L255">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_float_comparison</span></span> <span class="ocamlLCIdentifier">cmp</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">y</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(match</span> <span class="ocamlLCIdentifier">cmp</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFeq</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFneq</span> <span class="Statement">-&gt;</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">y</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFlt</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&lt;</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFnlt</span> <span class="Statement">-&gt;</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span> <span class="Statement">&lt;</span> <span class="ocamlLCIdentifier">y</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFgt</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&gt;</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFngt</span> <span class="Statement">-&gt;</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span> <span class="Statement">&gt;</span> <span class="ocamlLCIdentifier">y</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFle</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&lt;=</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFnle</span> <span class="Statement">-&gt;</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span> <span class="Statement">&lt;=</span> <span class="ocamlLCIdentifier">y</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFge</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">&gt;=</span> <span class="ocamlLCIdentifier">y<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">CFnge</span> <span class="Statement">-&gt;</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span> <span class="Statement">&gt;=</span> <span class="ocamlLCIdentifier">y</span><span class="Statement">))<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">make_const_float</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L238" title="ocaml/middle_end/closure/closure.ml:238">make_const_ref</a></span> <span class="Statement">(</span><span class="Constant">Uconst_float</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">make_const_natint</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L238" title="ocaml/middle_end/closure/closure.ml:238">make_const_ref</a></span> <span class="Statement">(</span><span class="Constant">Uconst_nativeint</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">make_const_int32</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L238" title="ocaml/middle_end/closure/closure.ml:238">make_const_ref</a></span> <span class="Statement">(</span><span class="Constant">Uconst_int32</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">make_const_int64</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L238" title="ocaml/middle_end/closure/closure.ml:238">make_const_ref</a></span> <span class="Statement">(</span><span class="Constant">Uconst_int64</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* The [fpc] parameter is true if constant propagation of<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; floating-point computations is allowed *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">simplif_arith_prim_pure</span> <span class="Statement">~</span><span class="Identifier">backend</span> <span class="ocamlLCIdentifier">fpc</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier">approxs</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">module</span><span class="PreProc"> B</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="ocamlModParam">(</span><span class="Statement">val </span><span class="ocamlLCIdentifier">backend</span><span class="ocamlModParam"> </span><span class="ocamlMPRestr">:</span><span class="ocamlModParam"> </span><span class="PreProc">Backend_intf.S</span><span class="ocamlModParam">)</span> <span class="Statement">in<br/></li>
<li><a id="L279">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><span class="linkable">open</span></span><span class="ocamlNone"> </span><span class="PreProc">Clambda_primitives</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="Statement">(</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span>, <span class="Constant">Value_unknown</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">approxs</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Comment">(* int (or enumerated type) *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pnot</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pnegint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlEnd">- </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Poffsetint</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd"> + </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pfloatofint</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fpc</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_float</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">float_of_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pbintofint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">of_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pbintofint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">of_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pbintofint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">of_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pbswap16</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(((</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">land</span><span class="ocamlEnd"> </span><span class="Constant">0xff</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">lsl</span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">lor</span><span class="ocamlEnd"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">land</span><span class="ocamlEnd"> </span><span class="Constant">0xff00</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">lsr</span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* int (or enumerated type), int (or enumerated type) *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Psequand</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Psequor</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">||</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Paddint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> + </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Psubint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> - </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmulint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">*</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pdivint</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> / </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmodint</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">mod</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pandint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">land</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Porint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">lor</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pxorint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">lxor</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Plslint</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="ocamlEnd"> </span><span class="Statement">*</span><span class="ocamlEnd"> </span><span class="PreProc">B</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">size_int</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">lsl</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Plsrint</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="ocamlEnd"> </span><span class="Statement">*</span><span class="ocamlEnd"> </span><span class="PreProc">B</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">size_int</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">lsr</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pasrint</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="ocamlEnd"> </span><span class="Statement">*</span><span class="ocamlEnd"> </span><span class="PreProc">B</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">size_int</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">asr</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pintcomp</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L244" title="ocaml/middle_end/closure/closure.ml:244">make_integer_comparison</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* float *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_float</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)))]</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">fpc</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pintoffloat</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">int_of_float</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pnegfloat</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_float</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlEnd">-. </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pabsfloat</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_float</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">abs_float</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* float, float *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_float</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)));<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_float</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)))]</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">fpc</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Paddfloat</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_float</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> +. </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Psubfloat</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_float</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> -. </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmulfloat</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_float</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="Statement">*</span><span class="ocamlEnd">. </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pdivfloat</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_float</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> /. </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pfloatcomp</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd">&nbsp; </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L255" title="ocaml/middle_end/closure/closure.ml:255">make_float_comparison</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* nativeint *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_nativeint</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)))]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pintofbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">to_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pcvtbint</span><span class="Statement">(</span><span class="Constant">Pnativeint</span><span class="ocamlEnd">, </span><span class="Constant">Pint32</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">to_int32</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pcvtbint</span><span class="Statement">(</span><span class="Constant">Pnativeint</span><span class="ocamlEnd">, </span><span class="Constant">Pint64</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">of_nativeint</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pnegbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">neg</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* nativeint, nativeint *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_nativeint</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)));<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_nativeint</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)))]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Paddbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Psubbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">sub</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmulbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">mul</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pdivbint</span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlLCIdentifier">size</span><span class="Statement">=</span><span class="Constant">Pnativeint</span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0n</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">div</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmodbint</span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlLCIdentifier">size</span><span class="Statement">=</span><span class="Constant">Pnativeint</span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0n</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">rem</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pandbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logand</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Porbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd">&nbsp; </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logor</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pxorbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logxor</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pbintcomp</span><span class="Statement">(</span><span class="Constant">Pnativeint</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">c</span><span class="Statement">)</span><span class="ocamlEnd">&nbsp; </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L244" title="ocaml/middle_end/closure/closure.ml:244">make_integer_comparison</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* nativeint, int *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_nativeint</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)));<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Plslbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="ocamlEnd"> </span><span class="Statement">*</span><span class="ocamlEnd"> </span><span class="PreProc">B</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">size_int</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_left</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Plsrbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="ocamlEnd"> </span><span class="Statement">*</span><span class="ocamlEnd"> </span><span class="PreProc">B</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">size_int</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_right_logical</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pasrbint</span><span class="ocamlEnd"> </span><span class="Constant">Pnativeint</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="ocamlEnd"> </span><span class="Statement">*</span><span class="ocamlEnd"> </span><span class="PreProc">B</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">size_int</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_right</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* int32 *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_int32</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)))]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pintofbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">to_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pcvtbint</span><span class="Statement">(</span><span class="Constant">Pint32</span><span class="ocamlEnd">, </span><span class="Constant">Pnativeint</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Nativeint</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">of_int32</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pcvtbint</span><span class="Statement">(</span><span class="Constant">Pint32</span><span class="ocamlEnd">, </span><span class="Constant">Pint64</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">of_int32</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pnegbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">neg</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* int32, int32 *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_int32</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)));<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_int32</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)))]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Paddbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Psubbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">sub</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmulbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">mul</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pdivbint</span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlLCIdentifier">size</span><span class="Statement">=</span><span class="Constant">Pint32</span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0l</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">div</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmodbint</span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlLCIdentifier">size</span><span class="Statement">=</span><span class="Constant">Pint32</span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0l</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">rem</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pandbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logand</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Porbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logor</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pxorbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logxor</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pbintcomp</span><span class="Statement">(</span><span class="Constant">Pint32</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">c</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L244" title="ocaml/middle_end/closure/closure.ml:244">make_integer_comparison</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* int32, int *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_int32</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)));<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Plslbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_left</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Plsrbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_right_logical</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pasrbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint32</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">32</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int32</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_right</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* int64 *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_int64</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)))]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pintofbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">to_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pcvtbint</span><span class="Statement">(</span><span class="Constant">Pint64</span><span class="ocamlEnd">, </span><span class="Constant">Pint32</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int32</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">to_int32</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pcvtbint</span><span class="Statement">(</span><span class="Constant">Pint64</span><span class="ocamlEnd">, </span><span class="Constant">Pnativeint</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_natint</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">to_nativeint</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pnegbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">neg</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* int64, int64 *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_int64</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)));<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_int64</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)))]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Paddbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Psubbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">sub</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmulbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">mul</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pdivbint</span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlLCIdentifier">size</span><span class="Statement">=</span><span class="Constant">Pint64</span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0L</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">div</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pmodbint</span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlLCIdentifier">size</span><span class="Statement">=</span><span class="Constant">Pint64</span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0L</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">rem</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pandbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logand</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Porbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logor</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pxorbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">logxor</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pbintcomp</span><span class="Statement">(</span><span class="Constant">Pint64</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">c</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L244" title="ocaml/middle_end/closure/closure.ml:244">make_integer_comparison</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* int64, int *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_int64</span> <span class="ocamlLCIdentifier">n1</span><span class="Statement">)));<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Plslbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_left</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Plsrbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_right_logical</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Pasrbint</span><span class="ocamlEnd"> </span><span class="Constant">Pint64</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="Constant">64</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">make_const_int64</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Int64</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">shift_right</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* </span><span class="Todo">TODO</span><span class="Comment">: Pbbswap *)<br/></li>
<li></span>&nbsp; <span class="Comment">(* Catch-all *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">default<br/></li>
<li></span><br/></li>
<li><a id="L457">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">field_approx</span></span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Value_tuple</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">&lt;</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">a</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Value_const</span> <span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_block</span><span class="Statement">(_</span>, <span class="ocamlLCIdentifier">l</span><span class="Statement">))))<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">when</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">&lt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">l</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Value_const</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">nth</span> <span class="ocamlLCIdentifier">l</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Value_unknown<br/></li>
<li></span><br/></li>
<li><a id="L464">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">simplif_prim_pure</span></span> <span class="Statement">~</span><span class="Identifier">backend</span> <span class="ocamlLCIdentifier">fpc</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier">approxs</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L279" title="ocaml/middle_end/closure/closure.ml:279">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Clambda_primitives</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier">approxs</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Comment">(* Block construction *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pmakeblock</span><span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span>, <span class="Constant">Immutable</span>, <span class="ocamlLCIdentifier">_kind</span><span class="Statement">)</span>, <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">field</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Value_const</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">raise</span> <span class="Constant">Exit<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">try<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Constant">Uconst_block</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span><span class="ocamlEnd">, </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">field</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">approxs</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">name</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Compilenv</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">new_structured_constant</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">shared</span><span class="ocamlEnd">:</span><span class="Constant">true<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/middle_end/closure/closure.ml:237">make_const</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">name</span><span class="ocamlEnd">, </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">with</span><span class="ocamlEnd"> </span><span class="Constant">Exit</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="Constant">Value_tuple</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Array</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">of_list</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">approxs</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* Field access *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pfield</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="Statement">_</span>, <span class="Statement">_)</span>, <span class="Statement">_</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span> <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_block</span><span class="Statement">(_</span>, <span class="ocamlLCIdentifier">l</span><span class="Statement">))))</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">when</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">&lt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">l</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/middle_end/closure/closure.ml:237">make_const</a></span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">nth</span> <span class="ocamlLCIdentifier">l</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pfield</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="Statement">_</span>, <span class="Statement">_)</span>, <span class="Statement">[</span> <span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span>.<span class="Constant">Pmakeblock</span> <span class="Statement">_</span>, <span class="ocamlLCIdentifier">ul</span>, <span class="Statement">_)</span> <span class="Statement">]</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier">approx</span><span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">when</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">&lt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">ul</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* This case is particularly useful for removing allocations<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for optional parameters *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">nth</span> <span class="ocamlLCIdentifier">ul</span> <span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier"><a href="#L457" title="ocaml/middle_end/closure/closure.ml:457">field_approx</a></span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Comment">(* Strings *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="Constant">Pstringlength</span> <span class="Statement">|</span> <span class="Constant">Pbyteslength</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp;&nbsp; <span class="Statement">_</span>,<br/></li>
<li>&nbsp; &nbsp;&nbsp; <span class="Statement">[</span> <span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="Statement">(_</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_string</span> <span class="ocamlLCIdentifier">s</span><span class="Statement">)))</span> <span class="Statement">]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span> <span class="Statement">(</span><span class="PreProc">String</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">s</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Comment">(* Kind test *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pisint</span>, <span class="Statement">[</span> <span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span>.<span class="Constant">Pmakeblock</span> <span class="Statement">_</span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">]</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* This case is particularly useful for removing allocations<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for optional parameters *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pisint</span>, <span class="Statement">_</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier">a1</span><span class="Statement">]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">a1</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_int</span><span class="ocamlEnd"> </span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span><span class="ocamlEnd"> </span><span class="Constant">true<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Value_const</span><span class="Statement">(</span><span class="Constant">Uconst_ref</span><span class="ocamlEnd"> </span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span><span class="ocamlEnd"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Value_closure</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Value_tuple</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span><span class="ocamlEnd"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* Catch-all *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">simplif_arith_prim_pure</span> <span class="Statement">~</span><span class="Identifier">backend</span> <span class="ocamlLCIdentifier">fpc</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier">approxs</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a><br/></li>
<li></span><br/></li>
<li><a id="L513">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">simplif_prim</span></span> <span class="Statement">~</span><span class="Identifier">backend</span> <span class="ocamlLCIdentifier">fpc</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier">approxs</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">args_approxs</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">for_all</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_pure</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">args<br/></li>
<li></span><span class="ocamlNone">&nbsp; </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/middle_end/closure/closure.ml:464">simplif_prim_pure</a></span> <span class="Statement">~</span><span class="Identifier">backend</span> <span class="ocamlLCIdentifier">fpc</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="ocamlLCIdentifier">args_approxs</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a><br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* </span><span class="Todo">XXX</span><span class="Comment"> : always return the same approxs as <a href="#L464" title="ocaml/middle_end/closure/closure.ml:464">simplif_prim_pure</a>? *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">approx</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">P</span>.<span class="Constant">Pmakeblock</span><span class="Statement">(_</span>, <span class="Constant">Immutable</span>, <span class="ocamlLCIdentifier">_kind</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Value_tuple</span> <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">of_list</span> <span class="ocamlLCIdentifier">approxs</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Value_unknown<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Substitute variables in a [ulambda] term (a body of an inlined function)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; and perform some more simplifications on integer primitives.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Also perform alpha-conversion on let-bound identifiers to avoid<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; clashes with locally-generated identifiers, and refresh raise counts<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; in order to avoid clashes with inlined code from other modules.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; The variables must not be assigned in the term.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; This is used to <a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a> &quot;trivial&quot; arguments for parameters<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; during inline expansion, and also for the translation of let rec<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; over functions. *)<br/></li>
<li></span><br/></li>
<li><a id="L537">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">approx_ulam</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Uconst</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">-&gt;</span> <span class="Constant">Value_const</span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Value_unknown<br/></li>
<li></span><br/></li>
<li><a id="L541">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">find_action</span></span> <span class="ocamlLCIdentifier">idxs</span> <span class="ocamlLCIdentifier">acts</span> <span class="ocamlLCIdentifier">tag</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">tag</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">tag</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">idxs</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">idx</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">idxs</span><span class="ocamlEnd">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">assert(</span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&lt;=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">idx</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">idx</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="PreProc">Array</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">acts</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">acts</span><span class="ocamlEnd">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">idx</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end</span> <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* Can this happen? *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">None<br/></li>
<li></span><br/></li>
<li><a id="L550">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">subst_debuginfo</span></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">debug</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">inline</span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a><br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a><br/></li>
<li></span><br/></li>
<li><a id="L556">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">substitute</span></span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">backend</span>, <span class="ocamlLCIdentifier">fpc</span><span class="Statement">)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">st</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Uvar</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">try</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">find</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">v</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="Statement">with</span><span class="ocamlEnd"> </span><span class="Constant">Not_found</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="ocamlEnd"> </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uconst</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Udirect_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier">lbl</span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L550" title="ocaml/middle_end/closure/closure.ml:550">subst_debuginfo</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Udirect_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier">lbl</span>, <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ugeneric_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1125" title="ocaml/middle_end/closure/closure.ml:1125">fn</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L550" title="ocaml/middle_end/closure/closure.ml:550">subst_debuginfo</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Ugeneric_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier"><a href="#L1125" title="ocaml/middle_end/closure/closure.ml:1125">fn</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uclosure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">defs</span>, <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Question: should we rename function labels as well?&nbsp; Otherwise,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; there is a risk that function labels are not globally unique.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; This should not happen in the current system because:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - Inlined function bodies contain no Uclosure nodes<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (cf. function [<a href="#L151" title="ocaml/middle_end/closure/closure.ml:151">lambda_smaller</a>])<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - When we <a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a> offsets for idents bound by let rec<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; in [<a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a>], case [Lletrec], we discard the original<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; let rec body and use only the substituted term. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Uclosure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">defs</span>, <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uoffset</span><span class="Statement">(</span><span class="ocamlLCIdentifier">u</span>, <span class="ocamlLCIdentifier">ofs</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Uoffset</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u</span>, <span class="ocamlLCIdentifier">ofs</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ulet</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span>, <span class="ocamlLCIdentifier">kind</span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>' <span class="Statement">=</span> <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">rename</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Ulet</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span>, <span class="ocamlLCIdentifier">kind</span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>', <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="Constant">Uvar</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>'<span class="Statement">))</span> <span class="ocamlLCIdentifier">sb</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uphantom_let</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L41" title="ocaml/middle_end/closure/closure.ml:41">no_phantom_lets</a></span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uletrec</span><span class="Statement">(</span><span class="ocamlLCIdentifier">bindings</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">bindings1</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">rhs</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">rename</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">rhs</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">bindings<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sb</span>' <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>', <span class="Statement">_)</span> <span class="ocamlLCIdentifier">s</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">(</span><span class="Constant">Uvar</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>'<span class="Statement">))</span> <span class="ocamlLCIdentifier">s</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">bindings1</span> <span class="ocamlLCIdentifier">sb<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Uletrec</span><span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>', <span class="ocamlLCIdentifier">rhs</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>', <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span>' <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">rhs</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">bindings1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span>' <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">body</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sargs</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">args</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L550" title="ocaml/middle_end/closure/closure.ml:550">subst_debuginfo</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">res</span>, <span class="Statement">_)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L513" title="ocaml/middle_end/closure/closure.ml:513">simplif_prim</a></span> <span class="Statement">~</span><span class="Identifier">backend</span> <span class="ocamlLCIdentifier">fpc</span> <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">sargs</span>, <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/middle_end/closure/closure.ml:537">approx_ulam</a></span> <span class="ocamlLCIdentifier">sargs</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">res<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>, <span class="ocamlLCIdentifier">sw</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sarg</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">action</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Unfortunately, we cannot easily deal with the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case of a constructed block (makeblock) bound to a local<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; identifier.&nbsp; This would require to keep track of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; local let bindings (at least their approximations)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; in this <a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a> function.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">sarg</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst</span> <span class="Statement">(</span><span class="Constant">Uconst_ref</span> <span class="Statement">(_</span>,&nbsp; <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Uconst_block</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span>, <span class="Statement">_))))</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L541" title="ocaml/middle_end/closure/closure.ml:541">find_action</a></span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">us_index_blocks</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">us_actions_blocks</span> <span class="ocamlLCIdentifier">tag<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst</span> <span class="Statement">(</span><span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">tag</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L541" title="ocaml/middle_end/closure/closure.ml:541">find_action</a></span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">us_index_consts</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">us_actions_consts</span> <span class="ocamlLCIdentifier">tag<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Uswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier">sarg</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sw</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">us_actions_consts</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Array</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sw</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">us_actions_consts</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">us_actions_blocks</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Array</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sw</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">us_actions_blocks</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">}</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ustringswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>,<span class="ocamlLCIdentifier">sw</span>,<span class="ocamlLCIdentifier">d</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Ustringswitch<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">s</span>,<span class="ocamlLCIdentifier">act</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">s</span>,<span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">act</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">sw</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">d</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ustaticfail</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">nfail</span>, <span class="ocamlLCIdentifier">args</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">nfail</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">rn</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">rn</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">try<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Int</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">find</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">nfail</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">with</span><span class="ocamlEnd"> </span><span class="Constant">Not_found</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">fatal_errorf</span><span class="ocamlEnd"> </span><span class="Constant">&quot;Closure.<a href="#L46" title="ocaml/middle_end/closure/closure.ml:46">split_list</a>: invalid nfail (%d)&quot;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">nfail<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">nfail</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Ustaticfail</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">nfail</span>, <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">args</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ucatch</span><span class="Statement">(</span><span class="ocamlLCIdentifier">nfail</span>, <span class="ocamlLCIdentifier">ids</span>, <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">nfail</span>, <span class="ocamlLCIdentifier">rn</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">rn</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">rn</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">new_nfail</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">next_raise_count</span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">new_nfail</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="PreProc">Int</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">nfail</span> <span class="ocamlLCIdentifier">new_nfail</span> <span class="ocamlLCIdentifier">rn</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">nfail</span>, <span class="ocamlLCIdentifier">rn</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ids</span>' <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">k</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">rename</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">k</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">ids</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sb</span>' <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right2<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="Statement">_)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>', <span class="Statement">_)</span> <span class="ocamlLCIdentifier">s</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="Constant">Uvar</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>'<span class="Statement">))</span> <span class="ocamlLCIdentifier">s<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ids</span> <span class="ocamlLCIdentifier">ids</span>' <span class="ocamlLCIdentifier">sb<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Ucatch</span><span class="Statement">(</span><span class="ocamlLCIdentifier">nfail</span>, <span class="ocamlLCIdentifier">ids</span>', <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span>' <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Utrywith</span><span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>' <span class="Statement">=</span> <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">rename</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Utrywith</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>',<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="Constant">Uvar</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>'<span class="Statement">))</span> <span class="ocamlLCIdentifier">sb</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uifthenelse</span><span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span>, <span class="ocamlLCIdentifier">u3</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u1</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Uconst</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Uconst_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u2<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u3<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">su1</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Uifthenelse</span><span class="Statement">(</span><span class="ocamlLCIdentifier">su1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u2</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rn</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u3</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Usequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Usequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uwhile</span><span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Uwhile</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ufor</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span>, <span class="ocamlLCIdentifier">dir</span>, <span class="ocamlLCIdentifier">u3</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>' <span class="Statement">=</span> <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">rename</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Ufor</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>', <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u2</span>, <span class="ocamlLCIdentifier">dir</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="Constant">Uvar</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>'<span class="Statement">))</span> <span class="ocamlLCIdentifier">sb</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u3</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uassign</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">u</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>' <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="ocamlLCIdentifier">sb</span> <span class="Statement">with</span> <span class="Constant">Uvar</span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">with</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Uassign</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>', <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Usend</span><span class="Statement">(</span><span class="ocamlLCIdentifier">k</span>, <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span>, <span class="ocamlLCIdentifier">ul</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L550" title="ocaml/middle_end/closure/closure.ml:550">subst_debuginfo</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Usend</span><span class="Statement">(</span><span class="ocamlLCIdentifier">k</span>, <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span> <span class="ocamlLCIdentifier">u2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">st</span> <span class="ocamlLCIdentifier">sb</span> <span class="ocamlLCIdentifier">rn</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">ul</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uunreachable</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Uunreachable<br/></li>
<li></span><br/></li>
<li><a id="L706">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">env</span></span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">backend</span> : <span class="Statement">(module</span><span class="PreProc"> Backend_intf</span><span class="ocamlPreDef">.</span><span class="PreProc">S</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">cenv</span> : <span class="ocamlLCIdentifier">ulambda</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">t</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span> : <span class="ocamlLCIdentifier">value_approximation</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">t</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">mutable_vars</span> : <span class="PreProc">V</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">t</span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Perform an inline expansion:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; If [f <a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a> = body], <a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a> [f a] by [let <a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a> = a in body].<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Under certain conditions, further simplifications are possible (we use the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; terminology of [Semantics_of_primitives], applied to terms of the Clambda<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; language):<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; - [f a] is equivalent to [body[a/<a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a>]] if [a] has no effects and no coeffects.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; However, we only want to do this rewriting if [body[a/<a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a>]] does not increase<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; the size of [body]. Since this is hard to decide in general, as an<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; approximation, only consider the case when [a] is an immutable variable or<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; a constant.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; - [f a] is equivalent to [body] if [<a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a>] does not occur in [body] and [a] has<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; only generative effects.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; - In general [f a] is equivalent to [a; body] if [<a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a>] does not occur in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; [body].<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Approximates &quot;no effects and no coeffects&quot; *)<br/></li>
<li></span><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">is_substituable</span> <span class="Statement">~</span><span class="Identifier">mutable_vars</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uvar</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">-&gt;</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="PreProc">V</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">mem</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">mutable_vars</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uconst</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uoffset</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">is_substituable</span> <span class="Statement">~</span><span class="Identifier">mutable_vars</span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Approximates &quot;only generative effects&quot; *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">is_erasable</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Uclosure</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">u</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">is_pure</span> <span class="ocamlLCIdentifier">u<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">bind_params</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">mutable_vars</span><span class="Statement">;</span> <span class="Statement">_</span> <span class="Statement">}</span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">fdesc</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> <span class="ocamlLCIdentifier">args</span> <span class="ocamlLCIdentifier">funct</span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fpc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">fdesc</span>.<span class="ocamlLCIdentifier">fun_float_const_prop</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">aux</span> <span class="ocamlLCIdentifier">subst</span> <span class="ocamlLCIdentifier">pl</span> <span class="ocamlLCIdentifier">al</span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pl</span>, <span class="ocamlLCIdentifier">al</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">[]</span>, <span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span> <span class="Statement">(</span><span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">backend</span>, <span class="ocamlLCIdentifier">fpc</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">subst</span> <span class="Statement">(</span><span class="Constant">Some</span> <span class="PreProc">Int</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">empty</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">pl</span>, <span class="ocamlLCIdentifier">a1</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">al</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_substituable</span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier">mutable_vars</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">a1</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">aux</span> <span class="Statement">(</span><span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">var</span> <span class="ocamlLCIdentifier">p1</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">a1</span> <span class="ocamlLCIdentifier">subst</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pl</span> <span class="ocamlLCIdentifier">al</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlEnd">' </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">rename</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">u2</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">name</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">a1</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">&quot;*opt*&quot;</span><span class="ocamlEnd">, </span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span><span class="ocamlEnd">.</span><span class="Constant">Pmakeblock</span><span class="Statement">(</span><span class="Constant">0</span><span class="ocamlEnd">, </span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">kind</span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="Statement">[</span><span class="ocamlLCIdentifier">a</span><span class="Statement">]</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* This parameter corresponds to an optional parameter,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; and although it is used twice pushing the expression down<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; actually allows us to remove the allocation as it will<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; appear once under a Pisint primitive and once under a Pfield<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; primitive (see [<a href="#L464" title="ocaml/middle_end/closure/closure.ml:464">simplif_prim_pure</a>]) *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">a</span><span class="ocamlEnd">, </span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span><span class="ocamlEnd">.</span><span class="Constant">Pmakeblock</span><span class="Statement">(</span><span class="Constant">0</span><span class="ocamlEnd">, </span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">kind</span><span class="Statement">)</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">[</span><span class="Constant">Uvar</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">var</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlEnd">'</span><span class="Statement">)]</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">a1</span><span class="ocamlEnd">, </span><span class="Constant">Uvar</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">var</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlEnd">'</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd">' </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">aux</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">var</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">p1</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u2</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">subst</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pl</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">al</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L71" title="ocaml/middle_end/closure/closure.ml:71">occurs_var</a></span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">VP</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">var</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p1</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Ulet</span><span class="Statement">(</span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="Constant">Pgenval</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlEnd">', </span><span class="ocamlLCIdentifier">u1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd">'</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_erasable</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">a1</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd">'<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Constant">Usequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier">a1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd">'</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Reverse parameters and arguments to preserve right-to-left<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; evaluation order (PR#2910). *)<br/></li>
<li><a id="L780">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">params</span></span>, <span class="ocamlLCIdentifier">args</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier"><span class="linkable">params</span></span>, <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier">args</span> <span class="Statement">in<br/></li>
<li><a id="L781">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">params</span></span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier">body</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* Ensure funct is evaluated after args *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">my_closure</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> <span class="Statement">when</span> <span class="Statement">not</span> <span class="ocamlLCIdentifier">fdesc</span>.<span class="ocamlLCIdentifier">fun_closed</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> @ <span class="Statement">[</span><span class="ocamlLCIdentifier">my_closure</span><span class="Statement">])</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">args</span> @ <span class="Statement">[</span><span class="ocamlLCIdentifier">funct</span><span class="Statement">])</span>, <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_pure</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">funct</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">else</span> <span class="Constant">Usequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">funct</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">))<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">aux</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">empty</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> <span class="ocamlLCIdentifier">args</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span><br/></li>
<li><a id="L791">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">warning_if_forced_inline</span></span> <span class="Statement">~</span><span class="Identifier">loc</span> <span class="Statement">~</span><span class="Identifier">attribute</span> <span class="ocamlLCIdentifier">warning</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">attribute</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">Always_inline</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">prerr_warning</span> <span class="Statement">(</span><span class="PreProc">Debuginfo</span>.<span class="PreProc">Scoped_location</span>.<span class="ocamlLCIdentifier">to_location</span> <span class="ocamlLCIdentifier">loc</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Warnings</span>.<span class="Constant">Inlining_impossible</span> <span class="ocamlLCIdentifier">warning</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Generate a direct application *)<br/></li>
<li></span><br/></li>
<li><a id="L798">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">direct_apply</span></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">fundesc</span> <span class="ocamlLCIdentifier">ufunct</span> <span class="ocamlLCIdentifier">uargs</span> <span class="Statement">~</span><span class="Identifier">loc</span> <span class="Statement">~</span><span class="Identifier">attribute</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">fundesc</span>.<span class="ocamlLCIdentifier">fun_inline</span>, <span class="ocamlLCIdentifier">attribute</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">Never_inline<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=</span> <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L791" title="ocaml/middle_end/closure/closure.ml:791">warning_if_forced_inline</a></span> <span class="Statement">~</span><span class="Identifier">loc</span> <span class="Statement">~</span><span class="Identifier">attribute<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;Function information unavailable&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">fun_closed</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_pure</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Udirect_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span>.<span class="ocamlLCIdentifier">fun_label</span>, <span class="ocamlLCIdentifier">uargs</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">fun_closed</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">is_substituable</span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier">mutable_vars</span><span class="ocamlNone">:</span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mutable_vars</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Udirect_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span>.<span class="ocamlLCIdentifier">fun_label</span>, <span class="ocamlLCIdentifier">uargs</span> @ <span class="Statement">[</span><span class="ocamlLCIdentifier">ufunct</span><span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_substituable</span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier">mutable_vars</span><span class="ocamlNone">:</span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mutable_vars</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">None</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create_local</span><span class="ocamlEnd"> </span><span class="Constant">&quot;<a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a>&quot;</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="Constant">Uvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">uargs</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">app_args</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">snd</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fold_left</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L936" title="ocaml/middle_end/closure/closure.ml:936">app</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">binding</span><span class="ocamlEnd">,</span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">binding</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L936" title="ocaml/middle_end/closure/closure.ml:936">app</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">v</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">e</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">Ulet</span><span class="Statement">(</span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="Constant">Pgenval</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">v</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">e</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L936" title="ocaml/middle_end/closure/closure.ml:936">app</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">fun_closed</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Usequence</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">, </span><span class="Constant">Udirect_apply</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_label</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">app_args</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create_local</span><span class="ocamlEnd"> </span><span class="Constant">&quot;<a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a>&quot;</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Ulet</span><span class="Statement">(</span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="Constant">Pgenval</span><span class="ocamlEnd">, </span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">Udirect_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_label</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">app_args</span><span class="ocamlEnd"> @ </span><span class="Statement">[</span><span class="Constant">Uvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span><span class="Statement">]</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">args<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span>, <span class="Statement">_</span>&nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">bind_params</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">loc</span> <span class="ocamlLCIdentifier">fundesc</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> <span class="ocamlLCIdentifier">uargs</span> <span class="ocamlLCIdentifier">ufunct</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Add [Value_integer] info to the approximation of an application *)<br/></li>
<li></span><br/></li>
<li><a id="L835">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">strengthen_approx</span></span> <span class="ocamlLCIdentifier">appl</span> <span class="ocamlLCIdentifier">approx</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/middle_end/closure/closure.ml:537">approx_ulam</a></span> <span class="ocamlLCIdentifier">appl</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Value_const</span> <span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">intapprox</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">intapprox<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">approx<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* If a term has approximation Value_integer and is pure,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; replace it by an integer constant *)<br/></li>
<li></span><br/></li>
<li><a id="L844">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">check_constant_result</span></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">approx</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">approx</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Value_const</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">is_pure</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/middle_end/closure/closure.ml:237">make_const</a></span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Value_global_field</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">i</span><span class="Statement">)</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">is_pure</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span><span class="ocamlEnd">.</span><span class="Constant">Pfield</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd">, </span><span class="Statement">[</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span><span class="ocamlEnd">.</span><span class="Constant">Pread_symbol</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd">, </span><span class="Statement">_</span><span class="ocamlEnd">, </span><span class="Statement">_)]</span><span class="ocamlEnd">, </span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">glb</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span><span class="ocamlEnd">.</span><span class="Constant">Pread_symbol</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="Constant">[]</span><span class="ocamlEnd">, </span><span class="PreProc">Debuginfo</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">none</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span><span class="ocamlEnd">.</span><span class="Constant">Pfield</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlEnd">, </span><span class="Constant">Pointer</span><span class="ocamlEnd">, </span><span class="Constant">Immutable</span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="Statement">[</span><span class="ocamlLCIdentifier">glb</span><span class="Statement">]</span><span class="ocamlEnd">, </span><span class="PreProc">Debuginfo</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">none</span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Evaluate an expression with known value for its side effects only,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; or discard it if it's pure *)<br/></li>
<li></span><br/></li>
<li><a id="L861">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">sequence_constant_expr</span></span> <span class="ocamlLCIdentifier"><a href="#L1192" title="ocaml/middle_end/closure/closure.ml:1192">ulam1</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1193" title="ocaml/middle_end/closure/closure.ml:1193">ulam2</a></span>, <span class="ocamlLCIdentifier">approx2</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">res2</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_pure</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1192" title="ocaml/middle_end/closure/closure.ml:1192">ulam1</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">res2</span> <span class="Statement">else</span> <span class="Statement">(</span><span class="Constant">Usequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1192" title="ocaml/middle_end/closure/closure.ml:1192">ulam1</a></span>, <span class="ocamlLCIdentifier"><a href="#L1193" title="ocaml/middle_end/closure/closure.ml:1193">ulam2</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">approx2</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Maintain the approximation of the global structure being defined *)<br/></li>
<li></span><br/></li>
<li><a id="L866">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">global_approx</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span><span class="Statement">([||]</span> : <span class="ocamlLCIdentifier">value_approximation</span> <span class="Type">array</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Maintain the nesting depth for functions *)<br/></li>
<li></span><br/></li>
<li><a id="L870">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">function_nesting_depth</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0<br/></li>
<li><a id="L871">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">excessive_function_nesting_depth</span></span> <span class="Statement">=</span> <span class="Constant">5<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Uncurry an expression and explicitate closures.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Also return the approximation of the expression.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; The approximation environment [<a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a>] maps idents to approximations.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Idents not bound in [<a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a>] approximate to [Value_unknown].<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; The closure environment [cenv] maps idents to [ulambda] terms.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; It is used to <a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a> environment accesses for free identifiers. *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">NotClosed<br/></li>
<li></span><br/></li>
<li><a id="L882">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">close_approx_var</span></span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cenv</span> <span class="Statement">}</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">approx</span> <span class="Statement">=</span> <span class="Statement">try</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span> <span class="Statement">with</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;</span> <span class="Constant">Value_unknown</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">approx</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Value_const</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/middle_end/closure/closure.ml:237">make_const</a></span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">approx</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">subst</span> <span class="Statement">=</span> <span class="Statement">try</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="ocamlLCIdentifier">cenv</span> <span class="Statement">with</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;</span> <span class="Constant">Uvar</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">subst</span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L890">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">close_var</span></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span>, <span class="ocamlLCIdentifier">_app</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L882" title="ocaml/middle_end/closure/closure.ml:882">close_approx_var</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">in</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a><br/></li>
<li></span><br/></li>
<li><a id="L893">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">close</span></span> <span class="Statement">({</span> <span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cenv</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">mutable_vars</span> <span class="Statement">}</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">module</span><span class="PreProc"> B</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="ocamlModParam">(</span><span class="Statement">val </span><span class="ocamlLCIdentifier">backend</span><span class="ocamlModParam"> </span><span class="ocamlMPRestr">:</span><span class="ocamlModParam"> </span><span class="PreProc">Backend_intf.S</span><span class="ocamlModParam">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L882" title="ocaml/middle_end/closure/closure.ml:882">close_approx_var</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lmutvar</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">Uvar</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lconst</span> <span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span> <span class="Statement">-&gt;<br/></li>
<li><a id="L900">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">str</span></span> <span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">name</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">new_structured_constant</span> <span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span> <span class="Statement">~</span><span class="Identifier">shared</span>:<span class="Constant">true<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Uconst_ref</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">name</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li><a id="L906">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">transl</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Uconst_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_char</span> <span class="ocamlLCIdentifier">c</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Uconst_int</span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">code</span> <span class="ocamlLCIdentifier">c</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_block</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span>, <span class="ocamlLCIdentifier">fields</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span> <span class="Statement">(</span><span class="Constant">Uconst_block</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span>, <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="ocamlLCIdentifier"><a href="#L906" title="ocaml/middle_end/closure/closure.ml:906">transl</a></span> <span class="ocamlLCIdentifier">fields</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_float_array</span> <span class="ocamlLCIdentifier">sl</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* constant float arrays are really immutable *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span> <span class="Statement">(</span><span class="Constant">Uconst_float_array</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="ocamlLCIdentifier">float_of_string</span> <span class="ocamlLCIdentifier">sl</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_immstring</span> <span class="ocamlLCIdentifier">s</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span> <span class="Statement">(</span><span class="Constant">Uconst_string</span> <span class="ocamlLCIdentifier">s</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span> <span class="Statement">(</span><span class="Constant">Const_string</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">s</span>, <span class="Statement">_</span>, <span class="Statement">_))</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span> <span class="Statement">(</span><span class="Constant">Uconst_string</span> <span class="ocamlLCIdentifier">s</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_float</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span> <span class="Statement">(</span><span class="Constant">Uconst_float</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">float_of_string</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_int32</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span> <span class="Statement">(</span><span class="Constant">Uconst_int32</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_int64</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span> <span class="Statement">(</span><span class="Constant">Uconst_int64</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_nativeint</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span> <span class="Statement">(</span><span class="Constant">Uconst_nativeint</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/middle_end/closure/closure.ml:237">make_const</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L906" title="ocaml/middle_end/closure/closure.ml:906">transl</a></span> <span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lfunction</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">funct</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1385" title="ocaml/middle_end/closure/closure.ml:1385">close_one_function</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="Statement">(</span><span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;fun&quot;</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">funct<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">(* We convert [f a] to [let a' = a in let f' = f in fun b c -&gt; f' a' b c]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; when fun_arity &gt; <a href="#L931" title="ocaml/middle_end/closure/closure.ml:931">nargs</a> *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lapply</span><span class="Statement">{</span><span class="ocamlLCIdentifier">ap_func</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">funct</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">ap_args</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">args</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">ap_loc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">loc</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_inlined</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">attribute</span><span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L931">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">nargs</span></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">args</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">funct</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1212" title="ocaml/middle_end/closure/closure.ml:1212">close_list</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">((</span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">, </span><span class="Constant">Value_closure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx_res</span><span class="Statement">))</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">[</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span><span class="ocamlEnd">.</span><span class="Constant">Pmakeblock</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">uargs</span><span class="ocamlEnd">, </span><span class="Statement">_)])<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">uargs</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> - </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_arity</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li><a id="L936">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">app</span></span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L798" title="ocaml/middle_end/closure/closure.ml:798">direct_apply</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">loc</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">attribute</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">uargs</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L936" title="ocaml/middle_end/closure/closure.ml:936">app</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L835" title="ocaml/middle_end/closure/closure.ml:835">strengthen_approx</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L936" title="ocaml/middle_end/closure/closure.ml:936">app</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">approx_res</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">, </span><span class="Constant">Value_closure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx_res</span><span class="Statement">))</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">uargs</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L931" title="ocaml/middle_end/closure/closure.ml:931">nargs</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_arity</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li><a id="L941">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">app</span></span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L798" title="ocaml/middle_end/closure/closure.ml:798">direct_apply</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">loc</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">attribute</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">uargs</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L936" title="ocaml/middle_end/closure/closure.ml:936">app</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L835" title="ocaml/middle_end/closure/closure.ml:835">strengthen_approx</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L936" title="ocaml/middle_end/closure/closure.ml:936">app</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">approx_res</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">, </span><span class="Statement">(</span><span class="Constant">Value_closure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">, </span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">as</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fapprox</span><span class="Statement">))</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">uargs</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L931" title="ocaml/middle_end/closure/closure.ml:931">nargs</a></span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_arity</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li><a id="L947">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">first_args</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create_local</span><span class="ocamlEnd"> </span><span class="Constant">&quot;<a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a>&quot;</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">uargs</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L949">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">final_args</span></span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Array</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">to_list</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Array</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">init</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_arity</span><span class="ocamlEnd"> - </span><span class="ocamlLCIdentifier"><a href="#L931" title="ocaml/middle_end/closure/closure.ml:931">nargs</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create_local</span><span class="ocamlEnd"> </span><span class="Constant">&quot;<a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a>&quot;</span><span class="Statement">))</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L952">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">rec</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">iter</span></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">arg1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">arg2</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Ulet</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="Constant">Pgenval</span><span class="ocamlEnd">, </span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">arg1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">arg2</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">body</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li><a id="L959">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">internal_args</span></span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">arg1</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">_arg2</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">Lvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">arg1</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L947" title="ocaml/middle_end/closure/closure.ml:947">first_args</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @ </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">Lvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="ocamlEnd"> </span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L949" title="ocaml/middle_end/closure/closure.ml:949">final_args</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li><a id="L963">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">funct_var</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create_local</span><span class="ocamlEnd"> </span><span class="Constant">&quot;funct&quot;</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L964">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">fenv</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L963" title="ocaml/middle_end/closure/closure.ml:963">funct_var</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fapprox</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">fenv</span></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L965">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">new_fun</span></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cenv</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mutable_vars</span><span class="ocamlEnd"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lfunction<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">~</span><span class="Identifier">kind</span><span class="ocamlEnd">:</span><span class="Constant">Curried<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">~</span><span class="Identifier">return</span><span class="ocamlEnd">:</span><span class="Constant">Pgenval<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">~</span><span class="Identifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span><span class="ocamlEnd">:</span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">v</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">v</span><span class="ocamlEnd">, </span><span class="Constant">Pgenval</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L949" title="ocaml/middle_end/closure/closure.ml:949">final_args</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">~</span><span class="Identifier">body</span><span class="ocamlEnd">:</span><span class="Statement">(</span><span class="Constant">Lapply</span><span class="Statement">{<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">ap_loc</span><span class="Statement">=</span><span class="ocamlLCIdentifier">loc</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">ap_func</span><span class="Statement">=(</span><span class="Constant">Lvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L963" title="ocaml/middle_end/closure/closure.ml:963">funct_var</a></span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">ap_args</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="#L959" title="ocaml/middle_end/closure/closure.ml:959">internal_args</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">ap_tailcall</span><span class="Statement">=</span><span class="Constant">Default_tailcall</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">ap_inlined</span><span class="Statement">=</span><span class="Constant">Default_inline</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">ap_specialised</span><span class="Statement">=</span><span class="Constant">Default_specialise</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">})<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">~</span><span class="Identifier">loc<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">~</span><span class="Identifier">attr</span><span class="ocamlEnd">:</span><span class="ocamlLCIdentifier">default_function_attribute</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L965" title="ocaml/middle_end/closure/closure.ml:965">new_fun</a></span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L947" title="ocaml/middle_end/closure/closure.ml:947">first_args</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Ulet</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="Constant">Pgenval</span><span class="ocamlEnd">, </span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L963" title="ocaml/middle_end/closure/closure.ml:963">funct_var</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L965" title="ocaml/middle_end/closure/closure.ml:965">new_fun</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L791" title="ocaml/middle_end/closure/closure.ml:791">warning_if_forced_inline</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">loc</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">attribute</span><span class="ocamlEnd"> </span><span class="Constant">&quot;Partial application&quot;</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L965" title="ocaml/middle_end/closure/closure.ml:965">new_fun</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">, </span><span class="Constant">Value_closure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">_approx_res</span><span class="Statement">))</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">uargs</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_arity</span><span class="ocamlEnd"> </span><span class="Statement">&gt;</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L931" title="ocaml/middle_end/closure/closure.ml:931">nargs</a></span><span class="ocamlEnd"> </span><span class="Statement">&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_arity</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create_local</span><span class="ocamlEnd"> </span><span class="Constant">&quot;<a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a>&quot;</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">uargs</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L947" title="ocaml/middle_end/closure/closure.ml:947">first_args</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">rem_args</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L46" title="ocaml/middle_end/closure/closure.ml:46">split_list</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_arity</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">args</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L947" title="ocaml/middle_end/closure/closure.ml:947">first_args</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">Uvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L947" title="ocaml/middle_end/closure/closure.ml:947">first_args</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem_args</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">Uvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem_args</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Debuginfo</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">from_location</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L791" title="ocaml/middle_end/closure/closure.ml:791">warning_if_forced_inline</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">loc</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">attribute</span><span class="ocamlEnd"> </span><span class="Constant">&quot;Over-application&quot;</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Ugeneric_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L798" title="ocaml/middle_end/closure/closure.ml:798">direct_apply</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">loc</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">attribute<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L947" title="ocaml/middle_end/closure/closure.ml:947">first_args</a></span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">rem_args</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">result</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fold_left</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">defining_expr</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Ulet</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="Constant">Pgenval</span><span class="ocamlEnd">, </span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">defining_expr</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">body</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">body<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">args<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">result</span><span class="ocamlEnd">, </span><span class="Constant">Value_unknown<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">, </span><span class="Statement">_)</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">uargs</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Debuginfo</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">from_location</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">loc</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L791" title="ocaml/middle_end/closure/closure.ml:791">warning_if_forced_inline</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">loc</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">attribute</span><span class="ocamlEnd"> </span><span class="Constant">&quot;Unknown function&quot;</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Ugeneric_apply</span><span class="Statement">(</span><span class="ocamlLCIdentifier">ufunct</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">uargs</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lsend</span><span class="Statement">(</span><span class="ocamlLCIdentifier">kind</span>, <span class="ocamlLCIdentifier">met</span>, <span class="ocamlLCIdentifier">obj</span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier">loc</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1014">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">umet</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">met</span> <span class="Statement">in<br/></li>
<li><a id="L1015">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">uobj</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">obj</span> <span class="Statement">in<br/></li>
<li><a id="L1016">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dbg</span></span> <span class="Statement">=</span> <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Usend</span><span class="Statement">(</span><span class="ocamlLCIdentifier">kind</span>, <span class="ocamlLCIdentifier"><a href="#L1014" title="ocaml/middle_end/closure/closure.ml:1014">umet</a></span>, <span class="ocamlLCIdentifier"><a href="#L1015" title="ocaml/middle_end/closure/closure.ml:1015">uobj</a></span>, <span class="ocamlLCIdentifier"><a href="#L1212" title="ocaml/middle_end/closure/closure.ml:1212">close_list</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Llet</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span>, <span class="ocamlLCIdentifier">kind</span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">lam</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1020">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulam</span></span>, <span class="ocamlLCIdentifier">alam</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">close_named</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">alam</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Value_const</span><span class="ocamlEnd"> </span><span class="Statement">_<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/middle_end/closure/closure.ml:900">str</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Constant">Alias</span><span class="ocamlEnd"> </span><span class="Statement">||</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">is_pure</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">alam</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">);</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cenv</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mutable_vars</span><span class="ocamlEnd"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">body<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li><a id="L1027">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ubody</span></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">abody</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">{</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">alam</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">);</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cenv</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mutable_vars</span><span class="ocamlEnd"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">body<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">(</span><span class="Constant">Ulet</span><span class="Statement">(</span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">kind</span><span class="ocamlEnd">, </span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">abody</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lmutlet</span><span class="Statement">(</span><span class="ocamlLCIdentifier">kind</span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">lam</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1035">&#x200c;</a></span>&nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulam</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">close_named</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li><a id="L1036">&#x200c;</a></span>&nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">env</span></span> <span class="Statement">=</span> <span class="Statement">{</span><span class="ocamlLCIdentifier"><span class="linkable">env</span></span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">mutable_vars</span> <span class="Statement">=</span> <span class="PreProc">V</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="ocamlLCIdentifier"><span class="linkable">env</span></span>.<span class="ocamlLCIdentifier">mutable_vars</span><span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span>, <span class="ocamlLCIdentifier">abody</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="Constant">Ulet</span><span class="Statement">(</span><span class="Constant">Mutable</span>, <span class="ocamlLCIdentifier">kind</span>, <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">create</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span>, <span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">abody</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lletrec</span><span class="Statement">(</span><span class="ocamlLCIdentifier">defs</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">for_all<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">(function</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">_id</span><span class="ocamlNone">, </span><span class="Constant">Lfunction</span><span class="ocamlNone"> </span><span class="Statement">_)</span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="Constant">true</span><span class="ocamlNone"> </span><span class="Statement">|</span><span class="ocamlNone"> </span><span class="Statement">_</span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">defs<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* Simple case: only function definitions *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">infos</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">close_functions</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">defs</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">clos_ident</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create_local</span><span class="ocamlEnd"> </span><span class="Constant">&quot;<a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a>&quot;</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fenv_body</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">_pos</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">approx</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">infos</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fenv_body</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cenv</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mutable_vars</span><span class="ocamlEnd"> </span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">_approx</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Uoffset</span><span class="Statement">(</span><span class="Constant">Uvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">clos_ident</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">pos</span><span class="Statement">))</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">infos</span><span class="ocamlEnd"> </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">empty</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Ulet</span><span class="Statement">(</span><span class="Constant">Immutable</span><span class="ocamlEnd">, </span><span class="Constant">Pgenval</span><span class="ocamlEnd">, </span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">clos_ident</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/middle_end/closure/closure.ml:556">substitute</a></span><span class="ocamlEnd"> </span><span class="PreProc">Debuginfo</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">none</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">backend</span><span class="ocamlEnd">, </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">float_const_prop</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sb<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="Statement">)</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* General case: recursive definition of values *)<br/></li>
<li><a id="L1064">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">rec</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">clos_defs</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">[]</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">lam</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1070" title="ocaml/middle_end/closure/closure.ml:1070">udefs</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">fenv_body</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1064" title="ocaml/middle_end/closure/closure.ml:1064">clos_defs</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">close_named</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">lam</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">((</span><span class="PreProc">VP</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">create</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1070" title="ocaml/middle_end/closure/closure.ml:1070">udefs</a></span><span class="ocamlEnd">, </span><span class="PreProc">V</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">approx</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fenv_body</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L1070">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">udefs</span></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">fenv_body</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1064" title="ocaml/middle_end/closure/closure.ml:1064">clos_defs</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">defs</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L1071">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ubody</span></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fenv_body</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cenv</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mutable_vars</span><span class="ocamlEnd"> </span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">body</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Uletrec</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1070" title="ocaml/middle_end/closure/closure.ml:1070">udefs</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Comment">(* Compile-time constants *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span><span class="Statement">(</span><span class="Constant">Pctconst</span> <span class="ocamlLCIdentifier">c</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="Statement">]</span>, <span class="ocamlLCIdentifier">_loc</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1077">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">cst</span></span>, <span class="ocamlLCIdentifier">approx</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Big_endian</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span> <span class="PreProc">B</span>.<span class="ocamlLCIdentifier">big_endian<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Word_size</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span> <span class="Statement">(</span><span class="Constant">8</span><span class="Statement">*</span><span class="PreProc">B</span>.<span class="ocamlLCIdentifier">size_int</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Int_size</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span> <span class="Statement">(</span><span class="Constant">8</span><span class="Statement">*</span><span class="PreProc">B</span>.<span class="ocamlLCIdentifier">size_int</span> - <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Max_wosize</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span> <span class="Statement">((</span><span class="Constant">1</span> <span class="Statement">lsl</span> <span class="Statement">((</span><span class="Constant">8</span><span class="Statement">*</span><span class="PreProc">B</span>.<span class="ocamlLCIdentifier">size_int</span><span class="Statement">)</span> - <span class="Constant">10</span><span class="Statement">))</span> - <span class="Constant">1</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ostype_unix</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span> <span class="Statement">(</span><span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">os_type</span> <span class="Statement">=</span> <span class="Constant">&quot;Unix&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ostype_win32</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span> <span class="Statement">(</span><span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">os_type</span> <span class="Statement">=</span> <span class="Constant">&quot;Win32&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ostype_cygwin</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L242" title="ocaml/middle_end/closure/closure.ml:242">make_const_bool</a></span> <span class="Statement">(</span><span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">os_type</span> <span class="Statement">=</span> <span class="Constant">&quot;Cygwin&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Backend_type</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span> <span class="Constant">0</span> <span class="Comment">(* tag 0 is the same as Native here *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li><a id="L1089">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">arg</span></span>, <span class="ocamlLCIdentifier">_approx</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><span class="linkable">arg</span></span> <span class="Statement">in<br/></li>
<li><a id="L1090">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">id</span></span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;dummy&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Ulet</span><span class="Statement">(</span><span class="Constant">Immutable</span>, <span class="Constant">Pgenval</span>, <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">create</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>, <span class="ocamlLCIdentifier"><a href="#L1077" title="ocaml/middle_end/closure/closure.ml:1077">cst</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">approx<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span><span class="Statement">(</span><span class="Constant">Pignore</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="Statement">]</span>, <span class="ocamlLCIdentifier">_loc</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1093">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">expr</span></span>, <span class="ocamlLCIdentifier">approx</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/middle_end/closure/closure.ml:241">make_const_int</a></span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Usequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fst</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L1093" title="ocaml/middle_end/closure/closure.ml:1093">expr</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">approx<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span><span class="Statement">((</span><span class="Constant">Pbytes_to_string</span> <span class="Statement">|</span> <span class="Constant">Pbytes_of_string</span><span class="Statement">)</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="Statement">]</span>, <span class="ocamlLCIdentifier">_loc</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span><span class="Statement">(</span><span class="Constant">Pgetglobal</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="Constant">[]</span>, <span class="ocamlLCIdentifier">loc</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1098">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dbg</span></span> <span class="Statement">=</span> <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L844" title="ocaml/middle_end/closure/closure.ml:844">check_constant_result</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L66" title="ocaml/middle_end/closure/closure.ml:66">getglobal</a></span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier"><a href="#L866" title="ocaml/middle_end/closure/closure.ml:866">global_approx</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span><span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier">ptr</span>, <span class="ocamlLCIdentifier">mut</span><span class="Statement">)</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier">lam</span><span class="Statement">]</span>, <span class="ocamlLCIdentifier">loc</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1102">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulam</span></span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li><a id="L1103">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dbg</span></span> <span class="Statement">=</span> <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L844" title="ocaml/middle_end/closure/closure.ml:844">check_constant_result</a></span> <span class="Statement">(</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span>.<span class="Constant">Pfield</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier">ptr</span>, <span class="ocamlLCIdentifier">mut</span><span class="Statement">)</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L457" title="ocaml/middle_end/closure/closure.ml:457">field_approx</a></span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span><span class="Statement">(</span><span class="Constant">Psetfield</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier">is_ptr</span>, <span class="ocamlLCIdentifier">init</span><span class="Statement">)</span>, <span class="Statement">[</span><span class="Constant">Lprim</span><span class="Statement">(</span><span class="Constant">Pgetglobal</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="Constant">[]</span>, <span class="Statement">_);</span> <span class="ocamlLCIdentifier">lam</span><span class="Statement">]</span>, <span class="ocamlLCIdentifier">loc</span><span class="Statement">)-&gt;<br/></li>
<li><a id="L1107">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulam</span></span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">approx</span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">Value_unknown</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(!</span><span class="ocamlLCIdentifier"><a href="#L866" title="ocaml/middle_end/closure/closure.ml:866">global_approx</a></span><span class="Statement">)</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier">approx</span><span class="Statement">;<br/></li>
<li><a id="L1110">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dbg</span></span> <span class="Statement">=</span> <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span>.<span class="Constant">Psetfield</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier">is_ptr</span>, <span class="ocamlLCIdentifier">init</span><span class="Statement">)</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L66" title="ocaml/middle_end/closure/closure.ml:66">getglobal</a></span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span><span class="Statement">(</span><span class="Constant">Praise</span> <span class="ocamlLCIdentifier">k</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="Statement">]</span>, <span class="ocamlLCIdentifier">loc</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1114">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulam</span></span>, <span class="ocamlLCIdentifier">_approx</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span> <span class="Statement">in<br/></li>
<li><a id="L1115">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dbg</span></span> <span class="Statement">=</span> <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Uprim</span><span class="Statement">(</span><span class="PreProc">P</span>.<span class="Constant">Praise</span> <span class="ocamlLCIdentifier">k</span>, <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pmakearray</span> <span class="Statement">_</span>, <span class="Constant">[]</span>, <span class="ocamlLCIdentifier">_loc</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L238" title="ocaml/middle_end/closure/closure.ml:238">make_const_ref</a></span> <span class="Statement">(</span><span class="Constant">Uconst_block</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">[]</span><span class="Statement">))<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span>, <span class="ocamlLCIdentifier">args</span>, <span class="ocamlLCIdentifier">loc</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1120">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">p</span></span> <span class="Statement">=</span> <span class="PreProc">Convert_primitives</span>.<span class="ocamlLCIdentifier">convert</span> <span class="ocamlLCIdentifier"><span class="linkable">p</span></span> <span class="Statement">in<br/></li>
<li><a id="L1121">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dbg</span></span> <span class="Statement">=</span> <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L513" title="ocaml/middle_end/closure/closure.ml:513">simplif_prim</a></span> <span class="Statement">~</span><span class="Identifier">backend</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">float_const_prop<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L1120" title="ocaml/middle_end/closure/closure.ml:1120">p</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">close_list_approx</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">args</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>, <span class="ocamlLCIdentifier">sw</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1125">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">fn</span></span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1157" title="ocaml/middle_end/closure/closure.ml:1157">uarg</a></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">const_index</span>, <span class="ocamlLCIdentifier">const_actions</span>, <span class="ocamlLCIdentifier">fconst</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">close_switch</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_consts</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_numconsts</span> <span class="ocamlLCIdentifier">fail<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">block_index</span>, <span class="ocamlLCIdentifier">block_actions</span>, <span class="ocamlLCIdentifier">fblock</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">close_switch</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_blocks</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_numblocks</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Uswitch<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1157" title="ocaml/middle_end/closure/closure.ml:1157">uarg</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier">us_index_consts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">const_index</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">us_actions_consts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">const_actions</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">us_index_blocks</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">block_index</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">us_actions_blocks</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">block_actions</span><span class="Statement">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">fconst</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fblock</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="Statement">)</span>,<span class="Constant">Value_unknown</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(* NB: failaction might get copied, thus it should be some Lstaticraise *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_failaction</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fail</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="Statement">|</span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Lstaticraise</span><span class="ocamlEnd"> </span><span class="Statement">(_</span><span class="ocamlEnd">,</span><span class="Statement">_))</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1125" title="ocaml/middle_end/closure/closure.ml:1125">fn</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fail<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">lamfail</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">sw</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">sw_numconsts</span><span class="ocamlNone"> - </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">sw</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">sw_consts</span><span class="Statement">)</span><span class="ocamlNone"> +<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">sw</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">sw_numblocks</span><span class="ocamlNone"> - </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">sw</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">sw_blocks</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Constant">1<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">next_raise_count</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="ocamlEnd">,</span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1125" title="ocaml/middle_end/closure/closure.ml:1125">fn</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Lstaticraise</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlEnd">,</span><span class="Constant">[]</span><span class="Statement">)))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">and</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1174" title="ocaml/middle_end/closure/closure.ml:1174">uhandler</a></span><span class="ocamlEnd">,</span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">lamfail</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Ucatch</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlEnd">,</span><span class="Constant">[]</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier"><a href="#L1174" title="ocaml/middle_end/closure/closure.ml:1174">uhandler</a></span><span class="Statement">)</span><span class="ocamlEnd">,</span><span class="Constant">Value_unknown<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1125" title="ocaml/middle_end/closure/closure.ml:1125">fn</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fail<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstringswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>,<span class="ocamlLCIdentifier">sw</span>,<span class="ocamlLCIdentifier">d</span>,<span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1157">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">uarg</span></span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span> <span class="Statement">in<br/></li>
<li><a id="L1158">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">usw</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">s</span>,<span class="ocamlLCIdentifier">act</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">uact</span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">act</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">s</span>,<span class="ocamlLCIdentifier">uact</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw</span> <span class="Statement">in<br/></li>
<li><a id="L1164">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">ud</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1164" title="ocaml/middle_end/closure/closure.ml:1164">ud</a></span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1164" title="ocaml/middle_end/closure/closure.ml:1164">ud</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Ustringswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1157" title="ocaml/middle_end/closure/closure.ml:1157">uarg</a></span>,<span class="ocamlLCIdentifier"><a href="#L1158" title="ocaml/middle_end/closure/closure.ml:1158">usw</a></span>,<span class="ocamlLCIdentifier"><a href="#L1164" title="ocaml/middle_end/closure/closure.ml:1164">ud</a></span><span class="Statement">)</span>,<span class="Constant">Value_unknown<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">i</span>, <span class="ocamlLCIdentifier">args</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Ustaticfail</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">i</span>, <span class="ocamlLCIdentifier"><a href="#L1212" title="ocaml/middle_end/closure/closure.ml:1212">close_list</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">args</span><span class="Statement">)</span>, <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstaticcatch</span><span class="Statement">(</span><span class="ocamlLCIdentifier">body</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">i</span>, <span class="ocamlLCIdentifier"><a href="#L1175" title="ocaml/middle_end/closure/closure.ml:1175">vars</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">handler</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1173">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ubody</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">in<br/></li>
<li><a id="L1174">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">uhandler</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">in<br/></li>
<li><a id="L1175">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">vars</span></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">var</span>, <span class="ocamlLCIdentifier">k</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">create</span> <span class="ocamlLCIdentifier">var</span>, <span class="ocamlLCIdentifier">k</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><span class="linkable">vars</span></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Ucatch</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span>, <span class="ocamlLCIdentifier"><a href="#L1175" title="ocaml/middle_end/closure/closure.ml:1175">vars</a></span>, <span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span>, <span class="ocamlLCIdentifier"><a href="#L1174" title="ocaml/middle_end/closure/closure.ml:1174">uhandler</a></span><span class="Statement">)</span>, <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ltrywith</span><span class="Statement">(</span><span class="ocamlLCIdentifier">body</span>, <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">handler</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1178">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ubody</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">in<br/></li>
<li><a id="L1179">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">uhandler</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Utrywith</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span>, <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">create</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L1174" title="ocaml/middle_end/closure/closure.ml:1174">uhandler</a></span><span class="Statement">)</span>, <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lifthenelse</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span>, <span class="ocamlLCIdentifier">ifso</span>, <span class="ocamlLCIdentifier">ifnot</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1157" title="ocaml/middle_end/closure/closure.ml:1157">uarg</a></span><span class="ocamlEnd">, </span><span class="Constant">Value_const</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Uconst_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">))</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L861" title="ocaml/middle_end/closure/closure.ml:861">sequence_constant_expr</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1157" title="ocaml/middle_end/closure/closure.ml:1157">uarg</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ifnot</span><span class="ocamlEnd"> </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ifso</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1157" title="ocaml/middle_end/closure/closure.ml:1157">uarg</a></span><span class="ocamlEnd">, </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li><a id="L1187">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">uifso</span></span><span class="ocamlEnd">, </span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ifso</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L1188">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">uifnot</span></span><span class="ocamlEnd">, </span><span class="Statement">_)</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ifnot</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Uifthenelse</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1157" title="ocaml/middle_end/closure/closure.ml:1157">uarg</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/middle_end/closure/closure.ml:1187">uifso</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1188" title="ocaml/middle_end/closure/closure.ml:1188">uifnot</a></span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lsequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier">lam1</span>, <span class="ocamlLCIdentifier">lam2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1192">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulam1</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam1</span> <span class="Statement">in<br/></li>
<li><a id="L1193">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulam2</span></span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Usequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1192" title="ocaml/middle_end/closure/closure.ml:1192">ulam1</a></span>, <span class="ocamlLCIdentifier"><a href="#L1193" title="ocaml/middle_end/closure/closure.ml:1193">ulam2</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lwhile</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1196">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ucond</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">cond</span> <span class="Statement">in<br/></li>
<li><a id="L1197">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ubody</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Uwhile</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1196" title="ocaml/middle_end/closure/closure.ml:1196">ucond</a></span>, <span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="Statement">)</span>, <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lfor</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">lo</span>, <span class="ocamlLCIdentifier">hi</span>, <span class="ocamlLCIdentifier">dir</span>, <span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1200">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulo</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lo</span> <span class="Statement">in<br/></li>
<li><a id="L1201">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">uhi</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">hi</span> <span class="Statement">in<br/></li>
<li><a id="L1202">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ubody</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">body</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Ufor</span><span class="Statement">(</span><span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">create</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L1200" title="ocaml/middle_end/closure/closure.ml:1200">ulo</a></span>, <span class="ocamlLCIdentifier"><a href="#L1201" title="ocaml/middle_end/closure/closure.ml:1201">uhi</a></span>, <span class="ocamlLCIdentifier">dir</span>, <span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="Statement">)</span>, <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lassign</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">lam</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1205">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">ulam</span></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Uassign</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="Statement">)</span>, <span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Levent</span><span class="Statement">(</span><span class="ocamlLCIdentifier">lam</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lifused</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1212">&#x200c;</a><span class="Statement">and</span> <span class="ocamlLCIdentifier"><span class="linkable">close_list</span></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Constant">[]<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span>, <span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L1212" title="ocaml/middle_end/closure/closure.ml:1212">close_list</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">close_list_approx</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">[]</span>, <span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ulams</span>, <span class="ocamlLCIdentifier">approxs</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">close_list_approx</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">ulams</span>, <span class="ocamlLCIdentifier">approx</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">approxs</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">close_named</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lfunction</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">funct</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1385" title="ocaml/middle_end/closure/closure.ml:1385">close_one_function</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="ocamlLCIdentifier">funct<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Build a shared closure for a set of mutually recursive functions *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">close_functions</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cenv</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">mutable_vars</span> <span class="Statement">}</span> <span class="ocamlLCIdentifier">fun_defs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fun_defs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">flatten<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="Constant">Lfunction</span><span class="Statement">{</span><span class="ocamlLCIdentifier">kind</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">return</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">body</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">attr</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">loc</span><span class="Statement">})</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Simplif</span>.<span class="ocamlLCIdentifier">split_default_wrapper</span> <span class="Statement">~</span><span class="Identifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">~</span><span class="Identifier">kind</span> <span class="Statement">~</span><span class="Identifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">~</span><span class="Identifier">body</span> <span class="Statement">~</span><span class="Identifier">attr</span> <span class="Statement">~</span><span class="Identifier">loc</span> <span class="Statement">~</span><span class="Identifier">return<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">fun_defs</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">inline_attribute</span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">fun_defs</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">[_</span>, <span class="Constant">Lfunction</span><span class="Statement">{</span><span class="ocamlLCIdentifier">attr</span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">inline</span><span class="Statement">;</span> <span class="Statement">}}]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">inline<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Default_inline</span> <span class="Comment">(* recursive functions can't be inlined *)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Update and check nesting depth *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier"><a href="#L870" title="ocaml/middle_end/closure/closure.ml:870">function_nesting_depth</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">initially_closed</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L870" title="ocaml/middle_end/closure/closure.ml:870">function_nesting_depth</a></span> <span class="Statement">&lt;</span> <span class="ocamlLCIdentifier"><a href="#L871" title="ocaml/middle_end/closure/closure.ml:871">excessive_function_nesting_depth</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Determine the free variables of the functions *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1378" title="ocaml/middle_end/closure/closure.ml:1378">fv</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">V</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">elements</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">free_variables</span> <span class="Statement">(</span><span class="Constant">Lletrec</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fun_defs</span>, <span class="ocamlLCIdentifier">lambda_unit</span><span class="Statement">)))</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Build the function descriptors for the functions.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Initially all functions are assumed not to need their environment<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; parameter. *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">uncurried_defs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="Constant">Lfunction</span><span class="Statement">{</span><span class="ocamlLCIdentifier">kind</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">return</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">body</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">loc</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">attr</span><span class="Statement">})</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">label</span> <span class="Statement">=</span> <span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">make_symbol</span> <span class="Statement">(</span><span class="Constant">Some</span> <span class="Statement">(</span><span class="PreProc">V</span>.<span class="ocamlLCIdentifier">unique_name</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="Statement">))</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">arity</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fundesc</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier">fun_label</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">label</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">fun_arity</span> <span class="Statement">=</span> <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">kind</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">Tupled</span><span class="ocamlNone"> </span><span class="Statement">then</span> -<span class="ocamlLCIdentifier">arity</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier">arity</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">fun_closed</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">initially_closed</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">fun_inline</span> <span class="Statement">=</span> <span class="Constant">None</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">fun_float_const_prop</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">float_const_prop</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">fun_poll</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">attr</span>.<span class="ocamlLCIdentifier">poll</span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span> <span class="Statement">=</span> <span class="PreProc">Debuginfo</span>.<span class="ocamlLCIdentifier">from_location</span> <span class="ocamlLCIdentifier">loc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span>, <span class="ocamlLCIdentifier">return</span>, <span class="ocamlLCIdentifier">body</span>, <span class="ocamlLCIdentifier">fundesc</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Closure.close_functions&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fun_defs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Build an approximate <a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a> for compiling the functions *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fenv_rec</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">_params</span>, <span class="ocamlLCIdentifier">_return</span>, <span class="ocamlLCIdentifier">_body</span>, <span class="ocamlLCIdentifier">fundesc</span>, <span class="ocamlLCIdentifier">_dbg</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">(</span><span class="Constant">Value_closure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span>, <span class="Constant">Value_unknown</span><span class="Statement">))</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">uncurried_defs</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Determine the offsets of each function's closure in the shared block *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">env_pos</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span>-<span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">clos_offsets</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">_id</span>, <span class="ocamlLCIdentifier">_params</span>, <span class="ocamlLCIdentifier">_return</span>, <span class="ocamlLCIdentifier">_body</span>, <span class="ocamlLCIdentifier">fundesc</span>, <span class="ocamlLCIdentifier">_dbg</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">env_pos</span> + <span class="Constant">1</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">env_pos</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">env_pos</span> + <span class="Constant">1</span> + <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">fun_arity</span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">3</span> <span class="Statement">else</span> <span class="Constant">2</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pos</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">uncurried_defs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fv_pos</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">env_pos</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* This reference will be set to false if the hypothesis that a function<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; does not use its environment parameter is invalidated. *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">useless_env</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">initially_closed</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Translate each function definition *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">clos_fundef</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span>, <span class="ocamlLCIdentifier">return</span>, <span class="ocamlLCIdentifier">body</span>, <span class="ocamlLCIdentifier">fundesc</span>, <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">env_pos</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">env_param</span> <span class="Statement">=</span> <span class="PreProc">V</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;<a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a>&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cenv_fv</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">build_closure_env</span> <span class="ocamlLCIdentifier">env_param</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fv_pos</span> - <span class="ocamlLCIdentifier">env_pos</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1378" title="ocaml/middle_end/closure/closure.ml:1378">fv</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cenv_body</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right2<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">_params</span>, <span class="ocamlLCIdentifier">_return</span>, <span class="ocamlLCIdentifier">_body</span>, <span class="ocamlLCIdentifier">_fundesc</span>, <span class="ocamlLCIdentifier">_dbg</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">(</span><span class="Constant">Uoffset</span><span class="Statement">(</span><span class="Constant">Uvar</span> <span class="ocamlLCIdentifier">env_param</span>, <span class="ocamlLCIdentifier">pos</span> - <span class="ocamlLCIdentifier">env_pos</span><span class="Statement">))</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">uncurried_defs</span> <span class="ocamlLCIdentifier">clos_offsets</span> <span class="ocamlLCIdentifier">cenv_fv</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">fenv_rec</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cenv</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">cenv_body</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">mutable_vars</span> <span class="Statement">}</span> <span class="ocamlLCIdentifier">body<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">useless_env</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L71" title="ocaml/middle_end/closure/closure.ml:71">occurs_var</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">env_param</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">raise</span> <span class="Constant">NotClosed</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fun_params</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">useless_env<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> @ <span class="Statement">[</span><span class="ocamlLCIdentifier">env_param</span>, <span class="Constant">Pgenval</span><span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">f</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">{<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">label</span>&nbsp; <span class="Statement">=</span> <span class="ocamlLCIdentifier">fundesc</span>.<span class="ocamlLCIdentifier">fun_label</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">arity</span>&nbsp; <span class="Statement">=</span> <span class="ocamlLCIdentifier">fundesc</span>.<span class="ocamlLCIdentifier">fun_arity</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L780" title="ocaml/middle_end/closure/closure.ml:780">params</a></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">var</span>, <span class="ocamlLCIdentifier">kind</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">create</span> <span class="ocamlLCIdentifier">var</span>, <span class="ocamlLCIdentifier">kind</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">fun_params</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">return</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">body</span>&nbsp;&nbsp; <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1016" title="ocaml/middle_end/closure/closure.ml:1016">dbg</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="Statement">=</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">env_param</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">poll</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">fundesc</span>.<span class="ocamlLCIdentifier">fun_poll<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* give more chance of function with default parameters (i.e.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; their wrapper functions) to be inlined *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">n</span> + <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">V</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">name</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">&quot;*opt*&quot;</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">8</span> <span class="Statement">else</span> <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fun_params<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">threshold</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">inline_attribute</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Default_inline</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">inline_threshold</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Clflags</span>.<span class="PreProc">Float_arg_helper</span>.<span class="ocamlLCIdentifier">get</span> <span class="Statement">~</span><span class="Identifier"><a href="#L31" title="ocaml/middle_end/closure/closure.ml:31">key</a></span>:<span class="Constant">0</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">inline_threshold<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">magic_scale_constant</span> <span class="Statement">=</span> <span class="Constant">8</span>. <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">int_of_float</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">inline_threshold</span> <span class="Statement">*</span>. <span class="ocamlLCIdentifier">magic_scale_constant</span><span class="Statement">)</span> + <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Always_inline</span> <span class="Statement">|</span> <span class="Constant">Hint_inline</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">max_int<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Never_inline</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">min_int<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Unroll</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fun_params</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">var</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">VP</span>.<span class="ocamlLCIdentifier">create</span> <span class="ocamlLCIdentifier">var</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">fun_params</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L151" title="ocaml/middle_end/closure/closure.ml:151">lambda_smaller</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">threshold<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">fundesc</span>.<span class="ocamlLCIdentifier">fun_inline</span> <span class="Statement">&lt;-</span> <span class="Constant">Some</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fun_params</span>, <span class="ocamlLCIdentifier"><a href="#L1027" title="ocaml/middle_end/closure/closure.ml:1027">ubody</a></span><span class="Statement">);<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">f</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">env_pos</span>, <span class="Constant">Value_closure</span><span class="Statement">(</span><span class="ocamlLCIdentifier">fundesc</span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)))</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Translate all function definitions. *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">clos_info_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">initially_closed</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">snap</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Compilenv</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">snapshot</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">try</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map2</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">clos_fundef</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">uncurried_defs</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">clos_offsets<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">with</span><span class="ocamlEnd"> </span><span class="Constant">NotClosed</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Comment">(* If the hypothesis that the environment parameters are useless has been<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; invalidated, then set [fun_closed] to false in all descriptions and<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; recompile *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Compilenv</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">backtrack</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">snap</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="Comment">(* PR#6337 *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">_id</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">_params</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">_return</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">_body</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">_dbg</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_closed</span><span class="ocamlEnd"> </span><span class="Statement">&lt;-</span><span class="ocamlEnd"> </span><span class="Constant">false</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">fundesc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_inline</span><span class="ocamlEnd"> </span><span class="Statement">&lt;-</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">uncurried_defs</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">useless_env</span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Constant">false</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map2</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">clos_fundef</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">uncurried_defs</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">clos_offsets<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end</span> <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Excessive closure nesting: assume environment parameter is used *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map2</span> <span class="ocamlLCIdentifier">clos_fundef</span> <span class="ocamlLCIdentifier">uncurried_defs</span> <span class="ocamlLCIdentifier">clos_offsets<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Update nesting depth *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">decr</span> <span class="ocamlLCIdentifier"><a href="#L870" title="ocaml/middle_end/closure/closure.ml:870">function_nesting_depth</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Comment">(* Return the Uclosure node and the list of all identifiers defined,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; with offsets and approximations. *)<br/></li>
<li><a id="L1377">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">clos</span></span>, <span class="ocamlLCIdentifier">infos</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">split</span> <span class="ocamlLCIdentifier">clos_info_list</span> <span class="Statement">in<br/></li>
<li><a id="L1378">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">fv</span></span> <span class="Statement">=</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">useless_env</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">[]</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier"><span class="linkable">fv</span></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="Constant">Uclosure</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L890" title="ocaml/middle_end/closure/closure.ml:890">close_var</a></span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cenv</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">mutable_vars</span> <span class="Statement">})</span> <span class="ocamlLCIdentifier"><a href="#L1378" title="ocaml/middle_end/closure/closure.ml:1378">fv</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp;&nbsp; <span class="ocamlLCIdentifier">infos</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Same, for one non-recursive function *)<br/></li>
<li></span><br/></li>
<li><a id="L1385">&#x200c;</a><span class="Statement">and</span> <span class="ocamlLCIdentifier"><span class="linkable">close_one_function</span></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="ocamlLCIdentifier">funct</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">close_functions</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">funct</span><span class="Statement">]</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">i</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="Statement">_)</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1377" title="ocaml/middle_end/closure/closure.ml:1377">clos</a></span>, <span class="ocamlLCIdentifier">approx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Closure.<a href="#L1385" title="ocaml/middle_end/closure/closure.ml:1385">close_one_function</a>&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Close a switch *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">close_switch</span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">cases</span> <span class="ocamlLCIdentifier">num_keys</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ncases</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">index</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="ocamlLCIdentifier">num_keys</span> <span class="Constant">0<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">store</span> <span class="Statement">=</span> <span class="PreProc">Storer</span>.<span class="ocamlLCIdentifier">mk_store</span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Comment">(* First default case *)<br/></li>
<li></span>&nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">default</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">def</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ncases</span><span class="ocamlEnd"> </span><span class="Statement">&lt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">num_keys</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">assert</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">store</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">act_store</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">def</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Comment">(* Then all other cases *)<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L31" title="ocaml/middle_end/closure/closure.ml:31">key</a></span>,<span class="ocamlLCIdentifier">lam</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">index</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L31" title="ocaml/middle_end/closure/closure.ml:31">key</a></span><span class="Statement">)</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier">store</span>.<span class="ocamlLCIdentifier">act_store</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier">lam</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">cases</span> <span class="Statement">;<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Comment">(*&nbsp; Explicit sharing with catch/exit, as switcher compilation may<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; later unshare *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">acts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">store</span>.<span class="ocamlLCIdentifier">act_get_shared</span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">hs</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">e</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Comment">(* Compile actions *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">actions</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Single</span> <span class="ocamlLCIdentifier">lam</span><span class="Statement">|</span><span class="Constant">Shared</span> <span class="Statement">(</span><span class="Constant">Lstaticraise</span> <span class="Statement">(_</span>,<span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">lam</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Shared</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="ocamlLCIdentifier"><a href="#L706" title="ocaml/middle_end/closure/closure.ml:706">env</a></span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">next_raise_count</span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let string_of_lambda e =<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Printlambda.lambda Format.str_formatter e ;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Format.flush_str_formatter () in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Printf.eprintf &quot;SHARE CLOSURE %i [%s]\n%s\n&quot; i<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (string_of_lambda <a href="#L1089" title="ocaml/middle_end/closure/closure.ml:1089">arg</a>)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (string_of_lambda lam) ;<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ohs</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">hs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">hs</span> <span class="Statement">:=</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;</span> <span class="Constant">Ucatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">i</span>,<span class="Constant">[]</span>,<span class="ocamlLCIdentifier">ohs</span> <span class="ocamlLCIdentifier">e</span>,<span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="Statement">))</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Ustaticfail</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">i</span>,<span class="Constant">[]</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">acts</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">actions</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[|</span> <span class="Statement">|]</span> <span class="Statement">-&gt;</span> <span class="Statement">[|</span> <span class="Statement">|]</span>, <span class="Statement">[|</span> <span class="Statement">|]</span>, <span class="Statement">!</span><span class="ocamlLCIdentifier">hs</span> <span class="Comment">(* May happen when default is None *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>&nbsp; &nbsp;&nbsp; <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">index</span>, <span class="ocamlLCIdentifier">actions</span>, <span class="Statement">!</span><span class="ocamlLCIdentifier">hs<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* Collect exported symbols for structured constants *)<br/></li>
<li></span><br/></li>
<li><a id="L1443">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">collect_exported_structured_constants</span></span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">approx</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Value_closure</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fd</span>, <span class="ocamlLCIdentifier">a</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">approx</span> <span class="ocamlLCIdentifier">a</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fd</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fun_inline</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="Statement">(_</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">u</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">u<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Value_tuple</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">-&gt;</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier">approx</span> <span class="ocamlLCIdentifier">a<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Value_const</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">const</span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Value_unknown</span> <span class="Statement">|</span> <span class="Constant">Value_global_field</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">const</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst_ref</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">s</span>, <span class="Statement">(</span><span class="Constant">Some</span> <span class="ocamlLCIdentifier">c</span><span class="Statement">))</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">add_exported_constant</span> <span class="ocamlLCIdentifier">s</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">structured_constant</span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst_ref</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">_s</span>, <span class="Constant">None</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span> <span class="Comment">(* Cannot be generated *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst_int</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">structured_constant</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst_block</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">ul</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier">const</span> <span class="ocamlLCIdentifier">ul<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst_float</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Uconst_int32</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst_int64</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Uconst_nativeint</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst_float_array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Uconst_string</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst_closure</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span> <span class="Comment">(* Cannot be generated *)<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uvar</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uconst</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">const</span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Udirect_apply</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">ul</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">ul<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ugeneric_apply</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">u</span>, <span class="ocamlLCIdentifier">ul</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u</span><span class="Statement">;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">ul<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uclosure</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fl</span>, <span class="ocamlLCIdentifier">ul</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">f</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">f</span>.<span class="ocamlLCIdentifier">body</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">fl</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">ul<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uoffset</span><span class="Statement">(</span><span class="ocamlLCIdentifier">u</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ulet</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">_str</span>, <span class="ocamlLCIdentifier">_kind</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u1</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uphantom_let</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L41" title="ocaml/middle_end/closure/closure.ml:41">no_phantom_lets</a></span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uletrec</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">l</span>, <span class="ocamlLCIdentifier">u</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="Statement">(fun</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">u</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">l</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uprim</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">ul</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">ul<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">u</span>, <span class="ocamlLCIdentifier">sl</span>, <span class="ocamlLCIdentifier">_dbg</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">sl</span>.<span class="ocamlLCIdentifier">us_actions_consts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">sl</span>.<span class="ocamlLCIdentifier">us_actions_blocks<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ustringswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">u</span>,<span class="ocamlLCIdentifier">sw</span>,<span class="ocamlLCIdentifier">d</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="Statement">(fun</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">act</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">act</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">d<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ustaticfail</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">ul</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">ul<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ucatch</span> <span class="Statement">(_</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Utrywith</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Usequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uwhile</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span><span class="Statement">)</span>&nbsp; <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u1</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uifthenelse</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span>, <span class="ocamlLCIdentifier">u3</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Ufor</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">u3</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u1</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u2</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u3<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uassign</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">u</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Usend</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">u1</span>, <span class="ocamlLCIdentifier">u2</span>, <span class="ocamlLCIdentifier">ul</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u1</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">u2</span><span class="Statement">;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L952" title="ocaml/middle_end/closure/closure.ml:952">iter</a></span> <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span> <span class="ocamlLCIdentifier">ul<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Uunreachable</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">approx</span> <span class="ocamlLCIdentifier">a<br/></li>
<li></span><br/></li>
<li><a id="L1500">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">reset</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L866" title="ocaml/middle_end/closure/closure.ml:866">global_approx</a></span> <span class="Statement">:=</span> <span class="Statement">[||];<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L870" title="ocaml/middle_end/closure/closure.ml:870">function_nesting_depth</a></span> <span class="Statement">:=</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* The entry point *)<br/></li>
<li></span><br/></li>
<li><a id="L1506">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">intro</span></span> <span class="Statement">~</span><span class="Identifier">backend</span> <span class="Statement">~</span><span class="Identifier">size</span> <span class="ocamlLCIdentifier">lam</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1500" title="ocaml/middle_end/closure/closure.ml:1500">reset</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span> <span class="Statement">=</span> <span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">make_symbol</span> <span class="Constant">None</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L866" title="ocaml/middle_end/closure/closure.ml:866">global_approx</a></span> <span class="Statement">:=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">init</span> <span class="ocamlLCIdentifier">size</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">-&gt;</span> <span class="Constant">Value_global_field</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1090" title="ocaml/middle_end/closure/closure.ml:1090">id</a></span>, <span class="ocamlLCIdentifier">i</span><span class="Statement">));<br/></li>
<li></span>&nbsp; <span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">set_global_approx</span><span class="Statement">(</span><span class="Constant">Value_tuple</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L866" title="ocaml/middle_end/closure/closure.ml:866">global_approx</a></span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a></span>, <span class="ocamlLCIdentifier">_approx</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L893" title="ocaml/middle_end/closure/closure.ml:893">close</a></span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">backend</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L964" title="ocaml/middle_end/closure/closure.ml:964">fenv</a></span> <span class="Statement">=</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">empty</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cenv</span> <span class="Statement">=</span> <span class="PreProc">V</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">empty</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">mutable_vars</span> <span class="Statement">=</span> <span class="PreProc">V</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">empty</span> <span class="Statement">}</span> <span class="ocamlLCIdentifier">lam<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L1515">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">opaque</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier"><a href="#L1515" title="ocaml/middle_end/closure/closure.ml:1515">opaque</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">||</span> <span class="PreProc">Env</span>.<span class="ocamlLCIdentifier">is_imported_opaque</span> <span class="Statement">(</span><span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">current_unit_name</span> <span class="Constant">()</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1515" title="ocaml/middle_end/closure/closure.ml:1515">opaque</a><br/></li>
<li></span><span class="ocamlNone">&nbsp; </span><span class="Statement">then</span> <span class="PreProc">Compilenv</span>.<span class="ocamlLCIdentifier">set_global_approx</span><span class="Statement">(</span><span class="Constant">Value_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L1443" title="ocaml/middle_end/closure/closure.ml:1443">collect_exported_structured_constants</a></span> <span class="Statement">(</span><span class="Constant">Value_tuple</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L866" title="ocaml/middle_end/closure/closure.ml:866">global_approx</a></span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L866" title="ocaml/middle_end/closure/closure.ml:866">global_approx</a></span> <span class="Statement">:=</span> <span class="Statement">[||];<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1020" title="ocaml/middle_end/closure/closure.ml:1020">ulam</a><br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
