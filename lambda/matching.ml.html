<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/lambda/matching.ml - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/lambda/matching.ml - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L2517">act_index</a></li>
<li><a href="#L884">add</a></li>
<li><a href="#L1671">add_in_div</a></li>
<li><a href="#L1697">add_line</a></li>
<li><a href="#L392">add_omega_column</a></li>
<li><a href="#L219">all_lbls</a></li>
<li><a href="#L132">all_record_args</a></li>
<li><a href="#L278">alpha</a></li>
<li><a href="#L3146">approx_present</a></li>
<li><a href="#L2374">arg_as_test</a></li>
<li><a href="#L3242">arg_to_var</a></li>
<li><a href="#L2605">as_interval</a></li>
<li><a href="#L2501">as_interval_canfail</a></li>
<li><a href="#L2558">as_interval_nofail</a></li>
<li><a href="#L1280">as_matrix</a></li>
<li><a href="#L1045">as_simple_exit</a></li>
<li><a href="#L3681">assign_pat</a></li>
<li><a href="#L1250">attempt</a></li>
<li><a href="#L2350">bind</a></li>
<li><a href="#L153">bind_alias</a></li>
<li><a href="#L3180">bind_check</a></li>
<li><a href="#L3870">bind_opt</a></li>
<li><a href="#L2147">bind_sw</a></li>
<li><a href="#L2957">call_switcher_variant_constant</a></li>
<li><a href="#L2960">call_switcher_variant_constr</a></li>
<li><a href="#L3689">collect_const</a></li>
<li><a href="#L525">combine</a></li>
<li><a href="#L554">combine</a></li>
<li><a href="#L3033">combine_array</a></li>
<li><a href="#L2796">combine_constructor</a></li>
<li><a href="#L2969">combine_variant</a></li>
<li><a href="#L3186">comp_exit</a></li>
<li><a href="#L3191">comp_match_handlers</a></li>
<li><a href="#L3824">compile_flattened</a></li>
<li><a href="#L3082">compile_list</a></li>
<li><a href="#L3260">compile_match</a></li>
<li><a href="#L3103">compile_orhandlers</a></li>
<li><a href="#L3132">compile_test</a></li>
<li><a href="#L2621">complete_pats_constrs</a></li>
<li><a href="#L686">cons</a></li>
<li><a href="#L2854">consts</a></li>
<li><a href="#L101">dbg</a></li>
<li><a href="#L1615">dbg_split_and_precompile</a></li>
<li><a href="#L2853">descr_lambda_list</a></li>
<li><a href="#L1222">disjoint</a></li>
<li><a href="#L1684">divide</a></li>
<li><a href="#L1739">divide_constant</a></li>
<li><a href="#L1784">divide_constructor</a></li>
<li><a href="#L1701">divide_line</a></li>
<li><a href="#L2076">divide_record</a></li>
<li><a href="#L1841">divide_var</a></li>
<li><a href="#L2198">do_make_string_test_tree</a></li>
<li><a href="#L2283">do_tests_fail</a></li>
<li><a href="#L2291">do_tests_nofail</a></li>
<li><a href="#L1714">drop_expr_arg</a></li>
<li><a href="#L1713">drop_pat_arg</a></li>
<li><a href="#L533">empty</a></li>
<li><a href="#L680">empty</a></li>
<li><a href="#L872">empty</a></li>
<li><a href="#L498">eprintf</a></li>
<li><a href="#L541">eprintf</a></li>
<li><a href="#L849">eprintf</a></li>
<li><a href="#L2326">eqint</a></li>
<li><a href="#L112">equal</a></li>
<li><a href="#L1192">equiv_pat</a></li>
<li><a href="#L3047">event_branch</a></li>
<li><a href="#L3704">exit</a></li>
<li><a href="#L382">expand_record_simple</a></li>
<li><a href="#L265">explode_or_pat</a></li>
<li><a href="#L321">explode_or_pat</a></li>
<li><a href="#L1194">extract_equiv_head</a></li>
<li><a href="#L2532">fail_rec</a></li>
<li><a href="#L3784">flatten_cases</a></li>
<li><a href="#L628">flatten_matrix</a></li>
<li><a href="#L3716">for_let</a></li>
<li><a href="#L3875">for_multiple_match</a></li>
<li><a href="#L3695">fresh_ids</a></li>
<li><a href="#L2334">geint</a></li>
<li><a href="#L2496">get_edges</a></li>
<li><a href="#L1737">get_expr_args_constant</a></li>
<li><a href="#L1757">get_expr_args_constr</a></li>
<li><a href="#L1990">get_expr_args_lazy</a></li>
<li><a href="#L1839">get_expr_args_var</a></li>
<li><a href="#L1729">get_key_constant</a></li>
<li><a href="#L1862">get_mod_field</a></li>
<li><a href="#L1736">get_pat_args_constant</a></li>
<li><a href="#L1752">get_pat_args_constr</a></li>
<li><a href="#L1849">get_pat_args_lazy</a></li>
<li><a href="#L1838">get_pat_args_var</a></li>
<li><a href="#L2336">gtint</a></li>
<li><a href="#L2230">handle_shared</a></li>
<li><a href="#L263">head</a></li>
<li><a href="#L276">head</a></li>
<li><a href="#L1809">head</a></li>
<li><a href="#L1354">idef</a></li>
<li><a href="#L2541">init_rec</a></li>
<li><a href="#L1968">inline_lazy_force</a></li>
<li><a href="#L1908">inline_lazy_force_cond</a></li>
<li><a href="#L1941">inline_lazy_force_switch</a></li>
<li><a href="#L537">is_empty</a></li>
<li><a href="#L682">is_empty</a></li>
<li><a href="#L1173">is_or</a></li>
<li><a href="#L2711">lambda1</a></li>
<li><a href="#L2878">lambda1</a></li>
<li><a href="#L2491">last</a></li>
<li><a href="#L501">le</a></li>
<li><a href="#L2330">leint</a></li>
<li><a href="#L508">lforget</a></li>
<li><a href="#L2616">list_as_pat</a></li>
<li><a href="#L3155">lower_bind</a></li>
<li><a href="#L503">lshift</a></li>
<li><a href="#L543">lshift</a></li>
<li><a href="#L2332">ltint</a></li>
<li><a href="#L596">lub</a></li>
<li><a href="#L2411">make_catch</a></li>
<li><a href="#L1050">make_catch_delayed</a></li>
<li><a href="#L2360">make_const</a></li>
<li><a href="#L2413">make_exit</a></li>
<li><a href="#L2376">make_if</a></li>
<li><a href="#L2366">make_is_nonzero</a></li>
<li><a href="#L2364">make_isin</a></li>
<li><a href="#L2362">make_isout</a></li>
<li><a href="#L1658">make_line_matching</a></li>
<li><a href="#L1650">make_matching</a></li>
<li><a href="#L2345">make_offset</a></li>
<li><a href="#L2343">make_prim</a></li>
<li><a href="#L2156">make_string_test_sequence</a></li>
<li><a href="#L2378">make_switch</a></li>
<li><a href="#L2300">make_test_sequence</a></li>
<li><a href="#L2953">make_test_sequence_variant_constant</a></li>
<li><a href="#L922">map</a></li>
<li><a href="#L406">matcher</a></li>
<li><a href="#L115">may_compat</a></li>
<li><a href="#L912">merge</a></li>
<li><a href="#L2637">mk_failaction_neg</a></li>
<li><a href="#L2652">mk_failaction_pos</a></li>
<li><a href="#L462">ncols</a></li>
<li><a href="#L2328">neint</a></li>
<li><a href="#L3845">next</a></li>
<li><a href="#L224">of_clause</a></li>
<li><a href="#L1178">omega_like</a></li>
<li><a href="#L419">open</a></li>
<li><a href="#L3865">param_to_var</a></li>
<li><a href="#L3694">pat_ids</a></li>
<li><a href="#L809">pop</a></li>
<li><a href="#L798">pop_column</a></li>
<li><a href="#L813">pp</a></li>
<li><a href="#L1860">prim_obj_tag</a></li>
<li><a href="#L3712">push_sublet</a></li>
<li><a href="#L2555">r</a></li>
<li><a href="#L2450">reintroduce_fail</a></li>
<li><a href="#L867">remove</a></li>
<li><a href="#L3703">rev_sublets</a></li>
<li><a href="#L513">rshift</a></li>
<li><a href="#L550">rshift</a></li>
<li><a href="#L518">rshift_num</a></li>
<li><a href="#L552">rshift_num</a></li>
<li><a href="#L1088">safe_before</a></li>
<li><a href="#L1224">safe_below</a></li>
<li><a href="#L1227">safe_below_or_matrix</a></li>
<li><a href="#L1074">same_actions</a></li>
<li><a href="#L585">select_columns</a></li>
<li><a href="#L2417">share_actions_sw</a></li>
<li><a href="#L2241">share_actions_tree</a></li>
<li><a href="#L2986">sig_complete</a></li>
<li><a href="#L205">simpl_under_orpat</a></li>
<li><a href="#L1187">simple_omega_like</a></li>
<li><a href="#L878">singleton</a></li>
<li><a href="#L3846">size</a></li>
<li><a href="#L2594">sort_int_lambda_list</a></li>
<li><a href="#L2279">sort_lambda_list</a></li>
<li><a href="#L556">specialize</a></li>
<li><a href="#L795">specialize</a></li>
<li><a href="#L775">specialize_</a></li>
<li><a href="#L691">specialize_matrix</a></li>
<li><a href="#L1635">split_and_precompile_half_simplified</a></li>
<li><a href="#L2768">split_cases</a></li>
<li><a href="#L2783">split_extension_cases</a></li>
<li><a href="#L1363">split_no_or</a></li>
<li><a href="#L535">start</a></li>
<li><a href="#L128">string_of_lam</a></li>
<li><a href="#L1814">tag</a></li>
<li><a href="#L2190">tree_way_test</a></li>
<li><a href="#L900">union</a></li>
<li><a href="#L916">unions</a></li>
<li><a href="#L2268">uniq_lambda_list</a></li>
<li><a href="#L1810">variants</a></li>
<li><a href="#L1404">yes</a></li>
<li><a href="#L2188">zero_lam</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L2341">act</a></li>
<li><a href="#L2339">arg</a></li>
<li><a href="#L1666">division</a></li>
<li><a href="#L388">initial_clause</a></li>
<li><a href="#L2338">loc</a></li>
<li><a href="#L390">matrix</a></li>
<li><a href="#L203">nonrec</a></li>
<li><a href="#L274">nonrec</a></li>
<li><a href="#L2324">primitive</a></li>
<li><a href="#L496">t</a></li>
<li><a href="#L531">t</a></li>
<li><a href="#L675">t</a></li>
<li><a href="#L847">t</a></li>
<li><a href="#L2340">test</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">(**************************************************************************)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Compilation of pattern matching<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Based upon Lefessant-Maranget ``Optimizing Pattern-Matching'' ICFP'2001.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; A previous version was based on Peyton-Jones, ``The Implementation of<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; functional programming languages'', chapter 5.<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Overview of the implementation<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; ==============================<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; 1. Precompilation<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; -----------------<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; (split_and_precompile)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; We first split the initial pattern matching (or &quot;pm&quot;) along its first column<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; -- simplifying pattern heads in the process --, so that we obtain an ordered<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> of pms.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; For every pm in this <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a>, and any two patterns in its first column, either<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the patterns have the same <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a>, or their heads match <a href="#L1222" title="ocaml/lambda/matching.ml:1222">disjoint</a> sets of<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; values. (In particular, two extension constructors that may or may not be<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="simplif.ml.html#L782" title="ocaml/lambda/simplif.ml:782">equal</a> due to hidden rebinding cannot occur in the same simple pm.)<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; 2. Compilation<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; --------------<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The compilation of one of these pms obtained after precompiling is done as<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; follows:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; (<a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a>)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; We split the match along the first column again, this time grouping rows<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; which <a href="#L535" title="ocaml/lambda/matching.ml:535">start</a> with the same <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a>, and removing the first column.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; As a result we get a &quot;<a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a>&quot;, which is a <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> a &quot;cells&quot; of the form:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; discriminating pattern <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a> * <a href="tmc.ml.html#L548" title="ocaml/lambda/tmc.ml:548">specialized</a> pm<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; (<a href="#L3082" title="ocaml/lambda/matching.ml:3082">compile_list</a> + <a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a>)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; We then <a href="#L922" title="ocaml/lambda/matching.ml:922">map</a> over the <a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a> to compile each cell: we simply restart the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; whole process on the second element of each cell.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Each cell is now of the form:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; discriminating pattern <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a> * <a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; (combine_constant, combine_construct, <a href="#L3033" title="ocaml/lambda/matching.ml:3033">combine_array</a>, ...)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; We recombine the cells using a switch or some ifs, and if the matching can<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; fail, introduce a jump to the <a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a> pm that could potentially match the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; scrutiny.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; 3. Chaining of pms<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; ------------------<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; (<a href="#L3191" title="ocaml/lambda/matching.ml:3191">comp_match_handlers</a>)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Once the pms have been compiled, we stitch them back together in the order<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; produced by precompilation, resulting in the following structure:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; {v<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; catch<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; catch<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;first <a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a>&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; with &lt;<a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> <a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a>&gt; -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;second <a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a>&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; with &lt;<a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> j&gt; -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;third <a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a>&gt;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; v}<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Additionally, bodies whose corresponding <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a>-number is never used are<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; discarded. So for instance, if in the pseudo-example above we know that <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a><br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; [<a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a>] is never taken, we would actually generate:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; {v<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; catch<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;first <a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a>&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; with &lt;<a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> j&gt; -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;third <a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a>&gt;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; v}<br/></li>
<li></span><br/></li>
<li><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Misc<br/></li>
<li></span><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Asttypes<br/></li>
<li></span><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Types<br/></li>
<li></span><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Typedtree<br/></li>
<li></span><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Lambda<br/></li>
<li></span><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Parmatch<br/></li>
<li></span><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Printf<br/></li>
<li></span><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Printpat<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Scoped_location</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Debuginfo.Scoped_location<br/></li>
<li></span><br/></li>
<li><a id="L101">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dbg</span></span> <span class="Statement">=</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Compatibility predicate that considers potential rebindings of constructors<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; of an extension type.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; &quot;<a href="#L115" title="ocaml/lambda/matching.ml:115">may_compat</a> p q&quot; returns false when p and q never admit a common instance;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; returns true when they may have a common instance.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> MayCompat</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Parmatch.Compat</span> <span class="ocamlFuncWith">(</span><span class="PreProc">struct<br/></li>
<li><a id="L112">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">equal</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Types</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">may_equal_constr<br/></li>
<li></span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L115">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">may_compat</span></span> <span class="Statement">=</span> <span class="PreProc">MayCompat</span>.<span class="ocamlLCIdentifier">compat<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">may_compats</span> <span class="Statement">=</span> <span class="PreProc">MayCompat</span>.<span class="ocamlLCIdentifier">compats<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Many functions on the various data structures of the algorithm :<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; - Pattern matrices.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; - Default environments: mapping from matrices to <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> numbers.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; - Contexts:&nbsp; matrices whose column are partitioned into<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; <a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a> and right.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; - Jump summaries: mapping from <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> numbers to contexts<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L128">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">string_of_lam</span></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Printlambda</span>.<span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">str_formatter</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">flush_str_formatter</span> <span class="Constant">()<br/></li>
<li></span><br/></li>
<li><a id="L132">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">all_record_args</span></span> <span class="ocamlLCIdentifier">lbls</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">lbls</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.<a href="#L132" title="ocaml/lambda/matching.ml:132">all_record_args</a>&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(_</span>, <span class="Statement">{</span> <span class="ocamlLCIdentifier">lbl_all</span> <span class="Statement">}</span>, <span class="Statement">_)</span> <span class="Statement">::</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">mknoloc</span> <span class="Statement">(</span><span class="PreProc">Longident</span>.<span class="Constant">Lident</span> <span class="Constant">&quot;?temp?&quot;</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>, <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omega</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lbl_all<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(fun</span> <span class="Statement">((_</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>, <span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_pos</span><span class="Statement">)</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">lbls</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">to_list</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">expand_record_head</span> <span class="ocamlLCIdentifier">h</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Patterns.Head</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">h</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.expand_record_head&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">({</span> <span class="ocamlLCIdentifier">lbl_all</span> <span class="Statement">}</span> <span class="Statement">::</span> <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">h</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Record</span> <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">to_list</span> <span class="ocamlLCIdentifier">lbl_all</span><span class="Statement">)</span> <span class="Statement">}<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">h<br/></li>
<li></span><br/></li>
<li><a id="L153">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">bind_alias</span></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">~</span><span class="Identifier">action</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=</span> <span class="PreProc">Typeopt</span>.<span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L56" title="ocaml/lambda/printlambda.ml:56">value_kind</a></span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_type</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L442" title="ocaml/lambda/lambda.mli:442">bind_with_value_kind</a></span> <span class="Constant">Alias</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">action<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">head_loc</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Scoped_location</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L85" title="ocaml/lambda/debuginfo.ml:85">of_location</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span>.<span class="ocamlLCIdentifier">pat_loc<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> '<span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier">clause</span> <span class="Statement">=</span> '<span class="ocamlLCIdentifier">a</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">map_on_row</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">row</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">row</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">map_on_rows</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">map_on_row</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Non_empty_row</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Patterns.Non_empty_row<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> General</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">include</span><span class="ocamlStruct"> </span><span class="PreProc">Patterns.General<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L203" title="ocaml/lambda/matching.ml:203">nonrec</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">clause</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlStruct"> </span><span class="PreProc">Non_empty_row</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">clause<br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Half_simple</span><span class="ocamlPreDef"> : </span><span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">include</span><span class="ocamlSig"> </span><span class="Statement">module type of </span><span class="PreProc">Patterns</span><span class="ocamlSig">.</span><span class="Constant">Half_simple<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Comment">(** Half-simplified patterns are patterns where:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; - records are expanded so that they possess all fields<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; - aliases are removed and replaced by bindings in actions.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; Or-patterns are not removed, they are only &quot;half-simplified&quot;:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; - aliases under or-patterns are kept<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; - or-patterns whose right-hand-side is subsumed by their lhs<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; are simplified to their lhs.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; For instance: [(_ :: _ | 1 :: _)] is changed into [_ :: _]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; - or-patterns whose <a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a>-hand-side is not simplified<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; are preserved: (p|q) is changed into (simpl(p)|simpl(q))<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {v<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # match lazy (print_int 3; 3) with _ | lazy 2 -&gt; ();;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - : <a href="tmc.ml.html#L197" title="ocaml/lambda/tmc.ml:197">unit</a> = ()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # match lazy (print_int 3; 3) with lazy 2 | _ -&gt; ();;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3- : <a href="tmc.ml.html#L197" title="ocaml/lambda/tmc.ml:197">unit</a> = ()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v}<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; In particular, or-patterns may still occur in the leading column,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; so this is only a &quot;half-simplification&quot;. *)<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L203" title="ocaml/lambda/matching.ml:203">nonrec</a></span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">clause</span><span class="ocamlSig"> </span><span class="Statement">=</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlSig"> </span><span class="PreProc">Non_empty_row</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">clause<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L224" title="ocaml/lambda/matching.ml:224">of_clause</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlSig">:</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="PreProc">General</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier">clause</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">clause<br/></li>
<li></span><span class="PreProc">end</span> <span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">include</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Patterns.Half_simple<br/></li>
<li></span><br/></li>
<li><a id="L203">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">nonrec</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">clause</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Non_empty_row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">clause<br/></li>
<li></span><br/></li>
<li><a id="L205">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">simpl_under_orpat</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_any<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_var</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">p<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_alias</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">q</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_alias</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L205" title="ocaml/lambda/matching.ml:205">simpl_under_orpat</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_or</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">o</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L205" title="ocaml/lambda/matching.ml:205">simpl_under_orpat</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="#L205" title="ocaml/lambda/matching.ml:205">simpl_under_orpat</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p2</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">le_pat</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">p1<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_or</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">o</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_record</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lbls</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">closed</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li><a id="L219">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">all_lbls</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L132" title="ocaml/lambda/matching.ml:132">all_record_args</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">lbls</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_record</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L219" title="ocaml/lambda/matching.ml:219">all_lbls</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">closed</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Comment">(* Explode or-patterns and turn aliases into bindings in actions *)<br/></li>
<li><a id="L224">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">of_clause</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">aux</span><span class="ocamlFuncStruct"> </span><span class="Statement">(((</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">action</span><span class="Statement">)</span><span class="ocamlFuncStruct"> : </span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">clause</span><span class="Statement">)</span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier">clause</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">continue</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> : </span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">view</span><span class="Statement">)</span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier">clause</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">aux</span><span class="ocamlFuncStruct"> </span><span class="Statement">(({</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">action</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">stop</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier">view</span><span class="Statement">)</span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier">clause</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(({</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">action</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Any</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">stop</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Any<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Var</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">continue</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="Constant">`Alias</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">Patterns</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">omega</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Alias</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">aux<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span><span class="ocamlFuncStruct">,<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/lambda/matching.ml:153">bind_alias</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">~</span><span class="Identifier">action</span><span class="ocamlFuncStruct"> </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Record</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="Constant">[]</span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">stop</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Record</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lbls</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">closed</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">full_view</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Record</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L132" title="ocaml/lambda/matching.ml:132">all_record_args</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">lbls</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">closed</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">stop</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">full_view<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Or</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">orpat</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L205" title="ocaml/lambda/matching.ml:205">simpl_under_orpat</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">erase</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="Statement">))</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">orpat</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Or</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">or_view</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">stop</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">orpat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">or_view<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">other_view</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">continue</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">orpat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">other_view<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Constant</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Tuple</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Construct</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Variant</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Array</span><span class="ocamlFuncStruct"> </span><span class="Statement">_<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Lazy</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">stop</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">aux</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a><br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">Cannot_flatten<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Simple</span><span class="ocamlPreDef"> : </span><span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">include</span><span class="ocamlSig"> </span><span class="Statement">module type of </span><span class="PreProc">Patterns</span><span class="ocamlSig">.</span><span class="Constant">Simple<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L203" title="ocaml/lambda/matching.ml:203">nonrec</a></span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">clause</span><span class="ocamlSig"> </span><span class="Statement">=</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlSig"> </span><span class="PreProc">Non_empty_row</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">clause<br/></li>
<li></span><br/></li>
<li><a id="L263">&#x200c;</a><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><span class="linkable">head</span></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="PreProc">Patterns</span><span class="ocamlSig">.</span><span class="PreProc">Head</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><a id="L265">&#x200c;</a><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><span class="linkable">explode_or_pat</span></span><span class="ocamlSig"> :<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlSig">:</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="PreProc">Half_simple</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlSig"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">mk_action</span><span class="ocamlSig">:</span><span class="Statement">(</span><span class="ocamlLCIdentifier">vars</span><span class="ocamlSig">:</span><span class="PreProc">Ident</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">patbound_action_vars</span><span class="ocamlSig">:</span><span class="PreProc">Ident</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlSig"> </span><span class="Statement">*</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a><br/></li>
<li></span><span class="PreProc">end</span> <span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">include</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Patterns.Simple<br/></li>
<li></span><br/></li>
<li><a id="L274">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">nonrec</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">clause</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Non_empty_row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">clause<br/></li>
<li></span><br/></li>
<li><a id="L276">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">head</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fst</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">Patterns</span><span class="ocamlFuncStruct">.</span><span class="PreProc">Head</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">deconstruct</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L278">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">alpha</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier">pattern</span><span class="Statement">)</span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">alpha_pat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Typedtree</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">alpha_pat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Any</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Any<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Constant</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">cst</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Constant</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">cst<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Tuple</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Tuple</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">alpha_pat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Construct</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">cstr</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">cst_descr</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">`Construct</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">cstr</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">cst_descr</span><span class="ocamlFuncStruct">, </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">alpha_pat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Variant</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">cstr</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">argo</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">row_desc</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">`Variant</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">cstr</span><span class="ocamlFuncStruct">, </span><span class="PreProc">Option</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">alpha_pat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">argo</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">row_desc</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Record</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">fields</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">closed</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">alpha_field</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lid</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lid</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">alpha_pat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">`Record</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">alpha_field</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fields</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">closed</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Array</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Array</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">alpha_pat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Lazy</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Lazy</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">alpha_pat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Comment">(* Consider the following matching problem involving a half-simple pattern,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; with an or-pattern and as-patterns below it:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; match <a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a>, other-<a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a> with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | (Foo(y, z) as x | Bar(x, y) as z), other-pats -&gt; action[x,y,z]<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; (action[x,y,z] is some right-hand-side expression using x, y and z,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; but we assume that it uses no variables from [other-pats]).<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; [<a href="#L265" title="ocaml/lambda/matching.ml:265">explode_or_pat</a>] explodes this into the following:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; match <a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a>, other-<a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a> with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | Foo(y1, z1), other-pats -&gt; let x1 = <a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a> in action[x1,y1,z1]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | Bar(x2, y2), other-pats -&gt; let z2 = <a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a> in action[x2,y2,z2]<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; notice that the binding occurrences of x,y,z are <a href="#L278" title="ocaml/lambda/matching.ml:278">alpha</a>-renamed with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; fresh variables x1,y1,z1 and x2,y2,z2.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; We assume that it is fine to <a href="lambda.mli.html#L431" title="ocaml/lambda/lambda.mli:431">duplicate</a> the argument [<a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a>] in each<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; exploded branch; in most cases it is a variable (in which case<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; the bindings [let x1 = <a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a>] are inlined on the fly), except when<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; compiling in [do_for_multiple_match] where it is a tuple of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; variables.<br/></li>
<li></span><span class="Comment">&nbsp; *)<br/></li>
<li><a id="L321">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">explode_or_pat</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> : </span><span class="PreProc">Half_simple</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pattern</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier">mk_action</span><span class="ocamlFuncStruct"> </span><span class="Statement">~</span><span class="Identifier">patbound_action_vars<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; : </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlFuncStruct"> </span><span class="Statement">*</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">explode</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">aliases</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">split_explode</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">aliases</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">explode</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">aliases</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Or</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">split_explode</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">aliases</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">split_explode</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">aliases</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Alias</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">split_explode</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">aliases</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Var</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">str</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">explode<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Alias</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">Patterns</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">omega</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">str</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">aliases</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="PreProc">#</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* We are doing two things here:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - we freshen the variables of the pattern, to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; avoid reusing the same identifier in distinct exploded<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; branches<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - we <a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a> the variables in [aliases] to the argument [<a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a>]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (the other variables are bound by [view]); to avoid<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; code duplication if [<a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a>] is itself not a variable, we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; generate a binding for it, but only if the binding is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; needed.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; We are careful to avoid binding [<a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a>] if not needed due<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; to the {!do_for_multiple_match} usage, which tries to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; compile a tuple pattern [match e1, .. en with ...]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; without allocating the tuple [(e1, .., en)].<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fresh_clause</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">arg_id</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">renaming_env</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fresh_pat</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L278" title="ocaml/lambda/matching.ml:278">alpha</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">renaming_env</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fresh_action</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">mk_action</span><span class="ocamlFuncStruct"> </span><span class="Statement">~</span><span class="Identifier">vars</span><span class="ocamlFuncStruct">:</span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">rev</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">fresh_pat</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">fresh_action</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_id</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem_vars</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mem</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pat_id</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">aliases</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlFuncStruct"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fresh_id</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Ident</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L427" title="ocaml/lambda/lambda.mli:427">rename</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pat_id</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">fresh_id</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">renaming_env</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">pat_id</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">fresh_id</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">renaming_env</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">fresh_clause</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">arg_id</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">renaming_env</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem_vars<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end</span><span class="ocamlFuncStruct"> </span><span class="Statement">else</span><span class="ocamlFuncStruct"> </span><span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">arg_id</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlEnd">, </span><span class="Statement">_<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd">, </span><span class="Constant">Lvar</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">fresh_clause</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">arg_id</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">renaming_env</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem_vars<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd">, </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* [pat_id] is a <a href="translcore.ml.html#L56" title="ocaml/lambda/translcore.ml:56">name</a> used locally to refer to the argument,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; so it makes sense to reuse it (refreshed) *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Ident</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L427" title="ocaml/lambda/lambda.mli:427">rename</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pat_id</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pat</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">action</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">fresh_clause</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">action_vars</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">renaming_env</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem_vars<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">pat</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/lambda/matching.ml:153">bind_alias</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pat</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">action<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">fresh_clause</span><span class="ocamlFuncStruct"> </span><span class="Constant">None</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">patbound_action_vars</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">explode</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> : </span><span class="PreProc">Half_simple</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlFuncStruct"> :</span><span class="Statement">&gt;</span><span class="ocamlFuncStruct"> </span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pattern</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><a id="L382">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">expand_record_simple</span></span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">pattern</span> <span class="Statement">-&gt;</span> <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">pattern</span> <span class="Statement">=<br/></li>
<li></span> <span class="Statement">fun</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Record</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">`Record</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L132" title="ocaml/lambda/matching.ml:132">all_record_args</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>, <span class="Constant">Closed</span><span class="Statement">)</span> <span class="Statement">}<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">p<br/></li>
<li></span><br/></li>
<li><a id="L388">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">initial_clause</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pattern</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span> <span class="ocamlLCIdentifier">clause<br/></li>
<li></span><br/></li>
<li><a id="L390">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">matrix</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pattern</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a><br/></li>
<li></span><br/></li>
<li><a id="L392">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_omega_column</span></span> <span class="ocamlLCIdentifier">pss</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">ps</span> <span class="Statement">-&gt;</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omega</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pss<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">rev_split_at</span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier">ps</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">[]</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">ps</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span>, <span class="ocamlLCIdentifier">right</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">rev_split_at</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span>, <span class="ocamlLCIdentifier">right</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">NoMatch<br/></li>
<li></span><br/></li>
<li><a id="L406">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">matcher</span></span> <span class="ocamlLCIdentifier">discr</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">pattern</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">discr</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">expand_record_head</span> <span class="ocamlLCIdentifier">discr</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L382" title="ocaml/lambda/matching.ml:382">expand_record_simple</a></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">omegas</span> <span class="Statement">=</span> <span class="PreProc">Patterns</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">omegas</span> <span class="Statement">(</span><span class="PreProc">Head</span>.<span class="ocamlLCIdentifier">arity</span> <span class="ocamlLCIdentifier">discr</span><span class="Statement">))</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ph</span>, <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="ocamlLCIdentifier">deconstruct</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="Constant">()</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> @ <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">no</span> <span class="Constant">()</span> <span class="Statement">=</span> <span class="Statement">raise</span> <span class="Constant">NoMatch</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">yesif</span> <span class="ocamlLCIdentifier">b</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">b</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">no</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L419">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><span class="linkable">open</span></span><span class="ocamlNone"> </span><span class="PreProc">Patterns.Head</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">discr</span>.<span class="ocamlLCIdentifier">pat_desc</span>, <span class="ocamlLCIdentifier">ph</span>.<span class="ocamlLCIdentifier">pat_desc</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Any</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span> <span class="Statement">(</span> <span class="Constant">Constant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_</span> <span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">Any</span> <span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">omegas</span> @ <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="ocamlLCIdentifier">cst</span>, <span class="Constant">Constant</span> <span class="ocamlLCIdentifier">cst</span>' <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">yesif</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">const_compare</span> <span class="ocamlLCIdentifier">cst</span> <span class="ocamlLCIdentifier">cst</span>' <span class="Statement">=</span> <span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="Constant">Construct</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">no</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="ocamlLCIdentifier">cstr</span>, <span class="Constant">Construct</span> <span class="ocamlLCIdentifier">cstr</span>' <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* NB: may_equal_constr considers (potential) constructor rebinding;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Types.may_equal_constr does check that the arities are the same,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; preserving row-<a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a> coherence. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">yesif</span> <span class="Statement">(</span><span class="PreProc">Types</span>.<span class="ocamlLCIdentifier">may_equal_constr</span> <span class="ocamlLCIdentifier">cstr</span> <span class="ocamlLCIdentifier">cstr</span>'<span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="Constant">Constant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">no</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">has_arg</span> <span class="Statement">}</span>, <span class="Constant">Variant</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span>'<span class="Statement">;</span> <span class="ocamlLCIdentifier">has_arg</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">has_arg</span>' <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">yesif</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span>' <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier">has_arg</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">has_arg</span>'<span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="Constant">Constant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">no</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Array</span> <span class="ocamlLCIdentifier">n1</span>, <span class="Constant">Array</span> <span class="ocamlLCIdentifier">n2</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">yesif</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="Constant">Constant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">no</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="ocamlLCIdentifier">n1</span>, <span class="Constant">Tuple</span> <span class="ocamlLCIdentifier">n2</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">yesif</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">n2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="Constant">Constant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">no</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>, <span class="Constant">Record</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>' <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* we already expanded the record fully *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">yesif</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>'<span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="Constant">Constant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">no</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lazy</span>, <span class="Constant">Lazy</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lazy</span>, <span class="Statement">(</span><span class="Constant">Constant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">no</span> <span class="Constant">()<br/></li>
<li></span><br/></li>
<li><a id="L462">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">ncols</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Constant">0<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">ps</span> <span class="Statement">::</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">ps<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Context</span><span class="ocamlPreDef"> : </span><span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">bool<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L535" title="ocaml/lambda/matching.ml:535">start</a></span><span class="ocamlSig"> : </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type"><a href="tmc.ml.html#L197" title="ocaml/lambda/tmc.ml:197">unit</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a></span><span class="ocamlSig"> : </span><span class="PreProc">Patterns</span><span class="ocamlSig">.</span><span class="PreProc">Head</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L503" title="ocaml/lambda/matching.ml:503">lshift</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L513" title="ocaml/lambda/matching.ml:513">rshift</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L518" title="ocaml/lambda/matching.ml:518">rshift_num</a></span><span class="ocamlSig"> : </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L596" title="ocaml/lambda/matching.ml:596">lub</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">matches</span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">bool<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L525" title="ocaml/lambda/matching.ml:525">combine</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L585" title="ocaml/lambda/matching.ml:585">select_columns</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><span class="PreProc">end</span> <span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">module</span><span class="PreProc"> Row</span><span class="ocamlPreDef"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">struct<br/></li>
<li><a id="L496">&#x200c;</a></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> : </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlStruct"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> : </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlStruct"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L498">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">eprintf</span></span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span><span class="ocamlStruct"> </span><span class="Constant">&quot;LEFT:%a RIGHT:%a\n&quot;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">pretty_line</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">pretty_line</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right<br/></li>
<li></span><br/></li>
<li><a id="L501">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">le</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c1</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c2</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">le_pats</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c1</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c2</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">le_pats</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c1</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c2</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">right<br/></li>
<li></span><br/></li>
<li><a id="L503">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">lshift</span></span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">xs</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">xs</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">assert</span><span class="ocamlStruct"> </span><span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L508">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">lforget</span></span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">xs</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Patterns</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">omega</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">xs</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">assert</span><span class="ocamlStruct"> </span><span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L513">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">rshift</span></span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">assert</span><span class="ocamlStruct"> </span><span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L518">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">rshift_num</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">shifted</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rev_split_at</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">shifted</span><span class="ocamlStruct"> @ </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Comment">(** Recombination of contexts (eg: (_,_)::p1::p2::rem -&gt;&nbsp; (p1,p2)::rem)<br/></li>
<li></span><span class="Comment">&nbsp; All mutable fields are replaced by '_', since side-effects in<br/></li>
<li></span><span class="Comment">&nbsp; guards can alter these fields *)<br/></li>
<li><a id="L525">&#x200c;</a></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">combine</span></span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">set_args_erase_mutable</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">assert</span><span class="ocamlStruct"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><a id="L531">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a><br/></li>
<li></span><br/></li>
<li><a id="L533">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">empty</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><a id="L535">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">start</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Patterns</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">omegas</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">]<br/></li>
<li></span><br/></li>
<li><a id="L537">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">is_empty</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">true<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L541">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">eprintf</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">iter</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">eprintf</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx<br/></li>
<li></span><br/></li>
<li><a id="L543">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">lshift</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">match_context_rows</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L503" title="ocaml/lambda/matching.ml:503">lshift</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Comment">(* Context pruning *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">get_mins</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L501" title="ocaml/lambda/matching.ml:501">le</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L508" title="ocaml/lambda/matching.ml:508">lforget</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L550">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">rshift</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">rshift</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx<br/></li>
<li></span><br/></li>
<li><a id="L552">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">rshift_num</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">rshift_num</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx<br/></li>
<li></span><br/></li>
<li><a id="L554">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">combine</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">combine</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx<br/></li>
<li></span><br/></li>
<li><a id="L556">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">specialize</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">non_empty</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">_;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">fatal_error</span><span class="ocamlFuncStruct"> </span><span class="Constant">&quot;Matching.Context.<a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a>&quot;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">non_empty</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">right</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Or</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">right</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">right</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Alias</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="Statement">_</span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">right</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Var</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct">, </span><span class="PreProc">Patterns</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">omega</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">right</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="PreProc">#Simple</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L406" title="ocaml/lambda/matching.ml:406">matcher</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">exception</span><span class="ocamlFuncStruct"> </span><span class="Constant">NoMatch</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Patterns</span><span class="ocamlFuncStruct">.</span><span class="PreProc">Head</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">to_omega_pattern</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx<br/></li>
<li></span><br/></li>
<li><a id="L585">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">select_columns</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L462" title="ocaml/lambda/matching.ml:462">ncols</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">lub_row</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">transfer</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rev_split_at</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">lubs</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">transfer</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">exception</span><span class="ocamlFuncStruct"> </span><span class="Constant">Empty</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L223" title="ocaml/lambda/switch.ml:223">inter</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">Some</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L223" title="ocaml/lambda/switch.ml:223">inter</a></span><span class="ocamlFuncStruct"> @ </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">lub_with_ctx</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">filter_map</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lub_row</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">flatten</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">lub_with_ctx</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L596">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">lub</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">filter_map<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">try</span><span class="ocamlFuncStruct"> </span><span class="Constant">Some</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a></span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L596" title="ocaml/lambda/matching.ml:596">lub</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="Constant">Empty</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fatal_error</span><span class="ocamlFuncStruct"> </span><span class="Constant">&quot;Matching.Context.<a href="#L596" title="ocaml/lambda/matching.ml:596">lub</a>&quot;</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">ctx<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">matches</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">exists<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">right</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">qs</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">exists</span><span class="ocamlFuncStruct"> </span><span class="Statement">(fun</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">may_compats</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">qs</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">ctx<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">qss</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">get_mins</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Row</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L501" title="ocaml/lambda/matching.ml:501">le</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> @ </span><span class="ocamlLCIdentifier">qss</span><span class="Statement">)<br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">flatten_pat_line</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_any</span> <span class="Statement">|</span> <span class="Constant">Tpat_var</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omegas</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_tuple</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_or</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span>, <span class="ocamlLCIdentifier">p2</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">flatten_pat_line</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">p1</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">flatten_pat_line</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">p2</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_alias</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Note: we are only called from <a href="#L628" title="ocaml/lambda/matching.ml:628">flatten_matrix</a>,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; which is itself only ever used in places<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; where variables do not matter (default environments,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &quot;provenance&quot;, etc.). *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">flatten_pat_line</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.flatten_pat_line&quot;<br/></li>
<li></span><br/></li>
<li><a id="L628">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">flatten_matrix</span></span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">pss</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">ps</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">ps</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">flatten_pat_line</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.<a href="#L628" title="ocaml/lambda/matching.ml:628">flatten_matrix</a>&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pss</span> <span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><span class="Comment">(** A default environment (referred to as &quot;reachable trap handlers&quot; in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; paper), is an ordered <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> of [<a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> * raise_num] pairs, and is used to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; decide where to jump <a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a> if <a href="debuginfo.ml.html#L118" title="ocaml/lambda/debuginfo.ml:118">none</a> of the rows in a given <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> match the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; input.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; In such situations, one thing you can do is to jump to the first (leftmost)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; [raise_num] in that <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> (by doing a raise to the static-cach handler number<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; [raise_num]); and you can assume that if the associated pm doesn'<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> match<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; either, it will do the same thing, etc.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; This is what [<a href="#L2637" title="ocaml/lambda/matching.ml:2637">mk_failaction_neg</a>] (and its callers) does.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; A more sophisticated alternative is to use what you know about the input<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; (what you might already have matched) and the current pm (what you know you<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; can'<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> match) to directly jump to a pm that might match it instead of the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; <a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a> one; that is why we don'<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> just keep [raise_num]<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a> but also the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; associated matrices.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; [<a href="#L2652" title="ocaml/lambda/matching.ml:2652">mk_failaction_pos</a>] does (a slightly more sophisticated version of) this.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><span class="Statement">module</span><span class="PreProc"> Default_environment</span><span class="ocamlPreDef"> : </span><span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">bool<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L809" title="ocaml/lambda/matching.ml:809">pop</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="ocamlSig"> </span><span class="Statement">*</span><span class="ocamlSig"> </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="Statement">*</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="Type"><a href="tmc.ml.html#L473" title="ocaml/lambda/tmc.ml:473">option</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L36" title="ocaml/lambda/debuginfo.ml:36">cons</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a></span><span class="ocamlSig"> : </span><span class="PreProc">Patterns</span><span class="ocamlSig">.</span><span class="PreProc">Head</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L798" title="ocaml/lambda/matching.ml:798">pop_column</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">pop_compat</span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier">pattern</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">flatten</span><span class="ocamlSig"> : </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lambda/matching.ml:813">pp</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type"><a href="tmc.ml.html#L197" title="ocaml/lambda/tmc.ml:197">unit</a><br/></li>
<li></span><span class="PreProc">end</span> <span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li><a id="L675">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">*</span><span class="ocamlFuncStruct"> </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a><br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Comment">(** All matrices in the <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> should have the same arity -- their rows should<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; have the same number of columns -- as it should match the arity of the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; current scrutiny vector. *)<br/></li>
<li></span><br/></li>
<li><a id="L680">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">empty</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><a id="L682">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">is_empty</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">true<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L686">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">cons</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">raise_num</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">default</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">raise_num</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">default<br/></li>
<li></span><br/></li>
<li><a id="L691">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">specialize_matrix</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">arity</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L406" title="ocaml/lambda/matching.ml:406">matcher</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">General</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Alias</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="Statement">_</span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Var</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="PreProc">Patterns</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">omega</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">`Or</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec_or</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="PreProc">#Simple</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">view</span><span class="ocamlFuncStruct"> </span><span class="Statement">}</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L406" title="ocaml/lambda/matching.ml:406">matcher</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">exception</span><span class="ocamlFuncStruct"> </span><span class="Constant">NoMatch</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="tmc.ml.html#L548" title="ocaml/lambda/tmc.ml:548">specialized</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">assert</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="tmc.ml.html#L548" title="ocaml/lambda/tmc.ml:548">specialized</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> + </span><span class="ocamlLCIdentifier">arity</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="tmc.ml.html#L548" title="ocaml/lambda/tmc.ml:548">specialized</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Comment">(* Filter just one row, without a `rem` accumulator<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; of further rows to process.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; The following equality holds:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; filter_rec ((p :: ps) :: rem)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; = filter_one p ps @ filter_rec rem<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">and</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_one</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">]<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">and</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec_or</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">arity</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">0</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* if K has arity 0, specializing ((K|K)::rem) returns just (rem):<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if either sides works (filters into a non-<a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a> <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a>),<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; no need to keep the other. *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_one</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">matches</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">matches</span><span class="ocamlFuncStruct"> @ </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">1</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* if K has arity 1, ((K p | K q) :: rem) can be expressed<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; as ((p | q) :: rem): even if both sides of an or-pattern<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; match, we can compress the output in a single row,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; instead of duplicating the row.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; In particular, filtering a single row (the filter_one calls)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; returns a result that respects the following properties:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - &quot;row count&quot;: the result is either an <a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a> <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> or a single row<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - &quot;row <a href="translprim.ml.html#L486" title="ocaml/lambda/translprim.ml:486">shape</a>&quot;: if there is a row in the result, it contains one<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; pattern consed to the <a href="simplif.ml.html#L812" title="ocaml/lambda/simplif.ml:812">tail</a> [ps] of our input row; in particular<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; the row is not <a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a>. *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">filter_one</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">filter_one</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">row<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">row</span><span class="ocamlFuncStruct">, </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">row</span><span class="ocamlFuncStruct"> @ </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">arg1</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">]</span><span class="ocamlFuncStruct">, </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">arg2</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* By the row <a href="translprim.ml.html#L486" title="ocaml/lambda/translprim.ml:486">shape</a> property,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; the wildcard patterns can only be ps. *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* The output below is a single row,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; respecting the row count property. *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">({</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">arg1</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">Tpat_or</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">arg1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">arg2</span><span class="ocamlFuncStruct">, </span><span class="Constant">None</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">pat_loc</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Location</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L118" title="ocaml/lambda/debuginfo.ml:118">none</a><br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">(_</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_)</span><span class="ocamlFuncStruct">, </span><span class="Statement">_<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct">, </span><span class="Statement">(_</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* Cannot happen from the row count property. *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">assert</span><span class="ocamlFuncStruct"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">]</span><span class="ocamlFuncStruct">, </span><span class="Statement">_<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct">, </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* Cannot happen from the row <a href="translprim.ml.html#L486" title="ocaml/lambda/translprim.ml:486">shape</a> property. *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">assert</span><span class="ocamlFuncStruct"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* we cannot preserve the or-pattern as in the arity-1 case,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; because we cannot express<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (K (p1, .., pn) | K (q1, .. qn))<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; as (p1 .. pn | q1 .. qn) *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">p1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p2</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">filter_rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss<br/></li>
<li></span><br/></li>
<li><a id="L775">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">specialize_</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">arity</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L406" title="ocaml/lambda/matching.ml:406">matcher</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L430" title="ocaml/lambda/switch.ml:430">make_rec</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_)</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Statement">([</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">]</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* we already handled the <a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a>-row case<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; so we know that all rows in pss are non-<a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a> *)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">non_empty</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">assert</span><span class="ocamlFuncStruct"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">non_empty</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L691" title="ocaml/lambda/matching.ml:691">specialize_matrix</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">arity</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L406" title="ocaml/lambda/matching.ml:406">matcher</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L430" title="ocaml/lambda/switch.ml:430">make_rec</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Statement">([</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">]</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L430" title="ocaml/lambda/switch.ml:430">make_rec</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L430" title="ocaml/lambda/switch.ml:430">make_rec</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env<br/></li>
<li></span><br/></li>
<li><a id="L795">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">specialize</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L775" title="ocaml/lambda/matching.ml:775">specialize_</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">Patterns</span><span class="ocamlFuncStruct">.</span><span class="PreProc">Head</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">arity</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L406" title="ocaml/lambda/matching.ml:406">matcher</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def<br/></li>
<li></span><br/></li>
<li><a id="L798">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">pop_column</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L775" title="ocaml/lambda/matching.ml:775">specialize_</a></span><span class="ocamlFuncStruct"> </span><span class="Constant">0</span><span class="ocamlFuncStruct"> </span><span class="Statement">(fun</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">_p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pop_compat</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">compat_matcher</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L115" title="ocaml/lambda/matching.ml:115">may_compat</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">General</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">erase</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">q</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">raise</span><span class="ocamlFuncStruct"> </span><span class="Constant">NoMatch<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L775" title="ocaml/lambda/matching.ml:775">specialize_</a></span><span class="ocamlFuncStruct"> </span><span class="Constant">0</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">compat_matcher</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def<br/></li>
<li></span><br/></li>
<li><a id="L809">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">pop</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">defs</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">Some</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">def</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">defs</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L813">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">pp</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span><span class="ocamlFuncStruct"> </span><span class="Constant">&quot;+++++ Defaults +++++\n&quot;</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">iter<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Format</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span><span class="ocamlFuncStruct"> </span><span class="Constant">&quot;Matrix for %d\n%a&quot;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pretty_matrix</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">def</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span><span class="ocamlFuncStruct"> </span><span class="Constant">&quot;+++++++++++++++++++++\n&quot;<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">flatten</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(fun</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L628" title="ocaml/lambda/matching.ml:628">flatten_matrix</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">))</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">def<br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Jumps</span><span class="ocamlPreDef"> : </span><span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">bool<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L878" title="ocaml/lambda/matching.ml:878">singleton</a></span><span class="ocamlSig"> : </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="PreProc">Context</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span><span class="ocamlSig"> : </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="PreProc">Context</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L916" title="ocaml/lambda/matching.ml:916">unions</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlSig"> : </span><span class="Statement">(</span><span class="PreProc">Context</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="PreProc">Context</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L867" title="ocaml/lambda/matching.ml:867">remove</a></span><span class="ocamlSig"> : </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">extract</span><span class="ocamlSig"> : </span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="PreProc">Context</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">*</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type"><a href="tmc.ml.html#L197" title="ocaml/lambda/tmc.ml:197">unit</a><br/></li>
<li></span><span class="PreProc">end</span> <span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li><a id="L847">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">*</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Context</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a><br/></li>
<li></span><br/></li>
<li><a id="L849">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">eprintf</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">iter<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ctx</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Printf</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span><span class="ocamlFuncStruct"> </span><span class="Constant">&quot;jump for %d\n&quot;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Context</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">env<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">extract</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="PreProc">Context</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="ocamlFuncStruct">, </span><span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">j</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">pss</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">all</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pss</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlFuncStruct"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="PreProc">Context</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">all</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">extract</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">x</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L867">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">remove</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlFuncStruct">, </span><span class="Statement">_)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">when</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L867" title="ocaml/lambda/matching.ml:867">remove</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><br/></li>
<li><a id="L872">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">empty</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">and</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">true<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L878">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">singleton</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Context</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ctx</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">]<br/></li>
<li></span><br/></li>
<li><a id="L884">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">add</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">jumps</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ctx</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">j</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">qss</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">all</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">x</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlFuncStruct"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">ctx</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">all<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct">, </span><span class="PreProc">Context</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">qss</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Context</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">jumps<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">jumps<br/></li>
<li></span><br/></li>
<li><a id="L900">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">union</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L744" title="ocaml/lambda/translclass.ml:744">env1</a></span><span class="ocamlFuncStruct"> : </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env2</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L744" title="ocaml/lambda/translclass.ml:744">env1</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">env2</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct">, </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env2<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct">, </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L744" title="ocaml/lambda/translclass.ml:744">env1</a><br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">i1</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">pss1</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">x1</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem1</span><span class="ocamlFuncStruct">, </span><span class="Statement">((</span><span class="ocamlLCIdentifier">i2</span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">pss2</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">as</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">x2</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem2</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i1</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i2</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i1</span><span class="ocamlFuncStruct">, </span><span class="PreProc">Context</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss2</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem2<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlFuncStruct"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i1</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i2</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">x1</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env2<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">x2</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L744" title="ocaml/lambda/translclass.ml:744">env1</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem2<br/></li>
<li></span><br/></li>
<li><a id="L912">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">merge</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L744" title="ocaml/lambda/translclass.ml:744">env1</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env2</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L744" title="ocaml/lambda/translclass.ml:744">env1</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env2</span><span class="ocamlFuncStruct"> </span><span class="Statement">::</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L912" title="ocaml/lambda/matching.ml:912">merge</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L221" title="ocaml/lambda/translclass.ml:221">envs</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L221" title="ocaml/lambda/translclass.ml:221">envs</a><br/></li>
<li></span><br/></li>
<li><a id="L916">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="Statement">rec</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">unions</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L221" title="ocaml/lambda/translclass.ml:221">envs</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L221" title="ocaml/lambda/translclass.ml:221">envs</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">[</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="Statement">]</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Statement">_</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L916" title="ocaml/lambda/matching.ml:916">unions</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L912" title="ocaml/lambda/matching.ml:912">merge</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L221" title="ocaml/lambda/translclass.ml:221">envs</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L922">&#x200c;</a><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">map</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">List</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">map</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">(fun</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">pss</span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">pss</span><span class="Statement">))</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">env<br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Pattern matching before any compilation *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> '<span class="ocamlLCIdentifier">row</span> <span class="ocamlLCIdentifier">pattern_matching</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="Statement">mutable</span> <span class="ocamlLCIdentifier">cases</span> : '<span class="ocamlLCIdentifier">row</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> : <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L250" title="ocaml/lambda/lambda.mli:250">let_kind</a></span><span class="Statement">)</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(** <a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a> are not just Ident.<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> in at least the following cases:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; - when matching the arguments of a constructor,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="tmc.ml.html#L439" title="ocaml/lambda/tmc.ml:439">direct</a> <a href="translmod.ml.html#L1095" title="ocaml/lambda/translmod.ml:1095">field</a> projections are used (make_field_args)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; - with lazy patterns <a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a> can be of the form [Lazy.force ...]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L1968" title="ocaml/lambda/matching.ml:1968">inline_lazy_force</a>). *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">default</span> : <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">provenance</span> : <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a></span> : <span class="Type"><a href="translobj.ml.html#L84" title="ocaml/lambda/translobj.ml:84">int</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">vars</span> : <span class="Statement">(</span><span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="Statement">*</span> <span class="PreProc">Lambda</span>.<span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L56" title="ocaml/lambda/printlambda.ml:56">value_kind</a></span><span class="Statement">)</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pm</span> : <span class="ocamlLCIdentifier"><a href="#L388" title="ocaml/lambda/matching.ml:388">initial_clause</a></span> <span class="ocamlLCIdentifier">pattern_matching<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="Statement">(</span>'<span class="ocamlLCIdentifier">head_pat</span>, '<span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pm_or_compiled</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> : '<span class="ocamlLCIdentifier">head_pat</span> <span class="PreProc">Non_empty_row</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="ocamlLCIdentifier">clause</span> <span class="ocamlLCIdentifier">pattern_matching</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">handlers</span> : <span class="ocamlLCIdentifier">handler</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">or_matrix</span> : '<span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a><br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Pattern matching after application of both the or-pat rule and the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; mixture rule *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier">pm_half_compiled</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">PmOr</span> <span class="Statement">of</span> <span class="Statement">(</span><span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">pattern</span>, <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pm_or_compiled<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">PmVar</span> <span class="Statement">of</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">inside</span> : <span class="ocamlLCIdentifier">pm_half_compiled</span> <span class="Statement">}<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pm</span> <span class="Statement">of</span> <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="ocamlLCIdentifier">pattern_matching<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Only used inside the various split functions, we only keep [me] when we're<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; done splitting / precompiling. *)<br/></li>
<li></span><span class="Statement">type</span> <span class="ocamlLCIdentifier">pm_half_compiled_info</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">me</span> : <span class="ocamlLCIdentifier">pm_half_compiled</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span> : <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Comment">(* the <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> matched by [me]. Is used to extend the <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> of reachable trap<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; handlers (aka &quot;default environments&quot;) when returning from recursive<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; calls. *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">top_default</span> : <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">erase_cases</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">ps</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">))</span> <span class="ocamlLCIdentifier">cases<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">erase_pm</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">erase_cases</span> <span class="PreProc">General</span>.<span class="ocamlLCIdentifier">erase</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">pretty_cases</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ps</span>, <span class="ocamlLCIdentifier">_l</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">-&gt;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot; %a%!&quot;</span> <span class="ocamlLCIdentifier">top_pretty</span> <span class="ocamlLCIdentifier">p</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">ps</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;\n&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">cases<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">pretty_pm</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pretty_cases</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">Default_environment</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pm</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">default</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lambda/matching.ml:813">pp</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">default<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">pretty_precompiled</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pm</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;++++ PM ++++\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_pm</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">erase_pm</span> <span class="ocamlLCIdentifier">pm</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">PmVar</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;++++ VAR ++++\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_precompiled</span> <span class="ocamlLCIdentifier">x</span>.<span class="ocamlLCIdentifier">inside<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">PmOr</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;++++ OR ++++\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_pm</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">erase_pm</span> <span class="ocamlLCIdentifier">x</span>.<span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_matrix</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">err_formatter</span> <span class="ocamlLCIdentifier">x</span>.<span class="ocamlLCIdentifier">or_matrix</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pm</span><span class="Statement">;</span> <span class="Statement">_</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;++ Handler %d ++\n&quot;</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_pm</span> <span class="ocamlLCIdentifier">pm</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">x</span>.<span class="ocamlLCIdentifier">handlers<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">pretty_precompiled_res</span> <span class="ocamlLCIdentifier">first</span> <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pretty_precompiled</span> <span class="ocamlLCIdentifier">first</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>, <span class="ocamlLCIdentifier">pmh</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;** DEFAULT %d **\n&quot;</span> <span class="ocamlLCIdentifier">e</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_precompiled</span> <span class="ocamlLCIdentifier">pmh</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">nexts<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Identifying some semantically equivalent <a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a>-expressions,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Our goal here is also to<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; find <a href="#L278" title="ocaml/lambda/matching.ml:278">alpha</a>-equivalent (simple) terms *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* However, as shown by PR#6359 such sharing may hinders the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a>-code invariant that all bound idents are unique,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; when switches are compiled to <a href="#L2340" title="ocaml/lambda/matching.ml:2340">test</a> sequences.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; The definitive fix is the systematic introduction of <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a>/catch<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; in case action sharing is present.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> StoreExp</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Switch.Store</span> <span class="ocamlFuncWith">(</span><span class="PreProc">struct<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.mli.html#L42" title="ocaml/lambda/switch.mli:42">key</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.mli.html#L43" title="ocaml/lambda/switch.mli:43">compare_key</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Stdlib</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L188" title="ocaml/lambda/debuginfo.ml:188">compare</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L362" title="ocaml/lambda/lambda.mli:362">make_key</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Lambda</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L362" title="ocaml/lambda/lambda.mli:362">make_key</a><br/></li>
<li></span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2413" title="ocaml/lambda/matching.ml:2413">make_exit</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">=</span> <span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Introduce a catch, if worth it *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2411" title="ocaml/lambda/matching.ml:2411">make_catch</a></span> <span class="ocamlLCIdentifier">d</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstaticraise</span> <span class="Statement">(_</span>, <span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="ocamlLCIdentifier">d<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L469" title="ocaml/lambda/lambda.mli:469">next_raise_count</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lstaticcatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2413" title="ocaml/lambda/matching.ml:2413">make_exit</a></span> <span class="ocamlLCIdentifier">e</span><span class="Statement">)</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>, <span class="Constant">[]</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">d</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Introduce a catch, if worth it, delayed version *)<br/></li>
<li><a id="L1045">&#x200c;</a></span><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">as_simple_exit</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Llet</span> <span class="Statement">(</span><span class="Constant">Alias</span>, <span class="ocamlLCIdentifier">_k</span>, <span class="Statement">_</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">e</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1045" title="ocaml/lambda/matching.ml:1045">as_simple_exit</a></span> <span class="ocamlLCIdentifier">e<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span><br/></li>
<li><a id="L1050">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_catch_delayed</span></span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L1045" title="ocaml/lambda/matching.ml:1045">as_simple_exit</a></span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="Statement">fun</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L469" title="ocaml/lambda/lambda.mli:469">next_raise_count</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; Printf.<a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a> &quot;SHARE LAMBDA: %<a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a>\n%<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>\n&quot; <a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a> (<a href="#L128" title="ocaml/lambda/matching.ml:128">string_of_lam</a> handler);<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">fun</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">j</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">handler<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Lstaticcatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span>, <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="Constant">[]</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">handler</span><span class="Statement">)</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">raw_action</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L362" title="ocaml/lambda/lambda.mli:362">make_key</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span><br/></li>
<li><a id="L1074">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">same_actions</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">act0</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L362" title="ocaml/lambda/lambda.mli:362">make_key</a></span> <span class="ocamlLCIdentifier">act0</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">key0_opt</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L444" title="ocaml/lambda/switch.ml:444">same_act</a></span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L362" title="ocaml/lambda/lambda.mli:362">make_key</a></span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">key0_opt</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">for_all</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L444" title="ocaml/lambda/switch.ml:444">same_act</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Some</span> <span class="ocamlLCIdentifier">act0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L1088">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">safe_before</span></span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">act_p</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* Test for swapping two clauses *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1074" title="ocaml/lambda/matching.ml:1074">same_actions</a></span> <span class="ocamlLCIdentifier">act1</span> <span class="ocamlLCIdentifier">act2</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L362" title="ocaml/lambda/lambda.mli:362">make_key</a></span> <span class="ocamlLCIdentifier">act1</span>, <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L362" title="ocaml/lambda/lambda.mli:362">make_key</a></span> <span class="ocamlLCIdentifier">act2</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">key1</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier">key2</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">key1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">key2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span>, <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">for_all<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">q</span>, <span class="ocamlLCIdentifier">qs</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">act_q</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1074" title="ocaml/lambda/matching.ml:1074">same_actions</a></span> <span class="ocamlLCIdentifier">act_p</span> <span class="ocamlLCIdentifier">act_q<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">||</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">may_compats</span> <span class="Statement">(</span><span class="PreProc">General</span>.<span class="ocamlLCIdentifier">erase</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">General</span>.<span class="ocamlLCIdentifier">erase</span> <span class="ocamlLCIdentifier">q</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">qs</span><span class="Statement">)))<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">half_simplify_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cls</span> : <span class="PreProc">Typedtree</span>.<span class="ocamlLCIdentifier">pattern</span> <span class="PreProc">Non_empty_row</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="ocamlLCIdentifier">clause</span><span class="Statement">)<br/></li>
<li></span>&nbsp; : <span class="PreProc">Half_simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">cls<br/></li>
<li></span>&nbsp; <span class="Statement">|&gt;</span> <span class="ocamlLCIdentifier">map_on_row</span> <span class="Statement">(</span><span class="PreProc">Non_empty_row</span>.<span class="ocamlLCIdentifier">map_first</span> <span class="PreProc">General</span>.<span class="ocamlLCIdentifier">view</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|&gt;</span> <span class="PreProc">Half_simple</span>.<span class="ocamlLCIdentifier"><a href="#L224" title="ocaml/lambda/matching.ml:224">of_clause</a></span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">half_simplify_clause</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cls</span> : <span class="PreProc">Typedtree</span>.<span class="ocamlLCIdentifier">pattern</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span> <span class="ocamlLCIdentifier">clause</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">cls<br/></li>
<li></span>&nbsp; <span class="Statement">|&gt;</span> <span class="ocamlLCIdentifier">map_on_row</span> <span class="PreProc">Non_empty_row</span>.<span class="ocamlLCIdentifier">of_initial<br/></li>
<li></span>&nbsp; <span class="Statement">|&gt;</span> <span class="ocamlLCIdentifier">half_simplify_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Once matchings are *fully* simplified, one can easily find<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; their nature. *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">what_is_cases</span> <span class="Statement">~</span><span class="Identifier">skip_any</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="ocamlLCIdentifier">omega<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="Statement">_)</span>, <span class="Statement">_)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">=</span> <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="Constant">Any</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">skip_any</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">what_is_cases</span> <span class="Statement">~</span><span class="Identifier">skip_any</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">what_is_first_case</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">what_is_cases</span> <span class="Statement">~</span><span class="Identifier">skip_any</span>:<span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">what_is_cases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">what_is_cases</span> <span class="Statement">~</span><span class="Identifier">skip_any</span>:<span class="Constant">true<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">pm_free_variables</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">}</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span> <span class="Statement">-&gt;</span> <span class="PreProc">Ident</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L401" title="ocaml/lambda/lambda.mli:401">free_variables</a></span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">cases</span> <span class="PreProc">Ident</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Basic grouping predicates *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">can_group</span> <span class="ocamlLCIdentifier">discr</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Patterns.Head</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">discr</span>.<span class="ocamlLCIdentifier">pat_desc</span>, <span class="Statement">(</span><span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">pat</span><span class="Statement">)</span>.<span class="ocamlLCIdentifier">pat_desc</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Any</span>, <span class="Constant">Any<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_int</span> <span class="Statement">_)</span>, <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_int</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_char</span> <span class="Statement">_)</span>, <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_char</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_string</span> <span class="Statement">_)</span>, <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_string</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_float</span> <span class="Statement">_)</span>, <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_float</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_int32</span> <span class="Statement">_)</span>, <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_int32</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_int64</span> <span class="Statement">_)</span>, <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_int64</span> <span class="Statement">_)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_nativeint</span> <span class="Statement">_)</span>, <span class="Constant">Constant</span> <span class="Statement">(</span><span class="Constant">Const_nativeint</span> <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cstr_tag</span> <span class="Statement">=</span> <span class="Constant">Cstr_extension</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">discr_tag</span> <span class="Statement">}</span>, <span class="Constant">Construct</span> <span class="ocamlLCIdentifier">pat_cstr<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Extension constructors with distinct names may be <a href="simplif.ml.html#L782" title="ocaml/lambda/simplif.ml:782">equal</a> thanks to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; constructor rebinding. So we need to produce a <a href="tmc.ml.html#L548" title="ocaml/lambda/tmc.ml:548">specialized</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; submatrix for each syntactically-distinct constructor (with a threading<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; of exits such that each submatrix falls back to the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; potentially-compatible submatrices below it).&nbsp; *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Types</span>.<span class="ocamlLCIdentifier">equal_tag</span> <span class="ocamlLCIdentifier">discr_tag</span> <span class="ocamlLCIdentifier">pat_cstr</span>.<span class="ocamlLCIdentifier">cstr_tag<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span>, <span class="Constant">Construct</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="Constant">Tuple</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Any</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="Constant">Record</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Any</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span>, <span class="Constant">Array</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span>, <span class="Constant">Variant</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lazy</span>, <span class="Constant">Lazy</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span> <span class="Statement">_</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Any<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Constant<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Const_int</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Const_char</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Const_string</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Const_float</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_int32</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Const_int64</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Const_nativeint</span> <span class="Statement">_</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">)</span> <span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1173">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">is_or</span></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_or</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1178">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">omega_like</span></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_any<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_var</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_alias</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1178" title="ocaml/lambda/matching.ml:1178">omega_like</a></span> <span class="ocamlLCIdentifier">p<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_or</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span>, <span class="ocamlLCIdentifier">p2</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1178" title="ocaml/lambda/matching.ml:1178">omega_like</a></span> <span class="ocamlLCIdentifier">p1</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier"><a href="#L1178" title="ocaml/lambda/matching.ml:1178">omega_like</a></span> <span class="ocamlLCIdentifier">p2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1187">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">simple_omega_like</span></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">p</span><span class="Statement">)</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Any</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1192">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">equiv_pat</span></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">q</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">le_pat</span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">q</span> <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier">le_pat</span> <span class="ocamlLCIdentifier">q</span> <span class="ocamlLCIdentifier">p<br/></li>
<li></span><br/></li>
<li><a id="L1194">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">extract_equiv_head</span></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(((</span><span class="ocamlLCIdentifier">q</span>, <span class="Statement">_)</span>, <span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1192" title="ocaml/lambda/matching.ml:1192">equiv_pat</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">General</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">erase</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">q</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">others</span>, <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1194" title="ocaml/lambda/matching.ml:1194">extract_equiv_head</a></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">others</span>, <span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">[]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">[]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Or_matrix</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Comment">(* Splitting a <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> uses an or-<a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> that contains or-patterns (at<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; the <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a> of some of its rows).<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; The property that we want to maintain for the rows of the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; or-<a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> is that if the row p::ps is before q::qs and p is an<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; or-pattern, and v::vs matches p but not ps, then we don'<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> need to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; try q::qs. This is necessary because the compilation of the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; or-pattern p will <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> to a sub-<a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> and never come back.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; For this to hold, (p::ps) and (q::qs) must satisfy one of:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; - disjointness: p and q are not compatible<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; - ordering: if p and q are compatible, ps is more general than qs<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; (this only works if the row p::ps is not guarded; otherwise the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; guard could fail and q::qs should still be tried)<br/></li>
<li></span><span class="Comment">&nbsp; *)<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Comment">(* Conditions for appending to the Or <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> *)<br/></li>
<li><a id="L1222">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">disjoint</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">not</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L115" title="ocaml/lambda/matching.ml:115">may_compat</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L1224">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">safe_below</span></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">ps</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">qs</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">(not</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L474" title="ocaml/lambda/lambda.mli:474">is_guarded</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">))</span><span class="ocamlStruct"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlStruct"> </span><span class="PreProc">Parmatch</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">le_pats</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">qs<br/></li>
<li></span><br/></li>
<li><a id="L1227">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">safe_below_or_matrix</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">q</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">qs</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">for_all<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">act_p</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">General</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">erase</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">pat_desc</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Tpat_or</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L1222" title="ocaml/lambda/matching.ml:1222">disjoint</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlStruct"> </span><span class="Statement">||</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L1224" title="ocaml/lambda/matching.ml:1224">safe_below</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">ps</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">act_p</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">qs<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">true</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Comment">(* Insert or append a clause in the Or <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a>:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; - insert: adding the clause in the middle of the or_matrix<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; - append: adding the clause at the bottom of the or_matrix<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; If neither are possible we <a href="#L884" title="ocaml/lambda/matching.ml:884">add</a> to the bottom of the No <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a>.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">insert_or_append</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rev_ors</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rev_no</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">safe_to_insert</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">seen</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">not_e</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L1194" title="ocaml/lambda/matching.ml:1194">extract_equiv_head</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Comment">(* check append condition for <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a> of O *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L1227" title="ocaml/lambda/matching.ml:1227">safe_below_or_matrix</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">not_e</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">&amp;&amp;</span><span class="ocamlStruct"> </span><span class="Comment">(* check insert condition for <a href="simplif.ml.html#L812" title="ocaml/lambda/simplif.ml:812">tail</a> of O *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">for_all</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">q</span><span class="ocamlStruct">, </span><span class="Statement">_)</span><span class="ocamlStruct">, </span><span class="Statement">_)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L1222" title="ocaml/lambda/matching.ml:1222">disjoint</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="PreProc">General</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">erase</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="Statement">))</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">seen<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li><a id="L1250">&#x200c;</a></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="Statement">rec</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">attempt</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">seen</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Comment">(* invariant: the new clause is safe to append at the end of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [seen] (but maybe not [rem] yet) *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">[]</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">(((</span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rev_ors</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">(((</span><span class="ocamlLCIdentifier">q</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">qs</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">act_q</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">as</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">General</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">erase</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">General</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">erase</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">(not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1173" title="ocaml/lambda/matching.ml:1173">is_or</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">q</span><span class="Statement">))</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1222" title="ocaml/lambda/matching.ml:1222">disjoint</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L1250" title="ocaml/lambda/matching.ml:1250">attempt</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">seen</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Statement">if<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Typedtree</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pat_bound_idents</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="PreProc">Typedtree</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pat_bound_idents</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">q</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1192" title="ocaml/lambda/matching.ml:1192">equiv_pat</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">q<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* <a href="#L1250" title="ocaml/lambda/matching.ml:1250">attempt</a> insertion, for equivalent orpats with no variables *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">safe_to_insert</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlNone">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">seen</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">rev_append</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">seen</span><span class="ocamlStruct"> </span><span class="Statement">(((</span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* fail to insert or append *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">rev_ors</span><span class="ocamlStruct">, </span><span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1224" title="ocaml/lambda/matching.ml:1224">safe_below</a></span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">qs</span><span class="ocamlNone">, </span><span class="ocamlLCIdentifier">act_q</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ps</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L1250" title="ocaml/lambda/matching.ml:1250">attempt</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">seen</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">rev_ors</span><span class="ocamlStruct">, </span><span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L1250" title="ocaml/lambda/matching.ml:1250">attempt</a></span><span class="ocamlStruct"> </span><span class="Constant">[]</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">rev_ors<br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Reconstruct default information from half_compiled&nbsp; pm <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> *)<br/></li>
<li></span><br/></li>
<li><a id="L1280">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">as_matrix</span></span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">get_mins</span> <span class="ocamlLCIdentifier">le_pats</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">General</span>.<span class="ocamlLCIdentifier">erase</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">cases</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; Split a matching along the first column.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; Splitting is first directed by or-patterns, then by<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; tests (e.g. constructors)/variable transitions.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; The approach is greedy, every split function attempts to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; raise rows as much as possible in the top <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a>,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; then splitting applies again to the remaining rows.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; Some precompilation of or-patterns and<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; variable pattern occurs. Mostly this means that bindings<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; are performed now,&nbsp; being replaced by let-bindings<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; in actions (cf. Half_simple.<a href="#L224" title="ocaml/lambda/matching.ml:224">of_clause</a>).<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; Additionally, if the match argument is a variable, matchings whose<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; first column is made of variables only are split further<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; (cf. precompile_var).<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; ---<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; Note: we assume that the first column of each pattern is coherent -- all<br/></li>
<li></span><span class="Comment">&nbsp; patterns match values of the same type. This comes from the fact that<br/></li>
<li></span><span class="Comment">&nbsp; we <a href="tmc.ml.html#L190" title="ocaml/lambda/tmc.ml:190">make</a> aggressive splitting decisions, splitting pattern heads that<br/></li>
<li></span><span class="Comment">&nbsp; may be different into different submatrices; in particular, in a given<br/></li>
<li></span><span class="Comment">&nbsp; submatrix the first column is formed of first arguments to the same<br/></li>
<li></span><span class="Comment">&nbsp; constructor.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; GADTs are not an issue because we split columns <a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a>-to-right, and<br/></li>
<li></span><span class="Comment">&nbsp; GADT typing also introduces typing equations <a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a>-to-right. In<br/></li>
<li></span><span class="Comment">&nbsp; particular, a leftmost column in matching.ml will be well-typed under<br/></li>
<li></span><span class="Comment">&nbsp; a set of equations accepted by the type-checker, and those equations<br/></li>
<li></span><span class="Comment">&nbsp; are forced to remain consistent: they can equate known types to<br/></li>
<li></span><span class="Comment">&nbsp; abstract types, but they cannot equate two incompatible known types<br/></li>
<li></span><span class="Comment">&nbsp; together, and in particular incompatible pattern heads do not appear<br/></li>
<li></span><span class="Comment">&nbsp; in a leftmost column.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; Parmatch has to be more conservative because it splits less<br/></li>
<li></span><span class="Comment">&nbsp; aggressively: submatrices will contain not just the arguments of<br/></li>
<li></span><span class="Comment">&nbsp; a given pattern <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a>, but also other lines that may be compatible with<br/></li>
<li></span><span class="Comment">&nbsp; it, in particular those with a leftmost omega and those starting with<br/></li>
<li></span><span class="Comment">&nbsp; an extension constructor that may be <a href="simplif.ml.html#L782" title="ocaml/lambda/simplif.ml:782">equal</a> to it.<br/></li>
<li></span><br/></li>
<li><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">split_or</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cls</span> : <span class="PreProc">Half_simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">do_split</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">rev_before</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rev_ors</span> <span class="ocamlLCIdentifier">rev_no</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cons_next</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier">rev_before</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier">rev_ors</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">when</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1088" title="ocaml/lambda/matching.ml:1088">safe_before</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">do_split</span> <span class="ocamlLCIdentifier">rev_before</span> <span class="ocamlLCIdentifier">rev_ors</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">#Simple</span>.<span class="ocamlLCIdentifier">view</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">view</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier"><a href="#L1088" title="ocaml/lambda/matching.ml:1088">safe_before</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="ocamlLCIdentifier">rev_ors</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">do_split<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">((({</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">view</span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rev_before</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">rev_ors</span> <span class="ocamlLCIdentifier">rev_no</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rev_ors</span>, <span class="ocamlLCIdentifier">rev_no</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Or_matrix</span>.<span class="ocamlLCIdentifier">insert_or_append</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">ps</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rev_ors</span> <span class="ocamlLCIdentifier">rev_no<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">do_split</span> <span class="ocamlLCIdentifier">rev_before</span> <span class="ocamlLCIdentifier">rev_ors</span> <span class="ocamlLCIdentifier">rev_no</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">cons_next</span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="ocamlLCIdentifier">yesor</span> <span class="ocamlLCIdentifier">no</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">def</span>, <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">no</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">def</span>, <span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">me</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">top_default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">do_split</span> <span class="Constant">[]</span> <span class="Constant">[]</span> <span class="Constant">[]</span> <span class="ocamlLCIdentifier">no<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li><a id="L1354">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">idef</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L469" title="ocaml/lambda/lambda.mli:469">next_raise_count</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L36" title="ocaml/lambda/debuginfo.ml:36">cons</a></span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span> <span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span> <span class="ocamlLCIdentifier">def</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span>, <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">nexts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">yesor</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1363" title="ocaml/lambda/matching.ml:1363">split_no_or</a></span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier">nexts<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">precompile_or</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="ocamlLCIdentifier">yesor</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier">nexts<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">do_split</span> <span class="Constant">[]</span> <span class="Constant">[]</span> <span class="Constant">[]</span> <span class="ocamlLCIdentifier">cls<br/></li>
<li></span><br/></li>
<li><a id="L1363">&#x200c;</a><span class="Statement">and</span> <span class="ocamlLCIdentifier"><span class="linkable">split_no_or</span></span> <span class="ocamlLCIdentifier">cls</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* We split the remaining clauses in as few pms as possible while maintaining<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; the property stated earlier (cf. {1. Precompilation}), <a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a>.e. for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; any pm in the result, it is possible to decide for any two patterns<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; on the first column whether their heads are <a href="simplif.ml.html#L782" title="ocaml/lambda/simplif.ml:782">equal</a> or not.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; This generally means that we'<a href="translcore.ml.html#L384" title="ocaml/lambda/translcore.ml:384">ll</a> have two kinds of pms: ones where the first<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; column is made of variables only, and ones where the <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a> is actually a<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; discriminating pattern.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; There is some subtlety regarding the handling of extension constructors<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; (where it is not always possible to syntactically decide whether two<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; different heads match different values), but this is handled by the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; [can_group] function. *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">split</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cls</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">discr</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">what_is_first_case</span> <span class="ocamlLCIdentifier">cls</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">collect</span> <span class="ocamlLCIdentifier">discr</span> <span class="Constant">[]</span> <span class="Constant">[]</span> <span class="ocamlLCIdentifier">cls<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">collect</span> <span class="ocamlLCIdentifier">group_discr</span> <span class="ocamlLCIdentifier">rev_yes</span> <span class="ocamlLCIdentifier">rev_no</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Statement">(((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="Statement">)</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">when</span> <span class="ocamlLCIdentifier">rev_yes</span> <span class="Statement">&lt;&gt;</span> <span class="Constant">[]</span> <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/lambda/matching.ml:1187">simple_omega_like</a></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">&amp;&amp;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">for_all</span> <span class="ocamlLCIdentifier"><a href="#L1178" title="ocaml/lambda/matching.ml:1178">omega_like</a></span> <span class="ocamlLCIdentifier">ps</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* This enables an extra <a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a> in some frequent cases:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L2491" title="ocaml/lambda/matching.ml:2491">last</a> row is made of variables only<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Splitting a <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> there creates two default environments (instead of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; one for the non-split <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a>), the first of which often gets<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="tmc.ml.html#L548" title="ocaml/lambda/tmc.ml:548">specialized</a> away by further refinement, and the second one jumping<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; directly to the catch-all case -- this produces better code.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; This optimisation is tested in the first part of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; testsuite/tests/basic/patmatch_split_no_or.ml *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">collect</span> <span class="ocamlLCIdentifier">group_discr</span> <span class="ocamlLCIdentifier">rev_yes</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)</span> <span class="Constant">[]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(((</span><span class="ocamlLCIdentifier">p</span>, <span class="Statement">_)</span>, <span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">can_group</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">group_discr</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L1088" title="ocaml/lambda/matching.ml:1088">safe_before</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">rev_no</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">collect</span> <span class="ocamlLCIdentifier">group_discr</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rev_yes</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rev_no</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">should_split</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">group_discr</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">assert</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">rev_no</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier">rev_yes</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">insert_split</span> <span class="ocamlLCIdentifier">group_discr</span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)</span> <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">collect</span> <span class="ocamlLCIdentifier">group_discr</span> <span class="ocamlLCIdentifier">rev_yes</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rev_no</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1404">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">yes</span></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier">rev_yes</span> <span class="Statement">and</span> <span class="ocamlLCIdentifier">no</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier">rev_no</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">insert_split</span> <span class="ocamlLCIdentifier">group_discr</span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="ocamlLCIdentifier">no</span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">insert_split</span> <span class="ocamlLCIdentifier">group_discr</span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="ocamlLCIdentifier">no</span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">precompile_group</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">group_discr</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="Constant">Any</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">precompile_var<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">do_not_precompile<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">no</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">precompile_group</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">me</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">top_default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">split</span> <span class="ocamlLCIdentifier">no</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L469" title="ocaml/lambda/lambda.mli:469">next_raise_count</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">precompile_group</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier"><a href="#L1404" title="ocaml/lambda/matching.ml:1404">yes</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L36" title="ocaml/lambda/debuginfo.ml:36">cons</a></span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span> <span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span> <span class="ocamlLCIdentifier">def</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span>, <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">nexts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">should_split</span> <span class="ocamlLCIdentifier">group_discr</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">group_discr</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="Constant">Construct</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cstr_tag</span> <span class="Statement">=</span> <span class="Constant">Cstr_extension</span> <span class="Statement">_</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* it is unlikely that we will raise anything, so we split now *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">true<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">split</span> <span class="ocamlLCIdentifier">cls<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">precompile_var</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">cls</span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* Strategy: <a href="#L809" title="ocaml/lambda/matching.ml:809">pop</a> the first column,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; precompile the rest, <a href="#L884" title="ocaml/lambda/matching.ml:884">add</a> a PmVar to all precompiled submatrices.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; If the rest doesn'<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> generate any split, abort and do_not_precompile. *)<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">::</span> <span class="Statement">((</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span>, <span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rargs</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* We will use the <a href="translcore.ml.html#L56" title="ocaml/lambda/translcore.ml:56">name</a> of the <a href="#L263" title="ocaml/lambda/matching.ml:263">head</a> column of the submatrix<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; we compile, and this is the *second* column of our argument. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">cls</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Statement">_</span> <span class="Statement">]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* as split as it can *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">do_not_precompile</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">cls</span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Precompile *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">var_args</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rargs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">var_cls</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">assert</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/lambda/matching.ml:1187">simple_omega_like</a></span> <span class="ocamlLCIdentifier">p</span><span class="Statement">);<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* we learned by pattern-matching on [<a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a>]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; that [p::ps] has at least two arguments,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; so [ps] must be non-<a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">half_simplify_clause</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>:<span class="Statement">(</span><span class="ocamlLCIdentifier">fst</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ps</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cls<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">var_def</span> <span class="Statement">=</span> <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L798" title="ocaml/lambda/matching.ml:798">pop_column</a></span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">me</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">first</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">split_or</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>:<span class="Statement">(</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">var_cls</span> <span class="ocamlLCIdentifier">var_args</span> <span class="ocamlLCIdentifier">var_def<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Compute top information *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* If you need *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">do_not_precompile</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">cls</span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">rebuild_matrix</span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Pm</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1280" title="ocaml/lambda/matching.ml:1280">as_matrix</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">PmOr</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">or_matrix</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">m<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">PmVar</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L392" title="ocaml/lambda/matching.ml:392">add_omega_column</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">rebuild_matrix</span> <span class="ocamlLCIdentifier">x</span>.<span class="ocamlLCIdentifier">inside</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rebuild_default</span> <span class="ocamlLCIdentifier">nexts</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* We can'<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> just do:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {[<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; List.<a href="#L922" title="ocaml/lambda/matching.ml:922">map</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (fun (mat, e) -&gt; <a href="#L392" title="ocaml/lambda/matching.ml:392">add_omega_column</a> mat, e)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; top_default (* assuming it'd been bound. *)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ]}<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; As we would be losing information: [def] is more precise<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; than [<a href="#L392" title="ocaml/lambda/matching.ml:392">add_omega_column</a> (<a href="#L798" title="ocaml/lambda/matching.ml:798">pop_column</a> def)]. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>, <span class="ocamlLCIdentifier">pmh</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L36" title="ocaml/lambda/debuginfo.ml:36">cons</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L392" title="ocaml/lambda/matching.ml:392">add_omega_column</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">rebuild_matrix</span> <span class="ocamlLCIdentifier">pmh</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">e</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">nexts</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rebuild_nexts</span> <span class="ocamlLCIdentifier">nexts</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">map_end</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>, <span class="ocamlLCIdentifier">pm</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>, <span class="Constant">PmVar</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">inside</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">}))</span> <span class="ocamlLCIdentifier">nexts</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rfirst</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">me</span> <span class="Statement">=</span> <span class="Constant">PmVar</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">inside</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">first</span> <span class="Statement">};<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L392" title="ocaml/lambda/matching.ml:392">add_omega_column</a></span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">top_default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">rebuild_default</span> <span class="ocamlLCIdentifier">nexts</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">rnexts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">rebuild_nexts</span> <span class="ocamlLCIdentifier">nexts</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">rfirst</span>, <span class="ocamlLCIdentifier">rnexts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">do_not_precompile</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">cls</span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">do_not_precompile</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">cls</span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">(</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">me</span> <span class="Statement">=</span> <span class="Constant">Pm</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">cls</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">};<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1280" title="ocaml/lambda/matching.ml:1280">as_matrix</a></span> <span class="ocamlLCIdentifier">cls</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">top_default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">}</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">precompile_or</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cls</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">ors</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* Example: if [cls] is a single-row <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; s11&nbsp; &nbsp; &nbsp; &nbsp; p12 .. p1n -&gt; act1<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; and [ors] has three rows<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; (s21|<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>'21) p22 .. p2n -&gt; act2<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; (s31|<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>'31) p32 .. p3n -&gt; act3<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; s41&nbsp; &nbsp; &nbsp; &nbsp; p42 .. p4n -&gt; act4<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; where the first and second rows <a href="#L535" title="ocaml/lambda/matching.ml:535">start</a> with <a href="#L1222" title="ocaml/lambda/matching.ml:1222">disjoint</a> or-patterns<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; of simple patterns, binding the variables x2, y2, z2 and x3, y3<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; respectively, we precompile into the following:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; catch<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; ( match arg1 .. argn with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | s11&nbsp; p12 .. p1n -&gt; act1<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | s21&nbsp; _&nbsp;&nbsp; .. _&nbsp;&nbsp; -&gt; <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> 2 x2 y2 z2<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | <a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>'21 _&nbsp;&nbsp; .. _&nbsp;&nbsp; -&gt; <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> 2 x2 y2 z2<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | s31&nbsp; _&nbsp;&nbsp; .. _&nbsp;&nbsp; -&gt; <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> 3 x3 y3<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | <a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>'31 _&nbsp;&nbsp; .. _&nbsp;&nbsp; -&gt; <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> 3 x3 y3<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | s41&nbsp; p42 .. p4n -&gt; act4 )<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; | <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> 2 x2 y2 z2 -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; ( match arg2 .. argn with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | p22 .. p2n -&gt; act2 )<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; | <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> 3 x3 y3 -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; ( match arg2 .. argn with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; | p32 .. p3n -&gt; act3 )<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; Note that if arg1 matches s21 or <a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>'21, we <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> to a submatrix<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; that will never try any of the following rows; this relies on the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; disjointness-like properties documented in the {!Or_matrix}<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; module.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; The code below builds this catch/<a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> structure, The splitting of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; the or-patterns is done in [Simple.<a href="#L265" title="ocaml/lambda/matching.ml:265">explode_or_pat</a>] -- it turns<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; half-simple clauses into simple clauses.<br/></li>
<li></span><span class="Comment">&nbsp; *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">do_cases</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">[]</span>, <span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">#Simple</span>.<span class="ocamlLCIdentifier">view</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">view</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">new_ord</span>, <span class="ocamlLCIdentifier">new_to_catch</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">do_cases</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Statement">(({</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">view</span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">new_ord</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">new_to_catch</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">`Or</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">orp</span> <span class="Statement">=</span> <span class="PreProc">General</span>.<span class="ocamlLCIdentifier">erase</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">others</span>, <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1194" title="ocaml/lambda/matching.ml:1194">extract_equiv_head</a></span> <span class="ocamlLCIdentifier">orp</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">orpm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">patl</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">::</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">((_</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ps</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">others</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier">pop_compat</span> <span class="ocamlLCIdentifier">orp</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pm_fv</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pm_free_variables</span> <span class="ocamlLCIdentifier">orpm</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">patbound_action_vars</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* variables bound in the or-pattern<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; that are used in the orpm actions *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Typedtree</span>.<span class="ocamlLCIdentifier">pat_bound_idents_full</span> <span class="ocamlLCIdentifier">orp<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">filter</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Ident</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">mem</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="ocamlLCIdentifier">pm_fv</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">ty</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="PreProc">Typeopt</span>.<span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L56" title="ocaml/lambda/printlambda.ml:56">value_kind</a></span> <span class="ocamlLCIdentifier">orp</span>.<span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier">ty</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">or_num</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L469" title="ocaml/lambda/lambda.mli:469">next_raise_count</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">new_patl</span> <span class="Statement">=</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omega_list</span> <span class="ocamlLCIdentifier">patl</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">mk_new_action</span> <span class="Statement">~</span><span class="Identifier">vars</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">or_num</span>, <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">-&gt;</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">vars</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">new_cases</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier"><a href="#L265" title="ocaml/lambda/matching.ml:265">explode_or_pat</a></span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">p<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">mk_action</span>:<span class="ocamlLCIdentifier">mk_new_action<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">patbound_action_vars</span>:<span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier">fst</span> <span class="ocamlLCIdentifier">patbound_action_vars</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">new_patl</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">))</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">provenance</span> <span class="Statement">=</span> <span class="Statement">[</span> <span class="Statement">[</span> <span class="ocamlLCIdentifier">orp</span> <span class="Statement">]</span> <span class="Statement">];<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">or_num</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">vars</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">patbound_action_vars</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">orpm<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rem_cases</span>, <span class="ocamlLCIdentifier">rem_handlers</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">do_cases</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">new_cases</span> @ <span class="ocamlLCIdentifier">rem_cases</span>, <span class="ocamlLCIdentifier">handler</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem_handlers</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cases</span>, <span class="ocamlLCIdentifier">handlers</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">do_cases</span> <span class="ocamlLCIdentifier">ors</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1280" title="ocaml/lambda/matching.ml:1280">as_matrix</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">((</span><span class="ocamlLCIdentifier">cls</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span> :<span class="Statement">&gt;</span> <span class="PreProc">General</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; @ <span class="Statement">(</span><span class="ocamlLCIdentifier">ors</span> : <span class="PreProc">Half_simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span> :<span class="Statement">&gt;</span> <span class="PreProc">General</span>.<span class="ocamlLCIdentifier">clause</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">cls</span> @ <span class="ocamlLCIdentifier">cases</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">me</span> <span class="Statement">=</span> <span class="Constant">PmOr</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">handlers</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">or_matrix</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span> <span class="Statement">};<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">top_default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">}</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L1615">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dbg_split_and_precompile</span></span> <span class="ocamlLCIdentifier">pm</span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span> <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/lambda/matching.ml:101">dbg</a><br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">nexts</span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">||<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">match</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span><span class="ocamlNone"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="ocamlNone"> </span><span class="Constant">PmOr</span><span class="ocamlNone"> </span><span class="Statement">_</span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="Constant">true<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="ocamlNone"> </span><span class="Statement">_</span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlNone">&nbsp; </span><span class="Statement">then</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;** SPLIT **\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_pm</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">erase_pm</span> <span class="ocamlLCIdentifier">pm</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_precompiled_res</span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span> <span class="ocamlLCIdentifier">nexts<br/></li>
<li></span>&nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">split_and_precompile_simplified</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">me</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1363" title="ocaml/lambda/matching.ml:1363">split_no_or</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">default</span> <span class="Constant">[]</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1615" title="ocaml/lambda/matching.ml:1615">dbg_split_and_precompile</a></span> <span class="ocamlLCIdentifier">pm</span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span> <span class="ocamlLCIdentifier">nexts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span>, <span class="ocamlLCIdentifier">nexts</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L1635">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">split_and_precompile_half_simplified</span></span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">me</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">split_or</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">default</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1615" title="ocaml/lambda/matching.ml:1615">dbg_split_and_precompile</a></span> <span class="ocamlLCIdentifier">pm</span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span> <span class="ocamlLCIdentifier">nexts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a></span>, <span class="ocamlLCIdentifier">nexts</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* General <a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a> functions *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier">cell</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pm</span> : <span class="ocamlLCIdentifier"><a href="#L388" title="ocaml/lambda/matching.ml:388">initial_clause</a></span> <span class="ocamlLCIdentifier">pattern_matching</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">ctx</span> : <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">discr</span> : <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a><br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><span class="Comment">(** a submatrix after specializing by discriminant pattern;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; [ctx] is the <a href="tmc.ml.html#L545" title="ocaml/lambda/tmc.ml:545">context</a> <a href="switch.mli.html#L32" title="ocaml/lambda/switch.mli:32">shared</a> by all rows. *)<br/></li>
<li></span><br/></li>
<li><a id="L1650">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_matching</span></span> <span class="ocamlLCIdentifier">get_expr_args</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.<a href="#L1650" title="ocaml/lambda/matching.ml:1650">make_matching</a>&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">=</span> <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">get_expr_args</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">=</span> <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">};</span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">discr</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L1658">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_line_matching</span></span> <span class="ocamlLCIdentifier">get_expr_args</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.<a href="#L1658" title="ocaml/lambda/matching.ml:1658">make_line_matching</a>&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">get_expr_args</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">rem</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L1666">&#x200c;</a><span class="Statement">type</span> '<span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier"><span class="linkable">division</span></span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> : <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L250" title="ocaml/lambda/lambda.mli:250">let_kind</a></span><span class="Statement">)</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">cells</span> : <span class="Statement">(</span>'<span class="ocamlLCIdentifier">a</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">cell</span><span class="Statement">)</span> <span class="Type"><a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a><br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L1671">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_in_div</span></span> <span class="ocamlLCIdentifier">make_matching_fun</span> <span class="ocamlLCIdentifier">eq_key</span> <span class="ocamlLCIdentifier"><a href="switch.mli.html#L42" title="ocaml/lambda/switch.mli:42">key</a></span> <span class="ocamlLCIdentifier">patl_action</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cells</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">find_opt</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">eq_key</span> <span class="ocamlLCIdentifier"><a href="switch.mli.html#L42" title="ocaml/lambda/switch.mli:42">key</a></span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span>.<span class="ocamlLCIdentifier">cells</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cell</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">make_matching_fun</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span>.<span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cell</span>.<span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">&lt;-</span> <span class="Statement">[</span> <span class="ocamlLCIdentifier">patl_action</span> <span class="Statement">];<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.mli.html#L42" title="ocaml/lambda/switch.mli:42">key</a></span>, <span class="ocamlLCIdentifier">cell</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span>.<span class="ocamlLCIdentifier">cells<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">cell</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cell</span>.<span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier">patl_action</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">cell</span>.<span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span>.<span class="ocamlLCIdentifier">cells<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">cells</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L1684">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">divide</span></span> <span class="ocamlLCIdentifier">get_expr_args</span> <span class="ocamlLCIdentifier">eq_key</span> <span class="ocamlLCIdentifier">get_key</span> <span class="ocamlLCIdentifier">get_pat_args</span> <span class="ocamlLCIdentifier">ctx<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">pm</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="ocamlLCIdentifier">pattern_matching</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ph</span> <span class="Statement">=</span> <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=</span> <span class="PreProc">General</span>.<span class="ocamlLCIdentifier">erase</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1671" title="ocaml/lambda/matching.ml:1671">add_in_div</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1650" title="ocaml/lambda/matching.ml:1650">make_matching</a></span> <span class="ocamlLCIdentifier">get_expr_args</span> <span class="ocamlLCIdentifier">ph</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">default</span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">eq_key</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">get_key</span> <span class="ocamlLCIdentifier">p</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">get_pat_args</span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">patl</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right</span> <span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cells</span> <span class="Statement">=</span> <span class="Constant">[]</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L1697">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_line</span></span> <span class="ocamlLCIdentifier">patl_action</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier">patl_action</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pm<br/></li>
<li></span><br/></li>
<li><a id="L1701">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">divide_line</span></span> <span class="ocamlLCIdentifier">make_ctx</span> <span class="ocamlLCIdentifier">get_expr_args</span> <span class="ocamlLCIdentifier">get_pat_args</span> <span class="ocamlLCIdentifier">discr</span> <span class="ocamlLCIdentifier">ctx<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">pm</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="ocamlLCIdentifier">pattern_matching</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">submatrix</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=</span> <span class="PreProc">General</span>.<span class="ocamlLCIdentifier">erase</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1697" title="ocaml/lambda/matching.ml:1697">add_line</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">get_pat_args</span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">patl</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">submatrix<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right</span> <span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1658" title="ocaml/lambda/matching.ml:1658">make_line_matching</a></span> <span class="ocamlLCIdentifier">get_expr_args</span> <span class="ocamlLCIdentifier">discr</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">default</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">pm</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">make_ctx</span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">discr</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L1713">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">drop_pat_arg</span></span> <span class="ocamlLCIdentifier">_p</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li><a id="L1714">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">drop_expr_arg</span></span> <span class="ocamlLCIdentifier">_head</span> <span class="ocamlLCIdentifier">_arg</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Then come various functions,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; There is one set of functions per matching style<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; (constants, constructors etc.)<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; - get_{expr,pat}_args and get_key are for the compiled matrices,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; note that selection and getting arguments are separated.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; - make_*_matching combines the previous functions for producing<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; new&nbsp; ``pattern_matching'' records.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Matching against a constant *)<br/></li>
<li></span><br/></li>
<li><a id="L1729">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_key_constant</span></span> <span class="ocamlLCIdentifier">caller</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_constant</span> <span class="ocamlLCIdentifier">cst</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">cst<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;BAD: %<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>&quot;</span> <span class="ocamlLCIdentifier">caller</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pretty_pat</span> <span class="ocamlLCIdentifier">p</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1736">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_pat_args_constant</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1713" title="ocaml/lambda/matching.ml:1713">drop_pat_arg</a><br/></li>
<li><a id="L1737">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_expr_args_constant</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1714" title="ocaml/lambda/matching.ml:1714">drop_expr_arg</a><br/></li>
<li></span><br/></li>
<li><a id="L1739">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">divide_constant</span></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1737" title="ocaml/lambda/matching.ml:1737">get_expr_args_constant</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">c</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">const_compare</span> <span class="ocamlLCIdentifier">c</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">=</span> <span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1729" title="ocaml/lambda/matching.ml:1729">get_key_constant</a></span> <span class="Constant">&quot;<a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a>&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1736" title="ocaml/lambda/matching.ml:1736">get_pat_args_constant</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">m<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Matching against a constructor *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_key_constr</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_construct</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">cstr</span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">cstr<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1752">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_pat_args_constr</span></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_construct</span> <span class="Statement">(_</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span>, <span class="Statement">_)</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> @ <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1757">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_expr_args_constr</span></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">_mut</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cstr</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="Constant">Construct</span> <span class="ocamlLCIdentifier">cstr</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">cstr<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.<a href="#L1757" title="ocaml/lambda/matching.ml:1757">get_expr_args_constr</a>&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">head_loc</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">make_field_accesses</span> <span class="ocamlLCIdentifier">binding_kind</span> <span class="ocamlLCIdentifier">first_pos</span> <span class="ocamlLCIdentifier">last_pos</span> <span class="ocamlLCIdentifier">argl</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">make_args</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">last_pos</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">argl<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span>, <span class="Constant">Pointer</span>, <span class="Constant">Immutable</span><span class="Statement">)</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">binding_kind</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">make_args</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span> + <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">make_args</span> <span class="ocamlLCIdentifier">first_pos<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cstr</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">cstr_inlined</span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">None</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="Constant">Alias</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_tag</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_constant</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_block</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">make_field_accesses</span> <span class="Constant">Alias</span> <span class="Constant">0</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_arity</span> - <span class="Constant">1</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_unboxed</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="Constant">Alias</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_extension</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">make_field_accesses</span> <span class="Constant">Alias</span> <span class="Constant">1</span> <span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_arity</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span><br/></li>
<li><a id="L1784">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">divide_constructor</span></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1757" title="ocaml/lambda/matching.ml:1757">get_expr_args_constr</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">cstr1</span> <span class="ocamlLCIdentifier">cstr2</span> <span class="Statement">-&gt;</span> <span class="PreProc">Types</span>.<span class="ocamlLCIdentifier">equal_tag</span> <span class="ocamlLCIdentifier">cstr1</span>.<span class="ocamlLCIdentifier">cstr_tag</span> <span class="ocamlLCIdentifier">cstr2</span>.<span class="ocamlLCIdentifier">cstr_tag</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">get_key_constr<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1752" title="ocaml/lambda/matching.ml:1752">get_pat_args_constr</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Matching against a variant *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_expr_args_variant_constant</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1714" title="ocaml/lambda/matching.ml:1714">drop_expr_arg</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_expr_args_variant_nonconst</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">_mut</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">head_loc</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="Constant">1</span>, <span class="Constant">Pointer</span>, <span class="Constant">Immutable</span><span class="Statement">)</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>, <span class="Constant">Alias</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">divide_variant</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">row</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">}</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cells</span> <span class="Statement">=</span> <span class="Constant">[]</span> <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">patl</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">lab</span>, <span class="ocamlLCIdentifier">pato</span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">`Variant</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lab</span>, <span class="ocamlLCIdentifier">pato</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">lab</span>, <span class="ocamlLCIdentifier">pato<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li><a id="L1809">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">head</span></span> <span class="Statement">=</span> <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier"><span class="linkable">head</span></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li><a id="L1810">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">variants</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a></span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">row_field_repr</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">get_row_field</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">lab</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">row</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">Rabsent</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1810" title="ocaml/lambda/matching.ml:1810">variants</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li><a id="L1814">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">tag</span></span> <span class="Statement">=</span> <span class="PreProc">Btype</span>.<span class="ocamlLCIdentifier">hash_variant</span> <span class="ocamlLCIdentifier">lab</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">pato</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1671" title="ocaml/lambda/matching.ml:1671">add_in_div</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1650" title="ocaml/lambda/matching.ml:1650">make_matching</a></span> <span class="ocamlLCIdentifier">get_expr_args_variant_constant</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Statement">=</span> <span class="Statement">)</span> <span class="Statement">(</span><span class="Constant">Cstr_constant</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">patl</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1810" title="ocaml/lambda/matching.ml:1810">variants</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1671" title="ocaml/lambda/matching.ml:1671">add_in_div</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1650" title="ocaml/lambda/matching.ml:1650">make_matching</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">get_expr_args_variant_nonconst</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Statement">=</span> <span class="Statement">)</span> <span class="Statement">(</span><span class="Constant">Cstr_block</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">pat</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">patl</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1810" title="ocaml/lambda/matching.ml:1810">variants</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L366" title="ocaml/lambda/translclass.ml:366">cl</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; Three ``no-<a href="#L2340" title="ocaml/lambda/matching.ml:2340">test</a>'' cases<br/></li>
<li></span><span class="Comment">&nbsp; *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Matching against a variable *)<br/></li>
<li></span><br/></li>
<li><a id="L1838">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_pat_args_var</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1713" title="ocaml/lambda/matching.ml:1713">drop_pat_arg</a><br/></li>
<li><a id="L1839">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_expr_args_var</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1714" title="ocaml/lambda/matching.ml:1714">drop_expr_arg</a><br/></li>
<li></span><br/></li>
<li><a id="L1841">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">divide_var</span></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1701" title="ocaml/lambda/matching.ml:1701">divide_line</a></span> <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L503" title="ocaml/lambda/matching.ml:503">lshift</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1839" title="ocaml/lambda/matching.ml:1839">get_expr_args_var</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1838" title="ocaml/lambda/matching.ml:1838">get_pat_args_var</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="ocamlLCIdentifier">omega</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Matching and forcing a lazy value *)<br/></li>
<li></span><br/></li>
<li><a id="L1849">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_pat_args_lazy</span></span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_any</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omega</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_lazy</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Inlining the <a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a> tests before calling the <a href="#L2324" title="ocaml/lambda/matching.ml:2324">primitive</a> that works on<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; lazy blocks. This is also used in translcore.ml.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; No other call than Obj.<a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a> when the value has been forced before.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L1860">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">prim_obj_tag</span></span> <span class="Statement">=</span> <span class="PreProc">Primitive</span>.<span class="ocamlLCIdentifier">simple</span> <span class="Statement">~</span><span class="Identifier"><a href="translcore.ml.html#L56" title="ocaml/lambda/translcore.ml:56">name</a></span>:<span class="Constant">&quot;caml_obj_tag&quot;</span> <span class="Statement">~</span><span class="Identifier">arity</span>:<span class="Constant">1</span> <span class="Statement">~</span><span class="Identifier">alloc</span>:<span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1862">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_mod_field</span></span> <span class="ocamlLCIdentifier">modname</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1095" title="ocaml/lambda/translmod.ml:1095">field</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">lazy<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(let</span> <span class="ocamlLCIdentifier">mod_ident</span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_persistent</span> <span class="ocamlLCIdentifier">modname</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">env</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Env</span>.<span class="ocamlLCIdentifier">add_persistent_structure</span> <span class="ocamlLCIdentifier">mod_ident</span> <span class="PreProc">Env</span>.<span class="ocamlLCIdentifier">initial<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">match</span> <span class="PreProc">Env</span>.<span class="ocamlLCIdentifier">open_pers_signature</span> <span class="ocamlLCIdentifier">modname</span> <span class="ocamlLCIdentifier">env</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Error</span> <span class="Constant">`Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">fatal_error</span> <span class="Statement">(</span><span class="Constant">&quot;Module &quot;</span> <span class="Statement">^</span> <span class="ocamlLCIdentifier">modname</span> <span class="Statement">^</span> <span class="Constant">&quot; unavailable.&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Ok</span> <span class="ocamlLCIdentifier">env</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">match</span> <span class="PreProc">Env</span>.<span class="ocamlLCIdentifier">find_value_by_name</span> <span class="Statement">(</span><span class="PreProc">Longident</span>.<span class="Constant">Lident</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1095" title="ocaml/lambda/translmod.ml:1095">field</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">env</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Statement">exception</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">fatal_error</span> <span class="Statement">(</span><span class="Constant">&quot;Primitive &quot;</span> <span class="Statement">^</span> <span class="ocamlLCIdentifier">modname</span> <span class="Statement">^</span> <span class="Constant">&quot;.&quot;</span> <span class="Statement">^</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1095" title="ocaml/lambda/translmod.ml:1095">field</a></span> <span class="Statement">^</span> <span class="Constant">&quot; not found.&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L404" title="ocaml/lambda/lambda.mli:404">transl_value_path</a></span> <span class="Constant">Loc_unknown</span> <span class="ocamlLCIdentifier">env</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">))<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">code_force_lazy_block</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1862" title="ocaml/lambda/matching.ml:1862">get_mod_field</a></span> <span class="Constant">&quot;CamlinternalLazy&quot;</span> <span class="Constant">&quot;force_lazy_block&quot;<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">code_force_lazy</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1862" title="ocaml/lambda/matching.ml:1862">get_mod_field</a></span> <span class="Constant">&quot;CamlinternalLazy&quot;</span> <span class="Constant">&quot;force_gen&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* <a href="#L1968" title="ocaml/lambda/matching.ml:1968">inline_lazy_force</a> inlines the beginning of the code of Lazy.force. When<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the value argument is tagged as:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - forward, take <a href="translmod.ml.html#L1095" title="ocaml/lambda/translmod.ml:1095">field</a> 0<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - lazy || forcing, call the <a href="#L2324" title="ocaml/lambda/matching.ml:2324">primitive</a> that forces<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - anything else, return it<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Using Lswitch below relies on the fact that the GC does not shortcut<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Forward(val_out_of_heap).<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">call_force_lazy_block</span> <span class="ocamlLCIdentifier">varg</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* The argument is wrapped with [Popaque] to prevent the rest of the compiler<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; from making any assumptions on its contents (see comments on<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; [CamlinternalLazy.force_gen], and discussions on PRs #9998 and #10909).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Alternatively, [ap_inlined] could be set to [Never_inline] to achieve a<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; similar result. *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">force_fun</span> <span class="Statement">=</span> <span class="PreProc">Lazy</span>.<span class="ocamlLCIdentifier">force</span> <span class="ocamlLCIdentifier">code_force_lazy_block</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Constant">Lapply<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">ap_tailcall</span> <span class="Statement">=</span> <span class="Constant">Default_tailcall</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_loc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_func</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">force_fun</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_args</span> <span class="Statement">=</span> <span class="Statement">[</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Popaque</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier">varg</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span> <span class="Statement">];<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_inlined</span> <span class="Statement">=</span> <span class="Constant">Default_inline</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_specialised</span> <span class="Statement">=</span> <span class="Constant">Default_specialise<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L1908">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">inline_lazy_force_cond</span></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">idarg</span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;lzarg&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">varg</span> <span class="Statement">=</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">idarg</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;<a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a>&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">test_tag</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lprim</span><span class="Statement">(</span><span class="Constant">Pintcomp</span> <span class="Constant">Ceq</span>, <span class="Statement">[</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span><span class="Statement">;</span> <span class="Constant">Lconst</span><span class="Statement">(</span><span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_int</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="Statement">))]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Constant">Llet<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Strict</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">Pgenval</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">idarg</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">Llet<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Alias</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Pgenval</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pccall</span> <span class="ocamlLCIdentifier"><a href="#L1860" title="ocaml/lambda/matching.ml:1860">prim_obj_tag</a></span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier">varg</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Comment">(* if (<a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a> == Obj.forward_tag) then varg.(0) else ... *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">test_tag</span> <span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier">forward_tag</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">Pointer</span>, <span class="Constant">Mutable</span><span class="Statement">)</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier">varg</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* ... if <a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a> == Obj.lazy_tag || <a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a> == Obj.forcing_tag then<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Lazy.force varg<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else ... *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Psequor</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">[</span><span class="ocamlLCIdentifier">test_tag</span> <span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier">lazy_tag</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">test_tag</span> <span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier">forcing_tag</span><span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">call_force_lazy_block</span> <span class="ocamlLCIdentifier">varg</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* ... <a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">varg</span> <span class="Statement">)</span> <span class="Statement">)</span> <span class="Statement">)</span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L1941">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">inline_lazy_force_switch</span></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">idarg</span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;lzarg&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">varg</span> <span class="Statement">=</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">idarg</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Constant">Llet<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Strict</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">Pgenval</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">idarg</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pisint</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier">varg</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">varg</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lswitch<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pccall</span> <span class="ocamlLCIdentifier"><a href="#L1860" title="ocaml/lambda/matching.ml:1860">prim_obj_tag</a></span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier">varg</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">sw_numblocks</span> <span class="Statement">=</span> <span class="Constant">0</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_blocks</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_numconsts</span> <span class="Statement">=</span> <span class="Constant">256</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* PR#6033 - <a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a> ranges from 0 to 255 *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_consts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span> <span class="Statement">(</span><span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier">forward_tag</span>, <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span><span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">Pointer</span>, <span class="Constant">Mutable</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">[</span> <span class="ocamlLCIdentifier">varg</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">));<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier">lazy_tag</span>, <span class="ocamlLCIdentifier">call_force_lazy_block</span> <span class="ocamlLCIdentifier">varg</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier">forcing_tag</span>, <span class="ocamlLCIdentifier">call_force_lazy_block</span> <span class="ocamlLCIdentifier">varg</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">];<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_failaction</span> <span class="Statement">=</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">varg<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">)</span> <span class="Statement">)</span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L1968">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">inline_lazy_force</span></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">afl_instrument</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* Disable inlining optimisation if AFL instrumentation active,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; so that the GC forwarding optimisation is not visible in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; instrumentation output.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; (see https://github.com/stedolan/crowbar/issues/14) *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lapply<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">ap_tailcall</span> <span class="Statement">=</span> <span class="Constant">Default_tailcall</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_loc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_func</span> <span class="Statement">=</span> <span class="PreProc">Lazy</span>.<span class="ocamlLCIdentifier">force</span> <span class="ocamlLCIdentifier">code_force_lazy</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_args</span> <span class="Statement">=</span> <span class="Statement">[</span> <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_base</span> <span class="Statement">(</span><span class="Constant">Const_int</span> <span class="Constant">0</span><span class="Statement">));</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">];<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_inlined</span> <span class="Statement">=</span> <span class="Constant">Default_inline</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ap_specialised</span> <span class="Statement">=</span> <span class="Constant">Default_specialise<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">native_code</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* Lswitch generates compact and efficient native code *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1941" title="ocaml/lambda/matching.ml:1941">inline_lazy_force_switch</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a><br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* generating bytecode: Lswitch would generate too many rather big<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; tables (~ 250 elts); conditionals are better *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1908" title="ocaml/lambda/matching.ml:1908">inline_lazy_force_cond</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a><br/></li>
<li></span><br/></li>
<li><a id="L1990">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_expr_args_lazy</span></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">_mut</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">head_loc</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1968" title="ocaml/lambda/matching.ml:1968">inline_lazy_force</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span>, <span class="Constant">Strict</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">divide_lazy</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1701" title="ocaml/lambda/matching.ml:1701">divide_line</a></span> <span class="Statement">(</span><span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1990" title="ocaml/lambda/matching.ml:1990">get_expr_args_lazy</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1849" title="ocaml/lambda/matching.ml:1849">get_pat_args_lazy</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Matching against a tuple pattern *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_pat_args_tuple</span> <span class="ocamlLCIdentifier">arity</span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_any</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omegas</span> <span class="ocamlLCIdentifier">arity</span> @ <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_tuple</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> @ <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_expr_args_tuple</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">_mut</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">head_loc</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">arity</span> <span class="Statement">=</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="ocamlLCIdentifier">arity</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">make_args</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">arity</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span>, <span class="Constant">Pointer</span>, <span class="Constant">Immutable</span><span class="Statement">)</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Alias</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">make_args</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span> + <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">make_args</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">divide_tuple</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">arity</span> <span class="Statement">=</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="ocamlLCIdentifier">arity</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1701" title="ocaml/lambda/matching.ml:1701">divide_line</a></span> <span class="Statement">(</span><span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">get_expr_args_tuple</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">get_pat_args_tuple</span> <span class="ocamlLCIdentifier">arity</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Matching against a record pattern *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">record_matching_line</span> <span class="ocamlLCIdentifier">num_fields</span> <span class="ocamlLCIdentifier">lbl_pat_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">patv</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="tmc.ml.html#L190" title="ocaml/lambda/tmc.ml:190">make</a></span> <span class="ocamlLCIdentifier">num_fields</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omega</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(fun</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>, <span class="ocamlLCIdentifier">pat</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">patv</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_pos</span><span class="Statement">)</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier">pat</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">lbl_pat_list</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">to_list</span> <span class="ocamlLCIdentifier">patv<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_pat_args_record</span> <span class="ocamlLCIdentifier">num_fields</span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_any</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">record_matching_line</span> <span class="ocamlLCIdentifier">num_fields</span> <span class="Constant">[]</span> @ <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_record</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lbl_pat_list</span>, <span class="Statement">_)</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">record_matching_line</span> <span class="ocamlLCIdentifier">num_fields</span> <span class="ocamlLCIdentifier">lbl_pat_list</span> @ <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_expr_args_record</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">_mut</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">head_loc</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">all_labels</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Patterns.Head</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span> <span class="Statement">::</span> <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_all<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Constant">[]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">make_args</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">all_labels</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">all_labels</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ptr</span> <span class="Statement">=</span> <span class="PreProc">Typeopt</span>.<span class="ocamlLCIdentifier">maybe_pointer_type</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span>.<span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_arg</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L370" title="ocaml/lambda/translcore.ml:370">access</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_repres</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record_regular<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record_inlined</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_pos</span>, <span class="ocamlLCIdentifier">ptr</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_mut</span><span class="Statement">)</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record_unboxed</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record_float</span> <span class="Statement">-&gt;</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfloatfield</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_pos</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record_extension</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_pos</span> + <span class="Constant">1</span>, <span class="ocamlLCIdentifier">ptr</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_mut</span><span class="Statement">)</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">str</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_mut</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Immutable</span> <span class="Statement">-&gt;</span> <span class="Constant">Alias<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Mutable</span> <span class="Statement">-&gt;</span> <span class="Constant">StrictOpt<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L370" title="ocaml/lambda/translcore.ml:370">access</a></span>, <span class="ocamlLCIdentifier">str</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">make_args</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span> + <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">make_args</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><a id="L2076">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">divide_record</span></span> <span class="ocamlLCIdentifier">all_labels</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* There is some redundancy in the expansions here, [<a href="#L263" title="ocaml/lambda/matching.ml:263">head</a>] is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; expanded here and again in the <a href="#L406" title="ocaml/lambda/matching.ml:406">matcher</a>. It would be<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; nicer to have a type-level distinction between expanded heads<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; and non-expanded heads, to be able to reason confidently on<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; when expansions must happen. *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">expand_record_head</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1701" title="ocaml/lambda/matching.ml:1701">divide_line</a></span> <span class="Statement">(</span><span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L556" title="ocaml/lambda/matching.ml:556">specialize</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">get_expr_args_record</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">get_pat_args_record</span> <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">all_labels</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Matching against an array pattern *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_key_array</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_array</span> <span class="ocamlLCIdentifier">patl</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">patl<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_pat_args_array</span> <span class="ocamlLCIdentifier">p</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_array</span> <span class="ocamlLCIdentifier">patl</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">patl</span> @ <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_expr_args_array</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">_mut</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">len</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Patterns.Head</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Array</span> <span class="ocamlLCIdentifier">len</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">len<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">head_loc</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L263" title="ocaml/lambda/matching.ml:263">head</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">make_args</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">len</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Parrayrefu</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span> <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_base</span> <span class="Statement">(</span><span class="Constant">Const_int</span> <span class="ocamlLCIdentifier">pos</span><span class="Statement">))</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">StrictOpt</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">::</span> <span class="ocamlLCIdentifier">make_args</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span> + <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">make_args</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">divide_array</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">get_expr_args_array</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span> <span class="Statement">=</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">get_key_array</span> <span class="ocamlLCIdentifier">get_pat_args_array<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Specific string <a href="#L2340" title="ocaml/lambda/matching.ml:2340">test</a> <a href="printlambda.ml.html#L697" title="ocaml/lambda/printlambda.ml:697">sequence</a><br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Will be called by the bytecode compiler, from bytegen.ml.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; The strategy is first dichotomic search (we perform 3-way tests<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; with compare_string), then <a href="printlambda.ml.html#L697" title="ocaml/lambda/printlambda.ml:697">sequence</a> of equality tests<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; when there are less then T=strings_test_threshold static strings to match.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; Increasing T entails (slightly) less code, decreasing T<br/></li>
<li></span><span class="Comment">&nbsp; (slightly) favors runtime speed.<br/></li>
<li></span><span class="Comment">&nbsp; T=8 looks a decent tradeoff.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Utilities *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">strings_test_threshold</span> <span class="Statement">=</span> <span class="Constant">8<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">prim_string_notequal</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Constant">Pccall</span> <span class="Statement">(</span><span class="PreProc">Primitive</span>.<span class="ocamlLCIdentifier">simple</span> <span class="Statement">~</span><span class="Identifier"><a href="translcore.ml.html#L56" title="ocaml/lambda/translcore.ml:56">name</a></span>:<span class="Constant">&quot;<a href="translprim.ml.html#L531" title="ocaml/lambda/translprim.ml:531">caml_string_notequal</a>&quot;</span> <span class="Statement">~</span><span class="Identifier">arity</span>:<span class="Constant">2</span> <span class="Statement">~</span><span class="Identifier">alloc</span>:<span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">prim_string_compare</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Constant">Pccall</span> <span class="Statement">(</span><span class="PreProc">Primitive</span>.<span class="ocamlLCIdentifier">simple</span> <span class="Statement">~</span><span class="Identifier"><a href="translcore.ml.html#L56" title="ocaml/lambda/translcore.ml:56">name</a></span>:<span class="Constant">&quot;<a href="translprim.ml.html#L561" title="ocaml/lambda/translprim.ml:561">caml_string_compare</a>&quot;</span> <span class="Statement">~</span><span class="Identifier">arity</span>:<span class="Constant">2</span> <span class="Statement">~</span><span class="Identifier">alloc</span>:<span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2147">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">bind_sw</span></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lvar</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;switch&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Llet</span> <span class="Statement">(</span><span class="Constant">Strict</span>, <span class="Constant">Pgenval</span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">(</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="Statement">))<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Sequential equality tests *)<br/></li>
<li></span><br/></li>
<li><a id="L2156">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_string_test_sequence</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">d</span>, <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">d</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">d</span>, <span class="ocamlLCIdentifier">sw</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">d</span>, <span class="ocamlLCIdentifier">sw</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L2147" title="ocaml/lambda/matching.ml:2147">bind_sw</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="ocamlLCIdentifier">prim_string_notequal</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span> <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_immstring</span> <span class="ocamlLCIdentifier">str</span><span class="Statement">)</span> <span class="Statement">]</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw</span> <span class="ocamlLCIdentifier">d</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">split</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="ocamlLCIdentifier">xs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">xs</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">x0</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">xs</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">[]</span>, <span class="ocamlLCIdentifier">x0</span>, <span class="ocamlLCIdentifier">xs</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">xs</span>, <span class="ocamlLCIdentifier">y0</span>, <span class="ocamlLCIdentifier">ys</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">split</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> - <span class="Constant">2</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">xs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">x0</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">xs</span>, <span class="ocamlLCIdentifier">y0</span>, <span class="ocamlLCIdentifier">ys</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2188">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">zero_lam</span></span> <span class="Statement">=</span> <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_base</span> <span class="Statement">(</span><span class="Constant">Const_int</span> <span class="Constant">0</span><span class="Statement">))<br/></li>
<li></span><br/></li>
<li><a id="L2190">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">tree_way_test</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">lt</span> <span class="ocamlLCIdentifier">eq</span> <span class="ocamlLCIdentifier">gt</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pintcomp</span> <span class="Constant">Clt</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L2188" title="ocaml/lambda/matching.ml:2188">zero_lam</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lt</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse</span> <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pintcomp</span> <span class="Constant">Clt</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2188" title="ocaml/lambda/matching.ml:2188">zero_lam</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">gt</span>, <span class="ocamlLCIdentifier">eq</span><span class="Statement">)</span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Dichotomic tree *)<br/></li>
<li></span><br/></li>
<li><a id="L2198">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">do_make_string_test_tree</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="ocamlLCIdentifier">delta</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">len</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">len</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">strings_test_threshold</span><span class="ocamlNone"> + </span><span class="ocamlLCIdentifier">delta</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2156" title="ocaml/lambda/matching.ml:2156">make_string_test_sequence</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="ocamlLCIdentifier">d<br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">lt</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">gt</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">split</span> <span class="ocamlLCIdentifier">len</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2147" title="ocaml/lambda/matching.ml:2147">bind_sw</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">prim_string_compare</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span> <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_immstring</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span><span class="Statement">)</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2190" title="ocaml/lambda/matching.ml:2190">tree_way_test</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2198" title="ocaml/lambda/matching.ml:2198">do_make_string_test_tree</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">lt</span> <span class="ocamlLCIdentifier">delta</span> <span class="ocamlLCIdentifier">d</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2198" title="ocaml/lambda/matching.ml:2198">do_make_string_test_tree</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">gt</span> <span class="ocamlLCIdentifier">delta</span> <span class="ocamlLCIdentifier">d</span><span class="Statement">))<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Entry point *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="matching.mli.html#L50" title="ocaml/lambda/matching.mli:50">expand_stringswitch</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2147" title="ocaml/lambda/matching.ml:2147">bind_sw</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2198" title="ocaml/lambda/matching.ml:2198">do_make_string_test_tree</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="Constant">0</span> <span class="Constant">None</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2147" title="ocaml/lambda/matching.ml:2147">bind_sw</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2411" title="ocaml/lambda/matching.ml:2411">make_catch</a></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2198" title="ocaml/lambda/matching.ml:2198">do_make_string_test_tree</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="Constant">1</span> <span class="Statement">(</span><span class="Constant">Some</span> <span class="ocamlLCIdentifier">d</span><span class="Statement">)))<br/></li>
<li></span><br/></li>
<li><span class="Comment">(**********************)<br/></li>
<li></span><span class="Comment">(* Generic <a href="#L2340" title="ocaml/lambda/matching.ml:2340">test</a> trees *)<br/></li>
<li></span><span class="Comment">(**********************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Sharing *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Add handler, if <a href="switch.mli.html#L32" title="ocaml/lambda/switch.mli:32">shared</a> *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2230" title="ocaml/lambda/matching.ml:2230">handle_shared</a></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">hs</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li><a id="L2230">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">handle_shared</span></span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">Switch</span>.<span class="Constant">Single</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">Switch</span>.<span class="Constant">Shared</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">h</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1050" title="ocaml/lambda/matching.ml:1050">make_catch_delayed</a></span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ohs</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">hs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">hs</span> <span class="Statement">:=</span> <span class="Statement">fun</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">h</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ohs</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">));<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2413" title="ocaml/lambda/matching.ml:2413">make_exit</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">hs</span>, <span class="ocamlLCIdentifier"><a href="#L2230" title="ocaml/lambda/matching.ml:2230">handle_shared</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2241">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">share_actions_tree</span></span> <span class="ocamlLCIdentifier">sw</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">store</span> <span class="Statement">=</span> <span class="PreProc">StoreExp</span>.<span class="ocamlLCIdentifier"><a href="switch.ml.html#L48" title="ocaml/lambda/switch.ml:48">mk_store</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Default action is always <a href="switch.mli.html#L32" title="ocaml/lambda/switch.mli:32">shared</a> *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">store</span>.<span class="PreProc">Switch</span>.<span class="ocamlLCIdentifier">act_store_shared</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier">d</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Store all other actions *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cst</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cst</span>, <span class="ocamlLCIdentifier">store</span>.<span class="PreProc">Switch</span>.<span class="ocamlLCIdentifier">act_store</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">))</span> <span class="ocamlLCIdentifier">sw<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Retrieve all actions, including potential default *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">store</span>.<span class="PreProc">Switch</span>.<span class="ocamlLCIdentifier">act_get_shared</span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Array of actual actions *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">hs</span>, <span class="ocamlLCIdentifier"><a href="#L2230" title="ocaml/lambda/matching.ml:2230">handle_shared</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2230" title="ocaml/lambda/matching.ml:2230">handle_shared</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier"><a href="#L2230" title="ocaml/lambda/matching.ml:2230">handle_shared</a></span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Reconstruct default and switch <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">d</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">d</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cst</span>, <span class="ocamlLCIdentifier">j</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cst</span>, <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)))</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(!</span><span class="ocamlLCIdentifier">hs</span>, <span class="ocamlLCIdentifier">sw</span>, <span class="ocamlLCIdentifier">d</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Note: dichotomic search requires sorted input with no duplicates *)<br/></li>
<li><a id="L2268">&#x200c;</a></span><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">uniq_lambda_list</span></span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Statement">_</span> <span class="Statement">]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">c1</span>, <span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">p1</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">c2</span>, <span class="Statement">_)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">sw2</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">sw1</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">const_compare</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">c1</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">c2</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2268" title="ocaml/lambda/matching.ml:2268">uniq_lambda_list</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p1</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">sw2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">p1</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L2268" title="ocaml/lambda/matching.ml:2268">uniq_lambda_list</a></span> <span class="ocamlLCIdentifier">sw1<br/></li>
<li></span><br/></li>
<li><a id="L2279">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">sort_lambda_list</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">stable_sort</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span>, <span class="Statement">_)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">y</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">const_compare</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">y</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L2268" title="ocaml/lambda/matching.ml:2268">uniq_lambda_list</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span><br/></li>
<li><a id="L2283">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">do_tests_fail</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier">tst</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fail<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">c</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tst</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span> <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_base</span> <span class="ocamlLCIdentifier">c</span><span class="Statement">)</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2283" title="ocaml/lambda/matching.ml:2283">do_tests_fail</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier">tst</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">rem</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2291">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">do_tests_nofail</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">tst</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.<a href="#L2291" title="ocaml/lambda/matching.ml:2291">do_tests_nofail</a>&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">c</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tst</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span> <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_base</span> <span class="ocamlLCIdentifier">c</span><span class="Statement">)</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2291" title="ocaml/lambda/matching.ml:2291">do_tests_nofail</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">tst</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">rem</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2300">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_test_sequence</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier">tst</span> <span class="ocamlLCIdentifier">lt_tst</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">const_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">const_lambda_list</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2279" title="ocaml/lambda/matching.ml:2279">sort_lambda_list</a></span> <span class="ocamlLCIdentifier">const_lambda_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">hs</span>, <span class="ocamlLCIdentifier">const_lambda_list</span>, <span class="ocamlLCIdentifier">fail</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2241" title="ocaml/lambda/matching.ml:2241">share_actions_tree</a></span> <span class="ocamlLCIdentifier">const_lambda_list</span> <span class="ocamlLCIdentifier">fail<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><a href="#L2300" title="ocaml/lambda/matching.ml:2300">make_test_sequence</a></span> <span class="ocamlLCIdentifier">const_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">const_lambda_list</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">4</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">lt_tst</span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">Pignore</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">split_sequence</span> <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2291" title="ocaml/lambda/matching.ml:2291">do_tests_nofail</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">tst</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2283" title="ocaml/lambda/matching.ml:2283">do_tests_fail</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier">tst</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">split_sequence</span> <span class="ocamlLCIdentifier">const_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">list1</span>, <span class="ocamlLCIdentifier">list2</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">rev_split_at</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">const_lambda_list</span> / <span class="Constant">2</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lt_tst</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span> <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_base</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fst</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">hd</span> <span class="ocamlLCIdentifier">list2</span><span class="Statement">)))</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2300" title="ocaml/lambda/matching.ml:2300">make_test_sequence</a></span> <span class="ocamlLCIdentifier">list1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2300" title="ocaml/lambda/matching.ml:2300">make_test_sequence</a></span> <span class="ocamlLCIdentifier">list2</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">hs</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2300" title="ocaml/lambda/matching.ml:2300">make_test_sequence</a></span> <span class="ocamlLCIdentifier">const_lambda_list</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> SArg</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li><a id="L2324">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">primitive</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Lambda</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">primitive</span><br/></li>
<li></span><br/></li>
<li><a id="L2326">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">eqint</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Pintcomp</span><span class="ocamlStruct"> </span><span class="Constant">Ceq<br/></li>
<li></span><br/></li>
<li><a id="L2328">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">neint</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Pintcomp</span><span class="ocamlStruct"> </span><span class="Constant">Cne<br/></li>
<li></span><br/></li>
<li><a id="L2330">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">leint</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Pintcomp</span><span class="ocamlStruct"> </span><span class="Constant">Cle<br/></li>
<li></span><br/></li>
<li><a id="L2332">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">ltint</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Pintcomp</span><span class="ocamlStruct"> </span><span class="Constant">Clt<br/></li>
<li></span><br/></li>
<li><a id="L2334">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">geint</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Pintcomp</span><span class="ocamlStruct"> </span><span class="Constant">Cge<br/></li>
<li></span><br/></li>
<li><a id="L2336">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">gtint</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Pintcomp</span><span class="ocamlStruct"> </span><span class="Constant">Cgt<br/></li>
<li></span><br/></li>
<li><a id="L2338">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">loc</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Lambda</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L277" title="ocaml/lambda/lambda.mli:277">scoped_location</a><br/></li>
<li><a id="L2339">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">arg</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Lambda</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li><a id="L2340">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">test</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Lambda</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li><a id="L2341">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">act</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Lambda</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li></span><br/></li>
<li><a id="L2343">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_prim</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Lprim</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">p</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="ocamlStruct">, </span><span class="Constant">Loc_unknown</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2345">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_offset</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">Lprim</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Poffsetint</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlStruct">, </span><span class="Statement">[</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">]</span><span class="ocamlStruct">, </span><span class="Constant">Loc_unknown</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2350">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">bind</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">newvar</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">newarg</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Lvar</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">v</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">v</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">newvar</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Ident</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">create_local</span><span class="ocamlStruct"> </span><span class="Constant">&quot;switcher&quot;</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">newvar</span><span class="ocamlStruct">, </span><span class="Constant">Lvar</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">newvar</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span><span class="ocamlStruct"> </span><span class="Constant">Alias</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">newvar</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">newarg</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2360">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_const</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Lconst</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Const_base</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Const_int</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">))<br/></li>
<li></span><br/></li>
<li><a id="L2362">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_isout</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">h</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Lprim</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Pisout</span><span class="ocamlStruct">, </span><span class="Statement">[</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">h</span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">]</span><span class="ocamlStruct">, </span><span class="Constant">Loc_unknown</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2364">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_isin</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">h</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Lprim</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Pnot</span><span class="ocamlStruct">, </span><span class="Statement">[</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2362" title="ocaml/lambda/matching.ml:2362">make_isout</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">h</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">]</span><span class="ocamlStruct">, </span><span class="Constant">Loc_unknown</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2366">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_is_nonzero</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">native_code</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Constant">Lprim</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Pintcomp</span><span class="ocamlStruct"> </span><span class="Constant">Cne</span><span class="ocamlStruct">,<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="Constant">Lconst</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Const_base</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Const_int</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="Statement">))]</span><span class="ocamlStruct">,<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">Loc_unknown</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a><br/></li>
<li></span><br/></li>
<li><a id="L2374">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">arg_as_test</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a><br/></li>
<li></span><br/></li>
<li><a id="L2376">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_if</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">cond</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ifso</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ifnot</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Lifthenelse</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ifso</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ifnot</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2378">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_switch</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">cases</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Comment">(* The [<a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a>] array can contain arbitrary terms.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; If several entries in the [cases] array point to the same action,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; we must <a href="translobj.ml.html#L27" title="ocaml/lambda/translobj.ml:27">share</a> it to avoid duplicating terms.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; See PR#11893 on Github for an example where the other de-duplication<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; mechanisms do not <a href="tmc.ml.html#L89" title="ocaml/lambda/tmc.ml:89">apply</a>. *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">act_uses</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="tmc.ml.html#L190" title="ocaml/lambda/tmc.ml:190">make</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">cases</span><span class="ocamlStruct"> - </span><span class="Constant">1</span><span class="ocamlStruct"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">act_uses</span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cases</span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">))</span><span class="ocamlDo"> </span><span class="Statement">&lt;-</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">act_uses</span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cases</span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">))</span><span class="ocamlDo"> + </span><span class="Constant">1<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">wrapper</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ref</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span><span class="ocamlStruct"> - </span><span class="Constant">1</span><span class="ocamlStruct"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">act_uses</span><span class="ocamlNone">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">nfail</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">wrap</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1050" title="ocaml/lambda/matching.ml:1050">make_catch_delayed</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span><span class="ocamlEnd">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span><span class="ocamlEnd">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">&lt;-</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L2413" title="ocaml/lambda/matching.ml:2413">make_exit</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">nfail</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">prev_wrapper</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">wrapper</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">wrapper</span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">wrap</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">prev_wrapper</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ref</span><span class="ocamlStruct"> </span><span class="Constant">[]</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cases</span><span class="ocamlNone"> - </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">downto</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlDo">, </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cases</span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)))</span><span class="ocamlDo"> </span><span class="Statement">::</span><span class="ocamlDo"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">!</span><span class="ocamlLCIdentifier">wrapper</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Lswitch<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="ocamlStruct">,<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">sw_numconsts</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">cases</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">sw_consts</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">sw_numblocks</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">sw_blocks</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">sw_failaction</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">}</span><span class="ocamlStruct">,<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="ocamlStruct"> </span><span class="Statement">))<br/></li>
<li></span><br/></li>
<li><a id="L2411">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_catch</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L1050" title="ocaml/lambda/matching.ml:1050">make_catch_delayed</a><br/></li>
<li></span><br/></li>
<li><a id="L2413">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_exit</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">make_exit</span><br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Action sharing for Lswitch argument *)<br/></li>
<li><a id="L2417">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">share_actions_sw</span></span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* Attempt sharing on all actions *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">store</span> <span class="Statement">=</span> <span class="PreProc">StoreExp</span>.<span class="ocamlLCIdentifier"><a href="switch.ml.html#L48" title="ocaml/lambda/switch.ml:48">mk_store</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_failaction</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Fail is translated to <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a>, whatever happens *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">store</span>.<span class="PreProc">Switch</span>.<span class="ocamlLCIdentifier">act_store_shared</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier">fail</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">e</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">store</span>.<span class="PreProc">Switch</span>.<span class="ocamlLCIdentifier">act_store</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier">e</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_consts<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">blocks</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">e</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">store</span>.<span class="PreProc">Switch</span>.<span class="ocamlLCIdentifier">act_store</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier">e</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_blocks<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">store</span>.<span class="PreProc">Switch</span>.<span class="ocamlLCIdentifier">act_get_shared</span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">hs</span>, <span class="ocamlLCIdentifier"><a href="#L2230" title="ocaml/lambda/matching.ml:2230">handle_shared</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2230" title="ocaml/lambda/matching.ml:2230">handle_shared</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier"><a href="#L2230" title="ocaml/lambda/matching.ml:2230">handle_shared</a></span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">fail</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">hs</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_consts</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">j</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)))</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_blocks</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">j</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="switch.ml.html#L954" title="ocaml/lambda/switch.ml:954">acts</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)))</span> <span class="ocamlLCIdentifier">blocks</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_failaction</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">fail<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">}</span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Reintroduce fail action in switch argument,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; for the sake of avoiding carrying over huge switches *)<br/></li>
<li></span><br/></li>
<li><a id="L2450">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">reintroduce_fail</span></span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_failaction</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="Statement">=</span> <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">create</span> <span class="Constant">17</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">seen</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L1045" title="ocaml/lambda/matching.ml:1045">as_simple_exit</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">old</span> <span class="Statement">=</span> <span class="Statement">try</span> <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">with</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">replace</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">old</span> + <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="ocamlLCIdentifier">seen</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_consts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="ocamlLCIdentifier">seen</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_blocks</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">i_max</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span>-<span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">and</span> <span class="ocamlLCIdentifier">max</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span>-<span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">iter<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">max</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">i_max</span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">max</span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">max</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">3</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">i_max</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L867" title="ocaml/lambda/matching.ml:867">remove</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">filter</span> <span class="Statement">(fun</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L1045" title="ocaml/lambda/matching.ml:1045">as_simple_exit</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">j</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">j</span> <span class="Statement">&lt;&gt;</span> <span class="ocamlLCIdentifier">default<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">true</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_consts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L867" title="ocaml/lambda/matching.ml:867">remove</a></span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_consts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_blocks</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L867" title="ocaml/lambda/matching.ml:867">remove</a></span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_blocks</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_failaction</span> <span class="Statement">=</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2413" title="ocaml/lambda/matching.ml:2413">make_exit</a></span> <span class="ocamlLCIdentifier">default</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">sw<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Switcher</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Switch.Make</span> <span class="ocamlFuncWith">(</span><span class="PreProc">SArg</span><span class="ocamlFuncWith">)<br/></li>
<li></span><span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Switch<br/></li>
<li></span><br/></li>
<li><a id="L2491">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">last</span></span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span>, <span class="Statement">_)</span> <span class="Statement">]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">x<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2491" title="ocaml/lambda/matching.ml:2491">last</a></span> <span class="ocamlLCIdentifier">def</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span><br/></li>
<li><a id="L2496">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_edges</span></span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span> <span class="ocamlLCIdentifier">high</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span>, <span class="ocamlLCIdentifier">high</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span>, <span class="Statement">_)</span> <span class="Statement">::</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span>, <span class="ocamlLCIdentifier"><a href="#L2491" title="ocaml/lambda/matching.ml:2491">last</a></span> <span class="ocamlLCIdentifier">high</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2501">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">as_interval_canfail</span></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span> <span class="ocamlLCIdentifier">high</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">store</span> <span class="Statement">=</span> <span class="PreProc">StoreExp</span>.<span class="ocamlLCIdentifier"><a href="switch.ml.html#L48" title="ocaml/lambda/switch.ml:48">mk_store</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">do_store</span> <span class="ocamlLCIdentifier">_tag</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">store</span>.<span class="ocamlLCIdentifier">act_store</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; <a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a> &quot;STORE [%<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>] %<a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a> %<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>\n&quot; <a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a> <a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a> (<a href="#L128" title="ocaml/lambda/matching.ml:128">string_of_lam</a> <a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a>) ;<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">nofail_rec</span> <span class="ocamlLCIdentifier">cur_low</span> <span class="ocamlLCIdentifier">cur_high</span> <span class="ocamlLCIdentifier">cur_act</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cur_high</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">high</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier">cur_high</span>, <span class="ocamlLCIdentifier">cur_act</span><span class="Statement">)</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier">cur_high</span>, <span class="ocamlLCIdentifier">cur_act</span><span class="Statement">);</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_high</span> + <span class="Constant">1</span>, <span class="ocamlLCIdentifier">high</span>, <span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">act_i</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">all</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L2517">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">act_index</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">do_store</span> <span class="Constant">&quot;NO&quot;</span> <span class="ocamlLCIdentifier">act_i</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cur_high</span><span class="ocamlNone"> + </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cur_act</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">nofail_rec</span> <span class="ocamlLCIdentifier">cur_low</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier">cur_act</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> - <span class="Constant">1</span>, <span class="ocamlLCIdentifier">cur_act</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L2532" title="ocaml/lambda/matching.ml:2532">fail_rec</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> - <span class="Constant">1</span>, <span class="ocamlLCIdentifier">cur_act</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">nofail_rec</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier">cur_high</span>, <span class="ocamlLCIdentifier">cur_act</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L2532" title="ocaml/lambda/matching.ml:2532">fail_rec</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_high</span> + <span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_high</span> + <span class="Constant">1</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">all<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier">cur_high</span>, <span class="ocamlLCIdentifier">cur_act</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">::</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_high</span> + <span class="Constant">1</span>, <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> - <span class="Constant">1</span>, <span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">::</span> <span class="ocamlLCIdentifier">nofail_rec</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li><a id="L2532">&#x200c;</a></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier"><span class="linkable">fail_rec</span></span> <span class="ocamlLCIdentifier">cur_low</span> <span class="ocamlLCIdentifier">cur_high</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier">cur_high</span>, <span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">act_i</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L270" title="ocaml/lambda/translclass.ml:270">index</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">do_store</span> <span class="Constant">&quot;YES&quot;</span> <span class="ocamlLCIdentifier">act_i</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L270" title="ocaml/lambda/translclass.ml:270">index</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2532" title="ocaml/lambda/matching.ml:2532">fail_rec</a></span> <span class="ocamlLCIdentifier">cur_low</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> - <span class="Constant">1</span>, <span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">nofail_rec</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L270" title="ocaml/lambda/translclass.ml:270">index</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L2541">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">init_rec</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span>, <span class="ocamlLCIdentifier">high</span>, <span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">act_i</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L270" title="ocaml/lambda/translclass.ml:270">index</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">do_store</span> <span class="Constant">&quot;INIT&quot;</span> <span class="ocamlLCIdentifier">act_i</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L270" title="ocaml/lambda/translclass.ml:270">index</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2532" title="ocaml/lambda/matching.ml:2532">fail_rec</a></span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span>, <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> - <span class="Constant">1</span>, <span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">nofail_rec</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L270" title="ocaml/lambda/translclass.ml:270">index</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">nofail_rec</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L270" title="ocaml/lambda/translclass.ml:270">index</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">assert</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">do_store</span> <span class="Constant">&quot;FAIL&quot;</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">=</span> <span class="Constant">0</span><span class="Statement">);<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Comment">(* fail has action <a href="translclass.ml.html#L270" title="ocaml/lambda/translclass.ml:270">index</a> 0 *)<br/></li>
<li><a id="L2555">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">r</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2541" title="ocaml/lambda/matching.ml:2541">init_rec</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">of_list</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span>, <span class="ocamlLCIdentifier">store</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2558">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">as_interval_nofail</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">store</span> <span class="Statement">=</span> <span class="PreProc">StoreExp</span>.<span class="ocamlLCIdentifier"><a href="switch.ml.html#L48" title="ocaml/lambda/switch.ml:48">mk_store</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">some_hole</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Statement">_</span> <span class="Statement">]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="Statement">_)</span> <span class="Statement">::</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">j</span>, <span class="Statement">_)</span> <span class="Statement">::</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">rem</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">j</span> <span class="Statement">&gt;</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> + <span class="Constant">1</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier">some_hole</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">i_rec</span> <span class="ocamlLCIdentifier">cur_low</span> <span class="ocamlLCIdentifier">cur_high</span> <span class="ocamlLCIdentifier">cur_act</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier">cur_high</span>, <span class="ocamlLCIdentifier">cur_act</span><span class="Statement">)</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">store</span>.<span class="ocamlLCIdentifier">act_store</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cur_act</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">i_rec</span> <span class="ocamlLCIdentifier">cur_low</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier">cur_act</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">cur_low</span>, <span class="ocamlLCIdentifier">cur_high</span>, <span class="ocamlLCIdentifier">cur_act</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">i_rec</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">inters</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* In case there is some hole and that a switch is emitted,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; action 0 will be used as the action of unreachable<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cases (cf. switch.ml, <a href="#L2378" title="ocaml/lambda/matching.ml:2378">make_switch</a>).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Hence, this action will be <a href="switch.mli.html#L32" title="ocaml/lambda/switch.mli:32">shared</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">some_hole</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">store</span>.<span class="ocamlLCIdentifier">act_store_shared</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">store</span>.<span class="ocamlLCIdentifier">act_store</span> <span class="Constant">()</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">assert</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span> <span class="Statement">=</span> <span class="Constant">0</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">i_rec</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier"><a href="#L2517" title="ocaml/lambda/matching.ml:2517">act_index</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">of_list</span> <span class="ocamlLCIdentifier">inters</span>, <span class="ocamlLCIdentifier">store</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2594">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">sort_int_lambda_list</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">sort<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">i1</span>, <span class="Statement">_)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">i2</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i1</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i2</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; -<span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i2</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i1</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span><br/></li>
<li><a id="L2605">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">as_interval</span></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span> <span class="ocamlLCIdentifier">high</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2594" title="ocaml/lambda/matching.ml:2594">sort_int_lambda_list</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span> <span class="ocamlLCIdentifier"><a href="#L2496" title="ocaml/lambda/matching.ml:2496">get_edges</a></span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span> <span class="ocamlLCIdentifier">high</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2558" title="ocaml/lambda/matching.ml:2558">as_interval_nofail</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2501" title="ocaml/lambda/matching.ml:2501">as_interval_canfail</a></span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span> <span class="ocamlLCIdentifier">high</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">call_switcher</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span> <span class="ocamlLCIdentifier">high</span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">edges</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">cases</span>, <span class="ocamlLCIdentifier">actions</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2605" title="ocaml/lambda/matching.ml:2605">as_interval</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="switch.ml.html#L749" title="ocaml/lambda/switch.ml:749">low</a></span> <span class="ocamlLCIdentifier">high</span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Switcher</span>.<span class="ocamlLCIdentifier"><a href="switch.ml.html#L941" title="ocaml/lambda/switch.ml:941">zyva</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">edges</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">cases</span> <span class="ocamlLCIdentifier">actions<br/></li>
<li></span><br/></li>
<li><a id="L2616">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">list_as_pat</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.<a href="#L2616" title="ocaml/lambda/matching.ml:2616">list_as_pat</a>&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">pat<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Tpat_or</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pat</span>, <span class="ocamlLCIdentifier"><a href="#L2616" title="ocaml/lambda/matching.ml:2616">list_as_pat</a></span> <span class="ocamlLCIdentifier">rem</span>, <span class="Constant">None</span><span class="Statement">)</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L2621">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">complete_pats_constrs</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">constr</span> <span class="Statement">::</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">constrs</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">constr_of_pat</span> <span class="ocamlLCIdentifier">cstr_pat</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cstr_pat</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pat_of_constr</span> <span class="ocamlLCIdentifier">cstr</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Patterns.Head</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">to_omega_pattern</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">constr</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="Constant">Construct</span> <span class="ocamlLCIdentifier">cstr</span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier">pat_of_constr<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">complete_constrs</span> <span class="ocamlLCIdentifier">constr</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier">constr_of_pat</span> <span class="ocamlLCIdentifier">constrs</span><span class="Statement">))<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Following two ``failaction'' function compute n, the trap handler<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; to jump to in case of failure of elementary tests<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L2637">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">mk_failaction_neg</span></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Partial</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L809" title="ocaml/lambda/matching.ml:809">pop</a></span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">((_</span>, <span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span><span class="Statement">)</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span>, <span class="Constant">[]</span><span class="Statement">))</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L878" title="ocaml/lambda/matching.ml:878">singleton</a></span> <span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Act as Total, this means<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; If no appropriate default <a href="#L390" title="ocaml/lambda/matching.ml:390">matrix</a> exists,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; then this switch cannot fail *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">None</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Total</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">None</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* In line with the article and simpler than before *)<br/></li>
<li><a id="L2652">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">mk_failaction_pos</span></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">seen</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">defs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/lambda/matching.ml:101">dbg</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;**POS**\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lambda/matching.ml:813">pp</a></span> <span class="ocamlLCIdentifier">defs</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">scan_def</span> <span class="ocamlLCIdentifier">env</span> <span class="ocamlLCIdentifier">to_test</span> <span class="ocamlLCIdentifier">defs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">to_test</span>, <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L809" title="ocaml/lambda/matching.ml:809">pop</a></span> <span class="ocamlLCIdentifier">defs</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span>, <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">klist</span>, <span class="ocamlLCIdentifier">jumps</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pats</span>, <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">action</span> <span class="Statement">=</span> <span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">klist</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">get_key_constr</span> <span class="ocamlLCIdentifier">pat</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pats</span> <span class="ocamlLCIdentifier">klist<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">jumps</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">(</span><span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L596" title="ocaml/lambda/matching.ml:596">lub</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2616" title="ocaml/lambda/matching.ml:2616">list_as_pat</a></span> <span class="ocamlLCIdentifier">pats</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">jumps<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">klist</span>, <span class="ocamlLCIdentifier">jumps</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">[]</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">env<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">Some</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">pss</span>, <span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">rem</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">now</span>, <span class="ocamlLCIdentifier">later</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">partition</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">_p</span>, <span class="ocamlLCIdentifier">p_ctx</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier">matches</span> <span class="ocamlLCIdentifier">p_ctx</span> <span class="ocamlLCIdentifier">pss</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">to_test<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">now</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">scan_def</span> <span class="ocamlLCIdentifier">env</span> <span class="ocamlLCIdentifier">to_test</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">scan_def</span> <span class="Statement">((</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier">fst</span> <span class="ocamlLCIdentifier">now</span>, <span class="ocamlLCIdentifier"><a href="#L1354" title="ocaml/lambda/matching.ml:1354">idef</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">env</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">later</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail_pats</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2621" title="ocaml/lambda/matching.ml:2621">complete_pats_constrs</a></span> <span class="ocamlLCIdentifier">seen</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">fail_pats</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">match_context_rows</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier">jmps</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">scan_def</span> <span class="Constant">[]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pat</span>, <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L596" title="ocaml/lambda/matching.ml:596">lub</a></span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">fail_pats</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">defs<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/lambda/matching.ml:101">dbg</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;POSITIVE JUMPS [%<a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a>]:\n&quot;</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">fail_pats</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="ocamlLCIdentifier">jmps<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">None</span>, <span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier">jmps</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">)</span> <span class="Statement">else</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* Too many non-matched constructors -&gt; reduced information *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/lambda/matching.ml:101">dbg</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;POS-&gt;NEG!!!\n%!&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier">jumps</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2637" title="ocaml/lambda/matching.ml:2637">mk_failaction_neg</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">defs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/lambda/matching.ml:101">dbg</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;FAIL: %<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>\n&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">&quot;&lt;<a href="debuginfo.ml.html#L118" title="ocaml/lambda/debuginfo.ml:118">none</a>&gt;&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L128" title="ocaml/lambda/matching.ml:128">string_of_lam</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">fail</span>, <span class="Constant">[]</span>, <span class="ocamlLCIdentifier">jumps</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">combine_constant</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">cst</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">const_lambda_list</span>, <span class="ocamlLCIdentifier">total</span>, <span class="ocamlLCIdentifier">_pats</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier">local_jumps</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2637" title="ocaml/lambda/matching.ml:2637">mk_failaction_neg</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">in<br/></li>
<li><a id="L2711">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lambda1</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">cst</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_int</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_int</span> <span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">call_switcher</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">min_int</span> <span class="ocamlLCIdentifier">max_int</span> <span class="ocamlLCIdentifier">int_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_char</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_char</span> <span class="ocamlLCIdentifier">c</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">code</span> <span class="ocamlLCIdentifier">c</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">call_switcher</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Constant">0</span> <span class="Constant">255</span> <span class="ocamlLCIdentifier">int_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_string</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Note as the bytecode compiler may resort to dichotomic search,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the clauses of stringswitch&nbsp; are sorted with duplicates removed.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; This partly applies to the native code compiler, which requires<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; no duplicates *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">const_lambda_list</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2279" title="ocaml/lambda/matching.ml:2279">sort_lambda_list</a></span> <span class="ocamlLCIdentifier">const_lambda_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">c</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_string</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">hs</span>, <span class="ocamlLCIdentifier">sw</span>, <span class="ocamlLCIdentifier">fail</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2241" title="ocaml/lambda/matching.ml:2241">share_actions_tree</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">hs</span> <span class="Statement">(</span><span class="Constant">Lstringswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">sw</span>, <span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_float</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2300" title="ocaml/lambda/matching.ml:2300">make_test_sequence</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">(</span><span class="Constant">Pfloatcomp</span> <span class="Constant">CFneq</span><span class="Statement">)</span> <span class="Statement">(</span><span class="Constant">Pfloatcomp</span> <span class="Constant">CFlt</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_int32</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2300" title="ocaml/lambda/matching.ml:2300">make_test_sequence</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Pbintcomp</span> <span class="Statement">(</span><span class="Constant">Pint32</span>, <span class="Constant">Cne</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Pbintcomp</span> <span class="Statement">(</span><span class="Constant">Pint32</span>, <span class="Constant">Clt</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_int64</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2300" title="ocaml/lambda/matching.ml:2300">make_test_sequence</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Pbintcomp</span> <span class="Statement">(</span><span class="Constant">Pint64</span>, <span class="Constant">Cne</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Pbintcomp</span> <span class="Statement">(</span><span class="Constant">Pint64</span>, <span class="Constant">Clt</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Const_nativeint</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2300" title="ocaml/lambda/matching.ml:2300">make_test_sequence</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Pbintcomp</span> <span class="Statement">(</span><span class="Constant">Pnativeint</span>, <span class="Constant">Cne</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Pbintcomp</span> <span class="Statement">(</span><span class="Constant">Pnativeint</span>, <span class="Constant">Clt</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">const_lambda_list<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span> <span class="ocamlLCIdentifier">local_jumps</span> <span class="ocamlLCIdentifier">total</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2768">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">split_cases</span></span> <span class="ocamlLCIdentifier">tag_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">split_rec</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">[]</span>, <span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cstr_tag</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">split_rec</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">cstr_tag</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_constant</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_block</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_unboxed</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="Statement">(</span><span class="Constant">0</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_extension</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">const</span>, <span class="ocamlLCIdentifier">nonconst</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">split_rec</span> <span class="ocamlLCIdentifier">tag_lambda_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2594" title="ocaml/lambda/matching.ml:2594">sort_int_lambda_list</a></span> <span class="ocamlLCIdentifier">const</span>, <span class="ocamlLCIdentifier"><a href="#L2594" title="ocaml/lambda/matching.ml:2594">sort_int_lambda_list</a></span> <span class="ocamlLCIdentifier">nonconst</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2783">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">split_extension_cases</span></span> <span class="ocamlLCIdentifier">tag_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">split_rec</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">[]</span>, <span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cstr_tag</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">split_rec</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">cstr_tag</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_extension</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span>, <span class="Constant">true</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_extension</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span>, <span class="Constant">false</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">split_rec</span> <span class="ocamlLCIdentifier">tag_lambda_list<br/></li>
<li></span><br/></li>
<li><a id="L2796">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">combine_constructor</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier">cstr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2853" title="ocaml/lambda/matching.ml:2853">descr_lambda_list</a></span>, <span class="ocamlLCIdentifier">total1</span>, <span class="ocamlLCIdentifier">pats</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">tag_lambda</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cstr</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_tag</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_tag</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Cstr_extension</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Special cases for extensions *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier">local_jumps</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2637" title="ocaml/lambda/matching.ml:2637">mk_failaction_neg</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2783" title="ocaml/lambda/matching.ml:2783">split_extension_cases</a></span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier">tag_lambda</span> <span class="ocamlLCIdentifier"><a href="#L2853" title="ocaml/lambda/matching.ml:2853">descr_lambda_list</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">default</span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span>, <span class="ocamlLCIdentifier">rem</span>, <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">nonconst_lambda</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">nonconsts</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">default<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;<a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a>&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">tests</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ext</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L405" title="ocaml/lambda/lambda.mli:405">transl_extension_path</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pintcomp</span> <span class="Constant">Ceq</span>, <span class="Statement">[</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">ext</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span>, <span class="ocamlLCIdentifier">rem</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">nonconsts</span> <span class="ocamlLCIdentifier">default<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Llet</span> <span class="Statement">(</span><span class="Constant">Alias</span>, <span class="Constant">Pgenval</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L339" title="ocaml/lambda/translcore.ml:339">tag</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">Pointer</span>, <span class="Constant">Immutable</span><span class="Statement">)</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">tests</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ext</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L405" title="ocaml/lambda/lambda.mli:405">transl_extension_path</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse</span> <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pintcomp</span> <span class="Constant">Ceq</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">ext</span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span>, <span class="ocamlLCIdentifier">rem</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span> <span class="ocamlLCIdentifier">nonconst_lambda<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span> <span class="ocamlLCIdentifier">local_jumps</span> <span class="ocamlLCIdentifier">total1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Regular concrete type *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ncases</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="#L2853" title="ocaml/lambda/matching.ml:2853">descr_lambda_list</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">nconstrs</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_consts</span> + <span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_nonconsts</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2986" title="ocaml/lambda/matching.ml:2986">sig_complete</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ncases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">nconstrs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail_opt</span>, <span class="ocamlLCIdentifier">fails</span>, <span class="ocamlLCIdentifier">local_jumps</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L2986" title="ocaml/lambda/matching.ml:2986">sig_complete</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">None</span>, <span class="Constant">[]</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">constrs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map2</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">constr</span>, <span class="ocamlLCIdentifier">_act</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">-&gt;</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">constr</span> <span class="Statement">})<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2853" title="ocaml/lambda/matching.ml:2853">descr_lambda_list</a></span> <span class="ocamlLCIdentifier">pats</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2652" title="ocaml/lambda/matching.ml:2652">mk_failaction_pos</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">constrs</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li><a id="L2853">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">descr_lambda_list</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">fails</span> @ <span class="ocamlLCIdentifier"><span class="linkable">descr_lambda_list</span></span> <span class="Statement">in<br/></li>
<li><a id="L2854">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">consts</span></span>, <span class="ocamlLCIdentifier">nonconsts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2768" title="ocaml/lambda/matching.ml:2768">split_cases</a></span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier">tag_lambda</span> <span class="ocamlLCIdentifier"><a href="#L2853" title="ocaml/lambda/matching.ml:2853">descr_lambda_list</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Our duty below is to generate code, for matching on a <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; constructor+action cases, that is good for both bytecode and<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; native-code compilation. (Optimizations that only work well<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for one backend should be done in the backend.)<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; The [Lswitch] construct is generally an excellent <a href="tmc.ml.html#L573" title="ocaml/lambda/tmc.ml:573">choice</a>, as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; it generates a single instruction in bytecode, and can be<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; turned into efficient, simpler control-flow constructs in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; native-code. (The <a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a>/switch.ml module is precisely<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; responsible for efficiently compiling switches to simpler<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; tests.)<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Some additional optimizations <a href="tmc.ml.html#L190" title="ocaml/lambda/tmc.ml:190">make</a> sense here when they let<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; us generate better code, including in bytecode: the generated<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; code should still fit in one bytecode instruction or less.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Lswitch] has the downside of always needing a byte per<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; constructor in the generated bytecode, even when many actions<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; are <a href="switch.mli.html#L32" title="ocaml/lambda/switch.mli:32">shared</a>. For types with a lot of constructors, calling the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switcher directly can result in more compact code. This is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; a reason to deviate from the one-instruction policy.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; *)<br/></li>
<li><a id="L2878">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lambda1</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fail_opt</span>, <span class="ocamlLCIdentifier"><a href="#L1074" title="ocaml/lambda/matching.ml:1074">same_actions</a></span> <span class="ocamlLCIdentifier"><a href="#L2853" title="ocaml/lambda/matching.ml:2853">descr_lambda_list</a></span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Identical actions, no failure: 0 control-flow instructions. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_consts</span>, <span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_nonconsts</span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">1</span>, <span class="Constant">1</span>, <span class="Statement">[</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="ocamlLCIdentifier">act1</span><span class="Statement">)</span> <span class="Statement">]</span>, <span class="Statement">[</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="ocamlLCIdentifier">act2</span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* This case is very frequent, it corresponds to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; options and lists. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Keeping the Pisint <a href="#L2340" title="ocaml/lambda/matching.ml:2340">test</a> would <a href="tmc.ml.html#L190" title="ocaml/lambda/tmc.ml:190">make</a> the bytecode<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; slightly worse, but it lets the native compiler generate<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; better code -- see #10681. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">native_code</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse</span><span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pisint</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">act1</span>, <span class="ocamlLCIdentifier">act2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">act2</span>, <span class="ocamlLCIdentifier">act1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">n</span>, <span class="Constant">0</span>, <span class="Statement">_</span>, <span class="Constant">[]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* The matched type defines constant constructors only.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (typically the constant cases are <a href="switch.ml.html#L840" title="ocaml/lambda/switch.ml:840">dense</a>, so<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; call_switcher will generate a Lswitch, still one<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; instruction.) *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">call_switcher</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail_opt</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Constant">0</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">n</span>, <span class="Statement">_</span>, <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">act0</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* = Some <a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a> when all non-const constructors match to <a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fail_opt</span>, <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">a</span>, <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">a<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">nonconsts</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cstr</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">cstr_nonconsts</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1074" title="ocaml/lambda/matching.ml:1074">same_actions</a></span> <span class="ocamlLCIdentifier">nonconsts<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1074" title="ocaml/lambda/matching.ml:1074">same_actions</a></span> <span class="ocamlLCIdentifier">nonconsts<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">act0</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* This case deviates from our policy, by typically<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; generating three bytecode instructions.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; It can save a lot of bytecode space when matching<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; on a type with many non-constant constructors,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; all sent to the same action. This pattern occurs<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; several times in the compiler codebase<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (for example), due to code fragments such as the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; following:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; match token with SEMISEMI -&gt; true | _ -&gt; false<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (The type of tokens has more than 120 constructors.)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pisint</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">call_switcher</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail_opt</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Constant">0</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* In the general case, emit a switch. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">sw_numconsts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_consts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_consts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_numblocks</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">cstr</span>.<span class="ocamlLCIdentifier">cstr_nonconsts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_blocks</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_failaction</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">fail_opt<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">hs</span>, <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2417" title="ocaml/lambda/matching.ml:2417">share_actions_sw</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2450" title="ocaml/lambda/matching.ml:2450">reintroduce_fail</a></span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">hs</span> <span class="Statement">(</span><span class="Constant">Lswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">sw</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span> <span class="ocamlLCIdentifier">local_jumps</span> <span class="ocamlLCIdentifier">total1</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2953">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_test_sequence_variant_constant</span></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">_</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">cases</span>, <span class="ocamlLCIdentifier">actions</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2605" title="ocaml/lambda/matching.ml:2605">as_interval</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier">min_int</span> <span class="ocamlLCIdentifier">max_int</span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Switcher</span>.<span class="ocamlLCIdentifier">test_sequence</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">cases</span> <span class="ocamlLCIdentifier">actions<br/></li>
<li></span><br/></li>
<li><a id="L2957">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">call_switcher_variant_constant</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">call_switcher</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">min_int</span> <span class="ocamlLCIdentifier">max_int</span> <span class="ocamlLCIdentifier">int_lambda_list<br/></li>
<li></span><br/></li>
<li><a id="L2960">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">call_switcher_variant_constr</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;variant&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Constant">Llet<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Alias</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">Pgenval</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">v</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pfield</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">Pointer</span>, <span class="Constant">Immutable</span><span class="Statement">)</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">call_switcher</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">(</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">min_int</span> <span class="ocamlLCIdentifier">max_int</span> <span class="ocamlLCIdentifier">int_lambda_list</span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L2969">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">combine_variant</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">row</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tag_lambda_list</span>, <span class="ocamlLCIdentifier">total1</span>, <span class="ocamlLCIdentifier">_pats</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">num_constr</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">row_closed</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">row</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">row_field_repr</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Rabsent<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Reither</span> <span class="Statement">(</span><span class="Constant">true</span>, <span class="Statement">_</span> <span class="Statement">::</span> <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier">num_constr</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">row_fields</span> <span class="ocamlLCIdentifier">row</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">num_constr</span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier">max_int</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">test_int_or_block</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">if_int</span> <span class="ocamlLCIdentifier">if_block</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lifthenelse</span> <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pisint</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">if_int</span>, <span class="ocamlLCIdentifier">if_block</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L2986">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">sig_complete</span></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">tag_lambda_list</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">num_constr<br/></li>
<li></span>&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">one_action</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1074" title="ocaml/lambda/matching.ml:1074">same_actions</a></span> <span class="ocamlLCIdentifier">tag_lambda_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier">local_jumps</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L2986" title="ocaml/lambda/matching.ml:2986">sig_complete</a><br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">||<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">partial</span><span class="ocamlNone"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlNone"> </span><span class="Constant">Total</span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="Constant">true<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlNone"> </span><span class="Statement">_</span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">None</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2637" title="ocaml/lambda/matching.ml:2637">mk_failaction_neg</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2768" title="ocaml/lambda/matching.ml:2768">split_cases</a></span> <span class="ocamlLCIdentifier">tag_lambda_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier">one_action</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span>, <span class="ocamlLCIdentifier">nonconsts</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">[</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">act1</span><span class="Statement">)</span> <span class="Statement">]</span>, <span class="Statement">[</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">act2</span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">=</span> <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">test_int_or_block</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">act1</span> <span class="ocamlLCIdentifier">act2<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2953" title="ocaml/lambda/matching.ml:2953">make_test_sequence_variant_constant</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* PR#11587: Switcher.test_sequence expects integer inputs, so<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if the type allows pointers we must filter them away. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">test_int_or_block</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="ocamlLCIdentifier">fail<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2960" title="ocaml/lambda/matching.ml:2960">call_switcher_variant_constr</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">nonconsts</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* One must not dereference integers *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">test_int_or_block</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">lam_const</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2957" title="ocaml/lambda/matching.ml:2957">call_switcher_variant_constant</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L25" title="ocaml/lambda/translobj.ml:25">consts</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">lam_nonconst</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2960" title="ocaml/lambda/matching.ml:2960">call_switcher_variant_constr</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">nonconsts<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">test_int_or_block</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">lam_const</span> <span class="ocamlLCIdentifier">lam_nonconst<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span> <span class="ocamlLCIdentifier">local_jumps</span> <span class="ocamlLCIdentifier">total1</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L3033">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">combine_array</span></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">len_lambda_list</span>, <span class="ocamlLCIdentifier">total1</span>, <span class="ocamlLCIdentifier">_pats</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fail</span>, <span class="ocamlLCIdentifier">local_jumps</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L2637" title="ocaml/lambda/matching.ml:2637">mk_failaction_neg</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">newvar</span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;len&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">switch</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">call_switcher</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">fail</span> <span class="Statement">(</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">newvar</span><span class="Statement">)</span> <span class="Constant">0</span> <span class="ocamlLCIdentifier">max_int</span> <span class="ocamlLCIdentifier">len_lambda_list<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="Constant">Alias</span> <span class="ocamlLCIdentifier">newvar</span> <span class="Statement">(</span><span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Parraylength</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">]</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">))</span> <span class="ocamlLCIdentifier">switch<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span> <span class="ocamlLCIdentifier">local_jumps</span> <span class="ocamlLCIdentifier">total1</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Insertion of debugging events *)<br/></li>
<li></span><br/></li>
<li><a id="L3047">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">event_branch</span></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">repr</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Levent</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>', <span class="ocamlLCIdentifier">ev</span><span class="Statement">)</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Levent<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>',<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">lev_loc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ev</span>.<span class="ocamlLCIdentifier">lev_loc</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lev_kind</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ev</span>.<span class="ocamlLCIdentifier">lev_kind</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lev_repr</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">repr</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lev_env</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ev</span>.<span class="ocamlLCIdentifier">lev_env<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Llet</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">)</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Llet</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier"><a href="#L3047" title="ocaml/lambda/matching.ml:3047">event_branch</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstaticraise</span> <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">Some</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Printlambda</span>.<span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">str_formatter</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fatal_error</span> <span class="Statement">(</span><span class="Constant">&quot;Matching.<a href="#L3047" title="ocaml/lambda/matching.ml:3047">event_branch</a>: &quot;</span> <span class="Statement">^</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">flush_str_formatter</span> <span class="Constant">()</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; This exception is raised when the compiler cannot produce code<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; because control cannot reach the compiled clause,<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Unused is raised initially in <a href="#L3132" title="ocaml/lambda/matching.ml:3132">compile_test</a>.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; <a href="#L3082" title="ocaml/lambda/matching.ml:3082">compile_list</a> (for compiling switch results) catch Unused<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; <a href="#L3191" title="ocaml/lambda/matching.ml:3191">comp_match_handlers</a> (for compiling split matches)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; may reraise Unused<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">Unused<br/></li>
<li></span><br/></li>
<li><a id="L3082">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">compile_list</span></span> <span class="ocamlLCIdentifier">compile_fun</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">c_rec</span> <span class="ocamlLCIdentifier">totals</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">[]</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L916" title="ocaml/lambda/matching.ml:916">unions</a></span> <span class="ocamlLCIdentifier">totals</span>, <span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.mli.html#L42" title="ocaml/lambda/switch.mli:42">key</a></span>, <span class="ocamlLCIdentifier">cell</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Context</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cell</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">c_rec</span> <span class="ocamlLCIdentifier">totals</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">compile_fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cell</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">ctx</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cell</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">pm</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">exception</span><span class="ocamlEnd"> </span><span class="Constant">Unused</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c_rec</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">totals</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">total1</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c_rem</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">total</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">new_discrs</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">c_rec</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Jumps</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlEnd"> </span><span class="PreProc">Context</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L525" title="ocaml/lambda/matching.ml:525">combine</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">total1</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">totals</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="switch.mli.html#L42" title="ocaml/lambda/switch.mli:42">key</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c_rem</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">total</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Patterns</span><span class="ocamlEnd">.</span><span class="PreProc">Head</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">to_omega_pattern</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cell</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">discr</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">new_discrs</span><span class="ocamlEnd"> </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">c_rec</span> <span class="Constant">[]</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a><br/></li>
<li></span><br/></li>
<li><a id="L3103">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">compile_orhandlers</span></span> <span class="ocamlLCIdentifier">compile_fun</span> <span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span> <span class="ocamlLCIdentifier">total1</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">to_catch</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">do_rec</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span> <span class="ocamlLCIdentifier">total_r</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span>, <span class="ocamlLCIdentifier">total_r</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">provenance</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">mat</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">vars</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">}</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">=</span> <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L585" title="ocaml/lambda/matching.ml:585">select_columns</a></span> <span class="ocamlLCIdentifier">mat</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">compile_fun</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">exception</span> <span class="Constant">Unused</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">do_rec</span> <span class="Statement">(</span><span class="Constant">Lstaticcatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span>, <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">vars</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L366" title="ocaml/lambda/lambda.mli:366">lambda_unit</a></span><span class="Statement">))</span> <span class="ocamlLCIdentifier">total_r</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">handler_i</span>, <span class="ocamlLCIdentifier">total_i</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">raw_action</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Lstaticraise</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fold_right2<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L442" title="ocaml/lambda/lambda.mli:442">bind_with_value_kind</a></span><span class="ocamlEnd"> </span><span class="Constant">Alias</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">vars</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">handler_i</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Jumps</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Context</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L518" title="ocaml/lambda/matching.ml:518">rshift_num</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L462" title="ocaml/lambda/matching.ml:462">ncols</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mat</span><span class="Statement">))</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">total_i</span><span class="ocamlEnd"> </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">do_rec</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">total_r</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">do_rec<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Lstaticcatch</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="ocamlEnd">, </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">vars</span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">handler_i</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="PreProc">Jumps</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Jumps</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L867" title="ocaml/lambda/matching.ml:867">remove</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">total_r</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">(</span><span class="PreProc">Jumps</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Context</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L518" title="ocaml/lambda/matching.ml:518">rshift_num</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L462" title="ocaml/lambda/matching.ml:462">ncols</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mat</span><span class="Statement">))</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">total_i</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">do_rec</span> <span class="ocamlLCIdentifier"><a href="#L2711" title="ocaml/lambda/matching.ml:2711">lambda1</a></span> <span class="ocamlLCIdentifier">total1</span> <span class="ocamlLCIdentifier">to_catch<br/></li>
<li></span><br/></li>
<li><a id="L3132">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">compile_test</span></span> <span class="ocamlLCIdentifier">compile_fun</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a></span> <span class="ocamlLCIdentifier"><a href="#L525" title="ocaml/lambda/matching.ml:525">combine</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">to_match</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">to_match</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">c_div</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3082" title="ocaml/lambda/matching.ml:3082">compile_list</a></span> <span class="ocamlLCIdentifier">compile_fun</span> <span class="ocamlLCIdentifier"><a href="#L1666" title="ocaml/lambda/matching.ml:1666">division</a></span>.<span class="ocamlLCIdentifier">cells</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">c_div</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span>, <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L2637" title="ocaml/lambda/matching.ml:2637">mk_failaction_neg</a></span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">to_match</span>.<span class="ocamlLCIdentifier">default</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">raise</span> <span class="Constant">Unused<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>, <span class="ocamlLCIdentifier">total</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L525" title="ocaml/lambda/matching.ml:525">combine</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">to_match</span>.<span class="ocamlLCIdentifier">default</span> <span class="ocamlLCIdentifier">c_div<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Attempt to avoid some useless bindings by lowering them *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Approximation of v present in <a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a> *)<br/></li>
<li><a id="L3146">&#x200c;</a></span><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">approx_present</span></span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lconst</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstaticraise</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lprim</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Llet</span> <span class="Statement">(</span><span class="Constant">Alias</span>, <span class="ocamlLCIdentifier">_k</span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">l2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">l1</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">l2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">vv</span> <span class="Statement">-&gt;</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">same</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">vv<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span><br/></li>
<li><a id="L3155">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">lower_bind</span></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lifthenelse</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span>, <span class="ocamlLCIdentifier">ifso</span>, <span class="ocamlLCIdentifier">ifnot</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pcond</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">cond<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">pso</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">ifso<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">pnot</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">ifnot</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pcond</span>, <span class="ocamlLCIdentifier">pso</span>, <span class="ocamlLCIdentifier">pnot</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">false</span>, <span class="Constant">false</span>, <span class="Constant">false</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">false</span>, <span class="Constant">true</span>, <span class="Constant">false</span> <span class="Statement">-&gt;</span> <span class="Constant">Lifthenelse</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span>, <span class="ocamlLCIdentifier"><a href="#L3155" title="ocaml/lambda/matching.ml:3155">lower_bind</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">ifso</span>, <span class="ocamlLCIdentifier">ifnot</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">false</span>, <span class="Constant">false</span>, <span class="Constant">true</span> <span class="Statement">-&gt;</span> <span class="Constant">Lifthenelse</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">cond</span>, <span class="ocamlLCIdentifier">ifso</span>, <span class="ocamlLCIdentifier"><a href="#L3155" title="ocaml/lambda/matching.ml:3155">lower_bind</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">ifnot</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="Constant">Alias</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ls</span>, <span class="Statement">({</span> <span class="ocamlLCIdentifier">sw_consts</span> <span class="Statement">=</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">];</span> <span class="ocamlLCIdentifier">sw_blocks</span> <span class="Statement">=</span> <span class="Constant">[]</span> <span class="Statement">}</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">sw</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">when</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">ls</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ls</span>, <span class="Statement">{</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">sw_consts</span> <span class="Statement">=</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="#L3155" title="ocaml/lambda/matching.ml:3155">lower_bind</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ls</span>, <span class="Statement">({</span> <span class="ocamlLCIdentifier">sw_consts</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">sw_blocks</span> <span class="Statement">=</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">}</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">sw</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">when</span> <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">ls</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ls</span>, <span class="Statement">{</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">sw_blocks</span> <span class="Statement">=</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="#L3155" title="ocaml/lambda/matching.ml:3155">lower_bind</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="#L2341" title="ocaml/lambda/matching.ml:2341">act</a></span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">}</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Llet</span> <span class="Statement">(</span><span class="Constant">Alias</span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier">vv</span>, <span class="ocamlLCIdentifier">lv</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L3146" title="ocaml/lambda/matching.ml:3146">approx_present</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">v</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">lv</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="Constant">Alias</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Llet</span> <span class="Statement">(</span><span class="Constant">Alias</span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier">vv</span>, <span class="ocamlLCIdentifier">lv</span>, <span class="ocamlLCIdentifier"><a href="#L3155" title="ocaml/lambda/matching.ml:3155">lower_bind</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="Constant">Alias</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span><br/></li>
<li><a id="L3180">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">bind_check</span></span> <span class="ocamlLCIdentifier">str</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">Lvar</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="ocamlLCIdentifier">str</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alias</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L3155" title="ocaml/lambda/matching.ml:3155">lower_bind</a></span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="ocamlLCIdentifier">str</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span><br/></li>
<li><a id="L3186">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">comp_exit</span></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L809" title="ocaml/lambda/matching.ml:809">pop</a></span> <span class="ocamlLCIdentifier">m</span>.<span class="ocamlLCIdentifier">default</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">((_</span>, <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="Statement">)</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="Constant">[]</span><span class="Statement">)</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L878" title="ocaml/lambda/matching.ml:878">singleton</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.<a href="#L3186" title="ocaml/lambda/matching.ml:3186">comp_exit</a>&quot;<br/></li>
<li></span><br/></li>
<li><a id="L3191">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">comp_match_handlers</span></span> <span class="ocamlLCIdentifier">comp_fun</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">first_match</span> <span class="ocamlLCIdentifier">next_matchs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">next_matchs</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">comp_fun</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">first_match<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">c_rec</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="ocamlLCIdentifier">total_body</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span>, <span class="ocamlLCIdentifier">total_body</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* Hum, -1 means never taken<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; | (-1,pm)::rem -&gt; c_rec <a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a> total_body rem *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">pm</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ctx_i</span>, <span class="ocamlLCIdentifier">total_rem</span> <span class="Statement">=</span> <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier">extract</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="ocamlLCIdentifier">total_body</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Context</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ctx_i</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">c_rec</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="ocamlLCIdentifier">total_body</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">partial</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">partial<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">Partial<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">comp_fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">partial</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ctx_i</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pm</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">li</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">total_i</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">c_rec<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Lstaticcatch</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="ocamlEnd">, </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlEnd">, </span><span class="Constant">[]</span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">li</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="PreProc">Jumps</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L900" title="ocaml/lambda/matching.ml:900">union</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">total_i</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">total_rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">exception</span><span class="ocamlEnd"> </span><span class="Constant">Unused</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">c_rec<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="Constant">Lstaticcatch</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="ocamlEnd">, </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span><span class="ocamlEnd">, </span><span class="Constant">[]</span><span class="Statement">)</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L366" title="ocaml/lambda/lambda.mli:366">lambda_unit</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">total_rem</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">comp_fun</span> <span class="Constant">Partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">first_match</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">first_lam</span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">c_rec</span> <span class="ocamlLCIdentifier">first_lam</span> <span class="ocamlLCIdentifier">total</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">exception</span> <span class="Constant">Unused</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">next_matchs</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">raise</span> <span class="Constant">Unused<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">xs</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L3191" title="ocaml/lambda/matching.ml:3191">comp_match_handlers</a></span> <span class="ocamlLCIdentifier">comp_fun</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">xs<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* To find reasonable names for variables *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L124" title="ocaml/lambda/translclass.ml:124">name_pattern</a></span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">pat</span>, <span class="Statement">_)</span>, <span class="Statement">_)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">pat</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_var</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_alias</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L124" title="ocaml/lambda/translclass.ml:124">name_pattern</a></span> <span class="ocamlLCIdentifier">default</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="ocamlLCIdentifier">default<br/></li>
<li></span><br/></li>
<li><a id="L3242">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">arg_to_var</span></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">cls</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">v</span>, <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L124" title="ocaml/lambda/translclass.ml:124">name_pattern</a></span> <span class="Constant">&quot;*match*&quot;</span> <span class="ocamlLCIdentifier">cls</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">v</span>, <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; The main compilation function.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Input:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; repr=used for inserting debug events<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; partial=exhaustiveness information from Parmatch<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; ctx=a <a href="tmc.ml.html#L545" title="ocaml/lambda/tmc.ml:545">context</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; m=a pattern matching<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Output: a <a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a> term, a jump summary {..., <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> number -&gt; <a href="tmc.ml.html#L545" title="ocaml/lambda/tmc.ml:545">context</a>, .. }<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L3260">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">compile_match</span></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">m</span> : <span class="ocamlLCIdentifier"><a href="#L388" title="ocaml/lambda/matching.ml:388">initial_clause</a></span> <span class="ocamlLCIdentifier">pattern_matching</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">m</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="Constant">[]</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L474" title="ocaml/lambda/lambda.mli:474">is_guarded</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">action</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="Constant">None</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3047" title="ocaml/lambda/matching.ml:3047">event_branch</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L475" title="ocaml/lambda/lambda.mli:475">patch_guarded</a></span> <span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span> <span class="ocamlLCIdentifier">action</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">total</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3047" title="ocaml/lambda/matching.ml:3047">event_branch</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">action</span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">nonempty_cases</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">compile_match_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">map_on_rows</span> <span class="PreProc">Non_empty_row</span>.<span class="ocamlLCIdentifier">of_initial</span> <span class="ocamlLCIdentifier">nonempty_cases</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">compile_match_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">m</span> : <span class="PreProc">Typedtree</span>.<span class="ocamlLCIdentifier">pattern</span> <span class="PreProc">Non_empty_row</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="ocamlLCIdentifier">clause</span> <span class="ocamlLCIdentifier">pattern_matching</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="Constant">[]</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L3186" title="ocaml/lambda/matching.ml:3186">comp_exit</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">m<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="ocamlLCIdentifier">str</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">argl</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">v</span>, <span class="ocamlLCIdentifier">newarg</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3242" title="ocaml/lambda/matching.ml:3242">arg_to_var</a></span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">m</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">newarg</span>, <span class="Constant">Alias</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">argl</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">half_simplify_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>:<span class="ocamlLCIdentifier">newarg</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">m</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">first_match</span>, <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1635" title="ocaml/lambda/matching.ml:1635">split_and_precompile_half_simplified</a></span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>:<span class="ocamlLCIdentifier">newarg</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">combine_handlers</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">v</span>, <span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">first_match</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">compile_match_simplified</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">m</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">clause</span> <span class="ocamlLCIdentifier">pattern_matching</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="Constant">[]</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L3186" title="ocaml/lambda/matching.ml:3186">comp_exit</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">m<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="Statement">((</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">str</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">argl</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="Constant">Alias</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">argl</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">first_match</span>, <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">split_and_precompile_simplified</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">combine_handlers</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">v</span>, <span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">first_match</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">combine_handlers</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">v</span>, <span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">first_match</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3191" title="ocaml/lambda/matching.ml:3191">comp_match_handlers</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">((</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/lambda/matching.ml:101">dbg</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">do_compile_matching_pr</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">do_compile_matching</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">repr</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">first_match</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3180" title="ocaml/lambda/matching.ml:3180">bind_check</a></span> <span class="ocamlLCIdentifier">str</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">total</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* verbose version of do_compile_matching, for debug *)<br/></li>
<li></span><span class="Statement">and</span> <span class="ocamlLCIdentifier">do_compile_matching_pr</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;COMPILE: %<a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a>\nMATCH\n&quot;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Partial</span> <span class="Statement">-&gt;</span> <span class="Constant">&quot;Partial&quot;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Total</span> <span class="Statement">-&gt;</span> <span class="Constant">&quot;Total&quot;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pretty_precompiled</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;CTX\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">((_</span>, <span class="ocamlLCIdentifier">jumps</span><span class="Statement">)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a></span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">do_compile_matching</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="Constant">&quot;JUMPS\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L498" title="ocaml/lambda/matching.ml:498">eprintf</a></span> <span class="ocamlLCIdentifier">jumps</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L2555" title="ocaml/lambda/matching.ml:2555">r</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">do_compile_matching</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pm</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">first_arg</span>, <span class="Statement">_)</span> <span class="Statement">::</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">first_arg<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* We arrive in do_compile_matching from:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - compile_matching<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - recursive call on PmVars<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; The first one explicitly checks that [<a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a>] is nonempty, the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; second one is only generated when the inner pm first looks at<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; a variable (<a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a>.e. there is something to look at).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ph</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">what_is_cases</span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pomega</span> <span class="Statement">=</span> <span class="PreProc">Patterns</span>.<span class="PreProc">Head</span>.<span class="ocamlLCIdentifier">to_omega_pattern</span> <span class="ocamlLCIdentifier">ph</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ploc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">head_loc</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">ph</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement"><a href="#L419" title="ocaml/lambda/matching.ml:419">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Patterns.Head</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">ph</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Any</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">compile_no_test</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1841" title="ocaml/lambda/matching.ml:1841">divide_var</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L513" title="ocaml/lambda/matching.ml:513">rshift</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tuple</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">compile_no_test</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">divide_tuple</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">ph</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L525" title="ocaml/lambda/matching.ml:525">combine</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Record</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span> <span class="Statement">::</span> <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">compile_no_test</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2076" title="ocaml/lambda/matching.ml:2076">divide_record</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="ocamlLCIdentifier">lbl_all</span> <span class="ocamlLCIdentifier">ph</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L525" title="ocaml/lambda/matching.ml:525">combine</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Constant</span> <span class="ocamlLCIdentifier">cst</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3132" title="ocaml/lambda/matching.ml:3132">compile_test</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier"><a href="#L1739" title="ocaml/lambda/matching.ml:1739">divide_constant</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">combine_constant</span> <span class="ocamlLCIdentifier">ploc</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">cst</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Construct</span> <span class="ocamlLCIdentifier">cstr</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3132" title="ocaml/lambda/matching.ml:3132">compile_test</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">partial</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1784" title="ocaml/lambda/matching.ml:1784">divide_constructor</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2796" title="ocaml/lambda/matching.ml:2796">combine_constructor</a></span> <span class="ocamlLCIdentifier">ploc</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">ph</span>.<span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier">cstr</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Array</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span> <span class="Statement">=</span> <span class="PreProc">Typeopt</span>.<span class="ocamlLCIdentifier">array_pattern_kind</span> <span class="ocamlLCIdentifier">pomega</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3132" title="ocaml/lambda/matching.ml:3132">compile_test</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">partial</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">divide_array</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3033" title="ocaml/lambda/matching.ml:3033">combine_array</a></span> <span class="ocamlLCIdentifier">ploc</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L383" title="ocaml/lambda/translcore.ml:383">kind</a></span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Lazy</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">compile_no_test</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">divide_lazy</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">ph</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L525" title="ocaml/lambda/matching.ml:525">combine</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Variant</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">cstr_row</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">row</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3132" title="ocaml/lambda/matching.ml:3132">compile_test</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">partial</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">divide_variant</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier">row</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2969" title="ocaml/lambda/matching.ml:2969">combine_variant</a></span> <span class="ocamlLCIdentifier">ploc</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">row</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">PmVar</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">inside</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">do_compile_matching</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">(</span><span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L503" title="ocaml/lambda/matching.ml:503">lshift</a></span> <span class="ocamlLCIdentifier">ctx</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pmh<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L513" title="ocaml/lambda/matching.ml:513">rshift</a></span> <span class="ocamlLCIdentifier">total</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">PmOr</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">handlers</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">compile_match_simplified</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3103" title="ocaml/lambda/matching.ml:3103">compile_orhandlers</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="ocamlLCIdentifier">total</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">handlers<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">compile_no_test</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a></span> <span class="ocamlLCIdentifier">up_ctx</span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">to_match</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">this_match</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">ctx</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">this_ctx</span> <span class="Statement">}</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1684" title="ocaml/lambda/matching.ml:1684">divide</a></span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">to_match</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">this_ctx</span> <span class="ocamlLCIdentifier">this_match</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span>, <span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier">up_ctx</span> <span class="ocamlLCIdentifier">total</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* The entry points *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; If there is a guard in a matching or a lazy pattern,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; then set exhaustiveness info to Partial.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; (because of side effects, assume the worst).<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Notice that exhaustiveness information is trusted by the compiler,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; that is, a match flagged as Total should not fail at runtime.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; More specifically, for instance if match y with x::_ -&gt; x is flagged<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; total (as it happens during JoCaml compilation) then y cannot be []<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; at runtime. As a consequence, the static Total exhaustiveness information<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; have to be downgraded to Partial, in the dubious cases where guards<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; or lazy pattern execute arbitrary code that may perform side effects<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; and change the subject values.<br/></li>
<li></span><span class="Comment">LM:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Lazy pattern was PR#5992, initial patch by lpw25.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; I have&nbsp; generalized the patch, so as to also find mutable fields.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">is_lazy_pat</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_lazy</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_alias</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_variant</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_record</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_tuple</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_construct</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_array</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_or</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_constant</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_var</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_any</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">has_lazy</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=</span> <span class="PreProc">Typedtree</span>.<span class="ocamlLCIdentifier">exists_pattern</span> <span class="ocamlLCIdentifier">is_lazy_pat</span> <span class="ocamlLCIdentifier">p<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">is_record_with_mutable_field</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_record</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lps</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1043" title="ocaml/lambda/translcore.ml:1043">lbl</a></span>.<span class="PreProc">Types</span>.<span class="ocamlLCIdentifier">lbl_mut</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Mutable</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Immutable</span> <span class="Statement">-&gt;</span> <span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lps<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_alias</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_variant</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_lazy</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_tuple</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_construct</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_array</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_or</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_constant</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_var</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_any</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">has_mutable</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=</span> <span class="PreProc">Typedtree</span>.<span class="ocamlLCIdentifier">exists_pattern</span> <span class="ocamlLCIdentifier">is_record_with_mutable_field</span> <span class="ocamlLCIdentifier">p<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Downgrade Total when<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; 1. Matching accesses some mutable fields;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; 2. And there are&nbsp; guards or lazy patterns.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">check_partial</span> <span class="ocamlLCIdentifier">has_mutable</span> <span class="ocamlLCIdentifier">has_lazy</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Partial</span> <span class="Statement">-&gt;</span> <span class="Constant">Partial<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Total</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">pat_act_list</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="Comment">(* allow <a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a> case <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a> *)<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">exists<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">(fun</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">pats</span><span class="ocamlNone">, </span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">has_mutable</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pats</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lambda.mli.html#L474" title="ocaml/lambda/lambda.mli:474">is_guarded</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">has_lazy</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pats</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">pat_act_list<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Partial<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Total<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">check_partial_list</span> <span class="ocamlLCIdentifier">pats_act_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">check_partial</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="ocamlLCIdentifier">has_mutable</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">exists</span> <span class="ocamlLCIdentifier">has_lazy</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pats_act_list<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">check_partial</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">check_partial</span> <span class="ocamlLCIdentifier">has_mutable</span> <span class="ocamlLCIdentifier">has_lazy</span> <span class="ocamlLCIdentifier">pat_act_list<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* have toplevel handler when appropriate *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier">failer_kind</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Raise_match_failure<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Reraise_noloc</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">failure_handler</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">failer</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Reraise_noloc</span> <span class="ocamlLCIdentifier">exn_lam</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Praise</span> <span class="Constant">Raise_reraise</span>, <span class="Statement">[</span> <span class="ocamlLCIdentifier">exn_lam</span> <span class="Statement">]</span>, <span class="PreProc">Scoped_location</span>.<span class="Constant">Loc_unknown</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Raise_match_failure</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sloc</span> <span class="Statement">=</span> <span class="PreProc">Scoped_location</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L85" title="ocaml/lambda/debuginfo.ml:85">of_location</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L773" title="ocaml/lambda/simplif.ml:773">slot</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L405" title="ocaml/lambda/lambda.mli:405">transl_extension_path</a></span> <span class="ocamlLCIdentifier">sloc<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Env</span>.<span class="ocamlLCIdentifier">initial</span> <span class="PreProc">Predef</span>.<span class="ocamlLCIdentifier">path_match_failure<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fname</span>, <span class="ocamlLCIdentifier">line</span>, <span class="Type">char</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">get_pos_info</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span>.<span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">loc_start</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lprim<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Praise</span> <span class="Constant">Raise_regular</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span> <span class="Constant">Lprim<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="Constant">Pmakeblock</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">Immutable</span>, <span class="Constant">None</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L773" title="ocaml/lambda/simplif.ml:773">slot</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lconst<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Const_block<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span> <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">[</span> <span class="Constant">Const_base</span> <span class="Statement">(</span><span class="Constant">Const_string</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fname</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span>, <span class="Constant">None</span><span class="Statement">));<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Const_base</span> <span class="Statement">(</span><span class="Constant">Const_int</span> <span class="ocamlLCIdentifier">line</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Const_base</span> <span class="Statement">(</span><span class="Constant">Const_int</span> <span class="Type">char</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">]</span> <span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">]</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sloc</span> <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">]</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sloc</span> <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">check_total</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span> <span class="ocamlLCIdentifier">total</span> <span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Jumps</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">total</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a><br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lstaticcatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L705" title="ocaml/lambda/printlambda.ml:705">lambda</a></span>, <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="Constant">[]</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">failure_handler</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span> <span class="Constant">()</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">toplevel_handler</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">cases</span> <span class="ocamlLCIdentifier">compile_fun</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Total</span> <span class="Statement">when</span> <span class="Statement">not</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">safer_matching</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cases</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">total</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">compile_fun</span> <span class="Constant">Total</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">assert</span> <span class="Statement">(</span><span class="PreProc">Jumps</span>.<span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lambda/matching.ml:537">is_empty</a></span> <span class="ocamlLCIdentifier">total</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Partial</span> <span class="Statement">|</span> <span class="Constant">Total</span> <span class="Comment">(* when !Clflags.safer_matching *)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">raise_num</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L469" title="ocaml/lambda/lambda.mli:469">next_raise_count</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L36" title="ocaml/lambda/debuginfo.ml:36">cons</a></span> <span class="Statement">[</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omega_list</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">]</span> <span class="ocamlLCIdentifier">raise_num<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">cases</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">default</span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">compile_fun</span><span class="ocamlEnd"> </span><span class="Constant">Partial</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pm</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">exception</span><span class="ocamlEnd"> </span><span class="Constant">Unused</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">assert</span><span class="ocamlEnd"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">total</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">check_total</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">failer</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">total</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">raise_num<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">compile_matching</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">check_partial</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="Constant">Strict</span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rows</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">map_on_rows</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pat</span>, <span class="Constant">[]</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">toplevel_handler</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">rows</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">compile_match_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">(</span><span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L535" title="ocaml/lambda/matching.ml:535">start</a></span> <span class="Constant">1</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pm</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="matching.mli.html#L23" title="ocaml/lambda/matching.mli:23">for_function</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">param</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">compile_matching</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span>:<span class="Constant">Raise_match_failure<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">param</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="ocamlLCIdentifier">partial<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* In the following two cases, exhaustiveness info is not available! *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="matching.mli.html#L27" title="ocaml/lambda/matching.mli:27">for_trywith</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">param</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* Note: the failure action of [<a href="matching.mli.html#L27" title="ocaml/lambda/matching.mli:27">for_trywith</a>] corresponds<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; to an exception that is not matched by a try..with handler,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; and is thus reraised for the <a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a> handler in the stack.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; It is important to *not* include location information in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; the reraise (hence the [_noloc]) to avoid seeing this<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; silent reraise in exception backtraces. *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">compile_matching</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span>:<span class="Statement">(</span><span class="Constant">Reraise_noloc</span> <span class="ocamlLCIdentifier">param</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">None</span> <span class="ocamlLCIdentifier">param</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="Constant">Partial<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">simple_for_let</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">param</span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">compile_matching</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span>:<span class="Constant">Raise_match_failure<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">None</span> <span class="ocamlLCIdentifier">param</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pat</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">)</span> <span class="Statement">]</span> <span class="Constant">Partial<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Optimize binding of immediate tuples<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The goal of the implementation of '<a href="#L3716" title="ocaml/lambda/matching.ml:3716">for_let</a>' below, which replaces<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; 'simple_for_let', is to avoid tuple allocation in cases such as<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; this one:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; let (x,y) =<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; let foo = ... in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; if foo then (1, 2) else (3,4)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; in bar<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The compiler easily optimizes the simple `let (x,y) = (1,2) in ...`<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; case (call to Matching.<a href="#L3875" title="ocaml/lambda/matching.ml:3875">for_multiple_match</a> from Translcore), but<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; didn'<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> optimize situations where the <a href="translcore.ml.html#L1059" title="ocaml/lambda/translcore.ml:1059">rhs</a> tuples are hidden under<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; a more complex <a href="tmc.ml.html#L545" title="ocaml/lambda/tmc.ml:545">context</a>.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The idea comes from Alain Frisch who suggested and implemented<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the following compilation method, based on Lassign:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; let x = dummy in let y = dummy in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; begin<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; let foo = ... in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; if foo then<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; (let x1 = 1 in let y1 = 2 in x &lt;- x1; y &lt;- y1)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; else<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; (let x2 = 3 in let y2 = 4 in x &lt;- x2; y &lt;- y2)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; end;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; bar<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The current implementation from Gabriel Scherer uses Lstaticcatch /<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Lstaticraise instead:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; catch<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; let foo = ... in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; if foo then<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (let x1 = 1 in let y1 = 2 in <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> x1 y1)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; else<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; (let x2 = 3 in let y2 = 4 in <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> x2 y2)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; with x y -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; bar<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The catch/<a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a> is used to avoid duplication of the let <a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a> ('bar'<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; in the example), on 'if' branches for example; it is useless for<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; linear contexts such as 'let', but we don'<a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a> need to be careful to<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; generate nice code because Simplif will <a href="#L867" title="ocaml/lambda/matching.ml:867">remove</a> such useless<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; catch/<a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a>.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Llet</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">l2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Llet</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">str</span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">l2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lmutlet</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">l2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Lmutlet</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">l2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lletrec</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">l2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Lletrec</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">l2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lifthenelse</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lcond</span>, <span class="ocamlLCIdentifier">lthen</span>, <span class="ocamlLCIdentifier">lelse</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lifthenelse</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lcond</span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">lthen</span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">lelse</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lsequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">l2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Lsequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">l2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Levent</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>, <span class="ocamlLCIdentifier">ev</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Levent</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span>, <span class="ocamlLCIdentifier">ev</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ltrywith</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier">l2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Ltrywith</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">l2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstaticcatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">b</span>, <span class="ocamlLCIdentifier">l2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lstaticcatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">l1</span>, <span class="ocamlLCIdentifier">b</span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier">l2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>, <span class="ocamlLCIdentifier">sw</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">map_cases</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L713" title="ocaml/lambda/translclass.ml:713">i</a></span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">))</span> <span class="ocamlLCIdentifier">cases<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lswitch<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">sw</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_consts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">map_cases</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_consts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_blocks</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">map_cases</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_blocks</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sw_failaction</span> <span class="Statement">=</span> <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">sw</span>.<span class="ocamlLCIdentifier">sw_failaction<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lstringswitch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>, <span class="ocamlLCIdentifier">cases</span>, <span class="ocamlLCIdentifier">def</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lstringswitch<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span> <span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translclass.ml.html#L563" title="ocaml/lambda/translclass.ml:563">s</a></span>, <span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span><span class="Statement">))</span> <span class="ocamlLCIdentifier">cases</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">map_return</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">def</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="Constant">Lstaticraise</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Praise</span> <span class="Statement">_</span>, <span class="Statement">_</span>, <span class="Statement">_))</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span> <span class="Constant">Lvar</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lmutvar</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lconst</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lapply</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lfunction</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lsend</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lprim</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Lwhile</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lfor</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lassign</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Lifused</span> <span class="Statement">_</span> <span class="Statement">)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L1385" title="ocaml/lambda/translmod.ml:1385">f</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L708" title="ocaml/lambda/translcore.ml:708">l</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* The 'opt' reference indicates if the optimization is worthy.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; It is <a href="switch.mli.html#L32" title="ocaml/lambda/switch.mli:32">shared</a> by the different calls to '<a href="#L3681" title="ocaml/lambda/matching.ml:3681">assign_pat</a>' performed from<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; 'map_return'. For example with the code<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; let (x, y) = if foo then z else (1,2)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the else-branch will activate the optimization for both branches.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; That means that the optimization is activated if *there exists* an<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; interesting tuple in one hole of the let-<a href="translcore.ml.html#L1059" title="ocaml/lambda/translcore.ml:1059">rhs</a> <a href="tmc.ml.html#L545" title="ocaml/lambda/tmc.ml:545">context</a>. We could<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; choose to activate it only if *all* holes are interesting. We made<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; that <a href="tmc.ml.html#L573" title="ocaml/lambda/tmc.ml:573">choice</a> because being optimistic is extremely cheap (one static<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a>/catch overhead in the &quot;wrong cases&quot;), while being pessimistic<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; can be costly (one unnecessary tuple allocation).<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L3681">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">assign_pat</span></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">opt</span> <span class="ocamlLCIdentifier">nraise</span> <span class="ocamlLCIdentifier">catch_ids</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">collect</span> <span class="ocamlLCIdentifier">acc</span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pat</span>.<span class="ocamlLCIdentifier">pat_desc</span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_tuple</span> <span class="ocamlLCIdentifier">patl</span>, <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pmakeblock</span> <span class="Statement">_</span>, <span class="ocamlLCIdentifier">lams</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">opt</span> <span class="Statement">:=</span> <span class="Constant">true</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left2</span> <span class="ocamlLCIdentifier">collect</span> <span class="ocamlLCIdentifier">acc</span> <span class="ocamlLCIdentifier">patl</span> <span class="ocamlLCIdentifier">lams<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_tuple</span> <span class="ocamlLCIdentifier">patl</span>, <span class="Constant">Lconst</span> <span class="Statement">(</span><span class="Constant">Const_block</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">scl</span><span class="Statement">))</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">opt</span> <span class="Statement">:=</span> <span class="Constant">true</span><span class="Statement">;<br/></li>
<li><a id="L3689">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">collect_const</span></span> <span class="ocamlLCIdentifier">acc</span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier">sc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">collect</span> <span class="ocamlLCIdentifier">acc</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">(</span><span class="Constant">Lconst</span> <span class="ocamlLCIdentifier">sc</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left2</span> <span class="ocamlLCIdentifier"><a href="#L3689" title="ocaml/lambda/matching.ml:3689">collect_const</a></span> <span class="ocamlLCIdentifier">acc</span> <span class="ocamlLCIdentifier">patl</span> <span class="ocamlLCIdentifier">scl<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* pattern idents will be bound in staticcatch (let <a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a>), so we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; refresh them here to guarantee binders uniqueness *)<br/></li>
<li><a id="L3694">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">pat_ids</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pat_bound_idents</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">in<br/></li>
<li><a id="L3695">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">fresh_ids</span></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier"><a href="lambda.mli.html#L427" title="ocaml/lambda/lambda.mli:427">rename</a></span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="Statement">))</span> <span class="ocamlLCIdentifier"><a href="#L3694" title="ocaml/lambda/matching.ml:3694">pat_ids</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3695" title="ocaml/lambda/matching.ml:3695">fresh_ids</a></span>, <span class="ocamlLCIdentifier">alpha_pat</span> <span class="ocamlLCIdentifier"><a href="#L3695" title="ocaml/lambda/matching.ml:3695">fresh_ids</a></span> <span class="ocamlLCIdentifier">pat</span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">acc<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* sublets were accumulated by 'collect' with the leftmost tuple<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; pattern at the bottom of the <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a>; to respect right-to-<a href="switch.ml.html#L787" title="ocaml/lambda/switch.ml:787">left</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; evaluation order for tuples, we must evaluate sublets<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; top-to-bottom. To preserve <a href="simplif.ml.html#L812" title="ocaml/lambda/simplif.ml:812">tail</a>-rec, we will fold_left the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; reversed <a href="tmc.ml.html#L478" title="ocaml/lambda/tmc.ml:478">list</a>. *)<br/></li>
<li><a id="L3703">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">rev_sublets</span></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">collect</span> <span class="Constant">[]</span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li><a id="L3704">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">exit</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* <a href="translclass.ml.html#L182" title="ocaml/lambda/translclass.ml:182">build</a> an Ident.tbl to avoid quadratic refreshing costs *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier">fresh_id</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="ocamlLCIdentifier">fresh_id</span> <span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">add_ids</span> <span class="ocamlLCIdentifier">acc</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1050" title="ocaml/lambda/translcore.ml:1050">ids</a></span>, <span class="ocamlLCIdentifier">_pat</span>, <span class="ocamlLCIdentifier">_lam</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left</span> <span class="ocamlLCIdentifier"><a href="#L884" title="ocaml/lambda/matching.ml:884">add</a></span> <span class="ocamlLCIdentifier">acc</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1050" title="ocaml/lambda/translcore.ml:1050">ids</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">tbl</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left</span> <span class="ocamlLCIdentifier">add_ids</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier"><a href="#L533" title="ocaml/lambda/matching.ml:533">empty</a></span> <span class="ocamlLCIdentifier"><a href="#L3703" title="ocaml/lambda/matching.ml:3703">rev_sublets</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">fresh_var</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="Statement">=</span> <span class="Constant">Lvar</span> <span class="Statement">(</span><span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">find_same</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="ocamlLCIdentifier">tbl</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lstaticraise</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">nraise</span>, <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier">fresh_var</span> <span class="ocamlLCIdentifier">catch_ids</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L3712">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">push_sublet</span></span> <span class="ocamlLCIdentifier">code</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">_ids</span>, <span class="ocamlLCIdentifier">pat</span>, <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">simple_for_let</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier">code</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left</span> <span class="ocamlLCIdentifier"><a href="#L3712" title="ocaml/lambda/matching.ml:3712">push_sublet</a></span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L98" title="ocaml/lambda/simplif.ml:98">exit</a></span> <span class="ocamlLCIdentifier"><a href="#L3703" title="ocaml/lambda/matching.ml:3703">rev_sublets</a><br/></li>
<li></span><br/></li>
<li><a id="L3716">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">for_let</span></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">param</span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">pat</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_any</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* This eliminates a useless variable (and stack <a href="simplif.ml.html#L773" title="ocaml/lambda/simplif.ml:773">slot</a> in bytecode)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for &quot;let _ = ...&quot;. See #6865. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Lsequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">param</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_var</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* fast <a href="translclass.ml.html#L444" title="ocaml/lambda/translclass.ml:444">path</a>, and keep track of simple bindings to unboxable numbers *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=</span> <span class="PreProc">Typeopt</span>.<span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L56" title="ocaml/lambda/printlambda.ml:56">value_kind</a></span> <span class="ocamlLCIdentifier">pat</span>.<span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier">pat</span>.<span class="ocamlLCIdentifier">pat_type</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Llet</span> <span class="Statement">(</span><span class="Constant">Strict</span>, <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span>, <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="ocamlLCIdentifier">param</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">opt</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">false</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">nraise</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="lambda.mli.html#L469" title="ocaml/lambda/lambda.mli:469">next_raise_count</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">catch_ids</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pat_bound_idents_full</span> <span class="ocamlLCIdentifier">pat</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ids_with_kinds</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Statement">_</span>, <span class="ocamlLCIdentifier">typ</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="PreProc">Typeopt</span>.<span class="ocamlLCIdentifier"><a href="printlambda.ml.html#L56" title="ocaml/lambda/printlambda.ml:56">value_kind</a></span> <span class="ocamlLCIdentifier">pat</span>.<span class="ocamlLCIdentifier">pat_env</span> <span class="ocamlLCIdentifier">typ</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">catch_ids<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1050" title="ocaml/lambda/translcore.ml:1050">ids</a></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Statement">_</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">catch_ids</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">map_return</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3681" title="ocaml/lambda/matching.ml:3681">assign_pat</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">opt</span> <span class="ocamlLCIdentifier">nraise</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L1050" title="ocaml/lambda/translcore.ml:1050">ids</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">pat</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">param</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">opt</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Lstaticcatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">nraise</span>, <span class="ocamlLCIdentifier">ids_with_kinds</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">simple_for_let</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">param</span> <span class="ocamlLCIdentifier">pat</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Handling of tupled functions and matchings *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Easy case since variables are available *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="matching.mli.html#L40" title="ocaml/lambda/matching.mli:40">for_tupled_function</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">paraml</span> <span class="ocamlLCIdentifier">pats_act_list</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">check_partial_list</span> <span class="ocamlLCIdentifier">pats_act_list</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Constant">Strict</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">paraml</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">toplevel_handler</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span>:<span class="Constant">Raise_match_failure<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">pats_act_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">handler</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="Constant">None</span> <span class="ocamlLCIdentifier">partial<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L535" title="ocaml/lambda/matching.ml:535">start</a></span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">paraml</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="matching.mli.html#L47" title="ocaml/lambda/matching.mli:47">flatten_pattern</a></span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_tuple</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tpat_any</span> <span class="Statement">-&gt;</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omegas</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">raise</span> <span class="Constant">Cannot_flatten<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">flatten_simple_pattern</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span> : <span class="PreProc">Simple</span>.<span class="ocamlLCIdentifier">pattern</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pat_desc</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Tuple</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Any</span> <span class="Statement">-&gt;</span> <span class="PreProc">Patterns</span>.<span class="ocamlLCIdentifier">omegas</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Array</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Variant</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Record</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Lazy</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Construct</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Constant</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* All calls to this function originate from [do_for_multiple_match],<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; where we know that the scrutinee is a tuple literal.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Since the PM is well typed, <a href="debuginfo.ml.html#L118" title="ocaml/lambda/debuginfo.ml:118">none</a> of these cases are possible. *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translattribute.ml.html#L114" title="ocaml/lambda/translattribute.ml:114">msg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">str_formatter<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;Matching.<a href="matching.mli.html#L47" title="ocaml/lambda/matching.mli:47">flatten_pattern</a>: got '%a'&quot;</span> <span class="ocamlLCIdentifier">top_pretty</span> <span class="Statement">(</span><span class="PreProc">General</span>.<span class="ocamlLCIdentifier">erase</span> <span class="ocamlLCIdentifier">p</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">flush_str_formatter</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fatal_error</span> <span class="ocamlLCIdentifier"><a href="translattribute.ml.html#L114" title="ocaml/lambda/translattribute.ml:114">msg</a><br/></li>
<li></span><br/></li>
<li><a id="L3784">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">flatten_cases</span></span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span>, <span class="Constant">[]</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">action</span> <span class="Statement">-&gt;</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">flatten_simple_pattern</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">ps</span> <span class="Statement">-&gt;</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">p</span>, <span class="ocamlLCIdentifier">ps</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">action</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Matching.flatten_hc_cases&quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">cases<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">flatten_pm</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L3784" title="ocaml/lambda/matching.ml:3784">flatten_cases</a></span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">cases</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">default</span> <span class="Statement">=</span> <span class="PreProc">Default_environment</span>.<span class="ocamlLCIdentifier">flatten</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">pm</span>.<span class="ocamlLCIdentifier">default<br/></li>
<li></span>&nbsp; <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">flatten_handler</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">provenance</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L628" title="ocaml/lambda/matching.ml:628">flatten_matrix</a></span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier">handler</span>.<span class="ocamlLCIdentifier">provenance</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier">pm_flattened</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">FPmOr</span> <span class="Statement">of</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pattern</span>, <span class="Type"><a href="tmc.ml.html#L197" title="ocaml/lambda/tmc.ml:197">unit</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pm_or_compiled<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">FPm</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">pattern</span> <span class="PreProc">Non_empty_row</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L79" title="ocaml/lambda/debuginfo.ml:79">t</a></span> <span class="ocamlLCIdentifier">clause</span> <span class="ocamlLCIdentifier">pattern_matching<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">flatten_precompiled</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Pm</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">-&gt;</span> <span class="Constant">FPm</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">flatten_pm</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">pm</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">PmOr</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">b</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">handlers</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">hs</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">or_matrix</span> <span class="Statement">=</span> <span class="Statement">_</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">FPmOr<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">flatten_pm</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">b</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">handlers</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">flatten_handler</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">hs</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">or_matrix</span> <span class="Statement">=</span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">}<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">PmVar</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; compiled_flattened is a ``comp_fun'' argument to <a href="#L3191" title="ocaml/lambda/matching.ml:3191">comp_match_handlers</a>.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Hence it needs a fourth argument, which it ignores<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L3824">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">compile_flattened</span></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">pmh</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">FPm</span> <span class="ocamlLCIdentifier">pm</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">compile_match_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">pm<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">FPmOr</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L601" title="ocaml/lambda/translcore.ml:601">body</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">b</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">handlers</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">hs</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">compile_match_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">b</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3103" title="ocaml/lambda/matching.ml:3103">compile_orhandlers</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3260" title="ocaml/lambda/matching.ml:3260">compile_match</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span> <span class="ocamlLCIdentifier">total</span> <span class="ocamlLCIdentifier">ctx</span> <span class="ocamlLCIdentifier">hs<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">do_for_multiple_match</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">paraml</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">repr</span> <span class="Statement">=</span> <span class="Constant">None</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sloc</span> <span class="Statement">=</span> <span class="PreProc">Scoped_location</span>.<span class="ocamlLCIdentifier"><a href="debuginfo.ml.html#L85" title="ocaml/lambda/debuginfo.ml:85">of_location</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Lprim</span> <span class="Statement">(</span><span class="Constant">Pmakeblock</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">Immutable</span>, <span class="Constant">None</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">paraml</span>, <span class="ocamlLCIdentifier">sloc</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">handler</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">check_partial</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rows</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">map_on_rows</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span>, <span class="Constant">[]</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">toplevel_handler</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="Statement">~</span><span class="Identifier">failer</span>:<span class="Constant">Raise_match_failure<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">partial</span> <span class="Statement">[</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span>, <span class="Constant">Strict</span><span class="Statement">)</span> <span class="Statement">]</span> <span class="ocamlLCIdentifier">rows</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">handler</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">partial</span> <span class="ocamlLCIdentifier">pm1</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pm1_half</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">pm1</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">cases</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">half_simplify_nonempty</span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pm1</span>.<span class="ocamlLCIdentifier">cases</span> <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li><a id="L3845">&#x200c;</a></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">next</span></span>, <span class="ocamlLCIdentifier">nexts</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1635" title="ocaml/lambda/matching.ml:1635">split_and_precompile_half_simplified</a></span> <span class="Statement">~</span><span class="Identifier"><a href="#L2339" title="ocaml/lambda/matching.ml:2339">arg</a></span> <span class="ocamlLCIdentifier">pm1_half</span> <span class="Statement">in<br/></li>
<li><a id="L3846">&#x200c;</a></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">size</span></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">paraml<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">idl</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;*match*&quot;</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">paraml</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">Lvar</span> <span class="ocamlLCIdentifier"><a href="translmod.ml.html#L634" title="ocaml/lambda/translmod.ml:634">id</a></span>, <span class="Constant">Alias</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">idl</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">flat_next</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">flatten_precompiled</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier"><a href="#L3845" title="ocaml/lambda/matching.ml:3845">next</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">flat_nexts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>, <span class="ocamlLCIdentifier">pm</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>, <span class="ocamlLCIdentifier">flatten_precompiled</span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span> <span class="ocamlLCIdentifier"><a href="simplif.ml.html#L732" title="ocaml/lambda/simplif.ml:732">args</a></span> <span class="ocamlLCIdentifier">pm</span><span class="Statement">))</span> <span class="ocamlLCIdentifier">nexts<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">total</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L3191" title="ocaml/lambda/matching.ml:3191">comp_match_handlers</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L3824" title="ocaml/lambda/matching.ml:3824">compile_flattened</a></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier">repr</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">partial<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Context</span>.<span class="ocamlLCIdentifier"><a href="#L535" title="ocaml/lambda/matching.ml:535">start</a></span> <span class="ocamlLCIdentifier"><a href="#L3846" title="ocaml/lambda/matching.ml:3846">size</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">flat_next</span> <span class="ocamlLCIdentifier">flat_nexts<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right2</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="Constant">Strict</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">idl</span> <span class="ocamlLCIdentifier">paraml</span> <span class="ocamlLCIdentifier"><a href="translobj.ml.html#L145" title="ocaml/lambda/translobj.ml:145">lam</a></span>, <span class="ocamlLCIdentifier">total<br/></li>
<li></span>&nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* PR#4828: Believe it or not, the 'paraml' argument below<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; may not be side effect free. *)<br/></li>
<li></span><br/></li>
<li><a id="L3865">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">param_to_var</span></span> <span class="ocamlLCIdentifier">param</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">param</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">v</span>, <span class="Constant">None</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier">create_local</span> <span class="Constant">&quot;*match*&quot;</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier">param</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L3870">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">bind_opt</span></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">v</span>, <span class="ocamlLCIdentifier">eo</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">eo</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;</span> <span class="PreProc">Lambda</span>.<span class="ocamlLCIdentifier"><a href="#L2350" title="ocaml/lambda/matching.ml:2350">bind</a></span> <span class="Constant">Strict</span> <span class="ocamlLCIdentifier">v</span> <span class="ocamlLCIdentifier">e</span> <span class="ocamlLCIdentifier"><a href="translprim.ml.html#L473" title="ocaml/lambda/translprim.ml:473">k</a><br/></li>
<li></span><br/></li>
<li><a id="L3875">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">for_multiple_match</span></span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">paraml</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="ocamlLCIdentifier">partial</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">v_paraml</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="ocamlLCIdentifier"><a href="#L3865" title="ocaml/lambda/matching.ml:3865">param_to_var</a></span> <span class="ocamlLCIdentifier">paraml</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">paraml</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="#L922" title="ocaml/lambda/matching.ml:922">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">v</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="Constant">Lvar</span> <span class="ocamlLCIdentifier">v</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">v_paraml</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right</span> <span class="ocamlLCIdentifier"><a href="#L3870" title="ocaml/lambda/matching.ml:3870">bind_opt</a></span> <span class="ocamlLCIdentifier">v_paraml<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">do_for_multiple_match</span> <span class="Statement">~</span><span class="Identifier"><a href="debuginfo.ml.html#L28" title="ocaml/lambda/debuginfo.ml:28">scopes</a></span> <span class="ocamlLCIdentifier"><a href="translcore.ml.html#L62" title="ocaml/lambda/translcore.ml:62">loc</a></span> <span class="ocamlLCIdentifier">paraml</span> <span class="ocamlLCIdentifier">pat_act_list</span> <span class="ocamlLCIdentifier">partial</span><span class="Statement">)<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
