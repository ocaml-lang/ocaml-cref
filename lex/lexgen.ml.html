<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/lex/lexgen.ml - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/lex/lexgen.ml - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L1187">actions</a></li>
<li><a href="#L319">add_pos</a></li>
<li><a href="#L224">add_some</a></li>
<li><a href="#L228">add_some_some</a></li>
<li><a href="#L982">add_tags_to_map</a></li>
<li><a href="#L568">addtags</a></li>
<li><a href="#L435">alloc_exp</a></li>
<li><a href="#L801">alloc_map</a></li>
<li><a href="#L830">alloc_new_addr</a></li>
<li><a href="#L1012">apply_transitions</a></li>
<li><a href="#L91">c</a></li>
<li><a href="#L93">c</a></li>
<li><a href="#L267">chars</a></li>
<li><a href="#L268">chars_count</a></li>
<li><a href="#L1042">comp_shift</a></li>
<li><a href="#L84">compare</a></li>
<li><a href="#L97">compare</a></li>
<li><a href="#L100">compare</a></li>
<li><a href="#L103">compare</a></li>
<li><a href="#L544">compare</a></li>
<li><a href="#L739">compare</a></li>
<li><a href="#L841">create_mem_map</a></li>
<li><a href="#L828">create_new_addr_gen</a></li>
<li><a href="#L812">create_new_state</a></li>
<li><a href="#L875">dest</a></li>
<li><a href="#L775">do_alloc_cell</a></li>
<li><a href="#L770">do_alloc_temp</a></li>
<li><a href="#L232">do_find_chars</a></li>
<li><a href="#L189">do_find_double</a></li>
<li><a href="#L157">do_find_opt</a></li>
<li><a href="#L111">do_remove_nested</a></li>
<li><a href="#L1067">do_tag_actions</a></li>
<li><a href="#L553">emptymatch</a></li>
<li><a href="#L483">encode_casedef</a></li>
<li><a href="#L502">encode_lexdef</a></li>
<li><a href="#L271">encode_regexp</a></li>
<li><a href="#L1051">env</a></li>
<li><a href="#L1053">env</a></li>
<li><a href="#L690">env_to_class</a></li>
<li><a href="#L1132">extract_tags</a></li>
<li><a href="#L147">find_all_vars</a></li>
<li><a href="#L259">find_chars</a></li>
<li><a href="#L214">find_double</a></li>
<li><a href="#L177">find_optional</a></li>
<li><a href="#L1150">follow</a></li>
<li><a href="#L588">followpos</a></li>
<li><a href="#L869">get_map</a></li>
<li><a href="#L943">get_state</a></li>
<li><a href="#L425">get_tag_addr</a></li>
<li><a href="#L1061">get_tag_mem</a></li>
<li><a href="#L969">goto_state</a></li>
<li><a href="#L86">id_compare</a></li>
<li><a href="#L1156">initial_states</a></li>
<li><a href="#L789">is_old_addr</a></li>
<li><a href="#L732">key_compare</a></li>
<li><a href="#L424">loc_count</a></li>
<li><a href="#L464">m</a></li>
<li><a href="#L1000">m</a></li>
<li><a href="#L1006">m</a></li>
<li><a href="#L1127">make_tag_entry</a></li>
<li><a href="#L957">map_on_all_states</a></li>
<li><a href="#L728">mem_key</a></li>
<li><a href="#L323">mem_name</a></li>
<li><a href="#L314">mk_seq</a></li>
<li><a href="#L918">move_to</a></li>
<li><a href="#L817">new_m_act</a></li>
<li><a href="#L818">new_o</a></li>
<li><a href="#L744">next_mem_cell</a></li>
<li><a href="#L743">next_state_num</a></li>
<li><a href="#L546">nullable</a></li>
<li><a href="#L792">old_in_map</a></li>
<li><a href="#L998">opri</a></li>
<li><a href="#L312">opt</a></li>
<li><a href="#L416">r</a></li>
<li><a href="#L463">r</a></li>
<li><a href="#L1155">r_states</a></li>
<li><a href="#L127">remove_nested_as</a></li>
<li><a href="#L751">reset_state</a></li>
<li><a href="#L764">reset_state_partial</a></li>
<li><a href="#L1057">shift</a></li>
<li><a href="#L390">simple_backward</a></li>
<li><a href="#L347">simple_forward</a></li>
<li><a href="#L374">size_backward</a></li>
<li><a href="#L332">size_forward</a></li>
<li><a href="#L887">sort_mvs</a></li>
<li><a href="#L848">st</a></li>
<li><a href="#L724">state_key</a></li>
<li><a href="#L741">state_map</a></li>
<li><a href="#L747">state_table</a></li>
<li><a href="#L1177">states</a></li>
<li><a href="#L142">stringset_delta</a></li>
<li><a href="#L746">tag_cells</a></li>
<li><a href="#L88">tag_compare</a></li>
<li><a href="#L745">temp_pending</a></li>
<li><a href="#L742">todo</a></li>
<li><a href="#L537">trans_compare</a></li>
<li><a href="#L1084">translate_state</a></li>
<li><a href="#L813">used</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L53">automata</a></li>
<li><a href="#L73">automata_entry</a></li>
<li><a href="#L61">automata_move</a></li>
<li><a href="#L57">automata_trans</a></li>
<li><a href="#L687">dfa_key</a></li>
<li><a href="#L26">ident</a></li>
<li><a href="#L41">ident_info</a></li>
<li><a href="#L46">lexer_entry</a></li>
<li><a href="#L65">memory_action</a></li>
<li><a href="#L826">new_addr_gen</a></li>
<li><a href="#L30">regexp</a></li>
<li><a href="#L84">t</a></li>
<li><a href="#L97">t</a></li>
<li><a href="#L100">t</a></li>
<li><a href="#L103">t</a></li>
<li><a href="#L544">t</a></li>
<li><a href="#L739">t</a></li>
<li><a href="#L44">t_env</a></li>
<li><a href="#L531">t_transition</a></li>
<li><a href="#L69">tag_action</a></li>
<li><a href="#L40">tag_addr</a></li>
<li><a href="#L39">tag_base</a></li>
<li><a href="#L28">tag_info</a></li>
<li><a href="#L535">transition</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">(**************************************************************************)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Luc Maranget, projet Moscova, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Compiling a lexer definition *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Syntax<br/></li>
<li></span><span class="Comment">(*open Printf*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">Memory_overflow<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Deep abstract syntax for regular expressions *)<br/></li>
<li></span><br/></li>
<li><a id="L26">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">ident</span></span> <span class="Statement">=</span> <span class="Type">string</span> <span class="Statement">*</span>&nbsp; <span class="PreProc">Syntax</span>.<span class="ocamlLCIdentifier"><a href="syntax.ml.html#L21" title="ocaml/lex/syntax.ml:21">location</a><br/></li>
<li></span><br/></li>
<li><a id="L28">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">tag_info</span></span> <span class="Statement">=</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">id</span> : <span class="Type">string</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">start</span> : <span class="Type">bool</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">action</span> : <span class="Type">int</span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L30">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">regexp</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Empty<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">of</span> <span class="Type">int</span> <span class="Statement">*</span> <span class="Type">bool<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Action</span> <span class="Statement">of</span> <span class="Type">int<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tag</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="#L28" title="ocaml/lex/lexgen.ml:28">tag_info</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="#L30" title="ocaml/lex/lexgen.ml:30">regexp</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="#L30" title="ocaml/lex/lexgen.ml:30">regexp</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="#L30" title="ocaml/lex/lexgen.ml:30">regexp</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="#L30" title="ocaml/lex/lexgen.ml:30">regexp</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="#L30" title="ocaml/lex/lexgen.ml:30">regexp</a><br/></li>
<li></span><br/></li>
<li><a id="L39">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">tag_base</span></span> <span class="Statement">=</span> <span class="Constant">Start</span> <span class="Statement">|</span> <span class="Constant">End</span> <span class="Statement">|</span> <span class="Constant">Mem</span> <span class="Statement">of</span> <span class="Type">int<br/></li>
<li><a id="L40">&#x200c;</a></span><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">tag_addr</span></span> <span class="Statement">=</span> <span class="Constant">Sum</span> <span class="Statement">of</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L41" title="ocaml/lex/lexgen.mli:41">tag_base</a></span> <span class="Statement">*</span> <span class="Type">int</span><span class="Statement">)<br/></li>
<li><a id="L41">&#x200c;</a></span><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">ident_info</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ident_string</span> <span class="Statement">of</span> <span class="Type">bool</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L42" title="ocaml/lex/lexgen.mli:42">tag_addr</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L42" title="ocaml/lex/lexgen.mli:42">tag_addr</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ident_char</span> <span class="Statement">of</span> <span class="Type">bool</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L42" title="ocaml/lex/lexgen.mli:42">tag_addr</a><br/></li>
<li><a id="L44">&#x200c;</a></span><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">t_env</span></span> <span class="Statement">=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L38" title="ocaml/lex/lexgen.mli:38">ident</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L43" title="ocaml/lex/lexgen.mli:43">ident_info</a></span><span class="Statement">)</span> <span class="Type">list<br/></li>
<li></span><br/></li>
<li><a id="L46">&#x200c;</a><span class="Statement">type</span> <span class="Statement">(</span>'<span class="ocamlLCIdentifier">args</span>,'<span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><span class="linkable">lexer_entry</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">lex_name</span>: <span class="Type">string</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">lex_regexp</span>: <span class="ocamlLCIdentifier"><a href="#L30" title="ocaml/lex/lexgen.ml:30">regexp</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">lex_mem_tags</span>: <span class="Type">int</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">lex_actions</span>: <span class="Statement">(</span><span class="Type">int</span> <span class="Statement">*</span>&nbsp; <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L47" title="ocaml/lex/lexgen.mli:47">t_env</a></span> <span class="Statement">*</span> '<span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Type">list</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L53">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">automata</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Perform</span> <span class="Statement">of</span> <span class="Type">int</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L36" title="ocaml/lex/lexgen.mli:36">tag_action</a></span> <span class="Type">list<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Shift</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L26" title="ocaml/lex/lexgen.mli:26">automata_trans</a></span> <span class="Statement">*</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L29" title="ocaml/lex/lexgen.mli:29">automata_move</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L32" title="ocaml/lex/lexgen.mli:32">memory_action</a></span> <span class="Type">list</span><span class="Statement">)</span> <span class="Type">array<br/></li>
<li></span><br/></li>
<li><a id="L57">&#x200c;</a><span class="Statement">and</span> <span class="ocamlLCIdentifier"><span class="linkable">automata_trans</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">No_remember<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Remember</span> <span class="Statement">of</span> <span class="Type">int</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L36" title="ocaml/lex/lexgen.mli:36">tag_action</a></span> <span class="Type">list<br/></li>
<li></span><br/></li>
<li><a id="L61">&#x200c;</a><span class="Statement">and</span> <span class="ocamlLCIdentifier"><span class="linkable">automata_move</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Backtrack<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Goto</span> <span class="Statement">of</span> <span class="Type">int<br/></li>
<li></span><br/></li>
<li><a id="L65">&#x200c;</a><span class="Statement">and</span> <span class="ocamlLCIdentifier"><span class="linkable">memory_action</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Copy</span> <span class="Statement">of</span> <span class="Type">int</span> <span class="Statement">*</span> <span class="Type">int<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Set</span> <span class="Statement">of</span> <span class="Type">int<br/></li>
<li></span><br/></li>
<li><a id="L69">&#x200c;</a><span class="Statement">and</span> <span class="ocamlLCIdentifier"><span class="linkable">tag_action</span></span> <span class="Statement">=</span> <span class="Constant">SetTag</span> <span class="Statement">of</span> <span class="Type">int</span> <span class="Statement">*</span> <span class="Type">int</span> <span class="Statement">|</span> <span class="Constant">EraseTag</span> <span class="Statement">of</span> <span class="Type">int<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Representation of <a href="syntax.ml.html#L38" title="ocaml/lex/syntax.ml:38">entry</a> points *)<br/></li>
<li></span><br/></li>
<li><a id="L73">&#x200c;</a><span class="Statement">type</span> <span class="Statement">(</span>'<span class="ocamlLCIdentifier">args</span>,'<span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><span class="linkable">automata_entry</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">auto_name</span>: <span class="Type">string</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">auto_args</span>: '<span class="ocamlLCIdentifier">args</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">auto_mem_size</span> : <span class="Type">int</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">auto_initial_state</span>: <span class="Type">int</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L32" title="ocaml/lex/lexgen.mli:32">memory_action</a></span> <span class="Type">list</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">auto_actions</span>: <span class="Statement">(</span><span class="Type">int</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L47" title="ocaml/lex/lexgen.mli:47">t_env</a></span> <span class="Statement">*</span> '<span class="ocamlLCIdentifier">action</span><span class="Statement">)</span> <span class="Type">list</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* A lot of sets and map structures *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Ints</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li><a id="L84">&#x200c;</a><a id="L84">&#x200c;</a></span>&nbsp; <span class="PreProc">Set.Make</span><span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Type">int</span><span class="ocamlFuncStruct"> </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">x</span><span class="ocamlFuncStruct">:</span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L86">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">id_compare</span></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">id1</span>,<span class="Statement">_)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">id2</span>,<span class="Statement">_)</span> <span class="Statement">=</span> <span class="PreProc">String</span>.<span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span> <span class="ocamlLCIdentifier">id1</span> <span class="ocamlLCIdentifier">id2<br/></li>
<li></span><br/></li>
<li><a id="L88">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">tag_compare</span><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier">id</span><span class="Statement">=</span><span class="ocamlLCIdentifier">id1</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">start</span><span class="Statement">=</span><span class="ocamlLCIdentifier">start1</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">action</span><span class="Statement">=</span><span class="ocamlLCIdentifier">action1</span><span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier">id</span><span class="Statement">=</span><span class="ocamlLCIdentifier">id2</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">start</span><span class="Statement">=</span><span class="ocamlLCIdentifier">start2</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">action</span><span class="Statement">=</span><span class="ocamlLCIdentifier">action2</span><span class="Statement">}</span> <span class="Statement">=<br/></li>
<li><a id="L91">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">c</span></span> <span class="Statement">=</span> <span class="PreProc">String</span>.<span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span> <span class="ocamlLCIdentifier">id1</span> <span class="ocamlLCIdentifier">id2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span> <span class="Statement">else<br/></li>
<li><a id="L93">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">c</span></span> <span class="Statement">=</span> <span class="PreProc">Bool</span>.<span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span> <span class="ocamlLCIdentifier">start1</span> <span class="ocamlLCIdentifier">start2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span> <span class="Statement">else<br/></li>
<li></span>&nbsp; <span class="PreProc">Int</span>.<span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span> <span class="ocamlLCIdentifier">action1</span> <span class="ocamlLCIdentifier">action2<br/></li>
<li></span><br/></li>
<li><a id="L97">&#x200c;</a><a id="L97">&#x200c;</a><span class="Statement">module</span><span class="PreProc"> Tags</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Set.Make</span><span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L28" title="ocaml/lex/lexgen.ml:28">tag_info</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/lex/lexgen.ml:88">tag_compare</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> TagMap</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li><a id="L100">&#x200c;</a><a id="L100">&#x200c;</a></span>&nbsp; <span class="PreProc">Map.Make</span> <span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L28" title="ocaml/lex/lexgen.ml:28">tag_info</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/lex/lexgen.ml:88">tag_compare</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> IdSet</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li><a id="L103">&#x200c;</a><a id="L103">&#x200c;</a></span>&nbsp; <span class="PreProc">Set.Make</span> <span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L38" title="ocaml/lex/lexgen.mli:38">ident</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L86" title="ocaml/lex/lexgen.ml:86">id_compare</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*********************)<br/></li>
<li></span><span class="Comment">(* Variable cleaning *)<br/></li>
<li></span><span class="Comment">(*********************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Silently eliminate nested variables *)<br/></li>
<li></span><br/></li>
<li><a id="L111">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">do_remove_nested</span></span> <span class="ocamlLCIdentifier">to_remove</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Bind</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>,<span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">IdSet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mem</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">to_remove</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L111" title="ocaml/lex/lexgen.ml:111">do_remove_nested</a></span> <span class="ocamlLCIdentifier">to_remove</span> <span class="ocamlLCIdentifier">e<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Bind</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L111" title="ocaml/lex/lexgen.ml:111">do_remove_nested</a></span> <span class="Statement">(</span><span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">to_remove</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">e</span>, <span class="ocamlLCIdentifier">x</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Epsilon</span><span class="Statement">|</span><span class="Constant">Eof</span><span class="Statement">|</span><span class="Constant">Characters</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">e<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Sequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>, <span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Sequence<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L111" title="ocaml/lex/lexgen.ml:111">do_remove_nested</a></span> <span class="ocamlLCIdentifier">to_remove</span>&nbsp; <span class="ocamlLCIdentifier">e1</span>, <span class="ocamlLCIdentifier"><a href="#L111" title="ocaml/lex/lexgen.ml:111">do_remove_nested</a></span> <span class="ocamlLCIdentifier">to_remove</span>&nbsp; <span class="ocamlLCIdentifier">e2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alternative</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>, <span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Alternative<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L111" title="ocaml/lex/lexgen.ml:111">do_remove_nested</a></span> <span class="ocamlLCIdentifier">to_remove</span>&nbsp; <span class="ocamlLCIdentifier">e1</span>, <span class="ocamlLCIdentifier"><a href="#L111" title="ocaml/lex/lexgen.ml:111">do_remove_nested</a></span> <span class="ocamlLCIdentifier">to_remove</span>&nbsp; <span class="ocamlLCIdentifier">e2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Repetition</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Repetition</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L111" title="ocaml/lex/lexgen.ml:111">do_remove_nested</a></span> <span class="ocamlLCIdentifier">to_remove</span>&nbsp; <span class="ocamlLCIdentifier">e</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L127">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">remove_nested_as</span></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L111" title="ocaml/lex/lexgen.ml:111">do_remove_nested</a></span> <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> <span class="ocamlLCIdentifier">e<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*********************)<br/></li>
<li></span><span class="Comment">(* Variable analysis *)<br/></li>
<li></span><span class="Comment">(*********************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; Optional variables.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; A variable is optional when matching of <a href="#L30" title="ocaml/lex/lexgen.ml:30">regexp</a> does not<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; implies it binds.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; The typical case is:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; (&quot;&quot; | 'a' as x) -&gt; optional<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; (&quot;&quot; as x | 'a' as x) -&gt; non-optional<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L142">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">stringset_delta</span></span> <span class="ocamlLCIdentifier">s1</span> <span class="ocamlLCIdentifier">s2</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L32" title="ocaml/lex/cset.mli:32">diff</a></span> <span class="ocamlLCIdentifier">s1</span> <span class="ocamlLCIdentifier">s2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L32" title="ocaml/lex/cset.mli:32">diff</a></span> <span class="ocamlLCIdentifier">s2</span> <span class="ocamlLCIdentifier">s1</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L147">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">find_all_vars</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Characters</span> <span class="Statement">_|</span><span class="Constant">Epsilon</span><span class="Statement">|</span><span class="Constant">Eof</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Bind</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>,<span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L147" title="ocaml/lex/lexgen.ml:147">find_all_vars</a></span> <span class="ocamlLCIdentifier">e</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Sequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>,<span class="ocamlLCIdentifier">e2</span><span class="Statement">)|</span><span class="Constant">Alternative</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>,<span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L147" title="ocaml/lex/lexgen.ml:147">find_all_vars</a></span> <span class="ocamlLCIdentifier">e1</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L147" title="ocaml/lex/lexgen.ml:147">find_all_vars</a></span> <span class="ocamlLCIdentifier">e2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Repetition</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L147" title="ocaml/lex/lexgen.ml:147">find_all_vars</a></span> <span class="ocamlLCIdentifier">e<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L157">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">do_find_opt</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Characters</span> <span class="Statement">_|</span><span class="Constant">Epsilon</span><span class="Statement">|</span><span class="Constant">Eof</span> <span class="Statement">-&gt;</span> <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>, <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Bind</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>,<span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L312" title="ocaml/lex/lexgen.ml:312">opt</a></span>,<span class="ocamlLCIdentifier">all</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L157" title="ocaml/lex/lexgen.ml:157">do_find_opt</a></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L312" title="ocaml/lex/lexgen.ml:312">opt</a></span>, <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">all<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Sequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>,<span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">opt1</span>,<span class="ocamlLCIdentifier">all1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L157" title="ocaml/lex/lexgen.ml:157">do_find_opt</a></span> <span class="ocamlLCIdentifier">e1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">opt2</span>,<span class="ocamlLCIdentifier">all2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L157" title="ocaml/lex/lexgen.ml:157">do_find_opt</a></span> <span class="ocamlLCIdentifier">e2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">opt1</span> <span class="ocamlLCIdentifier">opt2</span>, <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">all1</span> <span class="ocamlLCIdentifier">all2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alternative</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>,<span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">opt1</span>,<span class="ocamlLCIdentifier">all1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L157" title="ocaml/lex/lexgen.ml:157">do_find_opt</a></span> <span class="ocamlLCIdentifier">e1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">opt2</span>,<span class="ocamlLCIdentifier">all2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L157" title="ocaml/lex/lexgen.ml:157">do_find_opt</a></span> <span class="ocamlLCIdentifier">e2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">opt1</span> <span class="ocamlLCIdentifier">opt2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L142" title="ocaml/lex/lexgen.ml:142">stringset_delta</a></span> <span class="ocamlLCIdentifier">all1</span> <span class="ocamlLCIdentifier">all2</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">all1</span> <span class="ocamlLCIdentifier">all2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Repetition</span> <span class="ocamlLCIdentifier">e</span>&nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L147" title="ocaml/lex/lexgen.ml:147">find_all_vars</a></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><a id="L177">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">find_optional</span></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L157" title="ocaml/lex/lexgen.ml:157">do_find_opt</a></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">in</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Double variables<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; A variable is double when it can be bound more than once<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; in a single matching<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; The typical case is:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; (e1 as x) (e2 as x)<br/></li>
<li></span><br/></li>
<li><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L189">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">do_find_double</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Characters</span> <span class="Statement">_|</span><span class="Constant">Epsilon</span><span class="Statement">|</span><span class="Constant">Eof</span> <span class="Statement">-&gt;</span> <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>, <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Bind</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>,<span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">dbl</span>,<span class="ocamlLCIdentifier">all</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L189" title="ocaml/lex/lexgen.ml:189">do_find_double</a></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="PreProc">IdSet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mem</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">all</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">dbl<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">dbl</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">all<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Sequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>,<span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">dbl1</span>, <span class="ocamlLCIdentifier">all1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L189" title="ocaml/lex/lexgen.ml:189">do_find_double</a></span> <span class="ocamlLCIdentifier">e1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">dbl2</span>, <span class="ocamlLCIdentifier">all2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L189" title="ocaml/lex/lexgen.ml:189">do_find_double</a></span> <span class="ocamlLCIdentifier">e2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L31" title="ocaml/lex/cset.mli:31">inter</a></span> <span class="ocamlLCIdentifier">all1</span> <span class="ocamlLCIdentifier">all2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">dbl1</span> <span class="ocamlLCIdentifier">dbl2</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">all1</span> <span class="ocamlLCIdentifier">all2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alternative</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>,<span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">dbl1</span>, <span class="ocamlLCIdentifier">all1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L189" title="ocaml/lex/lexgen.ml:189">do_find_double</a></span> <span class="ocamlLCIdentifier">e1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">dbl2</span>, <span class="ocamlLCIdentifier">all2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L189" title="ocaml/lex/lexgen.ml:189">do_find_double</a></span> <span class="ocamlLCIdentifier">e2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">dbl1</span> <span class="ocamlLCIdentifier">dbl2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">all1</span> <span class="ocamlLCIdentifier">all2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Repetition</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L147" title="ocaml/lex/lexgen.ml:147">find_all_vars</a></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><a id="L214">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">find_double</span></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L189" title="ocaml/lex/lexgen.ml:189">do_find_double</a></span> <span class="ocamlLCIdentifier">e<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Type of variables:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; A variable is bound to a char when all its occurrences<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; bind a pattern of length 1.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; The typical case is:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; (_ as x) -&gt; char<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L224">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_some</span></span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span>+<span class="ocamlLCIdentifier">i</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span>&nbsp;&nbsp; <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span><br/></li>
<li><a id="L228">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_some_some</span></span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">y</span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">x</span>,<span class="ocamlLCIdentifier">y</span> <span class="Statement">with<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">i</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier">j</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">i</span>+<span class="ocamlLCIdentifier">j</span><span class="Statement">)<br/></li>
<li></span><span class="Statement">|</span> <span class="Statement">_</span>,<span class="Statement">_</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span><br/></li>
<li><a id="L232">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">do_find_chars</span></span> <span class="ocamlLCIdentifier">sz</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Epsilon</span><span class="Statement">|</span><span class="Constant">Eof</span>&nbsp; &nbsp; <span class="Statement">-&gt;</span> <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>, <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>, <span class="ocamlLCIdentifier">sz<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Characters</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>, <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>, <span class="ocamlLCIdentifier"><a href="#L224" title="ocaml/lex/lexgen.ml:224">add_some</a></span> <span class="Constant">1</span> <span class="ocamlLCIdentifier">sz<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Bind</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>,<span class="ocamlLCIdentifier">x</span><span class="Statement">)</span>&nbsp;&nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span>,<span class="ocamlLCIdentifier">s</span>,<span class="ocamlLCIdentifier">e_sz</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L232" title="ocaml/lex/lexgen.ml:232">do_find_chars</a></span> <span class="Statement">(</span><span class="Constant">Some</span> <span class="Constant">0</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">e_sz</span><span class="ocamlEnd">&nbsp; </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="Constant">1</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">IdSet</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">s</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier"><a href="#L224" title="ocaml/lex/lexgen.ml:224">add_some</a></span><span class="ocamlEnd"> </span><span class="Constant">1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sz<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span><span class="ocamlEnd">, </span><span class="PreProc">IdSet</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">s</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L228" title="ocaml/lex/lexgen.ml:228">add_some_some</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sz</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">e_sz<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Sequence</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>,<span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">c1</span>,<span class="ocamlLCIdentifier">s1</span>,<span class="ocamlLCIdentifier">sz1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L232" title="ocaml/lex/lexgen.ml:232">do_find_chars</a></span> <span class="ocamlLCIdentifier">sz</span> <span class="ocamlLCIdentifier">e1</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">c2</span>,<span class="ocamlLCIdentifier">s2</span>,<span class="ocamlLCIdentifier">sz2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L232" title="ocaml/lex/lexgen.ml:232">do_find_chars</a></span> <span class="ocamlLCIdentifier">sz1</span> <span class="ocamlLCIdentifier">e2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">c1</span> <span class="ocamlLCIdentifier">c2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">s1</span> <span class="ocamlLCIdentifier">s2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">sz2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alternative</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">e1</span>,<span class="ocamlLCIdentifier">e2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">c1</span>,<span class="ocamlLCIdentifier">s1</span>,<span class="ocamlLCIdentifier">sz1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L232" title="ocaml/lex/lexgen.ml:232">do_find_chars</a></span> <span class="ocamlLCIdentifier">sz</span> <span class="ocamlLCIdentifier">e1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">c2</span>,<span class="ocamlLCIdentifier">s2</span>,<span class="ocamlLCIdentifier">sz2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L232" title="ocaml/lex/lexgen.ml:232">do_find_chars</a></span> <span class="ocamlLCIdentifier">sz</span> <span class="ocamlLCIdentifier">e2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">c1</span> <span class="ocamlLCIdentifier">c2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">s1</span> <span class="ocamlLCIdentifier">s2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">sz1</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">sz2</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">sz1</span> <span class="Statement">else</span> <span class="Constant">None</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Repetition</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L232" title="ocaml/lex/lexgen.ml:232">do_find_chars</a></span> <span class="Constant">None</span> <span class="ocamlLCIdentifier">e<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L259">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">find_chars</span></span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span>,<span class="ocamlLCIdentifier">s</span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L232" title="ocaml/lex/lexgen.ml:232">do_find_chars</a></span> <span class="Statement">(</span><span class="Constant">Some</span> <span class="Constant">0</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L32" title="ocaml/lex/cset.mli:32">diff</a></span> <span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/lex/lexgen.ml:91">c</a></span> <span class="ocamlLCIdentifier">s<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*******************************)<br/></li>
<li></span><span class="Comment">(* From shallow to deep syntax *)<br/></li>
<li></span><span class="Comment">(*******************************)<br/></li>
<li></span><br/></li>
<li><a id="L267">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">chars</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="Constant">[]</span> : <span class="PreProc">Cset</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Type">list</span><span class="Statement">)<br/></li>
<li><a id="L268">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">chars_count</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L271">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">encode_regexp</span></span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Epsilon</span> <span class="Statement">-&gt;</span> <span class="Constant">Empty<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Characters</span> <span class="ocamlLCIdentifier">cl</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L268" title="ocaml/lex/lexgen.ml:268">chars_count</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier">cl</span> <span class="Statement">::</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier"><a href="#L268" title="ocaml/lex/lexgen.ml:268">chars_count</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Chars</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>,<span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Eof</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L268" title="ocaml/lex/lexgen.ml:268">chars_count</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="Statement">:=</span> <span class="PreProc">Cset</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L27" title="ocaml/lex/cset.mli:27">eof</a></span> <span class="Statement">::</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier"><a href="#L268" title="ocaml/lex/lexgen.ml:268">chars_count</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Chars</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>,<span class="Constant">true</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Sequence</span><span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L271" title="ocaml/lex/lexgen.ml:271">encode_regexp</a></span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L271" title="ocaml/lex/lexgen.ml:271">encode_regexp</a></span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>, <span class="ocamlLCIdentifier">r2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alternative</span><span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L271" title="ocaml/lex/lexgen.ml:271">encode_regexp</a></span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L271" title="ocaml/lex/lexgen.ml:271">encode_regexp</a></span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Alt</span><span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>, <span class="ocamlLCIdentifier">r2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Repetition</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L271" title="ocaml/lex/lexgen.ml:271">encode_regexp</a></span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Star</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Bind</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Statement">((</span><span class="ocamlLCIdentifier">name</span>,<span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">))</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L271" title="ocaml/lex/lexgen.ml:271">encode_regexp</a></span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">IdSet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mem</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">char_vars</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Seq</span> <span class="Statement">(</span><span class="Constant">Tag</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">id</span><span class="Statement">=</span><span class="ocamlLCIdentifier">name</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">start</span><span class="Statement">=</span><span class="Constant">true</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">action</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">}</span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Seq</span> <span class="Statement">(</span><span class="Constant">Tag</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">id</span><span class="Statement">=</span><span class="ocamlLCIdentifier">name</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">start</span><span class="Statement">=</span><span class="Constant">true</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">action</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>, <span class="Constant">Tag</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">id</span><span class="Statement">=</span><span class="ocamlLCIdentifier">name</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">start</span><span class="Statement">=</span><span class="Constant">false</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">action</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">}))<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* Optimisation,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; Static optimization :<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; Replace tags by offsets relative to the beginning<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; or end of matched string.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; Dynamic optimization:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; Replace some non-optional, non-double tags by offsets w.<a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a>.<a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; a previous similar tag.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L312">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">opt</span></span> <span class="Statement">=</span> <span class="Constant">true<br/></li>
<li></span><br/></li>
<li><a id="L314">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">mk_seq</span></span> <span class="ocamlLCIdentifier">r1</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span>&nbsp; <span class="Statement">with<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Empty</span>,<span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">r2<br/></li>
<li></span><span class="Statement">|</span> <span class="Statement">_</span>,<span class="Constant">Empty</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">r1<br/></li>
<li></span><span class="Statement">|</span> <span class="Statement">_</span>,<span class="Statement">_</span>&nbsp; &nbsp;&nbsp; <span class="Statement">-&gt;</span> <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L319">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_pos</span></span> <span class="ocamlLCIdentifier"><a href="main.ml.html#L97" title="ocaml/lex/main.ml:97">p</a></span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="main.ml.html#L97" title="ocaml/lex/main.ml:97">p</a></span> <span class="Statement">with<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Sum</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">a</span>,<span class="ocamlLCIdentifier">n</span><span class="Statement">))</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">Sum</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">a</span>,<span class="ocamlLCIdentifier">n</span>+<span class="ocamlLCIdentifier">i</span><span class="Statement">))<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span><br/></li>
<li><a id="L323">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">mem_name</span></span> <span class="ocamlLCIdentifier">name</span> <span class="ocamlLCIdentifier">id_set</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">exists</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">id_name</span>,<span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">name</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">id_name</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">id_set<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">opt_regexp</span> <span class="ocamlLCIdentifier">all_vars</span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier">optional_vars</span> <span class="ocamlLCIdentifier">double_vars</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* From removed tags to their addresses *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">=</span> <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L20" title="ocaml/lex/table.ml:20">create</a></span> <span class="Constant">17</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* First static optimizations, from start position *)<br/></li>
<li><a id="L332">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">size_forward</span></span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Empty</span><span class="Statement">|</span><span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="Constant">true</span><span class="Statement">)|</span><span class="Constant">Tag</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="Constant">false</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span>+<span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L332" title="ocaml/lex/lexgen.ml:332">size_forward</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd">&nbsp; </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L332" title="ocaml/lex/lexgen.ml:332">size_forward</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r2<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L332" title="ocaml/lex/lexgen.ml:332">size_forward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">pos2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L332" title="ocaml/lex/lexgen.ml:332">size_forward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos1</span><span class="Statement">=</span><span class="ocamlLCIdentifier">pos2</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">pos1</span> <span class="Statement">else</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Action</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><a id="L347">&#x200c;</a>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">simple_forward</span></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tag</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L323" title="ocaml/lex/lexgen.ml:323">mem_name</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">id</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">double_vars</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Constant">Some</span> <span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Hashtbl</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">id</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">start</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Sum</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Start</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">pos</span><span class="Statement">))</span><span class="ocamlEnd"> </span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Empty</span><span class="ocamlEnd">,</span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Empty</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">is_eof</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Constant">Some</span> <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_eof</span><span class="ocamlNone"> </span><span class="Statement">then</span>&nbsp; <span class="ocamlLCIdentifier">pos</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier">pos</span>+<span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">pos</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L347" title="ocaml/lex/lexgen.ml:347">simple_forward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L314" title="ocaml/lex/lexgen.ml:314">mk_seq</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r2</span><span class="ocamlEnd">,</span><span class="Constant">None<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r2</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L347" title="ocaml/lex/lexgen.ml:347">simple_forward</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r2</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L314" title="ocaml/lex/lexgen.ml:314">mk_seq</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r2</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">pos<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L332" title="ocaml/lex/lexgen.ml:332">size_forward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">pos2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L332" title="ocaml/lex/lexgen.ml:332">size_forward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos1</span><span class="Statement">=</span><span class="ocamlLCIdentifier">pos2</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">pos1</span> <span class="Statement">else</span> <span class="Constant">None</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Action</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Then static optimizations, from end position *)<br/></li>
<li><a id="L374">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">size_backward</span></span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Empty</span><span class="Statement">|</span><span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="Constant">true</span><span class="Statement">)|</span><span class="Constant">Tag</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="Constant">false</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span>-<span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L374" title="ocaml/lex/lexgen.ml:374">size_backward</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r2</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd">&nbsp; </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L374" title="ocaml/lex/lexgen.ml:374">size_backward</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r1<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L374" title="ocaml/lex/lexgen.ml:374">size_backward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">pos2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L374" title="ocaml/lex/lexgen.ml:374">size_backward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos1</span><span class="Statement">=</span><span class="ocamlLCIdentifier">pos2</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">pos1</span> <span class="Statement">else</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Action</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L390">&#x200c;</a>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">simple_backward</span></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tag</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L323" title="ocaml/lex/lexgen.ml:323">mem_name</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">id</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">double_vars</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Constant">Some</span> <span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Hashtbl</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">id</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">start</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Sum</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">End</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">pos</span><span class="Statement">))</span><span class="ocamlEnd"> </span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Empty</span><span class="ocamlEnd">,</span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Empty</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Constant">Some</span> <span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">is_eof</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Constant">Some</span> <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_eof</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier">pos</span>-<span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">r2</span>,<span class="ocamlLCIdentifier">pos</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lex/lexgen.ml:390">simple_backward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L314" title="ocaml/lex/lexgen.ml:314">mk_seq</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r2</span><span class="ocamlEnd">,</span><span class="Constant">None<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lex/lexgen.ml:390">simple_backward</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L314" title="ocaml/lex/lexgen.ml:314">mk_seq</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">r2</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">pos<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos1</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L374" title="ocaml/lex/lexgen.ml:374">size_backward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">pos2</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L374" title="ocaml/lex/lexgen.ml:374">size_backward</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos1</span><span class="Statement">=</span><span class="ocamlLCIdentifier">pos2</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">pos1</span> <span class="Statement">else</span> <span class="Constant">None</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Action</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><a id="L416">&#x200c;</a>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">r</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L312" title="ocaml/lex/lexgen.ml:312">opt</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L347" title="ocaml/lex/lexgen.ml:347">simple_forward</a></span> <span class="Constant">0</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L390" title="ocaml/lex/lexgen.ml:390">simple_backward</a></span> <span class="Constant">0</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><a id="L424">&#x200c;</a>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_count</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li><a id="L425">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_tag_addr</span></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L424" title="ocaml/lex/lexgen.ml:424">loc_count</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier"><a href="#L424" title="ocaml/lex/lexgen.ml:424">loc_count</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">(</span><span class="Constant">Sum</span> <span class="Statement">(</span><span class="Constant">Mem</span> <span class="ocamlLCIdentifier">n</span>,<span class="Constant">0</span><span class="Statement">))</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Sum</span> <span class="Statement">(</span><span class="Constant">Mem</span> <span class="ocamlLCIdentifier">n</span>,<span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><a id="L435">&#x200c;</a>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">alloc_exp</span></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Tag</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L323" title="ocaml/lex/lexgen.ml:323">mem_name</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">id</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">double_vars</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Hashtbl</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">id</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">start</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlEnd"> </span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Empty</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">pos<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L425" title="ocaml/lex/lexgen.ml:425">get_tag_addr</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">id</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">start</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="ocamlEnd">,</span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">a<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Empty</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">is_eof</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_eof</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L319" title="ocaml/lex/lexgen.ml:319">add_pos</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">pos</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L435" title="ocaml/lex/lexgen.ml:435">alloc_exp</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">r2</span>,<span class="ocamlLCIdentifier">pos</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L435" title="ocaml/lex/lexgen.ml:435">alloc_exp</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">r2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L314" title="ocaml/lex/lexgen.ml:314">mk_seq</a></span> <span class="ocamlLCIdentifier">r1</span> <span class="ocamlLCIdentifier">r2</span>,<span class="ocamlLCIdentifier">pos<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span> <span class="Statement">(_</span>,<span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">off</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L332" title="ocaml/lex/lexgen.ml:332">size_forward</a></span> <span class="Constant">0</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">off</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier"><a href="#L319" title="ocaml/lex/lexgen.ml:319">add_pos</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="ocamlEnd">,</span><span class="Constant">None<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Action</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><a id="L463">&#x200c;</a>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">r</span></span>,<span class="Statement">_</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L435" title="ocaml/lex/lexgen.ml:435">alloc_exp</a></span> <span class="Constant">None</span> <span class="ocamlLCIdentifier"><span class="linkable">r</span></span> <span class="Statement">in<br/></li>
<li><a id="L464">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">m</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">name</span>,<span class="Statement">_)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">IdSet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mem</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">char_vars</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Ident_char<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">mem</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">optional_vars</span>, <span class="ocamlLCIdentifier"><a href="#L425" title="ocaml/lex/lexgen.ml:425">get_tag_addr</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">name</span>,<span class="Constant">true</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Ident_string<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">IdSet</span>.<span class="ocamlLCIdentifier">mem</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">optional_vars</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L425" title="ocaml/lex/lexgen.ml:425">get_tag_addr</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">name</span>,<span class="Constant">true</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L425" title="ocaml/lex/lexgen.ml:425">get_tag_addr</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">name</span>,<span class="Constant">false</span><span class="Statement">))</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span>,<span class="ocamlLCIdentifier">v</span><span class="Statement">)::</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">all_vars</span> <span class="Constant">[]</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>, <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L424" title="ocaml/lex/lexgen.ml:424">loc_count</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L483">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">encode_casedef</span></span> <span class="ocamlLCIdentifier">casedef</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">reg</span>,<span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/lex/lexgen.ml:1187">actions</a></span>,<span class="ocamlLCIdentifier">count</span>,<span class="ocamlLCIdentifier">ntags</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">expr</span>, <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">expr</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L127" title="ocaml/lex/lexgen.ml:127">remove_nested_as</a></span> <span class="ocamlLCIdentifier">expr</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">char_vars</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L259" title="ocaml/lex/lexgen.ml:259">find_chars</a></span> <span class="ocamlLCIdentifier">expr</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L271" title="ocaml/lex/lexgen.ml:271">encode_regexp</a></span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier">count</span> <span class="ocamlLCIdentifier">expr<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">opt_vars</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L177" title="ocaml/lex/lexgen.ml:177">find_optional</a></span> <span class="ocamlLCIdentifier">expr<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">double_vars</span>,<span class="ocamlLCIdentifier">all_vars</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L214" title="ocaml/lex/lexgen.ml:214">find_double</a></span> <span class="ocamlLCIdentifier">expr</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier">loc_ntags</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">opt_regexp</span> <span class="ocamlLCIdentifier">all_vars</span> <span class="ocamlLCIdentifier">char_vars</span> <span class="ocamlLCIdentifier">opt_vars</span> <span class="ocamlLCIdentifier">double_vars</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Alt</span><span class="Statement">(</span><span class="ocamlLCIdentifier">reg</span>, <span class="Constant">Seq</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>, <span class="Constant">Action</span> <span class="ocamlLCIdentifier">count</span><span class="Statement">))</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">count</span>, <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> ,<span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/lex/lexgen.ml:1187">actions</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">succ</span> <span class="ocamlLCIdentifier">count</span><span class="Statement">)</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Int</span>.<span class="ocamlLCIdentifier">max</span> <span class="ocamlLCIdentifier">loc_ntags</span> <span class="ocamlLCIdentifier">ntags</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Empty</span>, <span class="Constant">[]</span>, <span class="Constant">0</span>, <span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">casedef</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><a id="L502">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">encode_lexdef</span></span> <span class="ocamlLCIdentifier"><a href="main.ml.html#L75" title="ocaml/lex/main.ml:75">def</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L268" title="ocaml/lex/lexgen.ml:268">chars_count</a></span> <span class="Statement">:=</span> <span class="Constant">0</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">entry_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">name</span><span class="Statement">=</span><span class="ocamlLCIdentifier">entry_name</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">args</span><span class="Statement">=</span><span class="ocamlLCIdentifier">args</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">shortest</span><span class="Statement">=</span><span class="ocamlLCIdentifier">shortest</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">clauses</span><span class="Statement">=</span><span class="ocamlLCIdentifier">casedef</span><span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">re</span>,<span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/lex/lexgen.ml:1187">actions</a></span>,<span class="Statement">_</span>,<span class="ocamlLCIdentifier">ntags</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L483" title="ocaml/lex/lexgen.ml:483">encode_casedef</a></span> <span class="ocamlLCIdentifier">casedef</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">lex_name</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">entry_name</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lex_regexp</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">re</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lex_mem_tags</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ntags</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">lex_actions</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/lex/lexgen.ml:1187">actions</a></span> <span class="Statement">}</span>,<span class="ocamlLCIdentifier">args</span>,<span class="ocamlLCIdentifier">shortest</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="main.ml.html#L75" title="ocaml/lex/main.ml:75">def</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">chr</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">of_list</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">chr</span>, <span class="ocamlLCIdentifier">entry_list</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* To generate directly a NFA from a regular expression.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Confer Aho-Sethi-Ullman, dragon book, chap. 3<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Extension to tagged <a href="lexgen.mli.html#L23" title="ocaml/lex/lexgen.mli:23">automata</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Confer<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; Ville Larikari<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; 'NFAs with Tagged Transitions, their Conversion to Deterministic<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; Automata and Application to Regular Expressions'.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; Symposium on String Processing and Information Retrieval (SPIRE 2000),<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; http://kouli.iki.fi/~vlaurika/spire2000-tnfa.ps<br/></li>
<li></span><span class="Comment">(See also)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; http://kouli.iki.fi/~vlaurika/regex-submatch.ps.gz<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L531">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">t_transition</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">OnChars</span> <span class="Statement">of</span> <span class="Type">int<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">ToAction</span> <span class="Statement">of</span> <span class="Type">int<br/></li>
<li></span><br/></li>
<li><a id="L535">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">transition</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L531" title="ocaml/lex/lexgen.ml:531">t_transition</a></span> <span class="Statement">*</span> <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a><br/></li>
<li></span><br/></li>
<li><a id="L537">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">trans_compare</span></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">t1</span>,<span class="ocamlLCIdentifier">tags1</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">t2</span>,<span class="ocamlLCIdentifier">tags2</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="PreProc">Stdlib</span>.<span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span>&nbsp; <span class="ocamlLCIdentifier">t1</span> <span class="ocamlLCIdentifier">t2</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">0</span> <span class="Statement">-&gt;</span> <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span> <span class="ocamlLCIdentifier">tags1</span> <span class="ocamlLCIdentifier">tags2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> TransSet</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li><a id="L544">&#x200c;</a><a id="L544">&#x200c;</a></span>&nbsp; <span class="PreProc">Set.Make</span><span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L535" title="ocaml/lex/lexgen.ml:535">transition</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L537" title="ocaml/lex/lexgen.ml:537">trans_compare</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L546">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">nullable</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Empty</span><span class="Statement">|</span><span class="Constant">Tag</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="Statement">_)|</span><span class="Constant">Action</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span><span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L546" title="ocaml/lex/lexgen.ml:546">nullable</a></span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier"><a href="#L546" title="ocaml/lex/lexgen.ml:546">nullable</a></span> <span class="ocamlLCIdentifier">r2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span><span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L546" title="ocaml/lex/lexgen.ml:546">nullable</a></span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier"><a href="#L546" title="ocaml/lex/lexgen.ml:546">nullable</a></span> <span class="ocamlLCIdentifier">r2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="Statement">_</span>&nbsp; &nbsp;&nbsp; <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span><br/></li>
<li><a id="L553">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">emptymatch</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Empty</span> <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(_</span>,<span class="Statement">_)</span> <span class="Statement">|</span> <span class="Constant">Action</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Tag</span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">-&gt;</span> <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L553" title="ocaml/lex/lexgen.ml:553">emptymatch</a></span> <span class="ocamlLCIdentifier">r1</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L553" title="ocaml/lex/lexgen.ml:553">emptymatch</a></span> <span class="ocamlLCIdentifier">r2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span><span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span>&nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L546" title="ocaml/lex/lexgen.ml:546">nullable</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L553" title="ocaml/lex/lexgen.ml:553">emptymatch</a></span> <span class="ocamlLCIdentifier">r1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L553" title="ocaml/lex/lexgen.ml:553">emptymatch</a></span> <span class="ocamlLCIdentifier">r2<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L546" title="ocaml/lex/lexgen.ml:546">nullable</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L553" title="ocaml/lex/lexgen.ml:553">emptymatch</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span><br/></li>
<li><a id="L568">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">addtags</span></span> <span class="ocamlLCIdentifier">transs</span> <span class="ocamlLCIdentifier">tags</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span>,<span class="ocamlLCIdentifier">tags_t</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span>, <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier">tags_t</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">transs</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">firstpos</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Empty</span><span class="Statement">|</span><span class="Constant">Tag</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span>,<span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="Constant">OnChars</span> <span class="ocamlLCIdentifier">pos</span>,<span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">)</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Action</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="Statement">-&gt;</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="Constant">ToAction</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span>,<span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">)</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span><span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L546" title="ocaml/lex/lexgen.ml:546">nullable</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">r1</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier">r1</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L568" title="ocaml/lex/lexgen.ml:568">addtags</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L553" title="ocaml/lex/lexgen.ml:553">emptymatch</a></span> <span class="ocamlLCIdentifier">r1</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier">r1<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span><span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier">r1</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier">r2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>&nbsp; &nbsp;&nbsp; <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* Berry-Sethi <a href="#L588" title="ocaml/lex/lexgen.ml:588">followpos</a> *)<br/></li>
<li><a id="L588">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">followpos</span></span> <span class="ocamlLCIdentifier"><a href="table.ml.html#L56" title="ocaml/lex/table.ml:56">size</a></span> <span class="ocamlLCIdentifier">entry_list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="ocamlLCIdentifier"><a href="table.ml.html#L56" title="ocaml/lex/table.ml:56">size</a></span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">fill</span> <span class="ocamlLCIdentifier">s</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Empty</span><span class="Statement">|</span><span class="Constant">Action</span> <span class="Statement">_|</span><span class="Constant">Tag</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Chars</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>,<span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">v</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier">s<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Alt</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fill</span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier">r1</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">fill</span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier">r2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Seq</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">r1</span>,<span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fill<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L546" title="ocaml/lex/lexgen.ml:546">nullable</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">r2</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier">r2</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L568" title="ocaml/lex/lexgen.ml:568">addtags</a></span> <span class="ocamlLCIdentifier">s</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L553" title="ocaml/lex/lexgen.ml:553">emptymatch</a></span> <span class="ocamlLCIdentifier">r2</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier">r2</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">r1</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fill</span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier">r2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Star</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fill</span> <span class="Statement">(</span><span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L30" title="ocaml/lex/cset.mli:30">union</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">s</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L49" title="ocaml/lex/table.ml:49">iter</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="syntax.ml.html#L38" title="ocaml/lex/syntax.ml:38">entry</a></span>,<span class="Statement">_</span>,<span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fill</span> <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> <span class="ocamlLCIdentifier"><a href="syntax.ml.html#L38" title="ocaml/lex/syntax.ml:38">entry</a></span>.<span class="ocamlLCIdentifier">lex_regexp</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">entry_list</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">v<br/></li>
<li></span><br/></li>
<li><span class="Comment">(************************)<br/></li>
<li></span><span class="Comment">(* The algorithm itself *)<br/></li>
<li></span><span class="Comment">(************************)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">no_action</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">max_int<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> StateSet</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Set.Make</span> <span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L531" title="ocaml/lex/lexgen.ml:531">t_transition</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Stdlib</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> MemMap</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Map.Make</span> <span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Type">int<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">x</span><span class="ocamlFuncStruct">:</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">)</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Stdlib</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> '<span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier">dfa_state</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier">final</span> : <span class="Type">int</span> <span class="Statement">*</span> <span class="Statement">(</span>'<span class="ocamlLCIdentifier">a</span> <span class="Statement">*</span> <span class="Type">int</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">)</span> <span class="Statement">;<br/></li>
<li></span>&nbsp;&nbsp; <span class="ocamlLCIdentifier">others</span> : <span class="Statement">(</span>'<span class="ocamlLCIdentifier">a</span> <span class="Statement">*</span> <span class="Type">int</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">)</span> <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">let dtag <a href="main.ml.html#L68" title="ocaml/lex/main.ml:68">oc</a> <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a> =<br/></li>
<li></span><span class="Comment">&nbsp; fprintf <a href="main.ml.html#L68" title="ocaml/lex/main.ml:68">oc</a> &quot;%s&lt;%s&gt;&quot; <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a>.id (if <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a>.start then &quot;s&quot; else &quot;e&quot;)<br/></li>
<li></span><br/></li>
<li><span class="Comment">let dmem_map dp ds <a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a> =<br/></li>
<li></span><span class="Comment">&nbsp; MemMap.<a href="table.ml.html#L49" title="ocaml/lex/table.ml:49">iter</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; (fun k x -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; eprintf &quot;%d -&gt; &quot; k ; dp x ; ds ())<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; <a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">and dtag_map dp ds <a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a> =<br/></li>
<li></span><span class="Comment">&nbsp; TagMap.<a href="table.ml.html#L49" title="ocaml/lex/table.ml:49">iter</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; (fun <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a> x -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; dtag stderr <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a> ; eprintf &quot; -&gt; &quot; ; dp x ; ds ())<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; <a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">let dstate {final=(<a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a>,(_,<a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a>)) ; others=o} =<br/></li>
<li></span><span class="Comment">&nbsp; if <a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a> &lt;&gt; no_action then begin<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; eprintf &quot;final=%d &quot; <a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a> ;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; dtag_map (fun x -&gt; eprintf &quot;%d&quot; x) (fun () -&gt; prerr_string &quot; ,&quot;) <a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a> ;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; prerr_endline &quot;&quot;<br/></li>
<li></span><span class="Comment">&nbsp; end ;<br/></li>
<li></span><span class="Comment">&nbsp; dmem_map<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; (fun (_,<a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a>) -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; dtag_map (fun x -&gt; eprintf &quot;%d&quot; x) (fun () -&gt; prerr_string &quot; ,&quot;) <a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a>)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; (fun () -&gt; prerr_endline &quot;&quot;)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; o<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">dfa_state_empty</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier">final</span><span class="Statement">=(</span><span class="ocamlLCIdentifier">no_action</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">max_int</span>,<span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">))</span> <span class="Statement">;<br/></li>
<li></span>&nbsp;&nbsp; <span class="ocamlLCIdentifier">others</span><span class="Statement">=</span><span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">dfa_state_is_empty</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">final</span><span class="Statement">=(</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span>,<span class="Statement">_)</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">others</span><span class="Statement">=</span><span class="ocamlLCIdentifier">o</span><span class="Statement">}</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">no_action</span> <span class="Statement">&amp;&amp;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">o</span> <span class="Statement">=</span> <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* A key is an abstraction on a dfa state,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; two <a href="#L1177" title="ocaml/lex/lexgen.ml:1177">states</a> with the same key can be made the same by<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; copying some <a href="compact.ml.html#L43" title="ocaml/lex/compact.ml:43">memory</a> cells into others *)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> StateSetSet</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Set.Make</span> <span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">StateSet</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">StateSet</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier">t_equiv</span> <span class="Statement">=</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">tag</span>:<span class="ocamlLCIdentifier"><a href="#L28" title="ocaml/lex/lexgen.ml:28">tag_info</a></span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">equiv</span>:<span class="PreProc">StateSetSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> MemKey</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Set.Make<br/></li>
<li></span>&nbsp;&nbsp; <span class="ocamlFuncWith">(</span><span class="PreProc">struct<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp;&nbsp; </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">t_equiv<br/></li>
<li></span><br/></li>
<li><span class="ocamlFuncStruct">&nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">e1</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">e2</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">match</span><span class="ocamlFuncStruct"> </span><span class="PreProc">Stdlib</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">e1</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">tag</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">e2</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">tag</span><span class="ocamlFuncStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="Constant">0</span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="PreProc">StateSetSet</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">e1</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">equiv</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">e2</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier">equiv<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp;&nbsp; </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L687">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">dfa_key</span></span> <span class="Statement">=</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">kstate</span> : <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">kmem</span> : <span class="PreProc">MemKey</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Map a state to its key *)<br/></li>
<li><a id="L690">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">env_to_class</span></span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">env1</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">_</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span>,<span class="ocamlLCIdentifier">s</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">update</span> <span class="ocamlLCIdentifier">tag</span> <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="PreProc">StateSetSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L28" title="ocaml/lex/cset.mli:28">singleton</a></span> <span class="ocamlLCIdentifier">s</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">ss</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="PreProc">StateSetSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier">ss</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier">ss</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="PreProc">MemKey</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">tag</span><span class="Statement">=</span><span class="ocamlLCIdentifier">tag</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">equiv</span><span class="Statement">=</span><span class="ocamlLCIdentifier">ss</span><span class="Statement">}</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">env1</span> <span class="PreProc">MemKey</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* <a href="compact.ml.html#L108" title="ocaml/lex/compact.ml:108">trans</a> is nfa_state, <a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a> is associated <a href="compact.ml.html#L43" title="ocaml/lex/compact.ml:43">memory</a> map *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">inverse_mem_map</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L108" title="ocaml/lex/compact.ml:108">trans</a></span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier">addr</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">update</span> <span class="ocamlLCIdentifier">addr</span> <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span>, <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L28" title="ocaml/lex/cset.mli:28">singleton</a></span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L108" title="ocaml/lex/compact.ml:108">trans</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">otag</span>, <span class="ocamlLCIdentifier">s</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">assert</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">otag</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">tag</span>, <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L108" title="ocaml/lex/compact.ml:108">trans</a></span> <span class="ocamlLCIdentifier">s</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">inverse_mem_map_other</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">inverse_mem_map</span> <span class="Statement">(</span><span class="Constant">OnChars</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">get_key</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">final</span><span class="Statement">=(</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span>,<span class="Statement">(_</span>,<span class="ocamlLCIdentifier">m_act</span><span class="Statement">))</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">others</span><span class="Statement">=</span><span class="ocamlLCIdentifier">o</span><span class="Statement">}</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">fold</span> <span class="ocamlLCIdentifier">inverse_mem_map_other<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">o<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">no_action</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier">inverse_mem_map</span> <span class="Statement">(</span><span class="Constant">ToAction</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">m_act</span> <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li><a id="L724">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">state_key</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">fold</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">_</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="Constant">OnChars</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">o<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">=</span><span class="ocamlLCIdentifier">no_action</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="Constant">ToAction</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">)</span> <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li><a id="L728">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">mem_key</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L690" title="ocaml/lex/lexgen.ml:690">env_to_class</a></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier">kstate</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L724" title="ocaml/lex/lexgen.ml:724">state_key</a></span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">kmem</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L728" title="ocaml/lex/lexgen.ml:728">mem_key</a></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L732">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">key_compare</span></span> <span class="ocamlLCIdentifier">k1</span> <span class="ocamlLCIdentifier">k2</span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span> <span class="ocamlLCIdentifier">k1</span>.<span class="ocamlLCIdentifier">kstate</span> <span class="ocamlLCIdentifier">k2</span>.<span class="ocamlLCIdentifier">kstate</span> <span class="Statement">with<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">0</span> <span class="Statement">-&gt;</span> <span class="PreProc">MemKey</span>.<span class="ocamlLCIdentifier"><a href="#L84" title="ocaml/lex/lexgen.ml:84">compare</a></span> <span class="ocamlLCIdentifier">k1</span>.<span class="ocamlLCIdentifier">kmem</span> <span class="ocamlLCIdentifier">k2</span>.<span class="ocamlLCIdentifier">kmem<br/></li>
<li></span><span class="Statement">|</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Association dfa_state -&gt; state_num *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> StateMap</span><span class="ocamlPreDef"> </span><span class="Statement">=<br/></li>
<li><a id="L739">&#x200c;</a><a id="L739">&#x200c;</a></span>&nbsp; <span class="PreProc">Map.Make</span><span class="ocamlFuncWith">(</span><span class="PreProc">struct</span><span class="ocamlFuncStruct"> </span><span class="Statement">type</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L687" title="ocaml/lex/lexgen.ml:687">dfa_key</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L732" title="ocaml/lex/lexgen.ml:732">key_compare</a></span><span class="ocamlFuncStruct"> </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L741">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">state_map</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="PreProc">StateMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> : <span class="Type">int</span> <span class="PreProc">StateMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">)<br/></li>
<li><a id="L742">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">todo</span></span> <span class="Statement">=</span> <span class="PreProc">Stack</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L20" title="ocaml/lex/table.ml:20">create</a></span><span class="Constant">()<br/></li>
<li><a id="L743">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">next_state_num</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0<br/></li>
<li><a id="L744">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">next_mem_cell</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0<br/></li>
<li><a id="L745">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">temp_pending</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">false<br/></li>
<li><a id="L746">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">tag_cells</span></span> <span class="Statement">=</span> <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L20" title="ocaml/lex/table.ml:20">create</a></span> <span class="Constant">17<br/></li>
<li><a id="L747">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">state_table</span></span> <span class="Statement">=</span> <span class="PreProc">Table</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L20" title="ocaml/lex/table.ml:20">create</a></span> <span class="ocamlLCIdentifier">dfa_state_empty<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* Initial reset of state *)<br/></li>
<li><a id="L751">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">reset_state</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Stack</span>.<span class="ocamlLCIdentifier">clear</span> <span class="ocamlLCIdentifier"><a href="#L742" title="ocaml/lex/lexgen.ml:742">todo</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L743" title="ocaml/lex/lexgen.ml:743">next_state_num</a></span> <span class="Statement">:=</span> <span class="Constant">0</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">_</span> <span class="Statement">=</span> <span class="PreProc">Table</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L44" title="ocaml/lex/table.ml:44">trim</a></span> <span class="ocamlLCIdentifier"><a href="#L747" title="ocaml/lex/lexgen.ml:747">state_table</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Constant">()<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Reset state before processing a given <a href="lexgen.mli.html#L23" title="ocaml/lex/lexgen.mli:23">automata</a>.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; We clear both the <a href="compact.ml.html#L43" title="ocaml/lex/compact.ml:43">memory</a> mapping and<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the state mapping, as state sharing between different<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="lexgen.mli.html#L23" title="ocaml/lex/lexgen.mli:23">automata</a> may lead to incorrect estimation of the cell <a href="compact.ml.html#L43" title="ocaml/lex/compact.ml:43">memory</a> <a href="table.ml.html#L56" title="ocaml/lex/table.ml:56">size</a><br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; BUG ID 0004517 *)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L764">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">reset_state_partial</span></span> <span class="ocamlLCIdentifier">ntags</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L744" title="ocaml/lex/lexgen.ml:744">next_mem_cell</a></span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier">ntags</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">clear</span> <span class="ocamlLCIdentifier"><a href="#L746" title="ocaml/lex/lexgen.ml:746">tag_cells</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L745" title="ocaml/lex/lexgen.ml:745">temp_pending</a></span> <span class="Statement">:=</span> <span class="Constant">false</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L741" title="ocaml/lex/lexgen.ml:741">state_map</a></span> <span class="Statement">:=</span> <span class="PreProc">StateMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span><br/></li>
<li><a id="L770">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">do_alloc_temp</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L745" title="ocaml/lex/lexgen.ml:745">temp_pending</a></span> <span class="Statement">:=</span> <span class="Constant">true</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L744" title="ocaml/lex/lexgen.ml:744">next_mem_cell</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">n<br/></li>
<li></span><br/></li>
<li><a id="L775">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">do_alloc_cell</span></span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">available</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">try</span> <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier"><a href="#L746" title="ocaml/lex/lexgen.ml:746">tag_cells</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">with</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;</span> <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">choose</span> <span class="Statement">(</span><span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L32" title="ocaml/lex/cset.mli:32">diff</a></span> <span class="ocamlLCIdentifier">available</span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L745" title="ocaml/lex/lexgen.ml:745">temp_pending</a></span> <span class="Statement">:=</span> <span class="Constant">false</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L744" title="ocaml/lex/lexgen.ml:744">next_mem_cell</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">255</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">raise</span> <span class="Constant">Memory_overflow</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Hashtbl</span>.<span class="ocamlLCIdentifier">replace</span> <span class="ocamlLCIdentifier"><a href="#L746" title="ocaml/lex/lexgen.ml:746">tag_cells</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">(</span><span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier">available</span><span class="Statement">)</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier"><a href="#L744" title="ocaml/lex/lexgen.ml:744">next_mem_cell</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">n<br/></li>
<li></span><br/></li>
<li><a id="L789">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">is_old_addr</span></span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">&gt;=</span> <span class="Constant">0<br/></li>
<li></span><span class="Statement">and</span> <span class="ocamlLCIdentifier">is_new_addr</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">&lt;</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><a id="L792">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">old_in_map</span></span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">_</span> <span class="ocamlLCIdentifier">addr</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L789" title="ocaml/lex/lexgen.ml:789">is_old_addr</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">addr</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">addr</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><a id="L801">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">alloc_map</span></span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier">mvs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier">mvs</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">a</span>,<span class="ocamlLCIdentifier">mvs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_new_addr</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L775" title="ocaml/lex/lexgen.ml:775">do_alloc_cell</a></span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span> <span class="ocamlLCIdentifier">tag</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">a</span>,<span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier">mvs<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier">a</span>,<span class="ocamlLCIdentifier">mvs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier">mvs</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">(</span><span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>,<span class="ocamlLCIdentifier">mvs</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L812">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">create_new_state</span></span> <span class="Statement">{</span><span class="ocamlLCIdentifier">final</span><span class="Statement">=(</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span>,<span class="Statement">(_</span>,<span class="ocamlLCIdentifier">m_act</span><span class="Statement">))</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">others</span><span class="Statement">=</span><span class="ocamlLCIdentifier">o</span><span class="Statement">}</span> <span class="Statement">=<br/></li>
<li><a id="L813">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">used</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">fold</span> <span class="Statement">(fun</span> <span class="Statement">_</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L792" title="ocaml/lex/lexgen.ml:792">old_in_map</a></span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">o</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L792" title="ocaml/lex/lexgen.ml:792">old_in_map</a></span> <span class="ocamlLCIdentifier">m_act</span> <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><a id="L817">&#x200c;</a>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">new_m_act</span></span>,<span class="ocamlLCIdentifier">mvs</span>&nbsp; <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L801" title="ocaml/lex/lexgen.ml:801">alloc_map</a></span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span> <span class="ocamlLCIdentifier">m_act</span> <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> <span class="Statement">in<br/></li>
<li><a id="L818">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">new_o</span></span>,<span class="ocamlLCIdentifier">mvs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">fold</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier">mvs</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span>,<span class="ocamlLCIdentifier">mvs</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L801" title="ocaml/lex/lexgen.ml:801">alloc_map</a></span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier">mvs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">x</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>,<span class="ocamlLCIdentifier">mvs</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">o</span> <span class="Statement">(</span><span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>,<span class="ocamlLCIdentifier">mvs</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier">final</span><span class="Statement">=(</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span>,<span class="Statement">(</span><span class="Constant">0</span>,<span class="ocamlLCIdentifier"><a href="#L817" title="ocaml/lex/lexgen.ml:817">new_m_act</a></span><span class="Statement">))</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">others</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="#L818" title="ocaml/lex/lexgen.ml:818">new_o</a></span><span class="Statement">}</span>,<br/></li>
<li>&nbsp; <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">fold</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="Constant">Set</span> <span class="ocamlLCIdentifier">x</span><span class="Statement">::</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">mvs</span> <span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><a id="L826">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">new_addr_gen</span></span> <span class="Statement">=</span> <span class="Statement">{mutable</span> <span class="ocamlLCIdentifier">count</span> : <span class="Type">int</span> <span class="Statement">;</span> <span class="Statement">mutable</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> : <span class="Type">int</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L828">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">create_new_addr_gen</span></span> <span class="Constant">()</span> <span class="Statement">=</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">count</span> <span class="Statement">=</span> -<span class="Constant">1</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">=</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L830">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">alloc_new_addr</span></span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a><br/></li>
<li></span>&nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier">count</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier">count</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier">a</span>-<span class="Constant">1</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">&lt;-</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">a<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L841">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">create_mem_map</span></span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier">gen</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">tag</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L830" title="ocaml/lex/lexgen.ml:830">alloc_new_addr</a></span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier">gen</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">tags</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">create_init_state</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">gen</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L828" title="ocaml/lex/lexgen.ml:828">create_new_addr_gen</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li><a id="L848">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">st</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span>,<span class="ocamlLCIdentifier">tags</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">ToAction</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">on</span>,<span class="ocamlLCIdentifier">_otags</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span>.<span class="ocamlLCIdentifier">final</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">on</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">final</span> <span class="Statement">=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="Statement">(</span><span class="Constant">0</span>,<span class="ocamlLCIdentifier"><a href="#L841" title="ocaml/lex/lexgen.ml:841">create_mem_map</a></span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier">gen</span><span class="Statement">))}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">OnChars</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">_</span> <span class="Statement">=</span> <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span>.<span class="ocamlLCIdentifier">others</span> <span class="Statement">in</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">others</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">(</span><span class="Constant">0</span>,<span class="ocamlLCIdentifier"><a href="#L841" title="ocaml/lex/lexgen.ml:841">create_mem_map</a></span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier">gen</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span>.<span class="ocamlLCIdentifier">others</span><span class="Statement">})<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier">dfa_state_empty</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L869">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_map</span></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">with<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">ToAction</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">let</span> <span class="Statement">_</span>,<span class="Statement">(_</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span>.<span class="ocamlLCIdentifier">final</span> <span class="Statement">in</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a><br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">OnChars</span> <span class="ocamlLCIdentifier">n</span>&nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="Statement">=</span> <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span>.<span class="ocamlLCIdentifier">others</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a><br/></li>
<li></span><br/></li>
<li><a id="L875">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dest</span></span> <span class="Statement">=</span> <span class="Statement">function</span> <span class="Statement">|</span> <span class="Constant">Copy</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">d</span>,<span class="Statement">_)</span> <span class="Statement">|</span> <span class="Constant">Set</span> <span class="ocamlLCIdentifier">d</span>&nbsp; <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">d<br/></li>
<li></span><span class="Statement">and</span> <span class="ocamlLCIdentifier">orig</span> <span class="Statement">=</span> <span class="Statement">function</span> <span class="Statement">|</span> <span class="Constant">Copy</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">o</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">o</span> <span class="Statement">|</span> <span class="Constant">Set</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> -<span class="Constant">1<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">let pmv <a href="main.ml.html#L68" title="ocaml/lex/main.ml:68">oc</a> mv = fprintf <a href="main.ml.html#L68" title="ocaml/lex/main.ml:68">oc</a> &quot;%d &lt;- %d&quot; (<a href="#L875" title="ocaml/lex/lexgen.ml:875">dest</a> mv) (orig mv)<br/></li>
<li></span><span class="Comment">let pmvs <a href="main.ml.html#L68" title="ocaml/lex/main.ml:68">oc</a> mvs =<br/></li>
<li></span><span class="Comment">&nbsp; List.<a href="table.ml.html#L49" title="ocaml/lex/table.ml:49">iter</a> (fun mv -&gt; fprintf <a href="main.ml.html#L68" title="ocaml/lex/main.ml:68">oc</a> &quot;%a &quot; pmv&nbsp; mv) mvs ;<br/></li>
<li></span><span class="Comment">&nbsp; output_char <a href="main.ml.html#L68" title="ocaml/lex/main.ml:68">oc</a> '\n' ; flush <a href="main.ml.html#L68" title="ocaml/lex/main.ml:68">oc</a><br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* Topological sort &lt;&lt; a la louche &gt;&gt; *)<br/></li>
<li><a id="L887">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">sort_mvs</span></span> <span class="ocamlLCIdentifier">mvs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">do_rec</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="ocamlLCIdentifier">mvs</span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">mvs</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>&nbsp; <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">dests</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="ocamlLCIdentifier">mv</span> <span class="Statement">-&gt;</span> <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L875" title="ocaml/lex/lexgen.ml:875">dest</a></span> <span class="ocamlLCIdentifier">mv</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> <span class="ocamlLCIdentifier">mvs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rem</span>,<span class="ocamlLCIdentifier">here</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">partition<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">mv</span> <span class="Statement">-&gt;</span> <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">mem</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">orig</span> <span class="ocamlLCIdentifier">mv</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">dests</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">mvs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">here</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rem</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Copy</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">d</span><span class="ocamlEnd">,</span><span class="Statement">_)::_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">d</span><span class="ocamlEnd">' </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L770" title="ocaml/lex/lexgen.ml:770">do_alloc_temp</a></span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Copy</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">d</span><span class="ocamlEnd">',</span><span class="ocamlLCIdentifier">d</span><span class="Statement">)::<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">do_rec</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mv</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">orig</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">mv</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">d</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">Copy</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L875" title="ocaml/lex/lexgen.ml:875">dest</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">mv</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">d</span><span class="ocamlEnd">'</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">mv</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">rem</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">assert</span><span class="ocamlEnd"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>&nbsp; <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">do_rec</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">here</span>@<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">rem</span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">do_rec</span> <span class="Constant">[]</span> <span class="ocamlLCIdentifier">mvs<br/></li>
<li></span><br/></li>
<li><a id="L918">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">move_to</span></span> <span class="ocamlLCIdentifier"><a href="#L728" title="ocaml/lex/lexgen.ml:728">mem_key</a></span> <span class="ocamlLCIdentifier">src</span> <span class="ocamlLCIdentifier">tgt</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">mvs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">MemKey</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">tag</span><span class="Statement">=</span><span class="ocamlLCIdentifier">tag</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">equiv</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">}</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">StateSetSet</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">=</span> <span class="PreProc">StateSet</span>.<span class="ocamlLCIdentifier">choose</span> <span class="ocamlLCIdentifier">s</span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">src</span> <span class="Statement">=</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier">tag</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L869" title="ocaml/lex/lexgen.ml:869">get_map</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="ocamlLCIdentifier">src</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">tgt</span> <span class="Statement">=</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier">tag</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L869" title="ocaml/lex/lexgen.ml:869">get_map</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="ocamlLCIdentifier">tgt</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">src</span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">tgt</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_new_addr</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">src</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Set</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">tgt</span><span class="Statement">::</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Copy</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">tgt</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">src</span><span class="Statement">)::</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end</span> <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L728" title="ocaml/lex/lexgen.ml:728">mem_key</a></span> <span class="Constant">[]</span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(* Moves are topologically sorted *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L887" title="ocaml/lex/lexgen.ml:887">sort_mvs</a></span> <span class="ocamlLCIdentifier">mvs<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L943">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_state</span></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">key</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">get_key</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">num</span> <span class="Statement">=</span> <span class="PreProc">StateMap</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier">key</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L741" title="ocaml/lex/lexgen.ml:741">state_map</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">num</span>,<span class="ocamlLCIdentifier"><a href="#L918" title="ocaml/lex/lexgen.ml:918">move_to</a></span> <span class="ocamlLCIdentifier">key</span>.<span class="ocamlLCIdentifier">kmem</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">(</span><span class="PreProc">Table</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L38" title="ocaml/lex/table.ml:38">get</a></span> <span class="ocamlLCIdentifier"><a href="#L747" title="ocaml/lex/lexgen.ml:747">state_table</a></span> <span class="ocamlLCIdentifier">num</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">with</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">num</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L743" title="ocaml/lex/lexgen.ml:743">next_state_num</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier"><a href="#L743" title="ocaml/lex/lexgen.ml:743">next_state_num</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span>,<span class="ocamlLCIdentifier">mvs</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L812" title="ocaml/lex/lexgen.ml:812">create_new_state</a></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Table</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L28" title="ocaml/lex/table.ml:28">emit</a></span> <span class="ocamlLCIdentifier"><a href="#L747" title="ocaml/lex/lexgen.ml:747">state_table</a></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L741" title="ocaml/lex/lexgen.ml:741">state_map</a></span> <span class="Statement">:=</span> <span class="PreProc">StateMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">key</span> <span class="ocamlLCIdentifier">num</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L741" title="ocaml/lex/lexgen.ml:741">state_map</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Stack</span>.<span class="ocamlLCIdentifier">push</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span>, <span class="ocamlLCIdentifier">num</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L742" title="ocaml/lex/lexgen.ml:742">todo</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">num</span>,<span class="ocamlLCIdentifier">mvs<br/></li>
<li></span><br/></li>
<li><a id="L957">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">map_on_all_states</span></span> <span class="ocamlLCIdentifier">f</span> <span class="ocamlLCIdentifier">old_res</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">res</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">old_res</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">try<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">while</span><span class="ocamlEnd"> </span><span class="Constant">true</span><span class="ocamlEnd"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span><span class="ocamlDo">, </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="PreProc">Stack</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">pop</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L742" title="ocaml/lex/lexgen.ml:742">todo</a></span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">f</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">res</span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="ocamlDo">, </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">::</span><span class="ocamlDo"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">res<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">done<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">with</span><span class="ocamlEnd"> </span><span class="PreProc">Stack</span><span class="ocamlEnd">.</span><span class="Constant">Empty</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; <span class="Statement">!</span><span class="ocamlLCIdentifier">res<br/></li>
<li></span><br/></li>
<li><a id="L969">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">goto_state</span></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">dfa_state_is_empty</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a><br/></li>
<li></span><span class="ocamlNone">&nbsp; </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Backtrack</span>,<span class="Constant">[]<br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">n</span>,<span class="ocamlLCIdentifier">moves</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L943" title="ocaml/lex/lexgen.ml:943">get_state</a></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Goto</span> <span class="ocamlLCIdentifier">n</span>,<span class="ocamlLCIdentifier">moves<br/></li>
<li></span><br/></li>
<li><span class="Comment">(****************************)<br/></li>
<li></span><span class="Comment">(* compute reachable <a href="#L1177" title="ocaml/lex/lexgen.ml:1177">states</a> *)<br/></li>
<li></span><span class="Comment">(****************************)<br/></li>
<li></span><br/></li>
<li><a id="L982">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_tags_to_map</span></span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Tags</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">=</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">remove</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">tag</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L830" title="ocaml/lex/lexgen.ml:830">alloc_new_addr</a></span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier">gen</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">apply_transition</span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="ocamlLCIdentifier">pri</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">ToAction</span> <span class="ocamlLCIdentifier">n</span>,<span class="ocamlLCIdentifier">tags</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">on</span>,<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L998" title="ocaml/lex/lexgen.ml:998">opri</a></span>,<span class="Statement">_)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier">final</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">on</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">on</span><span class="Statement">=</span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pri</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L998" title="ocaml/lex/lexgen.ml:998">opri</a></span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L982" title="ocaml/lex/lexgen.ml:982">add_tags_to_map</a></span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">final</span><span class="Statement">=</span><span class="ocamlLCIdentifier">n</span>,<span class="Statement">(</span><span class="ocamlLCIdentifier">pri</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span>&nbsp; <span class="Constant">OnChars</span> <span class="ocamlLCIdentifier">n</span>,<span class="ocamlLCIdentifier">tags</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">try<br/></li>
<li><a id="L998">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><span class="linkable">opri</span></span>,<span class="Statement">_)</span> <span class="Statement">=</span> <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier">others</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pri</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L998" title="ocaml/lex/lexgen.ml:998">opri</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li><a id="L1000">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">m</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L982" title="ocaml/lex/lexgen.ml:982">add_tags_to_map</a></span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier"><span class="linkable">m</span></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">others</span><span class="Statement">=</span><span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pri</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">remove</span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier">others</span><span class="Statement">)}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L1006">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">m</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L982" title="ocaml/lex/lexgen.ml:982">add_tags_to_map</a></span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier"><span class="linkable">m</span></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">others</span><span class="Statement">=</span><span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pri</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span>.<span class="ocamlLCIdentifier">others</span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* add transitions ts to new state <a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; transitions in ts start from state pri and <a href="compact.ml.html#L43" title="ocaml/lex/compact.ml:43">memory</a> map <a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a><br/></li>
<li></span><span class="Comment">*)<br/></li>
<li><a id="L1012">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">apply_transitions</span></span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="ocamlLCIdentifier">pri</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier">ts</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">TransSet</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">apply_transition</span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="ocamlLCIdentifier">pri</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">ts</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* For a given nfa_state pos, refine char partition *)<br/></li>
<li></span><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">split_env</span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier">s</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Comment">(* Can occur ! because of non-matching <a href="#L30" title="ocaml/lex/lexgen.ml:30">regexp</a> ([^'\000'-'\255']) *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">[]<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">s1</span>,<span class="ocamlLCIdentifier">st1</span><span class="Statement">)</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="main.ml.html#L97" title="ocaml/lex/main.ml:97">p</a></span><span class="Statement">::</span><span class="ocamlLCIdentifier">rem</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">here</span> <span class="Statement">=</span> <span class="PreProc">Cset</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L31" title="ocaml/lex/cset.mli:31">inter</a></span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier">s1</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Cset</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L22" title="ocaml/lex/cset.mli:22">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">here</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="main.ml.html#L97" title="ocaml/lex/main.ml:97">p</a></span><span class="Statement">::</span><span class="ocamlLCIdentifier">split_env</span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rest</span> <span class="Statement">=</span> <span class="PreProc">Cset</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L32" title="ocaml/lex/cset.mli:32">diff</a></span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier">here</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rem</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Cset</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L22" title="ocaml/lex/cset.mli:22">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">rest</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">split_env</span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier">rest</span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">new_st</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1012" title="ocaml/lex/lexgen.ml:1012">apply_transitions</a></span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier">st1</span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">stay</span> <span class="Statement">=</span> <span class="PreProc">Cset</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L32" title="ocaml/lex/cset.mli:32">diff</a></span> <span class="ocamlLCIdentifier">s1</span> <span class="ocamlLCIdentifier">here</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Cset</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L22" title="ocaml/lex/cset.mli:22">is_empty</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">stay</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">here</span>, <span class="ocamlLCIdentifier">new_st</span><span class="Statement">)::</span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">stay</span>, <span class="ocamlLCIdentifier">st1</span><span class="Statement">)::(</span><span class="ocamlLCIdentifier">here</span>, <span class="ocamlLCIdentifier">new_st</span><span class="Statement">)::</span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* For all nfa_state pos in a dfa state <a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a> *)<br/></li>
<li><a id="L1042">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">comp_shift</span></span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">MemMap</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">pos</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">split_env</span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">pos</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">pos</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">[</span><span class="PreProc">Cset</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L26" title="ocaml/lex/cset.mli:26">all_chars_eof</a></span>,<span class="ocamlLCIdentifier">dfa_state_empty</span><span class="Statement">]<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">reachs</span> <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">gen</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L828" title="ocaml/lex/lexgen.ml:828">create_new_addr_gen</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(* build an association list (char set -&gt; new state) *)<br/></li>
<li><a id="L1051">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">env</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1042" title="ocaml/lex/lexgen.ml:1042">comp_shift</a></span> <span class="ocamlLCIdentifier">gen</span> <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(* change it into (char set -&gt; new state_num) *)<br/></li>
<li><a id="L1053">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">env</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">s</span>,<span class="ocamlLCIdentifier">dfa_state</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">s</span>,<span class="ocamlLCIdentifier"><a href="#L969" title="ocaml/lex/lexgen.ml:969">goto_state</a></span> <span class="ocamlLCIdentifier">dfa_state</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(* finally build the char indexed array -&gt; new state num *)<br/></li>
<li><a id="L1057">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">shift</span></span> <span class="Statement">=</span> <span class="PreProc">Cset</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L34" title="ocaml/lex/cset.mli:34">env_to_array</a></span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L1057" title="ocaml/lex/lexgen.ml:1057">shift</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L1061">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_tag_mem</span></span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">find</span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;</span> <span class="Statement">assert</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L1067">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">do_tag_actions</span></span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">=<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">fold</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1061" title="ocaml/lex/lexgen.ml:1061">get_tag_mem</a></span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span>,<span class="Constant">SetTag</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">a</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)::</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">(</span><span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span>,<span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">_</span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">fold<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">tag</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">Ints</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mem</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">tag</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">start</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Ints</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span>, <span class="Constant">EraseTag</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">::</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1051" title="ocaml/lex/lexgen.ml:1051">env</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L813" title="ocaml/lex/lexgen.ml:813">used</a></span>,<span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L1084">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">translate_state</span></span> <span class="ocamlLCIdentifier">shortest_match</span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>,<span class="Statement">(_</span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">))</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span>.<span class="ocamlLCIdentifier">final</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">MemMap</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">others</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Perform</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>,<span class="ocamlLCIdentifier"><a href="#L1067" title="ocaml/lex/lexgen.ml:1067">do_tag_actions</a></span> <span class="ocamlLCIdentifier">n</span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">shortest_match</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">=</span><span class="ocamlLCIdentifier">no_action</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Constant">Shift</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">No_remember</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier">reachs</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">others</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Constant">Perform</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L1067" title="ocaml/lex/lexgen.ml:1067">do_tag_actions</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">tags</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Constant">Shift</span><span class="ocamlEnd"> </span><span class="Statement">(<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">no_action</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Constant">No_remember<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Constant">Remember</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd">,</span><span class="ocamlLCIdentifier"><a href="#L1067" title="ocaml/lex/lexgen.ml:1067">do_tag_actions</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">tags</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span><span class="Statement">))</span><span class="ocamlEnd">,<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">reachs</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L848" title="ocaml/lex/lexgen.ml:848">st</a></span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">others</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(*<br/></li>
<li></span><span class="Comment">let dtags chan tags =<br/></li>
<li></span><span class="Comment">&nbsp; Tags.<a href="table.ml.html#L49" title="ocaml/lex/table.ml:49">iter</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; (fun <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a> -&gt; fprintf chan &quot; %a&quot; dtag <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a>)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; tags<br/></li>
<li></span><br/></li>
<li><span class="Comment">let dtransset s =<br/></li>
<li></span><span class="Comment">&nbsp; TransSet.<a href="table.ml.html#L49" title="ocaml/lex/table.ml:49">iter</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; (fun <a href="compact.ml.html#L108" title="ocaml/lex/compact.ml:108">trans</a> -&gt; match <a href="compact.ml.html#L108" title="ocaml/lex/compact.ml:108">trans</a> with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; | OnChars i,tags -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; eprintf &quot; (-&gt; %d,%a)&quot; i dtags tags<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; | ToAction i,tags -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; eprintf &quot; ([%d],%a)&quot; i dtags tags)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; s<br/></li>
<li></span><br/></li>
<li><span class="Comment">let dfollow <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a> =<br/></li>
<li></span><span class="Comment">&nbsp; eprintf &quot;<a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a>=[&quot; ;<br/></li>
<li></span><span class="Comment">&nbsp; for i = 0 to Array.length <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a>-1 do<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; eprintf &quot;%d:&quot; i ;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; dtransset <a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a>.(i)<br/></li>
<li></span><span class="Comment">&nbsp; done ;<br/></li>
<li></span><span class="Comment">&nbsp; prerr_endline &quot;]&quot;<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L1127">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">make_tag_entry</span></span> <span class="ocamlLCIdentifier">id</span> <span class="ocamlLCIdentifier">start</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">a</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Sum</span> <span class="Statement">(</span><span class="Constant">Mem</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span>,<span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">{</span><span class="ocamlLCIdentifier">id</span><span class="Statement">=</span><span class="ocamlLCIdentifier">id</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">start</span><span class="Statement">=</span><span class="ocamlLCIdentifier">start</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier">action</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">}</span> <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span><br/></li>
<li><a id="L1132">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">extract_tags</span></span> <span class="ocamlLCIdentifier">l</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">envs</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">l</span><span class="Statement">)</span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L49" title="ocaml/lex/table.ml:49">iter</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span>,<span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span>,<span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">envs</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">)</span> <span class="Statement">&lt;-<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(fun</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">name</span>,<span class="Statement">_)</span>,<span class="ocamlLCIdentifier">v</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span> <span class="Statement">-&gt;</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Ident_char</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1127" title="ocaml/lex/lexgen.ml:1127">make_tag_entry</a></span> <span class="ocamlLCIdentifier">name</span> <span class="Constant">true</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier"><a href="cset.mli.html#L19" title="ocaml/lex/cset.mli:19">t</a></span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">Ident_string</span> <span class="Statement">(_</span>,<span class="ocamlLCIdentifier">t1</span>,<span class="ocamlLCIdentifier">t2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L1127" title="ocaml/lex/lexgen.ml:1127">make_tag_entry</a></span> <span class="ocamlLCIdentifier">name</span> <span class="Constant">true</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier">t1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1127" title="ocaml/lex/lexgen.ml:1127">make_tag_entry</a></span> <span class="ocamlLCIdentifier">name</span> <span class="Constant">false</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span> <span class="ocamlLCIdentifier">t2</span> <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/lex/lexgen.ml:416">r</a></span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L464" title="ocaml/lex/lexgen.ml:464">m</a></span> <span class="PreProc">TagMap</span>.<span class="ocamlLCIdentifier"><a href="cset.mli.html#L21" title="ocaml/lex/cset.mli:21">empty</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">l</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">envs<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="lexgen.mli.html#L58" title="ocaml/lex/lexgen.mli:58">make_dfa</a></span> <span class="ocamlLCIdentifier">lexdef</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span>, <span class="ocamlLCIdentifier">entry_list</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L502" title="ocaml/lex/lexgen.ml:502">encode_lexdef</a></span> <span class="ocamlLCIdentifier">lexdef</span> <span class="Statement">in<br/></li>
<li><a id="L1150">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">follow</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L588" title="ocaml/lex/lexgen.ml:588">followpos</a></span> <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">entry_list</span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; dfollow <a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a> ;<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L751" title="ocaml/lex/lexgen.ml:751">reset_state</a></span> <span class="Constant">()</span> <span class="Statement">;<br/></li>
<li><a id="L1155">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">r_states</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">[]</span> <span class="Statement">in<br/></li>
<li><a id="L1156">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">initial_states</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">le</span>,<span class="ocamlLCIdentifier">args</span>,<span class="ocamlLCIdentifier">shortest</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">tags</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L1132" title="ocaml/lex/lexgen.ml:1132">extract_tags</a></span> <span class="ocamlLCIdentifier">le</span>.<span class="ocamlLCIdentifier">lex_actions</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L764" title="ocaml/lex/lexgen.ml:764">reset_state_partial</a></span> <span class="ocamlLCIdentifier">le</span>.<span class="ocamlLCIdentifier">lex_mem_tags</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos_set</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">firstpos</span> <span class="ocamlLCIdentifier">le</span>.<span class="ocamlLCIdentifier">lex_regexp</span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; prerr_string &quot;<a href="compact.ml.html#L108" title="ocaml/lex/compact.ml:108">trans</a>={&quot; ; dtransset pos_set ; prerr_endline &quot;}&quot; ;<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">init_state</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">create_init_state</span> <span class="ocamlLCIdentifier">pos_set</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">init_num</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L943" title="ocaml/lex/lexgen.ml:943">get_state</a></span> <span class="ocamlLCIdentifier">init_state</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L1155" title="ocaml/lex/lexgen.ml:1155">r_states</a></span> <span class="Statement">:=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L957" title="ocaml/lex/lexgen.ml:957">map_on_all_states</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1084" title="ocaml/lex/lexgen.ml:1084">translate_state</a></span> <span class="ocamlLCIdentifier">shortest</span> <span class="ocamlLCIdentifier">tags</span> <span class="ocamlLCIdentifier"><a href="#L267" title="ocaml/lex/lexgen.ml:267">chars</a></span> <span class="ocamlLCIdentifier"><a href="#L1150" title="ocaml/lex/lexgen.ml:1150">follow</a></span><span class="Statement">)</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L1155" title="ocaml/lex/lexgen.ml:1155">r_states</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">auto_name</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">le</span>.<span class="ocamlLCIdentifier">lex_name</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">auto_args</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">args</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">auto_mem_size</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L745" title="ocaml/lex/lexgen.ml:745">temp_pending</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L744" title="ocaml/lex/lexgen.ml:744">next_mem_cell</a></span>+<span class="Constant">1</span> <span class="Statement">else</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L744" title="ocaml/lex/lexgen.ml:744">next_mem_cell</a></span><span class="Statement">)</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">auto_initial_state</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">init_num</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">auto_actions</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">le</span>.<span class="ocamlLCIdentifier">lex_actions</span> <span class="Statement">})<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">entry_list</span> <span class="Statement">in<br/></li>
<li><a id="L1177">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">states</span></span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L1155" title="ocaml/lex/lexgen.ml:1155">r_states</a></span> <span class="Statement">in<br/></li>
<li></span><span class="Comment">(*<br/></li>
<li></span><span class="Comment">&nbsp; prerr_endline &quot;** <a href="#L1177" title="ocaml/lex/lexgen.ml:1177">states</a> **&quot; ;<br/></li>
<li></span><span class="Comment">&nbsp; for i = 0 to !<a href="#L743" title="ocaml/lex/lexgen.ml:743">next_state_num</a>-1 do<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; eprintf &quot;+++ %d +++\n&quot; i ;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; dstate (Table.<a href="table.ml.html#L38" title="ocaml/lex/table.ml:38">get</a> <a href="#L747" title="ocaml/lex/lexgen.ml:747">state_table</a> i) ;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; prerr_endline &quot;&quot;<br/></li>
<li></span><span class="Comment">&nbsp; done ;<br/></li>
<li></span><span class="Comment">&nbsp; eprintf &quot;%d <a href="#L1177" title="ocaml/lex/lexgen.ml:1177">states</a>\n&quot; !<a href="#L743" title="ocaml/lex/lexgen.ml:743">next_state_num</a> ;<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li><a id="L1187">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">actions</span></span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L743" title="ocaml/lex/lexgen.ml:743">next_state_num</a></span> <span class="Statement">(</span><span class="Constant">Perform</span> <span class="Statement">(</span><span class="Constant">0</span>,<span class="Constant">[]</span><span class="Statement">))</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="table.ml.html#L49" title="ocaml/lex/table.ml:49">iter</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span>, <span class="ocamlLCIdentifier">i</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/lex/lexgen.ml:1187">actions</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span> <span class="Statement">&lt;-</span> <span class="ocamlLCIdentifier"><a href="compact.ml.html#L151" title="ocaml/lex/compact.ml:151">act</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L1177" title="ocaml/lex/lexgen.ml:1177">states</a></span><span class="Statement">;<br/></li>
<li></span><span class="Comment">(* Useless state reset, so as to restrict GC roots *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L751" title="ocaml/lex/lexgen.ml:751">reset_state</a></span>&nbsp; <span class="Constant">()</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L764" title="ocaml/lex/lexgen.ml:764">reset_state_partial</a></span>&nbsp; <span class="Constant">0</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L1156" title="ocaml/lex/lexgen.ml:1156">initial_states</a></span>, <span class="ocamlLCIdentifier"><a href="#L1187" title="ocaml/lex/lexgen.ml:1187">actions</a></span><span class="Statement">)<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
