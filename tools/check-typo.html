<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/tools/check-typo - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/tools/check-typo - ocaml</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L103">check_prune</a></li>
<li><a href="#L137">check_script</a></li>
<li><a href="#L265">err</a></li>
<li><a href="#L276">err_if</a></li>
<li><a href="#L95">get_attrs</a></li>
<li><a href="#L255">is_err</a></li>
<li><a href="#L284">more_columns</a></li>
<li><a href="#L259">report_err</a></li>
<li><a href="#L132">usage</a></li>
<li><a href="#L296">utf8_decode</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">#!/bin/sh<br/></li>
<li></span><br/></li>
<li><span class="Comment">#**************************************************************************<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Damien Doligez, projet Gallium, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp;&nbsp; Copyright 2012 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#**************************************************************************<br/></li>
<li></span><br/></li>
<li><span class="Comment"># check-typo - Check typographic conventions on OCaml sources.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># This program will check files for the following rules:<br/></li>
<li></span><br/></li>
<li><span class="Comment"># - absence of TAB characters (tab)<br/></li>
<li></span><span class="Comment"># - absence of non-ASCII characters (non-ascii)<br/></li>
<li></span><span class="Comment"># - absence of non-printing ASCII characters (non-printing)<br/></li>
<li></span><span class="Comment"># - absence of white space at end of line (white-at-eol)<br/></li>
<li></span><span class="Comment"># - absence of empty lines at end of file (white-at-eof)<br/></li>
<li></span><span class="Comment"># - presence of a LF character at the end of the file (missing-lf)<br/></li>
<li></span><span class="Comment"># - maximum line length of 80 characters (long-line)<br/></li>
<li></span><span class="Comment"># - maximum line length of 132 characters (very-long-line)<br/></li>
<li></span><span class="Comment"># - presence of a copyright header (missing-header)<br/></li>
<li></span><span class="Comment"># - absence of a leftover &quot;$Id&quot; string (svn-keyword)<br/></li>
<li></span><span class="Comment"># - formatting of version numbers in @since, @after and @before (doc-version)<br/></li>
<li></span><br/></li>
<li><span class="Comment"># Exceptions are handled with git attributes: &quot;typo.*&quot;.<br/></li>
<li></span><span class="Comment"># Its value for a given file is a comma-separated list of rule names,<br/></li>
<li></span><span class="Comment"># which lists the rules that should be disabled for this file.<br/></li>
<li></span><span class="Comment"># The rule names are the ones shown above in parentheses.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># Built-in exception:<br/></li>
<li></span><span class="Comment"># - Any file git identifies as binary<br/></li>
<li></span><span class="Comment">#&nbsp;&nbsp; is automatically exempt from all the rules.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># ASCII characters are bytes from 0 to 127.&nbsp; Any other byte is<br/></li>
<li></span><span class="Comment"># flagged as a non-ASCII character.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># For the purpose of this tool, printing ASCII characters are:<br/></li>
<li></span><span class="Comment"># - the non-white printable ASCII characters (33 to 126)<br/></li>
<li></span><span class="Comment"># - TAB (09)<br/></li>
<li></span><span class="Comment"># - LF (10)<br/></li>
<li></span><span class="Comment"># - SPC (32)<br/></li>
<li></span><span class="Comment"># Anything else is flagged as a non-printing ASCII character.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># This program will recursively explore the files and directories given<br/></li>
<li></span><span class="Comment"># on the command line (or by default the current directory), and check<br/></li>
<li></span><span class="Comment"># every file therein for compliance to the rules.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># Directories named .git (and their contents) are always ignored.<br/></li>
<li></span><span class="Comment"># This program ignores any file that is not under git control, unless<br/></li>
<li></span><span class="Comment"># explicitly given on the command line.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># If a directory has the git attribute &quot;typo.prune&quot; then it and its contents are<br/></li>
<li></span><span class="Comment"># ignored.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># You can ignore a rule by giving the option -&lt;rule&gt; on the command<br/></li>
<li></span><span class="Comment"># line (before any file names).<br/></li>
<li></span><br/></li>
<li><span class="Comment"># Files which include the utf8 rule will be validated using grep and line-length<br/></li>
<li></span><span class="Comment"># computations will take UTF-8 sequences into account. As a special case, UTF-8<br/></li>
<li></span><span class="Comment"># sequences are always allowed in the copyright headers.<br/></li>
<li></span><br/></li>
<li><span class="Comment"># First prevent i18n from messing up everything.<br/></li>
<li></span><span class="Statement">export</span><span class="Identifier"> LC_ALL=C<br/></li>
<li></span><br/></li>
<li><span class="Identifier">OCAML_CT_CAT</span><span class="shVarAssign">=</span><span class="PreProc">${OCAML_CT_CAT</span><span class="Statement">:-</span><span class="Error">cat</span><span class="PreProc">}<br/></li>
<li></span><span class="Identifier">OCAML_CT_LS_FILES</span><span class="shVarAssign">=</span><span class="PreProc">${OCAML_CT_LS_FILES</span><span class="Statement">:-</span><span class="Error">git ls-files</span><span class="PreProc">}<br/></li>
<li></span><span class="Identifier">OCAML_CT_HEAD</span><span class="shVarAssign">=</span><span class="PreProc">${OCAML_CT_HEAD</span><span class="Statement">:-</span><span class="Error">HEAD</span><span class="PreProc">}<br/></li>
<li></span><span class="Identifier">OCAML_CT_AWK</span><span class="shVarAssign">=</span><span class="PreProc">${OCAML_CT_AWK</span><span class="Statement">:-</span><span class="Error">awk</span><span class="PreProc">}<br/></li>
<li></span><span class="Statement">if [</span><span class="shExpr"> </span><span class="Statement">-z</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">${OCAML_CT_GIT_INDEX</span><span class="Statement">+</span><span class="Error">x</span><span class="PreProc">}</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]</span> <span class="Statement">;</span> <span class="Statement">then<br/></li>
<li></span>&nbsp; <span class="Identifier">OCAML_CT_GIT_INDEX</span><span class="shVarAssign">=<br/></li>
<li></span><span class="Statement">else<br/></li>
<li></span>&nbsp; <span class="Identifier">OCAML_CT_GIT_INDEX</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="Constant">GIT_INDEX_FILE=</span><span class="PreProc">$OCAML_CT_GIT_INDEX</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Statement">fi<br/></li>
<li></span><br/></li>
<li><span class="Comment"># The output of processing the attributes should be whitespace-separated with<br/></li>
<li></span><span class="Comment"># - the &quot;typo.&quot; prefix dropped<br/></li>
<li></span><span class="Comment"># - unset/false keys not present<br/></li>
<li></span><span class="Comment"># - set/true keys present<br/></li>
<li></span><span class="Comment"># - &quot;may&quot; keys present, suffixed by a question mark<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># for example,<br/></li>
<li></span><span class="Comment">#&nbsp;&nbsp; typo.long-line: set<br/></li>
<li></span><span class="Comment">#&nbsp;&nbsp; typo.missing-header: may<br/></li>
<li></span><span class="Comment">#&nbsp;&nbsp; typo.very-long-line: false<br/></li>
<li></span><span class="Comment"># should result in &quot;long-line missing-header?&quot;<br/></li>
<li><a id="L95">&#x200c;</a></span><span class="Identifier"><span class="linkable">get_attrs</span>() {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; env </span><span class="PreProc">$OCAML_CT_GIT_INDEX</span><span class="shFunctionOne"> git check-attr </span><span class="Special">--all</span><span class="shFunctionOne"> </span><span class="PreProc">$OCAML_CT_CA_FLAG</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shFunctionOne"> \<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">|</span><span class="shFunctionOne"> grep </span><span class="Special">-o</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="Constant"> typo</span><span class="Special">\\</span><span class="Constant">..*$</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">|</span><span class="shFunctionOne"> sed </span><span class="Statement">&quot;</span><span class="Constant">s/ typo</span><span class="Special">\\</span><span class="Constant">.//g</span><span class="Statement">&quot;</span><span class="shFunctionOne"> \<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">|</span><span class="shFunctionOne"> grep </span><span class="Special">-v</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="Constant">: unset</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">|</span><span class="shFunctionOne"> grep </span><span class="Special">-v</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="Constant">: false</span><span class="Statement">&quot;</span><span class="shFunctionOne"> \<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">|</span><span class="shFunctionOne"> sed </span><span class="Statement">&quot;</span><span class="Constant">s/: set//g</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">|</span><span class="shFunctionOne"> sed </span><span class="Statement">&quot;</span><span class="Constant">s/: true//g</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">|</span><span class="shFunctionOne"> sed </span><span class="Statement">&quot;</span><span class="Constant">s/: may/?/g</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><span class="Comment"># empty if the path is *not* pruned<br/></li>
<li><a id="L103">&#x200c;</a></span><span class="Identifier"><span class="linkable">check_prune</span>() {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; env </span><span class="PreProc">$OCAML_CT_GIT_INDEX</span><span class="shFunctionOne"> git check-attr typo.prune </span><span class="PreProc">$OCAML_CT_CA_FLAG</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shFunctionOne"> \<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">|</span><span class="shFunctionOne"> grep </span><span class="Special">-v</span><span class="shFunctionOne"> </span><span class="Statement">'</span><span class="Constant">: unspecified$</span><span class="Statement">'</span><span class="shFunctionOne"> </span><span class="Statement">|</span><span class="shFunctionOne"> grep </span><span class="Special">-v</span><span class="shFunctionOne"> </span><span class="Statement">'</span><span class="Constant">: false$</span><span class="Statement">'<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><span class="Comment"># Special case for recursive call from the find command (see IGNORE_DIRS).<br/></li>
<li></span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; --check-prune</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="PreProc">$2</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; .git</span><span class="Statement">|</span><span class="shCaseEsac">.git/*</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">INFO: pruned path </span><span class="PreProc">$2</span><span class="Constant"> (.git)</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">&gt;&amp;2<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shCase"> </span><span class="Constant">0</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="shCase">git check-ignore </span><span class="Statement">-q</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$2</span><span class="Statement">&quot;;</span><span class="shCase"> </span><span class="Statement">then<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shCase"> </span><span class="Constant">0<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">if test</span><span class="shCase"> </span><span class="Statement">-n</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="Error">$(</span><span class="Special"><a href="#L103" title="ocaml/tools/check-typo:103">check_prune</a> </span><span class="Statement">&quot;</span><span class="PreProc">$2</span><span class="Statement">&quot;</span><span class="Error">)</span><span class="Statement">&quot;;</span><span class="shCase"> </span><span class="Statement">then<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">INFO: pruned path </span><span class="PreProc">$2</span><span class="Constant"> (typo.prune)</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">&gt;&amp;</span><span class="Constant">2<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shCase"> </span><span class="Constant">0<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shCase"> </span><span class="Constant">3</span><span class="Statement">;;<br/></li>
<li></span><span class="Statement">esac<br/></li>
<li></span><br/></li>
<li><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; --get-attrs</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L95" title="ocaml/tools/check-typo:95">get_attrs</a> </span><span class="Statement">&quot;</span><span class="PreProc">$2</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shCase"> </span><span class="Constant">0</span><span class="Statement">;;<br/></li>
<li></span><span class="Statement">esac<br/></li>
<li></span><br/></li>
<li><a id="L132">&#x200c;</a><span class="Identifier"><span class="linkable">usage</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant"><a href="#L132" title="ocaml/tools/check-typo:132">usage</a>: check-typo {-&lt;rule&gt;} [--] {&lt;file-or-dir&gt;}</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">&gt;&amp;2<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">exit</span><span class="shFunctionOne"> </span><span class="Constant">2<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><a id="L137">&#x200c;</a><span class="Identifier"><span class="linkable">check_script</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">if [</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="Error">$(</span><span class="PreProc">$OCAML_CT_CAT</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="PreProc">$OCAML_CT_PREFIX$1</span><span class="Statement">&quot;</span><span class="Special"> \<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="Special"> sed -ne </span><span class="Statement">'</span><span class="Constant">1s/^#!.*/#!/p</span><span class="Statement">'</span><span class="Error">)</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">!=</span><span class="shExpr"> </span><span class="Statement">'</span><span class="Constant">#!</span><span class="Statement">'</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">;</span><span class="shFunctionOne"> </span><span class="Statement">then<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Comment"># These files are listed manually, rather than via gitattributes,<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Comment"># because the list should never expand, and it should not be trivial to<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Comment"># expand (the unix-execvpe test is an ultra-special-case!)<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">f</span><span class="shVarAssign">=</span><span class="PreProc">${1</span><span class="Error">#./</span><span class="PreProc">}<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Statement">if [</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">!=</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="Constant">boot/ocamlc</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">!=</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="Constant">boot/ocamllex</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> \<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">!=</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="Constant">testsuite/tests/lib-unix/unix-execvpe/subdir/script2</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">;</span><span class="shFunctionOne"> </span><span class="Statement">then<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Constant"> shouldn't be executable; either:</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant"> - Add a #! line</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant"> - Run chmod -x </span><span class="PreProc">$1</span><span class="Constant"> (on Unix)</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant"> - Run git update-index --chmod=-x </span><span class="PreProc">$1</span><span class="Constant"> (on Windows)</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">You may wish to check your core.fileMode setting</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; &nbsp; </span><span class="Identifier">EXIT_CODE</span><span class="shVarAssign">=</span><span class="Constant">1<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><span class="Identifier">userrules</span><span class="shVarAssign">=</span><span class="Statement">''<br/></li>
<li></span><br/></li>
<li><span class="Statement">while : ; do<br/></li>
<li></span>&nbsp; <span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; -help</span><span class="Statement">|</span><span class="shCaseEsac">--help</span><span class="Statement">)</span><span class="shCase"> <a href="#L132" title="ocaml/tools/check-typo:132">usage</a></span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; -*</span><span class="Statement">)</span><span class="shCase"> </span><span class="Identifier">userrules</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="PreProc">${1</span><span class="Error">#-</span><span class="PreProc">}</span><span class="Constant"> </span><span class="PreProc">$userrules</span><span class="Statement">&quot;;</span><span class="shCase"> </span><span class="Statement">shift;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; --</span><span class="Statement">)</span><span class="shCase"> </span><span class="Statement">shift;</span><span class="shCase"> </span><span class="Statement">break;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> </span><span class="Statement">break;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="Statement">done<br/></li>
<li></span><br/></li>
<li><span class="Identifier">IGNORE_DIRS</span><span class="shVarAssign">=</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Constant">&nbsp; -name .git -prune -o<br/></li>
<li></span><span class="Constant">&nbsp; -type d -exec </span><span class="PreProc">$0</span><span class="Constant"> --check-prune {} ; -prune -o<br/></li>
<li></span><span class="Statement">&quot;<br/></li>
<li></span><span class="Comment"># `-type d`: simple files (not directories) are not pruned during the<br/></li>
<li></span><span class="Comment"># &quot;find&quot; invocation but below (look for &quot;<a href="#L103" title="ocaml/tools/check-typo:103">check_prune</a>&quot;) for performance<br/></li>
<li></span><span class="Comment"># reasons: most files outside pruned directories are not pruned, so it<br/></li>
<li></span><span class="Comment"># is faster to optimistically <a href="ci/appveyor/appveyor_build.sh.html#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> check-typo on them (and maybe get<br/></li>
<li></span><span class="Comment"># out in the middle) than to first check then <a href="ci/appveyor/appveyor_build.sh.html#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a>.<br/></li>
<li></span><br/></li>
<li><span class="Identifier">TEST_AWK</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">BEGIN {if (&quot;a{1}&quot; ~ /a{1}$/) exit 1}</span><span class="Statement">'<br/></li>
<li></span><span class="Statement">if !</span> <span class="PreProc">$OCAML_CT_AWK</span> <span class="Statement">&quot;</span><span class="PreProc">$TEST_AWK</span><span class="Statement">&quot;</span> <span class="Statement">;</span> <span class="Statement">then<br/></li>
<li></span>&nbsp; <span class="Statement">if </span><span class="PreProc">$OCAML_CT_AWK</span> <span class="Special">--re-interval</span> <span class="Statement">&quot;</span><span class="PreProc">$TEST_AWK</span><span class="Statement">&quot;</span> <span class="Constant">2</span><span class="Statement">&gt;</span>/dev/null <span class="Statement">;</span> <span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="Identifier">OCAML_CT_AWK</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="PreProc">$OCAML_CT_AWK</span><span class="Constant"> --re-interval</span><span class="Statement">&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">This script requires interval support in regexes ({m} notation)</span><span class="Statement">&quot;&gt;&amp;</span><span class="Constant">2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">Please install a version of awk (e.g. gawk) which supports this</span><span class="Statement">&quot;&gt;&amp;</span><span class="Constant">2<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">exit</span> <span class="Constant">2<br/></li>
<li></span>&nbsp; <span class="Statement">fi<br/></li>
<li></span><span class="Statement">fi<br/></li>
<li></span><br/></li>
<li><span class="Identifier">EXIT_CODE</span><span class="shVarAssign">=</span><span class="Constant">0<br/></li>
<li></span><span class="PreProc">(</span><span class="Special"> </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="PreProc">$#</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; 0</span><span class="Statement">)</span><span class="shCase"> find</span><span class="Statement"> . </span><span class="PreProc">$IGNORE_DIRS</span><span class="shCase"> </span><span class="Special">-type</span><span class="shCase"> f </span><span class="Special">-print</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> </span><span class="Statement">for</span><span class="shFor"> i </span><span class="Statement">in</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$@</span><span class="Statement">&quot;;</span><span class="shCase"> </span><span class="Statement">do</span><span class="shCase"> find </span><span class="Statement">&quot;</span><span class="PreProc">$i</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$IGNORE_DIRS</span><span class="shCase"> </span><span class="Special">-type</span><span class="shCase"> f </span><span class="Special">-print</span><span class="Statement">;</span><span class="shCase"> </span><span class="Statement">done;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="PreProc">)</span> | <span class="PreProc">(<br/></li>
<li></span><span class="Special">&nbsp; while </span><span class="Statement">read</span><span class="Special"> f</span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">do<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">if test</span><span class="Special"> </span><span class="Statement">-n</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="Error">$(</span><span class="Special"><a href="#L103" title="ocaml/tools/check-typo:103">check_prune</a> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="Error">)</span><span class="Statement">&quot;;</span><span class="Special"> </span><span class="Statement">then</span><span class="Special"> </span><span class="Statement">continue;</span><span class="Special"> </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Error">$(</span><span class="Special">git check-ignore -q </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="Error">)</span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">then</span><span class="Special"> </span><span class="Statement">continue;</span><span class="Special"> </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Special">`</span><span class="PreProc">$OCAML_CT_LS_FILES</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="Special"> </span><span class="Constant">2</span><span class="Statement">&gt;&amp;1</span><span class="Special">`</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; </span><span class="Statement">&quot;&quot;)</span><span class="shCase"> </span><span class="Identifier">path_in_index</span><span class="shVarAssign">=</span><span class="shCase">false</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> </span><span class="Identifier">path_in_index</span><span class="shVarAssign">=</span><span class="shCase">true</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$*</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; *</span><span class="PreProc">$f</span><span class="shCaseEsac">*</span><span class="Statement">)</span><span class="shCase"> </span><span class="Identifier">is_cmd_line</span><span class="shVarAssign">=</span><span class="shCase">true</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> </span><span class="Identifier">is_cmd_line</span><span class="shVarAssign">=</span><span class="shCase">false</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="PreProc">$path_in_index</span><span class="Special"> </span><span class="Statement">||</span><span class="Special"> </span><span class="PreProc">$is_cmd_line</span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">then</span><span class="Special"> :</span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">else</span><span class="Special"> </span><span class="Statement">continue;</span><span class="Special"> </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">if [</span><span class="shExpr"> </span><span class="Statement">-z</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$OCAML_CT_PREFIX</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]</span><span class="Special"> </span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">then<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if [</span><span class="shExpr"> </span><span class="Statement">-x</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]</span><span class="Special"> </span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">then<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L137" title="ocaml/tools/check-typo:137">check_script</a> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">git ls-files </span><span class="Statement">-s</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="Special"> </span><span class="Statement">|</span><span class="Special"> grep </span><span class="Statement">-q</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="Constant">^100755</span><span class="Statement">&quot;</span><span class="Special"> </span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">then<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L137" title="ocaml/tools/check-typo:137">check_script</a> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Identifier">attr_rules</span><span class="shVarAssign">=</span><span class="Statement">''<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="PreProc">$path_in_index</span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">then<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># Below is a git plumbing command to detect whether git regards a<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># particular file as binary. This takes into account .gitattributes, but<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># also works if the file has been automatically detected as binary by git.<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># EMPTY is the hash of the empty tree (which is specially known to git -<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># it is automatically included in every repository) as a way to get<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># `diff-tree` to print the whole tree state; its `--numstat` output then<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># prints a summary where two dashes in the first two columns indicates a<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># binary file.<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment">#&nbsp;&nbsp; (See https://git-scm.com/docs/git-diff-tree#_other_diff_formats and<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment">#&nbsp; &nbsp; the documentation for the --numstat option. Commands designated as<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Comment">#&nbsp; &nbsp; &quot;plumbing&quot; commands in git have stable output intended for parsing)<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Identifier">EMPTY</span><span class="shVarAssign">=</span><span class="Special">`git hash-object -t tree /dev/null`<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; git diff-tree --numstat </span><span class="PreProc">$EMPTY</span><span class="Special"> </span><span class="PreProc">$OCAML_CT_HEAD</span><span class="Special"> </span><span class="Statement">--</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="Special"> \<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="Special"> grep </span><span class="Statement">-q</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="Constant">^-[[:blank:]]-</span><span class="Statement">&quot;</span><span class="Special"> </span><span class="Statement">&amp;&amp;</span><span class="Special"> </span><span class="Statement">continue<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Identifier">attr_rules</span><span class="shVarAssign">=</span><span class="Error">$(</span><span class="Special"><a href="#L95" title="ocaml/tools/check-typo:95">get_attrs</a> </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="Error">)<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Identifier">rules</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="PreProc">$userrules</span><span class="Statement">&quot;<br/></li>
<li></span><br/></li>
<li><span class="Special">&nbsp; &nbsp; </span><span class="Comment"># remove newlines, ensure spaces at boundary<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Identifier">rules</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Error">$(</span><span class="Statement">echo</span><span class="Constant"> </span><span class="PreProc">$rules</span><span class="Error">)</span><span class="Constant"> </span><span class="Statement">&quot;<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Identifier">attr_rules</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Error">$(</span><span class="Statement">echo</span><span class="Constant"> </span><span class="PreProc">$attr_rules</span><span class="Error">)</span><span class="Constant"> </span><span class="Statement">&quot;<br/></li>
<li></span><br/></li>
<li><span class="Special">&nbsp; &nbsp; </span><span class="Statement">if test</span><span class="Special"> </span><span class="Statement">-n</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="Error">$(</span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="PreProc">$rules</span><span class="Constant"> </span><span class="PreProc">$attr_rules</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">|</span><span class="Special"> grep </span><span class="Statement">&quot;</span><span class="Constant"> utf8 </span><span class="Statement">&quot;</span><span class="Error">)</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">then<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment"># grep -a is used to force the file to be considered as text and -x<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment"># requires the entire line to match. This specifically detects the<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment"># presence of lines containing malformed UTF-8. It may be tested using<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment"># https://www.cl.cam.ac.uk/~mgk25/ucs/examples/UTF-8-test.txt<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if </span><span class="PreProc">$OCAML_CT_CAT</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="PreProc">$OCAML_CT_PREFIX$f</span><span class="Statement">&quot;</span><span class="Special"> \<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="Special"> </span><span class="Identifier">LC_ALL</span><span class="shVarAssign">=</span><span class="Special">en_US.UTF8 grep -qaxv </span><span class="Statement">'</span><span class="Constant">.*</span><span class="Statement">'</span><span class="Special"> </span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">then<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">File </span><span class="Special">\&quot;</span><span class="PreProc">$f</span><span class="Special">\&quot;</span><span class="Constant"> is not correctly encoded in UTF-8</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="Special"> </span><span class="Constant">2<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">if !</span><span class="Special"> \<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="PreProc">($OCAML_CT_CAT</span><span class="shCmdParenRegion"> </span><span class="Statement">&quot;</span><span class="PreProc">$OCAML_CT_PREFIX$f</span><span class="Statement">&quot;</span><span class="shCmdParenRegion"> </span><span class="Statement">|</span><span class="shCmdParenRegion"> tr </span><span class="Special">-d</span><span class="shCmdParenRegion"> </span><span class="Statement">'</span><span class="Constant">\r</span><span class="Statement">';</span><span class="shCmdParenRegion"> </span><span class="Statement">echo</span><span class="PreProc">)</span><span class="Special"> \<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="Special"> </span><span class="PreProc">$OCAML_CT_AWK</span><span class="Special"> </span><span class="Statement">-v</span><span class="Special"> </span><span class="Identifier">rules</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="PreProc">$rules</span><span class="Statement">&quot;</span><span class="Special"> </span><span class="Statement">-v</span><span class="Special"> </span><span class="Identifier">attr_rules</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="PreProc">$attr_rules</span><span class="Statement">&quot;</span><span class="Special"> </span><span class="Statement">-v</span><span class="Special"> </span><span class="Identifier">file</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="Special"> \<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Statement">'<br/></li>
<li><a id="L255">&#x200c;</a></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; function <span class="linkable">is_err</span>(name) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ((rules attr_rules) !~ (&quot; &quot; name &quot;[\\? ]&quot;));<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><a id="L259">&#x200c;</a><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; function <span class="linkable">report_err</span>(name, msg) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printf (&quot;%s:%d.%d:&quot;, file, NR, RSTART + RLENGTH);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printf (&quot; [%s] %s\n&quot;, name, msg);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; got_errors = 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><a id="L265">&#x200c;</a><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; function <span class="linkable">err</span>(name, msg) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++ counts[name];<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (<a href="#L255" title="ocaml/tools/check-typo:255">is_err</a>(name) &amp;&amp; counts[name] &lt;= 10) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L259" title="ocaml/tools/check-typo:259">report_err</a>(name, msg);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (counts[name] == 10){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printf (&quot;WARNING: too many [%s] in this file.&quot;, name);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printf (&quot;&nbsp; Others will not be reported.\n&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><a id="L276">&#x200c;</a><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; function <span class="linkable">err_if</span>(guard, name, msg) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (<a href="#L255" title="ocaml/tools/check-typo:255">is_err</a>(guard)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(name, msg);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++ counts[name];<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><a id="L284">&#x200c;</a><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; function <span class="linkable">more_columns</span>(str, limit,&nbsp; &nbsp; &nbsp;&nbsp; c){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (i = 1; i &lt;= length(str); i++){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (substr(str, i, 1) == &quot;\t&quot;){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c = int((c + 8) / 8) * 8;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++ c;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return c &gt; limit;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><a id="L296">&#x200c;</a><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; function <span class="linkable">utf8_decode</span>(str) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (<a href="#L255" title="ocaml/tools/check-typo:255">is_err</a>(&quot;utf8&quot;)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return str;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # This script assumes that the UTF-8 has been externally validated<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t = str;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gsub(/[\300-\367][\200-\277]+/, &quot;?&quot;, t);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (t != str) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++ counts[&quot;utf8&quot;];<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return t;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; BEGIN { state = &quot;(first line)&quot;; in_recipe = 0; in_continuation = 0; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # Makefile recipe automaton<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # in_continuation == 1 if the line ends with a backslash<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # in_recipe is:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;&nbsp; 0 - not in a recipe<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;&nbsp; 1 - target line scanned, but not yet seen first recipe line<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;&nbsp; 2 - scanning recipe lines<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # Non-recipe line<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /^[^\t#] *[^# ]/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!in_continuation) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!match($0, /^(ifn?eq|else|endif)/)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in_recipe = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # target: or target:: line<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /^[^#]*[^:#]::?($|[^=])/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!in_continuation) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in_recipe = 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /^\t[^\t]+$/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (in_recipe == 0 \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || in_recipe == 1 &amp;&amp; in_continuation \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="#L255" title="ocaml/tools/check-typo:255">is_err</a>(&quot;makefile-whitespace&quot;)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;tab&quot;, &quot;TAB character(s)&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++ counts[&quot;makefile-whitespace&quot;];<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in_recipe = 2;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /.$/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in_continuation = (substr($0, length($0)) == &quot;\\&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /.\t/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;tab&quot;, &quot;TAB character(s)&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t = <a href="#L296" title="ocaml/tools/check-typo:296">utf8_decode</a>($0);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (<a href="#L284" title="ocaml/tools/check-typo:284">more_columns</a>(t, 80)){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RSTART=81;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RLENGTH = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L276" title="ocaml/tools/check-typo:276">err_if</a>(&quot;very-long-line&quot;, &quot;long-line&quot;, &quot;line is over 80 columns&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (<a href="#L284" title="ocaml/tools/check-typo:284">more_columns</a>(t, 132)){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RSTART=133;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RLENGTH = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;very-long-line&quot;, &quot;line is over 132 columns&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /[\200-\377]/) \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; state != &quot;authors&quot; &amp;&amp; state != &quot;copyright&quot; {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (<a href="#L255" title="ocaml/tools/check-typo:255">is_err</a>(&quot;utf8&quot;)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;non-ascii&quot;, &quot;non-ASCII character(s)&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (header_utf8 &amp;&amp; !<a href="#L255" title="ocaml/tools/check-typo:255">is_err</a>(&quot;non-ascii&quot;)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;non-ascii-utf8&quot;, \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;non-ASCII character(s) AND UTF-8 encountered&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++ counts[&quot;utf8&quot;];<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /@(since|after|before) +[0-9.]+/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (match($0, / [34]\.[0-9]([^0-9]|$)/)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;doc-version&quot;, &quot;version should be formatted M.mm (e.g. 4.08)&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (match($0, / [5-9][0-9]*\.0[0-9]/)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;doc-version&quot;, &quot;version should be formatted M.m (e.g. 5.0)&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (match($0, / [0-9]+\.[0-9]+\.0/)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;doc-version&quot;, &quot;version should not include .0 revision&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /[^\t\200-\377 -~]/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;non-printing&quot;, &quot;non-printing ASCII character(s)&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /[ \t]+$/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;white-at-eol&quot;, &quot;whitespace at end of line&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /\$Id(: .*)?\$/) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;svn-keyword&quot;, &quot;SVN keyword marker&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; $0 !~ /\t/ &amp;&amp; length($0) &gt; 80 {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t = <a href="#L296" title="ocaml/tools/check-typo:296">utf8_decode</a>($0);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub(/https?:[A-Za-z0-9._~:\/?#\[\]@!$&amp;\047()*+,;=%-]{73,}$/, &quot;&quot;, t);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (length(t) &gt; 80) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RSTART = 81;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RLENGTH = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L276" title="ocaml/tools/check-typo:276">err_if</a>(&quot;very-long-line&quot;, &quot;long-line&quot;, &quot;line is over 80 columns&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; $0 !~ /\t/ &amp;&amp; length($0) &gt; 132 {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RSTART = 133;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RLENGTH = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t = <a href="#L296" title="ocaml/tools/check-typo:296">utf8_decode</a>($0);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (length(t) &gt; 132) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;very-long-line&quot;, &quot;line is over 132 columns&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # Record that the header contained UTF-8 sequences<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; match($0, /[\300-\367][\200-\277]+/) \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (state == &quot;authors&quot; || state == &quot;copyright&quot;) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; header_utf8 = 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (counts[&quot;non-ascii&quot;] &gt; 0 &amp;&amp; <a href="#L255" title="ocaml/tools/check-typo:255">is_err</a>(&quot;non-ascii&quot;)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;non-ascii-utf8&quot;, \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;non-ASCII character(s) AND UTF-8 encountered&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # Header-recognition automaton. Read this from bottom to top.<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # Valid UTF-8 chars are recognised in copyright and authors<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # TODO: ensure all files are valid UTF-8 before awking them.<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # Note that this code also assumes that combining characters are NOT<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # used (i.e. that every Unicode code-point corresponds to exactly<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # one displayed character, i.e. no Camels and no including<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; # weird-and-wonderful ways of encoded accented letters).<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;close&quot; &amp;&amp; $0 ~ /\*{74}/ { state = &quot;OK&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;close&quot; { state = &quot;(last line)&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;blurb&quot; &amp;&amp; $0 ~ /\* {72}\*/ { state = &quot;close&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;blurb&quot; &amp;&amp; $0 ~ /\/LICENSE/ { state = &quot;(license path)&quot; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;blurb1&quot; &amp;&amp; $0 ~ /\*&nbsp;&nbsp; All rights reserved. .{47} \*/ \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { state = &quot;blurb&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;blurb1&quot; { state = &quot;(blurb line 1)&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;copyright&quot; &amp;&amp; $0 ~ /\* {72}\*/ { state = &quot;blurb1&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;copyright&quot; \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; $0 !~ /\*&nbsp;&nbsp; Copyright [0-9]{4}([\300-\367][\200-\277]+|.){54} \*/ \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; $0 !~ /\*&nbsp; &nbsp;&nbsp; ([\300-\367][\200-\277]+|.){66} \*/ \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { state = &quot;(copyright lines)&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;authors&quot; &amp;&amp; $0 ~ /\* {72}\*/ { state = &quot;copyright&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;authors&quot; \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; $0 !~ /\* ([\300-\367][\200-\277]+|.){70} \*/ \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { state = &quot;(authors)&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;blank2&quot; &amp;&amp; $0 ~ /\* {72}\*/ { state = &quot;authors&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;blank2&quot; { state = &quot;(blank line 2)&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;title&quot; &amp;&amp; $0 ~ /\* {33}OCaml {34}\*/ { state = &quot;blank2&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;title&quot; { state = &quot;(title line)&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;blank1&quot; &amp;&amp; $0 ~ /\* {72}\*/ { state = &quot;title&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;blank1&quot; { state = &quot;(blank line 1)&quot;; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; state == &quot;(first line)&quot; &amp;&amp; NR &lt; 4 &amp;&amp; $0 ~ /\*{74}/ { state = &quot;blank1&quot;; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prev_line = last_line;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last_line = $0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; END {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (match(last_line, /.+/)){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;missing-lf&quot;, &quot;missing linefeed at EOF&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prev_line = last_line;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++ NR;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; empty_file = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; empty_file = NR == 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!empty_file &amp;&amp; match(prev_line, /^$/)){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;white-at-eof&quot;, &quot;empty line(s) at EOF&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (state != &quot;OK&quot;){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (NR &gt;= 10){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NR = 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RSTART = 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RLENGTH = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L265" title="ocaml/tools/check-typo:265">err</a>(&quot;missing-header&quot;, sprintf(&quot;bad copyright header %s&quot;, state));<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; counts[&quot;missing-header&quot;] = 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; split(attr_rules, r, &quot;[? ]&quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (i in r){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name = r[i];<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (name != &quot;&quot; &amp;&amp; !counts[name]){<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NR = 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RSTART = 1;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RLENGTH = 0;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (attr_rules !~ (&quot; &quot; name &quot;\\? &quot;)) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L259" title="ocaml/tools/check-typo:259">report_err</a>(name,<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(&quot;attribute is unused&quot;, name));<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit got_errors;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; </span><span class="Statement">'</span><span class="Special"> </span><span class="Statement">;</span><span class="Special"> </span><span class="Statement">then<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">EXIT_CODE</span><span class="shVarAssign">=</span><span class="Constant">1<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Special">&nbsp; </span><span class="Statement">done<br/></li>
<li></span><span class="Special">&nbsp; </span><span class="Statement">exit</span><span class="Special"> </span><span class="PreProc">$EXIT_CODE<br/></li>
<li></span><span class="PreProc">)<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
