<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/tools/ci/appveyor/appveyor_build.sh - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>ocaml/tools/ci/appveyor/appveyor_build.sh - ocaml</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L29">run</a></li>
<li><a href="#L52">set_configuration</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">#!/usr/bin/env bash<br/></li>
<li></span><span class="Comment">#**************************************************************************<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Christophe Troestler&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp;&nbsp; Copyright 2015 Christophe Troestler&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment">#**************************************************************************<br/></li>
<li></span><br/></li>
<li><span class="Statement">set</span><span class="Identifier"> </span><span class="Special">-e<br/></li>
<li></span><br/></li>
<li><span class="Identifier">BUILD_PID</span><span class="shVarAssign">=</span><span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Comment"># This must correspond with the entry in appveyor.yml<br/></li>
<li></span><span class="Identifier">CACHE_DIRECTORY</span><span class="shVarAssign">=</span>/cygdrive/c/projects/cache<br/></li>
<li><br/></li>
<li><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="Statement">-z</span><span class="shDblBrace"> </span><span class="PreProc">$APPVEYOR_PULL_REQUEST_HEAD_COMMIT</span><span class="shDblBrace"> </span><span class="Special">]]</span> <span class="Statement">;</span> <span class="Statement">then<br/></li>
<li></span>&nbsp; <span class="Identifier">MAKE</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="Constant">make -j</span><span class="PreProc">$NUMBER_OF_PROCESSORS</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Statement">else<br/></li>
<li></span>&nbsp; <span class="Identifier">MAKE</span><span class="shVarAssign">=</span>make<br/></li>
<li><span class="Statement">fi<br/></li>
<li></span><br/></li>
<li><a id="L29">&#x200c;</a><span class="Identifier">function</span> <span class="Identifier"><span class="linkable">run</span> {<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$1</span><span class="shDblBrace"> </span><span class="Statement">=</span><span class="shDblBrace"> </span><span class="Constant">&quot;--show&quot;</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="shFunctionTwo"> </span><span class="Statement">;</span><span class="shFunctionTwo"> </span><span class="Statement">then</span><span class="shFunctionTwo"> </span><span class="Identifier">SHOW_CMD</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">true</span><span class="Statement">';</span><span class="shFunctionTwo"> </span><span class="Statement">shift;</span><span class="shFunctionTwo"> </span><span class="Statement">else</span><span class="shFunctionTwo"> </span><span class="Identifier">SHOW_CMD</span><span class="shVarAssign">=</span><span class="Statement">'';</span><span class="shFunctionTwo"> </span><span class="Statement">fi<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Identifier">NAME</span><span class="shVarAssign">=</span><span class="PreProc">$1<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">shift<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">-=-=- </span><span class="PreProc">$NAME</span><span class="Constant"> -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="Statement">-n</span><span class="shDblBrace"> </span><span class="PreProc">$SHOW_CMD</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="Statement">;</span><span class="shFunctionTwo"> </span><span class="Statement">then</span><span class="shFunctionTwo"> </span><span class="PreProc">(</span><span class="shCmdParenRegion">set </span><span class="Special">-x</span><span class="Statement">;</span><span class="shCmdParenRegion"> </span><span class="Statement">&quot;</span><span class="PreProc">$@</span><span class="Statement">&quot;</span><span class="PreProc">)</span><span class="Statement">;</span><span class="shFunctionTwo"> </span><span class="Statement">else</span><span class="shFunctionTwo"> </span><span class="Statement">&quot;</span><span class="PreProc">$@</span><span class="Statement">&quot;;</span><span class="shFunctionTwo"> </span><span class="Statement">fi<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Identifier">CODE</span><span class="shVarAssign">=</span><span class="PreProc">$?<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$CODE</span><span class="shDblBrace"> </span><span class="Statement">-ne</span><span class="shDblBrace"> </span><span class="Constant">0</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="shFunctionTwo"> </span><span class="Statement">;</span><span class="shFunctionTwo"> </span><span class="Statement">then<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">-=-=- </span><span class="PreProc">$NAME</span><span class="Constant"> failed! -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$BUILD_PID</span><span class="shDblBrace"> </span><span class="Statement">-ne</span><span class="shDblBrace"> </span><span class="Constant">0</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="shFunctionTwo"> </span><span class="Statement">;</span><span class="shFunctionTwo"> </span><span class="Statement">then<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">kill</span><span class="shFunctionTwo"> </span><span class="Special">-KILL</span><span class="shFunctionTwo"> </span><span class="PreProc">$BUILD_PID</span><span class="shFunctionTwo"> </span><span class="Constant">2</span><span class="Statement">&gt;</span><span class="shFunctionTwo">/dev/null<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">wait</span><span class="shFunctionTwo"> </span><span class="PreProc">$BUILD_PID</span><span class="shFunctionTwo"> </span><span class="Constant">2</span><span class="Statement">&gt;</span><span class="shFunctionTwo">/dev/null<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shFunctionTwo"> </span><span class="PreProc">$CODE<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">-=-=- End of </span><span class="PreProc">$NAME</span><span class="Constant"> -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><span class="Comment"># Function: <a href="#L52" title="ocaml/tools/ci/appveyor/appveyor_build.sh:52">set_configuration</a><br/></li>
<li></span><span class="Comment"># Takes 3 arguments<br/></li>
<li></span><span class="Comment"># $1:the Windows port. Recognized values: mingw, msvc and msvc64<br/></li>
<li></span><span class="Comment"># $2: the prefix to use to install<br/></li>
<li><a id="L52">&#x200c;</a></span><span class="Identifier">function</span> <span class="Identifier"><span class="linkable">set_configuration</span> {<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; cygwin*</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">dep</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--disable-dependency-generation</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">man</span><span class="shVarAssign">=</span><span class="Statement">''<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; mingw32</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">build</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--build=i686-pc-cygwin</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">host</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--host=i686-w64-mingw32</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">dep</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--disable-dependency-generation</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">man</span><span class="shVarAssign">=</span><span class="Statement">''<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; mingw64</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">build</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--build=i686-pc-cygwin</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">host</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--host=x86_64-w64-mingw32</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">dep</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--disable-dependency-generation</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">man</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--disable-stdlib-manpages</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; msvc32</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">build</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--build=i686-pc-cygwin</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">host</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--host=i686-pc-windows</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">dep</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--disable-dependency-generation</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">man</span><span class="shVarAssign">=</span><span class="Statement">''<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; msvc64</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">build</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--build=x86_64-pc-cygwin</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">host</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--host=x86_64-pc-windows</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment"># Explicitly test dependency generation on msvc64<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">dep</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">--enable-dependency-generation</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">man</span><span class="shVarAssign">=</span><span class="Statement">''<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><br/></li>
<li><span class="shFunctionTwo">&nbsp; &nbsp; </span><span class="Statement">mkdir</span><span class="shFunctionTwo"> </span><span class="Special">-p</span><span class="shFunctionTwo"> </span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; ./configure </span><span class="Special">--cache-file=</span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Constant">/config.cache-</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shFunctionTwo"> \<br/></li>
<li></span><span class="shFunctionTwo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">$dep</span><span class="shFunctionTwo"> </span><span class="PreProc">$build</span><span class="shFunctionTwo"> </span><span class="PreProc">$man</span><span class="shFunctionTwo"> </span><span class="PreProc">$host</span><span class="shFunctionTwo"> </span><span class="Special">--prefix=</span><span class="Statement">&quot;</span><span class="PreProc">$2</span><span class="Statement">&quot;</span><span class="shFunctionTwo"> </span><span class="Special">--enable-ocamltest</span><span class="shFunctionTwo"> </span><span class="Statement">||</span><span class="shFunctionTwo"> </span><span class="PreProc">(</span><span class="shCmdParenRegion"> \<br/></li>
<li></span><span class="shCmdParenRegion">&nbsp; &nbsp; &nbsp; </span><span class="Statement">rm</span><span class="shCmdParenRegion"> </span><span class="Special">-f</span><span class="shCmdParenRegion"> </span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Constant">/config.cache-</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCmdParenRegion"> </span><span class="Statement">;</span><span class="shCmdParenRegion"> \<br/></li>
<li></span><span class="shCmdParenRegion">&nbsp; &nbsp; &nbsp; ./configure </span><span class="Special">--cache-file=</span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Constant">/config.cache-</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCmdParenRegion"> \<br/></li>
<li></span><span class="shCmdParenRegion">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">$dep</span><span class="shCmdParenRegion"> </span><span class="PreProc">$build</span><span class="shCmdParenRegion"> </span><span class="PreProc">$man</span><span class="shCmdParenRegion"> </span><span class="PreProc">$host</span><span class="shCmdParenRegion"> </span><span class="Special">--prefix=</span><span class="Statement">&quot;</span><span class="PreProc">$2</span><span class="Statement">&quot;</span><span class="shCmdParenRegion"> </span><span class="Special">--enable-ocamltest</span><span class="shCmdParenRegion"> </span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">#&nbsp; &nbsp; FILE=$(pwd | cygpath -f - -m)/Makefile.config<br/></li>
<li></span><span class="Comment">#&nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> &quot;Content of $FILE&quot; cat Makefile.config<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><span class="Identifier">PARALLEL_URL</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">https://git.savannah.gnu.org/cgit/parallel.git/plain/src/parallel</span><span class="Statement">'<br/></li>
<li></span><span class="Identifier">APPVEYOR_BUILD_FOLDER</span><span class="shVarAssign">=</span><span class="PreProc">$(</span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="PreProc">$APPVEYOR_BUILD_FOLDER</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">|</span><span class="Special"> cygpath -f -</span><span class="PreProc">)<br/></li>
<li></span><span class="Identifier">FLEXDLLROOT</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="PreProc">$PROGRAMFILES</span><span class="Constant">/flexdll</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Identifier">OCAMLROOT</span><span class="shVarAssign">=</span><span class="PreProc">$(</span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="PreProc">$OCAMLROOT</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">|</span><span class="Special"> cygpath -f - -m</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$BOOTSTRAP_FLEXDLL</span><span class="shDblBrace"> </span><span class="Statement">=</span><span class="shDblBrace"> </span><span class="Constant">'false'</span><span class="shDblBrace"> </span><span class="Special">]]</span> <span class="Statement">;</span> <span class="Statement">then<br/></li>
<li></span>&nbsp; <span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; cygwin*</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Identifier">install_flexdll</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">false</span><span class="Statement">';;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; *</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">export</span><span class="Identifier"> PATH=</span><span class="Statement">&quot;</span><span class="PreProc">$FLEXDLLROOT</span><span class="Constant">:</span><span class="PreProc">$PATH</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Identifier">install_flexdll</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">true</span><span class="Statement">';;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="Statement">else<br/></li>
<li></span>&nbsp; <span class="Identifier">install_flexdll</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">false</span><span class="Statement">'<br/></li>
<li></span><span class="Statement">fi<br/></li>
<li></span><br/></li>
<li><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; install</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">mkdir</span><span class="shCase"> </span><span class="Special">-p</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">if [</span><span class="shExpr"> </span><span class="Statement">!</span><span class="shExpr"> </span><span class="Statement">-e</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Constant">/parallel-source</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shCase"> </span><span class="Statement">||</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$PARALLEL_URL</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">!=</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$(</span><span class="Special">cat </span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Constant">/parallel-source</span><span class="Statement">&quot;</span><span class="PreProc">)</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shCase"> </span><span class="Statement">;</span><span class="shCase"> </span><span class="Statement">then<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># Download latest version directly from the repo<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; curl </span><span class="Special">-Ls</span><span class="shCase"> </span><span class="PreProc">$PARALLEL_URL</span><span class="shCase"> </span><span class="Statement">-o</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Constant">/parallel</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="PreProc">$PARALLEL_URL</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">&gt;</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Constant">/parallel-source</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; cp </span><span class="Statement">&quot;</span><span class="PreProc">$CACHE_DIRECTORY</span><span class="Constant">/parallel</span><span class="Statement">&quot;</span><span class="shCase"> /usr/bin<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">chmod</span><span class="shCase"> </span><span class="Special">+x</span><span class="shCase"> /usr/bin/parallel<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; parallel </span><span class="Special">--version<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$install_flexdll</span><span class="shDblBrace"> </span><span class="Statement">=</span><span class="shDblBrace"> </span><span class="Constant">'true'</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="shCase"> </span><span class="Statement">;</span><span class="shCase"> </span><span class="Statement">then<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">mkdir</span><span class="shCase"> </span><span class="Statement">-p</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FLEXDLLROOT</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">cd</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$APPVEYOR_BUILD_FOLDER</span><span class="Constant">/../flexdll</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># The objects are always built from the sources<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">for</span><span class="shFor"> f </span><span class="Statement">in</span><span class="shCase"> flexdll.h flexlink.exe default*.manifest </span><span class="Statement">;</span><span class="shCase"> </span><span class="Statement">do<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; cp </span><span class="Statement">&quot;</span><span class="PreProc">$f</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FLEXDLLROOT</span><span class="Constant">/</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">done<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; msvc*</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">'</span><span class="Constant">eval $($APPVEYOR_BUILD_FOLDER/tools/msvs-promote-path)</span><span class="Statement">'</span><span class="Constant"> \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">&gt;&gt;</span><span class="shCase"> ~/.bash_profile<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; test</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Identifier">FULL_BUILD_PREFIX</span><span class="shVarAssign">=</span><span class="Statement">&quot;</span><span class="PreProc">$APPVEYOR_BUILD_FOLDER</span><span class="Constant">/../</span><span class="PreProc">$BUILD_PREFIX</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">'</span><span class="Constant">ocamlc.opt -version</span><span class="Statement">'</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Constant">/ocamlc.opt</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Special">-version<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$PORT</span><span class="shDblBrace"> </span><span class="Statement">=~</span><span class="shDblBrace"> </span><span class="Constant">mingw*</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="shCase"> </span><span class="Statement">;</span><span class="shCase"> </span><span class="Statement">then<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="Constant">Check runtime symbols</span><span class="Statement">&quot;</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Constant">/tools/check-symbol-names</span><span class="Statement">&quot;</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="shCase">-</span><span class="PreProc">$PORT</span><span class="shCase">/runtime/*.a \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="shCase">-</span><span class="PreProc">$PORT</span><span class="shCase">/otherlibs/*/lib*.a<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Comment"># The testsuite is too slow to <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> on AppVeyor in full. Run the dynlink<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Comment"># tests now (to include natdynlink)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="Constant">test dynlink </span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">$MAKE</span><span class="shCase"> </span><span class="Special">-C</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Constant">/testsuite</span><span class="Statement">&quot;</span><span class="shCase"> parallel-lib-dynlink<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Comment"># Now reconfigure ocamltest to <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> in bytecode-only mode<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">sed</span><span class="shCase"> </span><span class="Special">-i</span><span class="shCase"> </span><span class="Statement">'</span><span class="Constant">/native_/s/true/false/</span><span class="Statement">'</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Constant">/ocamltest/ocamltest_config.ml</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="PreProc">$MAKE</span><span class="shCase"> </span><span class="Special">-C</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Constant">/ocamltest</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Special">-j</span><span class="shCase"> all allopt<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Comment"># And <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> the entire testsuite, skipping all the native-code tests<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="Constant">test </span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; make </span><span class="Special">-C</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Constant">/testsuite</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Identifier">SHOW_TIMINGS</span><span class="shVarAssign">=</span><span class="Constant">1</span><span class="shCase"> all<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="Constant">install </span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> </span><span class="Special">-C</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCase"> install<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$PORT</span><span class="shDblBrace"> </span><span class="Statement">=</span><span class="shDblBrace"> </span><span class="Constant">'msvc64'</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="shCase"> </span><span class="Statement">;</span><span class="shCase"> </span><span class="Statement">then<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> check_all_arches</span><span class="Statement">&quot;</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">$MAKE</span><span class="shCase"> </span><span class="Statement">-C</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCase"> check_all_arches<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">cd</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$FULL_BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># Ensure that .gitignore is up-to-date - this will fail if any untracked<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># or altered files exist. We revert the change from the bootstrap (that<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># would have failed the build earlier if necessary)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; git checkout </span><span class="Statement">--</span><span class="shCase"> boot/ocamlc boot/ocamllex<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># Remove the FlexDLL sources placed earlier in the process<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">rm</span><span class="shCase"> </span><span class="Special">-rf</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="Constant">flexdll-</span><span class="PreProc">$FLEXDLL_VERSION</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Special">--show</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="Constant">Check tree is tracked</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">test</span><span class="shCase"> </span><span class="Statement">-z</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$(</span><span class="Special">git status --porcelain</span><span class="PreProc">)</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># check that the `distclean` target definitely cleans the tree<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> distclean</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> distclean<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># Check the working tree is clean<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Special">--show</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="Constant">Check tree is tracked</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">test</span><span class="shCase"> </span><span class="Statement">-z</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$(</span><span class="Special">git status --porcelain</span><span class="PreProc">)</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># Check that there are no ignored files<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Special">--show</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="Constant">Check tree is clean</span><span class="Statement">&quot;</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">test</span><span class="shCase"> </span><span class="Statement">-z</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$(</span><span class="Special">git ls-files --others -i --exclude-standard</span><span class="PreProc">)</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; *</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">cd</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$APPVEYOR_BUILD_FOLDER</span><span class="Constant">/../</span><span class="PreProc">$BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Statement">&quot;<br/></li>
<li></span><br/></li>
<li><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$PORT</span><span class="shDblBrace"> </span><span class="Statement">=</span><span class="shDblBrace"> </span><span class="Constant">'msvc64'</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="shCase"> </span><span class="Statement">;</span><span class="shCase"> </span><span class="Statement">then<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Comment"># Ensure that make distclean can be <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> from an empty tree<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> distclean</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> distclean<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><br/></li>
<li><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">if </span><span class="Special">[[</span><span class="shDblBrace"> </span><span class="PreProc">$install_flexdll</span><span class="shDblBrace"> </span><span class="Statement">=</span><span class="shDblBrace"> </span><span class="Constant">'true'</span><span class="shDblBrace"> </span><span class="Special">]]</span><span class="shCase"> </span><span class="Statement">;</span><span class="shCase"> </span><span class="Statement">then<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; tar </span><span class="Special">-xzf</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$APPVEYOR_BUILD_FOLDER</span><span class="Constant">/flexdll.tar.gz</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">cd</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="Constant">flexdll-</span><span class="PreProc">$FLEXDLL_VERSION</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">$MAKE</span><span class="shCase"> </span><span class="Identifier">MSVC_DETECT</span><span class="shVarAssign">=</span><span class="Constant">0</span><span class="shCase"> </span><span class="Identifier">CHAINS</span><span class="shVarAssign">=</span><span class="PreProc">${PORT</span><span class="Statement">%</span><span class="shDerefPattern">32</span><span class="PreProc">}</span><span class="shCase"> support<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; cp </span><span class="Statement">-f</span><span class="shCase"> *.obj </span><span class="Statement">&quot;</span><span class="PreProc">$FLEXDLLROOT</span><span class="Constant">/</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Constant">2</span><span class="Statement">&gt;</span><span class="shCase">/dev/null </span><span class="Statement">||</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; cp </span><span class="Statement">-f</span><span class="shCase"> *.o </span><span class="Statement">&quot;</span><span class="PreProc">$FLEXDLLROOT</span><span class="Constant">/</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">cd</span><span class="shCase"> ..<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">fi<br/></li>
<li></span><br/></li>
<li><span class="shCase">&nbsp; &nbsp; <a href="#L52" title="ocaml/tools/ci/appveyor/appveyor_build.sh:52">set_configuration</a> </span><span class="Statement">&quot;</span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$OCAMLROOT</span><span class="Statement">&quot;<br/></li>
<li></span><br/></li>
<li><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">export</span><span class="Identifier"> TERM=</span><span class="shCase">ansi<br/></li>
<li></span><br/></li>
<li><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$BUILD_MODE</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; world.opt</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">set</span><span class="Identifier"> </span><span class="Special">-o</span><span class="Identifier"> pipefail<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment"># For an explanation of the sed command, see<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment"># https://github.com/appveyor/ci/issues/1824<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; script </span><span class="Special">--quiet</span><span class="shCase"> </span><span class="Special">--return</span><span class="shCase"> </span><span class="Special">--command</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> -C ../</span><span class="PreProc">$BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Constant"> world.opt</span><span class="Statement">&quot;</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">&quot;</span><span class="Constant">../</span><span class="PreProc">$BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Constant">/build.log</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">|<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">sed</span><span class="shCase"> </span><span class="Special">-e</span><span class="shCase"> </span><span class="Statement">'</span><span class="Constant">s/\d027\[K//g</span><span class="Statement">'</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">-e</span><span class="shCase"> </span><span class="Statement">'</span><span class="Constant">s/\d027\[m/\d027[0m/g</span><span class="Statement">'</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">-e</span><span class="shCase"> </span><span class="Statement">'</span><span class="Constant">s/\d027\[01\([m;]\)/\d027[1\1/g</span><span class="Statement">'<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">rm</span><span class="shCase"> </span><span class="Special">-f</span><span class="shCase"> build.log</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; steps</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="Constant">C deps: runtime</span><span class="Statement">&quot;</span><span class="shCase"> make </span><span class="Special">-j</span><span class="shCase">64 </span><span class="Special">-C</span><span class="shCase"> runtime setup-depend<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="Constant">C deps: win32unix</span><span class="Statement">&quot;</span><span class="shCase"> make </span><span class="Special">-j</span><span class="shCase">64 </span><span class="Special">-C</span><span class="shCase"> otherlibs/win32unix setup-depend<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> world</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> world<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> bootstrap</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> bootstrap<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> opt</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> opt<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> opt.opt</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> opt.opt</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; C</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> world</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> world<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> runtimeopt</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="PreProc">$MAKE</span><span class="shCase"> runtimeopt<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; <a href="#L29" title="ocaml/tools/ci/appveyor/appveyor_build.sh:29">run</a> </span><span class="Statement">&quot;</span><span class="PreProc">$MAKE</span><span class="Constant"> -C otherlibs/systhreads libthreadsnat.lib</span><span class="Statement">&quot;</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">$MAKE</span><span class="shCase"> </span><span class="Special">-C</span><span class="shCase"> otherlibs/systhreads libthreadsnat.lib</span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; *</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">Unrecognised build: </span><span class="PreProc">$BUILD_MODE</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shCase"> </span><span class="Constant">1<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><br/></li>
<li><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">echo</span><span class="Constant"> DLL base addresses<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; *32</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">ARG</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">-4</span><span class="Statement">';;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; *64</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">ARG</span><span class="shVarAssign">=</span><span class="Statement">'</span><span class="Constant">-8</span><span class="Statement">';;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">find</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="Constant">../</span><span class="PreProc">$BUILD_PREFIX</span><span class="Constant">-</span><span class="PreProc">$PORT</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Special">-type</span><span class="shCase"> f </span><span class="Special">\(</span><span class="shCase"> </span><span class="Special">-name</span><span class="shCase"> </span><span class="Special">\*</span><span class="shCase">.dll </span><span class="Special">-o</span><span class="shCase"> </span><span class="Special">-name</span><span class="shCase"> </span><span class="Special">\*</span><span class="shCase">.so </span><span class="Special">\)</span><span class="shCase"> </span><span class="Statement">|</span><span class="shCase"> \<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; xargs rebase </span><span class="Special">-i</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$ARG</span><span class="Statement">&quot;<br/></li>
<li></span><br/></li>
<li><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="Statement">esac<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
