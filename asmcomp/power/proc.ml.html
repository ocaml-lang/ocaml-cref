<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/asmcomp/power/proc.ml - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>ocaml/asmcomp/power/proc.ml - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L85">all_phys_regs</a></li>
<li><a href="#L352">assemble_file</a></li>
<li><a href="#L142">calling_conventions</a></li>
<li><a href="#L303">destroyed_at_c_call</a></li>
<li><a href="#L308">destroyed_at_oper</a></li>
<li><a href="#L314">destroyed_at_raise</a></li>
<li><a href="#L316">destroyed_at_reloadretaddr</a></li>
<li><a href="#L293">dwarf_register_numbers</a></li>
<li><a href="#L207">external_calling_conventions</a></li>
<li><a href="#L68">first_available_register</a></li>
<li><a href="#L212">float</a></li>
<li><a href="#L286">float_dwarf_reg_numbers</a></li>
<li><a href="#L53">float_reg_name</a></li>
<li><a href="#L336">frame_required</a></li>
<li><a href="#L81">hard_float_reg</a></li>
<li><a href="#L77">hard_int_reg</a></li>
<li><a href="#L157">incoming</a></li>
<li><a href="#L357">init</a></li>
<li><a href="#L211">int</a></li>
<li><a href="#L280">int_dwarf_reg_numbers</a></li>
<li><a href="#L48">int_reg_name</a></li>
<li><a href="#L105">l</a></li>
<li><a href="#L120">l</a></li>
<li><a href="#L169">loc_arguments</a></li>
<li><a href="#L262">loc_exn_bucket</a></li>
<li><a href="#L233">loc_external_arguments</a></li>
<li><a href="#L109">loc_float</a></li>
<li><a href="#L98">loc_int</a></li>
<li><a href="#L124">loc_int_pair</a></li>
<li><a href="#L172">loc_parameters</a></li>
<li><a href="#L177">loc_results</a></li>
<li><a href="#L167">max_arguments_for_tailcalls</a></li>
<li><a href="#L324">max_register_pressure</a></li>
<li><a href="#L165">not_supported</a></li>
<li><a href="#L66">num_available_registers</a></li>
<li><a href="#L59">num_register_classes</a></li>
<li><a href="#L213">ofs</a></li>
<li><a href="#L161">outgoing</a></li>
<li><a href="#L88">phys_reg</a></li>
<li><a href="#L347">prologue_required</a></li>
<li><a href="#L61">register_class</a></li>
<li><a href="#L70">register_name</a></li>
<li><a href="#L73">rotate_registers</a></li>
<li><a href="#L320">safe_register_pressure</a></li>
<li><a href="#L96">size_domainstate_args</a></li>
<li><a href="#L136">stack_lower</a></li>
<li><a href="#L299">stack_ptr_dwarf_register_number</a></li>
<li><a href="#L91">stack_slot</a></li>
<li><a href="#L137">stack_upper</a></li>
<li><a href="#L27">word_addressed</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="PreProc">#</span> <span class="Constant">2</span> <span class="Constant">&quot;asmcomp/power/proc.ml&quot;<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; All rights reserved.&nbsp; This <a href="../x86_dsl.ml.html#L97" title="ocaml/asmcomp/x86_dsl.ml:97">file</a> is distributed under the terms of&nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; special exception on linking described in the <a href="../x86_dsl.ml.html#L97" title="ocaml/asmcomp/x86_dsl.ml:97">file</a> LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Description of the Power PC *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Misc<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Cmm<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Reg<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Arch<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Mach<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Instruction selection *)<br/></li>
<li></span><br/></li>
<li><a id="L27">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">word_addressed</span></span> <span class="Statement">=</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Registers available for register allocation *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Integer register map:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; temporary, null register for some operations<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; stack pointer<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; pointer to table of contents<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 3 - 10&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function arguments and results<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 11 - 12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; temporaries<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 13&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pointer to small <a href="../emit.mli.html#L19" title="ocaml/asmcomp/emit.mli:19">data</a> area<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 14 - 28&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; general purpose, preserved by C<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 29&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trap pointer<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 30&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; domain <a href="../cmm_invariants.ml.html#L55" title="ocaml/asmcomp/cmm_invariants.ml:55">state</a> pointer<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 31&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; allocation pointer<br/></li>
<li></span><span class="Comment">&nbsp; Floating-point register map:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; temporary<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 1 - 13&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function arguments and results<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; 14 - 31&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; general purpose, preserved by C<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L48">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">int_reg_name</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">[|</span> <span class="Constant">&quot;3&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;4&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;5&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;6&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;7&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;8&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;9&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;10&quot;</span><span class="Statement">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* 0 - 7 *)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">&quot;14&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;15&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;16&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;17&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;18&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;19&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;20&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;21&quot;</span><span class="Statement">;</span>&nbsp; &nbsp; <span class="Comment">(* 8 - 15 *)<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">&quot;22&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;23&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;24&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;25&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;26&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;27&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;28&quot;</span> <span class="Statement">|]</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* 16 - 22 *)<br/></li>
<li></span><br/></li>
<li><a id="L53">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">float_reg_name</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">[|</span> <span class="Constant">&quot;1&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;2&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;3&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;4&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;5&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;6&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;7&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;8&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">&quot;9&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;10&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;11&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;12&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;13&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;14&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;15&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;16&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">&quot;17&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;18&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;19&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;20&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;21&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;22&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;23&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;24&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">&quot;25&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;26&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;27&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;28&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;29&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;30&quot;</span><span class="Statement">;</span> <span class="Constant">&quot;31&quot;</span> <span class="Statement">|]<br/></li>
<li></span><br/></li>
<li><a id="L59">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">num_register_classes</span></span> <span class="Statement">=</span> <span class="Constant">2<br/></li>
<li></span><br/></li>
<li><a id="L61">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">register_class</span></span> <span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span>.<span class="ocamlLCIdentifier">typ</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Val</span> <span class="Statement">|</span> <span class="Constant">Int</span> <span class="Statement">|</span> <span class="Constant">Addr</span> <span class="Statement">-&gt;</span> <span class="Constant">0<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Float</span> <span class="Statement">-&gt;</span> <span class="Constant">1<br/></li>
<li></span><br/></li>
<li><a id="L66">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">num_available_registers</span></span> <span class="Statement">=</span> <span class="Statement">[|</span> <span class="Constant">23</span><span class="Statement">;</span> <span class="Constant">31</span> <span class="Statement">|]<br/></li>
<li></span><br/></li>
<li><a id="L68">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">first_available_register</span></span> <span class="Statement">=</span> <span class="Statement">[|</span> <span class="Constant">0</span><span class="Statement">;</span> <span class="Constant">100</span> <span class="Statement">|]<br/></li>
<li></span><br/></li>
<li><a id="L70">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">register_name</span></span> <span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">100</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L48" title="ocaml/asmcomp/power/proc.ml:48">int_reg_name</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span><span class="Statement">)</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L53" title="ocaml/asmcomp/power/proc.ml:53">float_reg_name</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span> - <span class="Constant">100</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L73">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">rotate_registers</span></span> <span class="Statement">=</span> <span class="Constant">true<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Representation of hard registers by pseudo-registers *)<br/></li>
<li></span><br/></li>
<li><a id="L77">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">hard_int_reg</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="Constant">23</span> <span class="PreProc">Reg</span>.<span class="ocamlLCIdentifier"><a href="../reg.ml.html#L63" title="ocaml/asmcomp/reg.ml:63">dummy</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span> <span class="Constant">21</span> <span class="Statement">do</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">v</span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">&lt;-</span><span class="ocamlDo"> </span><span class="PreProc">Reg</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier"><a href="../reg.ml.html#L113" title="ocaml/asmcomp/reg.ml:113">at_location</a></span><span class="ocamlDo"> </span><span class="Constant">Int</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="Constant">Reg</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">done;</span> <span class="ocamlLCIdentifier">v<br/></li>
<li></span><br/></li>
<li><a id="L81">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">hard_float_reg</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">v</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="Constant">31</span> <span class="PreProc">Reg</span>.<span class="ocamlLCIdentifier"><a href="../reg.ml.html#L63" title="ocaml/asmcomp/reg.ml:63">dummy</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span> <span class="Constant">30</span> <span class="Statement">do</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">v</span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">&lt;-</span><span class="ocamlDo"> </span><span class="PreProc">Reg</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier"><a href="../reg.ml.html#L113" title="ocaml/asmcomp/reg.ml:113">at_location</a></span><span class="ocamlDo"> </span><span class="Constant">Float</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="Constant">Reg</span><span class="Statement">(</span><span class="Constant">100</span><span class="ocamlDo"> + </span><span class="ocamlLCIdentifier">i</span><span class="Statement">))</span><span class="ocamlDo"> </span><span class="Statement">done;</span> <span class="ocamlLCIdentifier">v<br/></li>
<li></span><br/></li>
<li><a id="L85">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">all_phys_regs</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier"><a href="../deadcode.ml.html#L29" title="ocaml/asmcomp/deadcode.ml:29">append</a></span> <span class="ocamlLCIdentifier"><a href="#L77" title="ocaml/asmcomp/power/proc.ml:77">hard_int_reg</a></span> <span class="ocamlLCIdentifier"><a href="#L81" title="ocaml/asmcomp/power/proc.ml:81">hard_float_reg</a><br/></li>
<li></span><br/></li>
<li><a id="L88">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">phys_reg</span></span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">100</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L77" title="ocaml/asmcomp/power/proc.ml:77">hard_int_reg</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L81" title="ocaml/asmcomp/power/proc.ml:81">hard_float_reg</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">n</span> - <span class="Constant">100</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L91">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">stack_slot</span></span> <span class="ocamlLCIdentifier">slot</span> <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L692" title="ocaml/asmcomp/selectgen.ml:692">ty</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Reg</span>.<span class="ocamlLCIdentifier"><a href="../reg.ml.html#L113" title="ocaml/asmcomp/reg.ml:113">at_location</a></span> <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L692" title="ocaml/asmcomp/selectgen.ml:692">ty</a></span> <span class="Statement">(</span><span class="Constant">Stack</span> <span class="ocamlLCIdentifier">slot</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Calling conventions *)<br/></li>
<li></span><br/></li>
<li><a id="L96">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">size_domainstate_args</span></span> <span class="Statement">=</span> <span class="Constant">64</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="arch.mli.html#L56" title="ocaml/asmcomp/power/arch.mli:56">size_int</a><br/></li>
<li></span><br/></li>
<li><a id="L98">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_int</span></span> <span class="ocamlLCIdentifier">last_int</span> <span class="ocamlLCIdentifier">make_stack</span> <span class="ocamlLCIdentifier">reg_use_stack</span> <span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">last_int</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L105" title="ocaml/asmcomp/power/proc.ml:105">l</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/asmcomp/power/proc.ml:88">phys_reg</a></span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">incr</span><span class="ocamlEnd"> </span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">reg_use_stack</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> + </span><span class="ocamlLCIdentifier"><a href="arch.mli.html#L56" title="ocaml/asmcomp/power/arch.mli:56">size_int</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L105" title="ocaml/asmcomp/power/proc.ml:105">l</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li><a id="L105">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">l</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/asmcomp/power/proc.ml:91">stack_slot</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">make_stack</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Constant">Int</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> + </span><span class="ocamlLCIdentifier"><a href="arch.mli.html#L56" title="ocaml/asmcomp/power/arch.mli:56">size_int</a></span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L105" title="ocaml/asmcomp/power/proc.ml:105">l</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><a id="L109">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_float</span></span> <span class="ocamlLCIdentifier">last_float</span> <span class="ocamlLCIdentifier">make_stack</span> <span class="ocamlLCIdentifier">reg_use_stack</span> <span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="Type"><a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a></span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="Type"><a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">last_float</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L105" title="ocaml/asmcomp/power/proc.ml:105">l</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/asmcomp/power/proc.ml:88">phys_reg</a></span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="Type"><a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">incr</span><span class="ocamlEnd"> </span><span class="Type"><a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Comment">(* On 64-bit platforms, passing <a href="../amd64/selection.ml.html#L43" title="ocaml/asmcomp/amd64/selection.ml:43">a</a> <a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a> in <a href="../amd64/selection.ml.html#L43" title="ocaml/asmcomp/amd64/selection.ml:43">a</a> <a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a> register<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; reserves <a href="../amd64/selection.ml.html#L43" title="ocaml/asmcomp/amd64/selection.ml:43">a</a> normal register as well *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="arch.mli.html#L56" title="ocaml/asmcomp/power/arch.mli:56">size_int</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">8</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">incr</span><span class="ocamlEnd"> </span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">reg_use_stack</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> + </span><span class="ocamlLCIdentifier"><a href="arch.mli.html#L58" title="ocaml/asmcomp/power/arch.mli:58">size_float</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L105" title="ocaml/asmcomp/power/proc.ml:105">l</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="PreProc">Misc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L84" title="ocaml/asmcomp/x86_dsl.ml:84">align</a></span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="arch.mli.html#L58" title="ocaml/asmcomp/power/arch.mli:58">size_float</a></span><span class="Statement">;<br/></li>
<li><a id="L120">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">l</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/asmcomp/power/proc.ml:91">stack_slot</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">make_stack</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Constant">Float</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> + </span><span class="ocamlLCIdentifier"><a href="arch.mli.html#L58" title="ocaml/asmcomp/power/arch.mli:58">size_float</a></span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L105" title="ocaml/asmcomp/power/proc.ml:105">l</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><a id="L124">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_int_pair</span></span> <span class="ocamlLCIdentifier">last_int</span> <span class="ocamlLCIdentifier">make_stack</span> <span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* 64-bit quantities split <a href="../liveness.ml.html#L44" title="ocaml/asmcomp/liveness.ml:44">across</a> two registers must either be in <a href="../amd64/selection.ml.html#L43" title="ocaml/asmcomp/amd64/selection.ml:43">a</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; consecutive pair of registers where the lowest numbered is an<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; even-numbered register; or in <a href="../amd64/selection.ml.html#L43" title="ocaml/asmcomp/amd64/selection.ml:43">a</a> stack slot that is 8-<a href="../x86_dsl.ml.html#L85" title="ocaml/asmcomp/x86_dsl.ml:85">byte</a> aligned. *)<br/></li>
<li></span>&nbsp; <span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="Statement">:=</span> <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L84" title="ocaml/asmcomp/x86_dsl.ml:84">align</a></span> <span class="Statement">!</span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="Constant">2</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">last_int</span><span class="ocamlNone"> - </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reg_lower</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/asmcomp/power/proc.ml:88">phys_reg</a></span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reg_upper</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/asmcomp/power/proc.ml:88">phys_reg</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">1</span><span class="ocamlEnd"> + </span><span class="Statement">!</span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlEnd"> + </span><span class="Constant">2</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">[|</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reg_lower</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reg_upper</span><span class="ocamlEnd"> </span><span class="Statement">|]<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="PreProc">Misc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L84" title="ocaml/asmcomp/x86_dsl.ml:84">align</a></span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="Constant">8</span><span class="Statement">;<br/></li>
<li><a id="L136">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">stack_lower</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/asmcomp/power/proc.ml:91">stack_slot</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">make_stack</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Constant">Int</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L137">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">stack_upper</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L91" title="ocaml/asmcomp/power/proc.ml:91">stack_slot</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">make_stack</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="arch.mli.html#L56" title="ocaml/asmcomp/power/arch.mli:56">size_int</a></span><span class="ocamlEnd"> + </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="Statement">))</span><span class="ocamlEnd"> </span><span class="Constant">Int</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlEnd"> + </span><span class="Constant">8</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">[|</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L136" title="ocaml/asmcomp/power/proc.ml:136">stack_lower</a></span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L137" title="ocaml/asmcomp/power/proc.ml:137">stack_upper</a></span><span class="ocamlEnd"> </span><span class="Statement">|]<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><a id="L142">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">calling_conventions</span></span> <span class="ocamlLCIdentifier">first_int</span> <span class="ocamlLCIdentifier">last_int</span> <span class="ocamlLCIdentifier">first_float</span> <span class="ocamlLCIdentifier">last_float<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">make_stack</span> <span class="ocamlLCIdentifier">first_stack</span> <span class="ocamlLCIdentifier"><a href="../x86_ast.mli.html#L89" title="ocaml/asmcomp/x86_ast.mli:89">arg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="../x86_ast.mli.html#L89" title="ocaml/asmcomp/x86_ast.mli:89">arg</a></span><span class="Statement">)</span> <span class="PreProc">Reg</span>.<span class="ocamlLCIdentifier"><a href="../reg.ml.html#L63" title="ocaml/asmcomp/reg.ml:63">dummy</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">first_int</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Type"><a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">first_float</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">first_stack</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="../x86_ast.mli.html#L89" title="ocaml/asmcomp/x86_ast.mli:89">arg</a></span> - <span class="Constant">1</span> <span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="../x86_ast.mli.html#L89" title="ocaml/asmcomp/x86_ast.mli:89">arg</a></span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Val</span><span class="ocamlDo"> </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Int</span><span class="ocamlDo"> </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Addr</span><span class="ocamlDo"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">&lt;-</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/asmcomp/power/proc.ml:98">loc_int</a></span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">last_int</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">make_stack</span><span class="ocamlDo"> </span><span class="Constant">false</span><span class="ocamlDo"> </span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a><br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Float</span><span class="ocamlDo"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span><span class="ocamlDo">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">&lt;-</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L109" title="ocaml/asmcomp/power/proc.ml:109">loc_float</a></span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">last_float</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">make_stack</span><span class="ocamlDo"> </span><span class="Constant">false</span><span class="ocamlDo"> </span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlDo"> </span><span class="Type"><a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a></span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a><br/></li>
<li></span><span class="ocamlDo">&nbsp; </span><span class="Statement">done;<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L84" title="ocaml/asmcomp/x86_dsl.ml:84">align</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">max</span> <span class="Constant">0</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="Statement">)</span> <span class="Constant">16</span><span class="Statement">)</span>&nbsp; <span class="Comment">(* keep stack 16-aligned *)<br/></li>
<li></span><br/></li>
<li><a id="L157">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">incoming</span></span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlNone">&nbsp; </span><span class="Statement">then</span> <span class="Constant">Incoming</span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a><br/></li>
<li></span>&nbsp; <span class="Statement">else</span> <span class="Constant">Domainstate</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> + <span class="ocamlLCIdentifier"><a href="#L96" title="ocaml/asmcomp/power/proc.ml:96">size_domainstate_args</a></span><span class="Statement">)<br/></li>
<li><a id="L161">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">outgoing</span></span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlNone">&nbsp; </span><span class="Statement">then</span> <span class="Constant">Outgoing</span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a><br/></li>
<li></span>&nbsp; <span class="Statement">else</span> <span class="Constant">Domainstate</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> + <span class="ocamlLCIdentifier"><a href="#L96" title="ocaml/asmcomp/power/proc.ml:96">size_domainstate_args</a></span><span class="Statement">)<br/></li>
<li><a id="L165">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">not_supported</span></span> <span class="ocamlLCIdentifier">_ofs</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Proc.<a href="#L177" title="ocaml/asmcomp/power/proc.ml:177">loc_results</a>: cannot <a href="../x86_dsl.ml.html#L121" title="ocaml/asmcomp/x86_dsl.ml:121">call</a>&quot;<br/></li>
<li></span><br/></li>
<li><a id="L167">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">max_arguments_for_tailcalls</span></span> <span class="Statement">=</span> <span class="Constant">16</span> <span class="Comment">(* in <a href="../printmach.mli.html#L21" title="ocaml/asmcomp/printmach.mli:21">regs</a> *)</span> + <span class="Constant">64</span> <span class="Comment">(* in domain <a href="../cmm_invariants.ml.html#L55" title="ocaml/asmcomp/cmm_invariants.ml:55">state</a> *)<br/></li>
<li></span><br/></li>
<li><a id="L169">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_arguments</span></span> <span class="ocamlLCIdentifier"><a href="../x86_ast.mli.html#L89" title="ocaml/asmcomp/x86_ast.mli:89">arg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L142" title="ocaml/asmcomp/power/proc.ml:142">calling_conventions</a></span> <span class="Constant">0</span> <span class="Constant">15</span> <span class="Constant">100</span> <span class="Constant">112</span> <span class="ocamlLCIdentifier"><a href="#L161" title="ocaml/asmcomp/power/proc.ml:161">outgoing</a></span> <span class="Statement">(</span>- <span class="ocamlLCIdentifier"><a href="#L96" title="ocaml/asmcomp/power/proc.ml:96">size_domainstate_args</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="../x86_ast.mli.html#L89" title="ocaml/asmcomp/x86_ast.mli:89">arg</a><br/></li>
<li></span><br/></li>
<li><a id="L172">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_parameters</span></span> <span class="ocamlLCIdentifier"><a href="../x86_ast.mli.html#L89" title="ocaml/asmcomp/x86_ast.mli:89">arg</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="ocamlLCIdentifier">_ofs</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L142" title="ocaml/asmcomp/power/proc.ml:142">calling_conventions</a></span> <span class="Constant">0</span> <span class="Constant">15</span> <span class="Constant">100</span> <span class="Constant">112</span> <span class="ocamlLCIdentifier"><a href="#L157" title="ocaml/asmcomp/power/proc.ml:157">incoming</a></span> <span class="Statement">(</span>- <span class="ocamlLCIdentifier"><a href="#L96" title="ocaml/asmcomp/power/proc.ml:96">size_domainstate_args</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="../x86_ast.mli.html#L89" title="ocaml/asmcomp/x86_ast.mli:89">arg</a><br/></li>
<li></span>&nbsp; <span class="Statement">in</span> <span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a><br/></li>
<li></span><br/></li>
<li><a id="L177">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_results</span></span> <span class="ocamlLCIdentifier"><a href="../s390x/reload.ml.html#L34" title="ocaml/asmcomp/s390x/reload.ml:34">res</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="ocamlLCIdentifier">_ofs</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L142" title="ocaml/asmcomp/power/proc.ml:142">calling_conventions</a></span> <span class="Constant">0</span> <span class="Constant">15</span> <span class="Constant">100</span> <span class="Constant">112</span> <span class="ocamlLCIdentifier"><a href="#L165" title="ocaml/asmcomp/power/proc.ml:165">not_supported</a></span> <span class="Constant">0</span> <span class="ocamlLCIdentifier"><a href="../s390x/reload.ml.html#L34" title="ocaml/asmcomp/s390x/reload.ml:34">res</a><br/></li>
<li></span>&nbsp; <span class="Statement">in</span> <span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* C calling conventions for ELF32:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; use GPR 3-10 and FPR 1-8 just like ML calling conventions.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Using <a href="../amd64/selection.ml.html#L43" title="ocaml/asmcomp/amd64/selection.ml:43">a</a> <a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a> register does not affect the <a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a> registers.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Always reserve 8 <a href="../x86_dsl.ml.html#L86" title="ocaml/asmcomp/x86_dsl.ml:86">bytes</a> at bottom of stack, plus whatever is needed<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; to hold the overflow arguments.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; C calling conventions for ELF64v1:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Use GPR 3-10 for the first integer arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Use FPR 1-13 for the first <a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a> arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Always reserve stack <a href="../x86_dsl.ml.html#L109" title="ocaml/asmcomp/x86_dsl.ml:109">space</a> for all arguments, even when passed in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; registers.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Always reserve at least 8 words (64 <a href="../x86_dsl.ml.html#L86" title="ocaml/asmcomp/x86_dsl.ml:86">bytes</a>) for the arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Always reserve 48 <a href="../x86_dsl.ml.html#L86" title="ocaml/asmcomp/x86_dsl.ml:86">bytes</a> at bottom of stack, plus whatever is needed<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; to hold the arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; The reserved 48 <a href="../x86_dsl.ml.html#L86" title="ocaml/asmcomp/x86_dsl.ml:86">bytes</a> are automatically added in <a href="../x86_proc.ml.html#L281" title="ocaml/asmcomp/x86_proc.ml:281">emit</a>.mlp<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; and need not appear here.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; C calling conventions for ELF64v2:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Use GPR 3-10 for the first integer arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Use FPR 1-13 for the first <a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a> arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; If all arguments fit in registers, don'<a href="../CSEgen.ml.html#L40" title="ocaml/asmcomp/CSEgen.ml:40">t</a> reserve stack <a href="../x86_dsl.ml.html#L109" title="ocaml/asmcomp/x86_dsl.ml:109">space</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Otherwise, reserve stack <a href="../x86_dsl.ml.html#L109" title="ocaml/asmcomp/x86_dsl.ml:109">space</a> for all arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Always reserve 32 <a href="../x86_dsl.ml.html#L86" title="ocaml/asmcomp/x86_dsl.ml:86">bytes</a> at bottom of stack, plus whatever is needed<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; to hold the arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; The reserved 32 <a href="../x86_dsl.ml.html#L86" title="ocaml/asmcomp/x86_dsl.ml:86">bytes</a> are automatically added in <a href="../x86_proc.ml.html#L281" title="ocaml/asmcomp/x86_proc.ml:281">emit</a>.mlp<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; and need not appear here.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L207">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">external_calling_conventions</span><br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">first_int</span> <span class="ocamlLCIdentifier">last_int</span> <span class="ocamlLCIdentifier">first_float</span> <span class="ocamlLCIdentifier">last_float<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">make_stack</span> <span class="ocamlLCIdentifier">stack_ofs</span> <span class="ocamlLCIdentifier">reg_use_stack</span> <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L973" title="ocaml/asmcomp/selectgen.ml:973">ty_args</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L973" title="ocaml/asmcomp/selectgen.ml:973">ty_args</a></span><span class="Statement">)</span> <span class="Statement">[|</span> <span class="PreProc">Reg</span>.<span class="ocamlLCIdentifier"><a href="../reg.ml.html#L63" title="ocaml/asmcomp/reg.ml:63">dummy</a></span> <span class="Statement">|]</span> <span class="Statement">in<br/></li>
<li><a id="L211">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Type"><span class="linkable">int</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">first_int</span> <span class="Statement">in<br/></li>
<li><a id="L212">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Type"><span class="linkable">float</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">first_float</span> <span class="Statement">in<br/></li>
<li><a id="L213">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">ofs</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">stack_ofs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iteri<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">i</span> <span class="ocamlLCIdentifier">ty_arg</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">ty_arg</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">XInt</span> <span class="Statement">|</span> <span class="Constant">XInt32</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span> <span class="Statement">&lt;-<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[|</span> <span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/asmcomp/power/proc.ml:98">loc_int</a></span> <span class="ocamlLCIdentifier">last_int</span> <span class="ocamlLCIdentifier">make_stack</span> <span class="ocamlLCIdentifier">reg_use_stack</span> <span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">|]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">XInt64</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="arch.mli.html#L56" title="ocaml/asmcomp/power/arch.mli:56">size_int</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">4</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">assert</span><span class="ocamlEnd"> </span><span class="Statement">(not</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reg_use_stack</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span><span class="ocamlEnd">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">&lt;-</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L124" title="ocaml/asmcomp/power/proc.ml:124">loc_int_pair</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">last_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_stack</span><span class="ocamlEnd"> </span><span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end</span> <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span> <span class="Statement">&lt;-<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[|</span> <span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/asmcomp/power/proc.ml:98">loc_int</a></span> <span class="ocamlLCIdentifier">last_int</span> <span class="ocamlLCIdentifier">make_stack</span> <span class="ocamlLCIdentifier">reg_use_stack</span> <span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">|]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">XFloat</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>.<span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span> <span class="Statement">&lt;-<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[|</span> <span class="ocamlLCIdentifier"><a href="#L109" title="ocaml/asmcomp/power/proc.ml:109">loc_float</a></span> <span class="ocamlLCIdentifier">last_float</span> <span class="ocamlLCIdentifier">make_stack</span> <span class="ocamlLCIdentifier">reg_use_stack</span> <span class="Type"><a href="#L211" title="ocaml/asmcomp/power/proc.ml:211">int</a></span> <span class="Type"><a href="#L212" title="ocaml/asmcomp/power/proc.ml:212">float</a></span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Statement">|])<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L973" title="ocaml/asmcomp/selectgen.ml:973">ty_args</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L84" title="ocaml/asmcomp/x86_dsl.ml:84">align</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Constant">16</span><span class="Statement">)</span> <span class="Comment">(* Keep stack 16-aligned *)<br/></li>
<li></span><br/></li>
<li><a id="L233">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_external_arguments</span></span> <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L973" title="ocaml/asmcomp/selectgen.ml:973">ty_args</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="arch.mli.html#L21" title="ocaml/asmcomp/power/arch.mli:21">abi</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">ELF32</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L207" title="ocaml/asmcomp/power/proc.ml:207">external_calling_conventions</a></span> <span class="Constant">0</span> <span class="Constant">7</span> <span class="Constant">100</span> <span class="Constant">107</span> <span class="ocamlLCIdentifier"><a href="#L161" title="ocaml/asmcomp/power/proc.ml:161">outgoing</a></span> <span class="Constant">8</span> <span class="Constant">false</span> <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L973" title="ocaml/asmcomp/selectgen.ml:973">ty_args</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">ELF64v1</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L207" title="ocaml/asmcomp/power/proc.ml:207">external_calling_conventions</a></span> <span class="Constant">0</span> <span class="Constant">7</span> <span class="Constant">100</span> <span class="Constant">112</span> <span class="ocamlLCIdentifier"><a href="#L161" title="ocaml/asmcomp/power/proc.ml:161">outgoing</a></span> <span class="Constant">0</span> <span class="Constant">true</span> <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L973" title="ocaml/asmcomp/selectgen.ml:973">ty_args</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="ocamlLCIdentifier">max</span> <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span> <span class="Constant">64</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">ELF64v2</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L207" title="ocaml/asmcomp/power/proc.ml:207">external_calling_conventions</a></span> <span class="Constant">0</span> <span class="Constant">7</span> <span class="Constant">100</span> <span class="Constant">112</span> <span class="ocamlLCIdentifier"><a href="#L161" title="ocaml/asmcomp/power/proc.ml:161">outgoing</a></span> <span class="Constant">0</span> <span class="Constant">true</span> <span class="ocamlLCIdentifier"><a href="../selectgen.ml.html#L973" title="ocaml/asmcomp/selectgen.ml:973">ty_args</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">fold_left<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">(fun</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">stk</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span><span class="ocamlNone"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">assert</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">1</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="../amd64/reload.ml.html#L90" title="ocaml/asmcomp/amd64/reload.ml:90">r</a></span><span class="ocamlNone">.</span><span class="Statement">(</span><span class="Constant">0</span><span class="Statement">)</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span><span class="ocamlNone"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlNone"> </span><span class="Constant">Stack</span><span class="ocamlNone"> </span><span class="Statement">_</span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="Constant">true<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlNone"> </span><span class="Statement">_</span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">stk</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">false</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a><br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="ocamlLCIdentifier"><a href="#L213" title="ocaml/asmcomp/power/proc.ml:213">ofs</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Results are in GPR 3 and FPR 1 *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="../amd64/proc.ml.html#L224" title="ocaml/asmcomp/amd64/proc.ml:224">loc_external_results</a></span> <span class="ocamlLCIdentifier"><a href="../s390x/reload.ml.html#L34" title="ocaml/asmcomp/s390x/reload.ml:34">res</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a></span>, <span class="ocamlLCIdentifier">_ofs</span><span class="Statement">)</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L142" title="ocaml/asmcomp/power/proc.ml:142">calling_conventions</a></span> <span class="Constant">0</span> <span class="Constant">1</span> <span class="Constant">100</span> <span class="Constant">100</span> <span class="ocamlLCIdentifier"><a href="#L165" title="ocaml/asmcomp/power/proc.ml:165">not_supported</a></span> <span class="Constant">0</span> <span class="ocamlLCIdentifier"><a href="../s390x/reload.ml.html#L34" title="ocaml/asmcomp/s390x/reload.ml:34">res</a><br/></li>
<li></span>&nbsp; <span class="Statement">in</span> <span class="ocamlLCIdentifier"><a href="../x86_dsl.ml.html#L101" title="ocaml/asmcomp/x86_dsl.ml:101">loc</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Exceptions are in GPR 3 *)<br/></li>
<li></span><br/></li>
<li><a id="L262">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">loc_exn_bucket</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/asmcomp/power/proc.ml:88">phys_reg</a></span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* For ELF32 see:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; &quot;System V Application Binary Interface PowerPC Processor Supplement&quot;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; http://refspecs.linux-foundation.org/elf/elfspec_ppc.pdf<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; For ELF64v1 see:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; &quot;64-bit PowerPC ELF Application Binary Interface Supplement 1.9&quot;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; http://refspecs.linuxfoundation.org/ELF/<a href="arch.mli.html#L19" title="ocaml/asmcomp/power/arch.mli:19">ppc64</a>/PPC-elf64abi.html<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; For ELF64v2 see:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; &quot;64-Bit ELF V2 ABI Specification -- Power Architecture&quot;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; http://openpowerfoundation.org/wp-content/uploads/resources/leabi/<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; content/dbdoclet.50655239___RefHeading___Toc377640569.html<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; All of these specifications seem to agree on the numberings we need.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L280">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">int_dwarf_reg_numbers</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">[|</span> <span class="Constant">3</span><span class="Statement">;</span> <span class="Constant">4</span><span class="Statement">;</span> <span class="Constant">5</span><span class="Statement">;</span> <span class="Constant">6</span><span class="Statement">;</span> <span class="Constant">7</span><span class="Statement">;</span> <span class="Constant">8</span><span class="Statement">;</span> <span class="Constant">9</span><span class="Statement">;</span> <span class="Constant">10</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">14</span><span class="Statement">;</span> <span class="Constant">15</span><span class="Statement">;</span> <span class="Constant">16</span><span class="Statement">;</span> <span class="Constant">17</span><span class="Statement">;</span> <span class="Constant">18</span><span class="Statement">;</span> <span class="Constant">19</span><span class="Statement">;</span> <span class="Constant">20</span><span class="Statement">;</span> <span class="Constant">21</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">22</span><span class="Statement">;</span> <span class="Constant">23</span><span class="Statement">;</span> <span class="Constant">24</span><span class="Statement">;</span> <span class="Constant">25</span><span class="Statement">;</span> <span class="Constant">26</span><span class="Statement">;</span> <span class="Constant">27</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">|]<br/></li>
<li></span><br/></li>
<li><a id="L286">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">float_dwarf_reg_numbers</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">[|</span> <span class="Constant">33</span><span class="Statement">;</span> <span class="Constant">34</span><span class="Statement">;</span> <span class="Constant">35</span><span class="Statement">;</span> <span class="Constant">36</span><span class="Statement">;</span> <span class="Constant">37</span><span class="Statement">;</span> <span class="Constant">38</span><span class="Statement">;</span> <span class="Constant">39</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">40</span><span class="Statement">;</span> <span class="Constant">41</span><span class="Statement">;</span> <span class="Constant">42</span><span class="Statement">;</span> <span class="Constant">43</span><span class="Statement">;</span> <span class="Constant">44</span><span class="Statement">;</span> <span class="Constant">45</span><span class="Statement">;</span> <span class="Constant">46</span><span class="Statement">;</span> <span class="Constant">47</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">48</span><span class="Statement">;</span> <span class="Constant">49</span><span class="Statement">;</span> <span class="Constant">50</span><span class="Statement">;</span> <span class="Constant">51</span><span class="Statement">;</span> <span class="Constant">52</span><span class="Statement">;</span> <span class="Constant">53</span><span class="Statement">;</span> <span class="Constant">54</span><span class="Statement">;</span> <span class="Constant">55</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">56</span><span class="Statement">;</span> <span class="Constant">57</span><span class="Statement">;</span> <span class="Constant">58</span><span class="Statement">;</span> <span class="Constant">59</span><span class="Statement">;</span> <span class="Constant">60</span><span class="Statement">;</span> <span class="Constant">61</span><span class="Statement">;</span> <span class="Constant">62</span><span class="Statement">;</span> <span class="Constant">63</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">|]<br/></li>
<li></span><br/></li>
<li><a id="L293">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">dwarf_register_numbers</span></span> <span class="Statement">~</span><span class="Identifier">reg_class</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">reg_class</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">0</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L280" title="ocaml/asmcomp/power/proc.ml:280">int_dwarf_reg_numbers</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">1</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L286" title="ocaml/asmcomp/power/proc.ml:286">float_dwarf_reg_numbers</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">fatal_errorf</span> <span class="Constant">&quot;Bad register class %<a href="../deadcode.ml.html#L23" title="ocaml/asmcomp/deadcode.ml:23">d</a>&quot;</span> <span class="ocamlLCIdentifier">reg_class<br/></li>
<li></span><br/></li>
<li><a id="L299">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">stack_ptr_dwarf_register_number</span></span> <span class="Statement">=</span> <span class="Constant">1<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Registers <a href="../spill.ml.html#L344" title="ocaml/asmcomp/spill.ml:344">destroyed</a> by operations *)<br/></li>
<li></span><br/></li>
<li><a id="L303">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">destroyed_at_c_call</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">of_list</span><span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/asmcomp/power/proc.ml:88">phys_reg</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">[</span><span class="Constant">0</span><span class="Statement">;</span> <span class="Constant">1</span><span class="Statement">;</span> <span class="Constant">2</span><span class="Statement">;</span> <span class="Constant">3</span><span class="Statement">;</span> <span class="Constant">4</span><span class="Statement">;</span> <span class="Constant">5</span><span class="Statement">;</span> <span class="Constant">6</span><span class="Statement">;</span> <span class="Constant">7</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Constant">100</span><span class="Statement">;</span> <span class="Constant">101</span><span class="Statement">;</span> <span class="Constant">102</span><span class="Statement">;</span> <span class="Constant">103</span><span class="Statement">;</span> <span class="Constant">104</span><span class="Statement">;</span> <span class="Constant">105</span><span class="Statement">;</span> <span class="Constant">106</span><span class="Statement">;</span> <span class="Constant">107</span><span class="Statement">;</span> <span class="Constant">108</span><span class="Statement">;</span> <span class="Constant">109</span><span class="Statement">;</span> <span class="Constant">110</span><span class="Statement">;</span> <span class="Constant">111</span><span class="Statement">;</span> <span class="Constant">112</span><span class="Statement">])<br/></li>
<li></span><br/></li>
<li><a id="L308">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">destroyed_at_oper</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Iop</span><span class="Statement">(</span><span class="Constant">Icall_ind</span> <span class="Statement">|</span> <span class="Constant">Icall_imm</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Iextcall</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">alloc</span> <span class="Statement">=</span> <span class="Constant">true</span><span class="Statement">;</span> <span class="Statement">_</span> <span class="Statement">})</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L85" title="ocaml/asmcomp/power/proc.ml:85">all_phys_regs</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Iop</span><span class="Statement">(</span><span class="Constant">Iextcall</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">alloc</span> <span class="Statement">=</span> <span class="Constant">false</span><span class="Statement">;</span> <span class="Statement">_</span> <span class="Statement">})</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L303" title="ocaml/asmcomp/power/proc.ml:303">destroyed_at_c_call</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">[||]<br/></li>
<li></span><br/></li>
<li><a id="L314">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">destroyed_at_raise</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L85" title="ocaml/asmcomp/power/proc.ml:85">all_phys_regs</a><br/></li>
<li></span><br/></li>
<li><a id="L316">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">destroyed_at_reloadretaddr</span></span> <span class="Statement">=</span> <span class="Statement">[|</span> <span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/asmcomp/power/proc.ml:88">phys_reg</a></span> <span class="Constant">11</span> <span class="Statement">|]<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Maximal register pressure *)<br/></li>
<li></span><br/></li>
<li><a id="L320">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">safe_register_pressure</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Iextcall</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">14<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">23<br/></li>
<li></span><br/></li>
<li><a id="L324">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">max_register_pressure</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Iextcall</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">[|</span> <span class="Constant">14</span><span class="Statement">;</span> <span class="Constant">18</span> <span class="Statement">|]<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">[|</span> <span class="Constant">23</span><span class="Statement">;</span> <span class="Constant">30</span> <span class="Statement">|]<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Layout of the stack *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* See [reserved_stack_space] in <a href="../x86_proc.ml.html#L281" title="ocaml/asmcomp/x86_proc.ml:281">emit</a>.mlp. *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">reserved_stack_space_required</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="arch.mli.html#L21" title="ocaml/asmcomp/power/arch.mli:21">abi</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">ELF32</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">ELF64v1</span> <span class="Statement">|</span> <span class="Constant">ELF64v2</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span><br/></li>
<li><a id="L336">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">frame_required</span></span> <span class="ocamlLCIdentifier">fd</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">is_elf32</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="arch.mli.html#L21" title="ocaml/asmcomp/power/arch.mli:21">abi</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">ELF32</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">ELF64v1</span> <span class="Statement">|</span> <span class="Constant">ELF64v2</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">reserved_stack_space_required</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">||</span> <span class="ocamlLCIdentifier">fd</span>.<span class="ocamlLCIdentifier">fun_num_stack_slots</span>.<span class="Statement">(</span><span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">&gt;</span> <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">||</span> <span class="ocamlLCIdentifier">fd</span>.<span class="ocamlLCIdentifier">fun_num_stack_slots</span>.<span class="Statement">(</span><span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">&gt;</span> <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">||</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">fd</span>.<span class="ocamlLCIdentifier">fun_contains_calls</span> <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier">is_elf32</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L347">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">prologue_required</span></span> <span class="ocamlLCIdentifier">fd</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L336" title="ocaml/asmcomp/power/proc.ml:336">frame_required</a></span> <span class="ocamlLCIdentifier">fd<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Calling the assembler *)<br/></li>
<li></span><br/></li>
<li><a id="L352">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">assemble_file</span></span> <span class="ocamlLCIdentifier">infile</span> <span class="ocamlLCIdentifier">outfile</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Ccomp</span>.<span class="ocamlLCIdentifier">command</span> <span class="Statement">(</span><span class="PreProc">Config</span>.<span class="ocamlLCIdentifier">asm</span> <span class="Statement">^</span> <span class="Constant">&quot; &quot;</span> <span class="Statement">^<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="PreProc">String</span>.<span class="ocamlLCIdentifier">concat</span> <span class="Constant">&quot; &quot;</span> <span class="Statement">(</span><span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">debug_prefix_map_flags</span> <span class="Constant">()</span><span class="Statement">))</span> <span class="Statement">^<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot; -o &quot;</span> <span class="Statement">^</span> <span class="PreProc">Filename</span>.<span class="ocamlLCIdentifier">quote</span> <span class="ocamlLCIdentifier">outfile</span> <span class="Statement">^</span> <span class="Constant">&quot; &quot;</span> <span class="Statement">^</span> <span class="PreProc">Filename</span>.<span class="ocamlLCIdentifier">quote</span> <span class="ocamlLCIdentifier">infile</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L357">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">init</span></span> <span class="Constant">()</span> <span class="Statement">=</span> <span class="Constant">()<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
