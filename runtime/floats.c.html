<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/runtime/floats.c - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/runtime/floats.c - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L112">caml_locale</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L541">double_as_int64</a></li>
<li><a href="#L1059">double_as_two_int32</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L84">caml_Double_val</a></li>
<li><a href="#L163">caml_Store_double_array_field</a></li>
<li><a href="#L94">caml_Store_double_val</a></li>
<li><a href="#L437">caml_abs_float</a></li>
<li><a href="#L902">caml_acos_float</a></li>
<li><a href="#L907">caml_acosh</a></li>
<li><a href="#L916">caml_acosh_float</a></li>
<li><a href="#L442">caml_add_float</a></li>
<li><a href="#L883">caml_asin_float</a></li>
<li><a href="#L888">caml_asinh</a></li>
<li><a href="#L897">caml_asinh_float</a></li>
<li><a href="#L940">caml_atan2_float</a></li>
<li><a href="#L921">caml_atan_float</a></li>
<li><a href="#L926">caml_atanh</a></li>
<li><a href="#L935">caml_atanh_float</a></li>
<li><a href="#L832">caml_cbrt</a></li>
<li><a href="#L843">caml_cbrt_float</a></li>
<li><a href="#L945">caml_ceil_float</a></li>
<li><a href="#L1181">caml_classify_float</a></li>
<li><a href="#L1140">caml_classify_float_unboxed</a></li>
<li><a href="#L152">caml_copy_double</a></li>
<li><a href="#L1068">caml_copysign</a></li>
<li><a href="#L1082">caml_copysign_float</a></li>
<li><a href="#L863">caml_cos_float</a></li>
<li><a href="#L868">caml_cosh_float</a></li>
<li><a href="#L457">caml_div_float</a></li>
<li><a href="#L1031">caml_erf</a></li>
<li><a href="#L1040">caml_erf_float</a></li>
<li><a href="#L1045">caml_erfc</a></li>
<li><a href="#L1054">caml_erfc_float</a></li>
<li><a href="#L467">caml_exp2</a></li>
<li><a href="#L476">caml_exp2_float</a></li>
<li><a href="#L462">caml_exp_float</a></li>
<li><a href="#L975">caml_expm1</a></li>
<li><a href="#L1002">caml_expm1_float</a></li>
<li><a href="#L1133">caml_float_compare</a></li>
<li><a href="#L1113">caml_float_compare_unboxed</a></li>
<li><a href="#L285">caml_float_of_hex</a></li>
<li><a href="#L427">caml_float_of_int</a></li>
<li><a href="#L374">caml_float_of_string</a></li>
<li><a href="#L525">caml_floor_float</a></li>
<li><a href="#L555">caml_fma</a></li>
<li><a href="#L751">caml_fma_float</a></li>
<li><a href="#L757">caml_fmod_float</a></li>
<li><a href="#L174">caml_format_float</a></li>
<li><a href="#L144">caml_free_locale</a></li>
<li><a href="#L762">caml_frexp_float</a></li>
<li><a href="#L200">caml_hexstring_of_float</a></li>
<li><a href="#L950">caml_hypot</a></li>
<li><a href="#L968">caml_hypot_float</a></li>
<li><a href="#L127">caml_init_locale</a></li>
<li><a href="#L422">caml_int_of_float</a></li>
<li><a href="#L783">caml_ldexp_float</a></li>
<li><a href="#L777">caml_ldexp_float_unboxed</a></li>
<li><a href="#L793">caml_log10_float</a></li>
<li><a href="#L989">caml_log1p</a></li>
<li><a href="#L1007">caml_log1p_float</a></li>
<li><a href="#L798">caml_log2</a></li>
<li><a href="#L807">caml_log2_float</a></li>
<li><a href="#L788">caml_log_float</a></li>
<li><a href="#L812">caml_modf_float</a></li>
<li><a href="#L452">caml_mul_float</a></li>
<li><a href="#L432">caml_neg_float</a></li>
<li><a href="#L1103">caml_neq_float</a></li>
<li><a href="#L530">caml_nextafter</a></li>
<li><a href="#L535">caml_nextafter_float</a></li>
<li><a href="#L848">caml_power_float</a></li>
<li><a href="#L495">caml_round</a></li>
<li><a href="#L520">caml_round_float</a></li>
<li><a href="#L1087">caml_signbit</a></li>
<li><a href="#L1098">caml_signbit_float</a></li>
<li><a href="#L853">caml_sin_float</a></li>
<li><a href="#L858">caml_sinh_float</a></li>
<li><a href="#L827">caml_sqrt_float</a></li>
<li><a href="#L447">caml_sub_float</a></li>
<li><a href="#L873">caml_tan_float</a></li>
<li><a href="#L878">caml_tanh_float</a></li>
<li><a href="#L481">caml_trunc</a></li>
<li><a href="#L490">caml_trunc_float</a></li>
<li><a href="#L1013">simple_erf</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L16">CAML_INTERNALS</a></li>
<li><a href="#L1108">DEFINE_NAN_CMP</a></li>
<li><a href="#L550">FL108</a></li>
<li><a href="#L546">FL53</a></li>
<li><a href="#L548">FL54</a></li>
<li><a href="#L552">FLM1074</a></li>
<li><a href="#L551">FLM108</a></li>
<li><a href="#L547">FLM53</a></li>
<li><a href="#L549">FLM54</a></li>
<li><a href="#L542">IEEE754_DOUBLE_BIAS</a></li>
<li><a href="#L543">IEEE_EXPONENT</a></li>
<li><a href="#L544">IEEE_NEGATIVE</a></li>
<li><a href="#L79">M_LOG2E</a></li>
<li><a href="#L118">RESTORE_LOCALE</a></li>
<li><a href="#L121">RESTORE_LOCALE</a></li>
<li><a href="#L124">RESTORE_LOCALE</a></li>
<li><a href="#L117">USE_LOCALE</a></li>
<li><a href="#L120">USE_LOCALE</a></li>
<li><a href="#L123">USE_LOCALE</a></li>
<li><a href="#L24">_GNU_SOURCE</a></li>
<li><a href="#L21">_XOPEN_SOURCE</a></li>
<li><a href="#L56">freelocale</a></li>
<li><a href="#L71">isfinite</a></li>
<li><a href="#L68">isnan</a></li>
<li><a href="#L53">locale_t</a></li>
<li><a href="#L74">nextafter</a></li>
<li><a href="#L59">strtod_l</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/**************************************************************************/<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/**************************************************************************/<br/></li>
<li></span><br/></li>
<li><a id="L16">&#x200c;</a><span class="PreProc">#define <span class="linkable">CAML_INTERNALS</span><br/></li>
<li></span><br/></li>
<li><span class="Comment">/* The interface of this file is in &quot;caml/mlvalues.h&quot; <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> &quot;caml/alloc.h&quot; */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Needed for uselocale */<br/></li>
<li><a id="L21">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">_XOPEN_SOURCE</span> </span><span class="Constant">700<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Needed for <a href="#L59" title="ocaml/runtime/floats.c:59">strtod_l</a> */<br/></li>
<li><a id="L24">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">_GNU_SOURCE</span><br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;math.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;stdio.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;stdlib.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;float.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;limits.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;caml/alloc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/fail.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/memory.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/mlvalues.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/misc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/reverse.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/fiber.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(<a href="caml/config.h.html#L54" title="ocaml/runtime/caml/config.h:54">HAS_LOCALE</a>) || defined(__MINGW32__)<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(HAS_LOCALE_H) || defined(__MINGW32__)<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;locale.h&gt;<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(HAS_XLOCALE_H)<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;xlocale.h&gt;<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(_MSC_VER)<br/></li>
<li></span><span class="PreProc">#ifndef <a href="#L53" title="ocaml/runtime/floats.c:53">locale_t</a><br/></li>
<li><a id="L53">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">locale_t</span> _locale_t<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#ifndef <a href="#L56" title="ocaml/runtime/floats.c:56">freelocale</a><br/></li>
<li><a id="L56">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">freelocale</span> _free_locale<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#ifndef <a href="#L59" title="ocaml/runtime/floats.c:59">strtod_l</a><br/></li>
<li><a id="L59">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">strtod_l</span> _strtod_l<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#endif</span> <span class="Comment">/* defined(<a href="caml/config.h.html#L54" title="ocaml/runtime/caml/config.h:54">HAS_LOCALE</a>) */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef _MSC_VER<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;float.h&gt;<br/></li>
<li></span><span class="PreProc">#ifndef <a href="#L68" title="ocaml/runtime/floats.c:68">isnan</a><br/></li>
<li><a id="L68">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">isnan</span> _isnan<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#ifndef <a href="#L71" title="ocaml/runtime/floats.c:71">isfinite</a><br/></li>
<li><a id="L71">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">isfinite</span> _finite<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#ifndef <a href="#L74" title="ocaml/runtime/floats.c:74">nextafter</a><br/></li>
<li><a id="L74">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">nextafter</span> _nextafter<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifndef <a href="#L79" title="ocaml/runtime/floats.c:79">M_LOG2E</a><br/></li>
<li><a id="L79">&#x200c;</a></span><span class="PreProc">#define </span><span class="Constant"><span class="linkable">M_LOG2E</span></span><span class="PreProc"> </span><span class="Constant">1.44269504088896340735992468100</span><span class="PreProc"> </span><span class="Comment">/* log_2 (e) */<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef ARCH_ALIGN_DOUBLE<br/></li>
<li></span><br/></li>
<li><a id="L84">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_Double_val</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> val)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Type">union</span> { <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> v[<span class="Constant">2</span>]; <span class="Type">double</span> d; } buffer;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a>(<span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span>(<span class="Type">double</span>) == <span class="Constant">2</span> * <span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>));<br/></li>
<li>&nbsp; buffer.v[<span class="Constant">0</span>] = <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(val, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; buffer.v[<span class="Constant">1</span>] = <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(val, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> buffer.d;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L94">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">void</span> <span class="linkable">caml_Store_double_val</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> val, <span class="Type">double</span> dbl)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Type">union</span> { <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> v[<span class="Constant">2</span>]; <span class="Type">double</span> d; } buffer;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a>(<span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span>(<span class="Type">double</span>) == <span class="Constant">2</span> * <span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>));<br/></li>
<li>&nbsp; buffer.d = dbl;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(val, <span class="Constant">0</span>) = buffer.v[<span class="Constant">0</span>];<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(val, <span class="Constant">1</span>) = buffer.v[<span class="Constant">1</span>];<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> OCaml runtime itself doesn't call setlocale, i.e. it is using<br/></li>
<li></span><span class="Comment"> standard &quot;C&quot; locale by default, but it is possible that<br/></li>
<li></span><span class="Comment"> third-party code loaded into process does.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><span class="PreProc">#ifdef <a href="caml/config.h.html#L54" title="ocaml/runtime/caml/config.h:54">HAS_LOCALE</a><br/></li>
<li><a id="L112">&#x200c;</a></span><a href="#L53" title="ocaml/runtime/floats.c:53">locale_t</a> <span class="linkable">caml_locale</span> = (<a href="#L53" title="ocaml/runtime/floats.c:53">locale_t</a>)<span class="Constant">0</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(_MSC_VER) || defined(__MINGW32__)<br/></li>
<li></span><span class="Comment">/* there is no analogue to uselocale in MSVC so just set locale for thread */<br/></li>
<li><a id="L117">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">USE_LOCALE</span> setlocale(</span><span class="Constant">LC_NUMERIC</span><span class="PreProc">,</span><span class="Constant">&quot;C&quot;</span><span class="PreProc">)<br/></li>
<li><a id="L118">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">RESTORE_LOCALE</span> </span><span class="Statement">do</span><span class="PreProc"> {} </span><span class="Statement">while</span><span class="PreProc">(</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><span class="PreProc">#elif defined(<a href="caml/config.h.html#L54" title="ocaml/runtime/caml/config.h:54">HAS_LOCALE</a>)<br/></li>
<li><a id="L120">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">USE_LOCALE</span> <a href="#L53" title="ocaml/runtime/floats.c:53">locale_t</a> saved_locale = uselocale(<a href="#L112" title="ocaml/runtime/floats.c:112">caml_locale</a>)<br/></li>
<li><a id="L121">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">RESTORE_LOCALE</span> uselocale(saved_locale)<br/></li>
<li></span><span class="PreProc">#else<br/></li>
<li><a id="L123">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">USE_LOCALE</span> </span><span class="Statement">do</span><span class="PreProc"> {} </span><span class="Statement">while</span><span class="PreProc">(</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li><a id="L124">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">RESTORE_LOCALE</span> </span><span class="Statement">do</span><span class="PreProc"> {} </span><span class="Statement">while</span><span class="PreProc">(</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><a id="L127">&#x200c;</a><span class="Type">void</span> <span class="linkable">caml_init_locale</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#if defined(_MSC_VER) || defined(__MINGW32__)<br/></li>
<li></span>&nbsp; _configthreadlocale(_ENABLE_PER_THREAD_LOCALE);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#ifdef <a href="caml/config.h.html#L54" title="ocaml/runtime/caml/config.h:54">HAS_LOCALE</a><br/></li>
<li></span>&nbsp; <span class="Statement">if</span> ((<a href="#L53" title="ocaml/runtime/floats.c:53">locale_t</a>)<span class="Constant">0</span> == <a href="#L112" title="ocaml/runtime/floats.c:112">caml_locale</a>)<br/></li>
<li>&nbsp; {<br/></li>
<li><span class="PreProc">#if defined(_MSC_VER)<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L112" title="ocaml/runtime/floats.c:112">caml_locale</a> = _create_locale(<span class="Constant">LC_NUMERIC</span>, <span class="Constant">&quot;C&quot;</span>);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L112" title="ocaml/runtime/floats.c:112">caml_locale</a> = newlocale(LC_NUMERIC_MASK,<span class="Constant">&quot;C&quot;</span>,(<a href="#L53" title="ocaml/runtime/floats.c:53">locale_t</a>)<span class="Constant">0</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L144">&#x200c;</a><span class="Type">void</span> <span class="linkable">caml_free_locale</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef <a href="caml/config.h.html#L54" title="ocaml/runtime/caml/config.h:54">HAS_LOCALE</a><br/></li>
<li></span>&nbsp; <span class="Statement">if</span> ((<a href="#L53" title="ocaml/runtime/floats.c:53">locale_t</a>)<span class="Constant">0</span> != <a href="#L112" title="ocaml/runtime/floats.c:112">caml_locale</a>) <a href="#L56" title="ocaml/runtime/floats.c:56">freelocale</a>(<a href="#L112" title="ocaml/runtime/floats.c:112">caml_locale</a>);<br/></li>
<li>&nbsp; <a href="#L112" title="ocaml/runtime/floats.c:112">caml_locale</a> = (<a href="#L53" title="ocaml/runtime/floats.c:53">locale_t</a>)<span class="Constant">0</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L152">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_copy_double</span>(<span class="Type">double</span> d)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/domain_state.h.html#L72" title="ocaml/runtime/caml/domain_state.h:72">Caml_check_caml_state</a>();<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> res;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L217" title="ocaml/runtime/caml/memory.h:217">Alloc_small</a>(res, <a href="caml/mlvalues.h.html#L337" title="ocaml/runtime/caml/mlvalues.h:337">Double_wosize</a>, <a href="caml/mlvalues.h.html#L336" title="ocaml/runtime/caml/mlvalues.h:336">Double_tag</a>, <a href="caml/memory.h.html#L199" title="ocaml/runtime/caml/memory.h:199">Alloc_small_enter_GC</a>);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L340" title="ocaml/runtime/caml/mlvalues.h:340">Store_double_val</a>(res, d);<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef FLAT_FLOAT_ARRAY<br/></li>
<li><a id="L163">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">void</span> <span class="linkable">caml_Store_double_array_field</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> val, <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> i, <span class="Type">double</span> dbl)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L276" title="ocaml/runtime/caml/memory.h:276">CAMLparam1</a> (val);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> d = <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a> (dbl);<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (<a href="caml/mlvalues.h.html#L199" title="ocaml/runtime/caml/mlvalues.h:199">Tag_val</a> (val) != <a href="caml/mlvalues.h.html#L349" title="ocaml/runtime/caml/mlvalues.h:349">Double_array_tag</a>);<br/></li>
<li>&nbsp; <a href="memory.c.html#L149" title="ocaml/runtime/memory.c:149">caml_modify</a> (&amp;<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(val, i), d);<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L408" title="ocaml/runtime/caml/memory.h:408">CAMLreturn0</a>;<br/></li>
<li>}<br/></li>
<li><span class="PreProc">#endif</span> <span class="Comment">/* ! FLAT_FLOAT_ARRAY */<br/></li>
<li></span><br/></li>
<li><a id="L174">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_format_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> fmt, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> arg)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> res;<br/></li>
<li>&nbsp; <span class="Type">double</span> d = <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(arg);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef HAS_BROKEN_PRINTF<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (<a href="#L71" title="ocaml/runtime/floats.c:71">isfinite</a>(d)) {<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L117" title="ocaml/runtime/floats.c:117">USE_LOCALE</a>;<br/></li>
<li>&nbsp; &nbsp; res = <a href="str.c.html#L390" title="ocaml/runtime/str.c:390">caml_alloc_sprintf</a>(<a href="caml/mlvalues.h.html#L329" title="ocaml/runtime/caml/mlvalues.h:329">String_val</a>(fmt), d);<br/></li>
<li>&nbsp; &nbsp; <a href="#L118" title="ocaml/runtime/floats.c:118">RESTORE_LOCALE</a>;<br/></li>
<li><span class="PreProc">#ifdef HAS_BROKEN_PRINTF<br/></li>
<li></span>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L68" title="ocaml/runtime/floats.c:68">isnan</a>(d)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; res = <a href="alloc.c.html#L214" title="ocaml/runtime/alloc.c:214">caml_copy_string</a>(<span class="Constant">&quot;nan&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; res = <a href="alloc.c.html#L214" title="ocaml/runtime/alloc.c:214">caml_copy_string</a>(<span class="Constant">&quot;inf&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; res = <a href="alloc.c.html#L214" title="ocaml/runtime/alloc.c:214">caml_copy_string</a>(<span class="Constant">&quot;-inf&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L200">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_hexstring_of_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> arg, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vprec, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vstyle)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Type">union</span> { <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> i; <span class="Type">double</span> d; } u;<br/></li>
<li>&nbsp; <span class="Type">int</span> sign, exp;<br/></li>
<li>&nbsp; <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> m;<br/></li>
<li>&nbsp; <span class="Type">char</span> buffer[<span class="Constant">64</span>];<br/></li>
<li>&nbsp; <span class="Type">char</span> * buf, * p;<br/></li>
<li>&nbsp; <a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> prec;<br/></li>
<li>&nbsp; <span class="Type">int</span> d;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> res;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* Allocate output buffer */<br/></li>
<li></span>&nbsp; prec = <a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(vprec);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 12 chars for sign, 0x, decimal point, exponent */<br/></li>
<li></span>&nbsp; buf = (prec + <span class="Constant">12</span> &lt;= <span class="Constant">64</span> ? buffer : <a href="memory.c.html#L550" title="ocaml/runtime/memory.c:550">caml_stat_alloc</a>(prec + <span class="Constant">12</span>));<br/></li>
<li>&nbsp; <span class="Comment">/* Extract sign, mantissa, <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> exponent */<br/></li>
<li></span>&nbsp; u.d = <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(arg);<br/></li>
<li>&nbsp; sign = u.i &gt;&gt; <span class="Constant">63</span>;<br/></li>
<li>&nbsp; exp = (u.i &gt;&gt; <span class="Constant">52</span>) &amp; <span class="Constant">0x7FF</span>;<br/></li>
<li>&nbsp; m = u.i &amp; (((<span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span>) <span class="Constant">1</span> &lt;&lt; <span class="Constant">52</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Comment">/* Put sign */<br/></li>
<li></span>&nbsp; p = buf;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; *p++ = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (<a href="caml/mlvalues.h.html#L82" title="ocaml/runtime/caml/mlvalues.h:82">Int_val</a>(vstyle)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'+'</span>: *p++ = <span class="Constant">'+'</span>; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">' '</span>: *p++ = <span class="Constant">' '</span>; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Comment">/* Treat special cases */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (exp == <span class="Constant">0x7FF</span>) {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span> * txt;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (m == <span class="Constant">0</span>) txt = <span class="Constant">&quot;infinity&quot;</span>; <span class="Statement">else</span> txt = <span class="Constant">&quot;nan&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; memcpy(p, txt, strlen(txt));<br/></li>
<li>&nbsp; &nbsp; p[strlen(txt)] = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; res = <a href="alloc.c.html#L214" title="ocaml/runtime/alloc.c:214">caml_copy_string</a>(buf);<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Output &quot;0x&quot; prefix */<br/></li>
<li></span>&nbsp; &nbsp; *p++ = <span class="Constant">'0'</span>; *p++ = <span class="Constant">'x'</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Normalize exponent <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> mantissa */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (exp == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (m != <span class="Constant">0</span>) exp = -<span class="Constant">1022</span>;&nbsp; &nbsp; <span class="Comment">/* denormal */<br/></li>
<li></span>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; exp = exp - <span class="Constant">1023</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; m = m | ((<span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span>) <span class="Constant">1</span> &lt;&lt; <span class="Constant">52</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* If a precision is given, <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> is small, round mantissa accordingly */<br/></li>
<li></span>&nbsp; &nbsp; prec = <a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(vprec);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (prec &gt;= <span class="Constant">0</span> &amp;&amp; prec &lt; <span class="Constant">13</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type">int</span> i = <span class="Constant">52</span> - prec * <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> unit = (<span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span>) <span class="Constant">1</span> &lt;&lt; i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> half = unit &gt;&gt; <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> mask = unit - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> frac = m &amp; mask;<br/></li>
<li>&nbsp; &nbsp; &nbsp; m = m &amp; ~mask;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* Round to nearest, ties to even */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (frac &gt; half || (frac == half &amp;&amp; (m &amp; unit) != <span class="Constant">0</span>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; m += unit;<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Leading digit */<br/></li>
<li></span>&nbsp; &nbsp; d = m &gt;&gt; <span class="Constant">52</span>;<br/></li>
<li>&nbsp; &nbsp; *p++ = (d &lt; <span class="Constant">10</span> ? d + <span class="Constant">'0'</span> : d - <span class="Constant">10</span> + <span class="Constant">'a'</span>);<br/></li>
<li>&nbsp; &nbsp; m = (m &lt;&lt; <span class="Constant">4</span>) &amp; (((<span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span>) <span class="Constant">1</span> &lt;&lt; <span class="Constant">56</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Fractional digits.&nbsp; If a precision is given, print that number of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; digits.&nbsp; Otherwise, print as many digits as needed to represent<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; the mantissa exactly. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (prec &gt;= <span class="Constant">0</span> ? prec &gt; <span class="Constant">0</span> : m != <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; *p++ = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (prec &gt;= <span class="Constant">0</span> ? prec &gt; <span class="Constant">0</span> : m != <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d = m &gt;&gt; <span class="Constant">52</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p++ = (d &lt; <span class="Constant">10</span> ? d + <span class="Constant">'0'</span> : d - <span class="Constant">10</span> + <span class="Constant">'a'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; m = (m &lt;&lt; <span class="Constant">4</span>) &amp; (((<span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span>) <span class="Constant">1</span> &lt;&lt; <span class="Constant">56</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; prec--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; *p = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Add exponent */<br/></li>
<li></span>&nbsp; &nbsp; res = <a href="str.c.html#L390" title="ocaml/runtime/str.c:390">caml_alloc_sprintf</a>(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">p</span><span class="Special">%+d</span><span class="Constant">&quot;</span>, buf, exp);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (buf != buffer) <a href="memory.c.html#L559" title="ocaml/runtime/memory.c:559">caml_stat_free</a>(buf);<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L285">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">caml_float_of_hex</span>(<span class="Type">const</span> <span class="Type">char</span> * s, <span class="Type">const</span> <span class="Type">char</span> * end, <span class="Type">double</span> * res)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Type"><a href="caml/config.h.html#L127" title="ocaml/runtime/caml/config.h:127">int64_t</a></span> m = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* the mantissa - top 60 bits at most */<br/></li>
<li></span>&nbsp; <span class="Type">int</span> n_bits = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* total number of bits read */<br/></li>
<li></span>&nbsp; <span class="Type">int</span> m_bits = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* number of bits in mantissa */<br/></li>
<li></span>&nbsp; <span class="Type">int</span> x_bits = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* number of bits after mantissa */<br/></li>
<li></span>&nbsp; <span class="Type">int</span> dec_point = -<span class="Constant">1</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* bit count corresponding to decimal point */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* -1 if no decimal point seen */<br/></li>
<li></span>&nbsp; <span class="Type">int</span> exp = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exponent */<br/></li>
<li></span>&nbsp; <span class="Type">char</span> * p;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* for converting the exponent */<br/></li>
<li></span>&nbsp; <span class="Type">double</span> f;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">while</span> (s &lt; end) {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span> c = *s++;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (c) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'.'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (dec_point &gt;= <span class="Constant">0</span>) <span class="Statement">return</span> -<span class="Constant">1</span>; <span class="Comment">/* multiple decimal points */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; dec_point = n_bits;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'p'</span>: <span class="Statement">case</span> <span class="Constant">'P'</span>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type">long</span> e;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == <span class="Constant">0</span>) <span class="Statement">return</span> -<span class="Constant">1</span>;&nbsp;&nbsp; <span class="Comment">/* nothing after exponent <a href="major_gc.c.html#L993" title="ocaml/runtime/major_gc.c:993">mark</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; e = strtol(s, &amp;p, <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p != end) <span class="Statement">return</span> -<span class="Constant">1</span>;&nbsp; <span class="Comment">/* ill-formed exponent */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">/* Handle exponents larger than int by returning 0/infinity directly.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Mind that INT_MIN/INT_MAX are included in the test so as to capture<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; the overflow case of strtol on Win64 -- long <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> int have the same<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; size there. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (e &lt;= <span class="Constant">INT_MIN</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *res = <span class="Constant">0.</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (e &gt;= <span class="Constant">INT_MAX</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *res = m == <span class="Constant">0</span> ? <span class="Constant">0.</span> : <span class="Constant">HUGE_VAL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* regular exponent <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; exp = e;<br/></li>
<li>&nbsp; &nbsp; &nbsp; s = p;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* stop at next loop iteration */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">default</span>: {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Nonzero digit */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Type">int</span> d;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'0'</span> &amp;&amp; c &lt;= <span class="Constant">'9'</span>) d = c - <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c &gt;= <span class="Constant">'<a href="shared_heap.c.html#L657" title="ocaml/runtime/shared_heap.c:657">A</a>'</span> &amp;&amp; c &lt;= <span class="Constant">'F'</span>) d = c - <span class="Constant">'<a href="shared_heap.c.html#L657" title="ocaml/runtime/shared_heap.c:657">A</a>'</span> + <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c &gt;= <span class="Constant">'a'</span> &amp;&amp; c &lt;= <span class="Constant">'f'</span>) d = c - <span class="Constant">'a'</span> + <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">return</span> -<span class="Constant">1</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* bad digit */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; n_bits += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d == <span class="Constant">0</span> &amp;&amp; m == <span class="Constant">0</span>) <span class="Statement">break</span>; <span class="Comment">/* leading zeros are skipped */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (m_bits &lt; <span class="Constant">60</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* There is still room in m.&nbsp; Add this digit to the mantissa. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; m = (m &lt;&lt; <span class="Constant">4</span>) + d;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; m_bits += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* We've already collected 60 significant bits in m.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Now all we care about is whether there is a nonzero bit<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; after. In this case, round m to odd so that the later<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rounding of m to FP produces the correct result. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d != <span class="Constant">0</span>) m |= <span class="Constant">1</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* round to odd */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; x_bits += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (n_bits == <span class="Constant">0</span>) <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; <span class="Comment">/* Convert mantissa to FP.&nbsp; We use a signed conversion because we can<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; (m has 60 bits at most) <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> because it is faster<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; on several architectures. */<br/></li>
<li></span>&nbsp; f = (<span class="Type">double</span>) (<span class="Type"><a href="caml/config.h.html#L127" title="ocaml/runtime/caml/config.h:127">int64_t</a></span>) m;<br/></li>
<li>&nbsp; <span class="Comment">/* Adjust exponent to take decimal point <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> extra digits into account */<br/></li>
<li></span>&nbsp; {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span> adj = x_bits;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dec_point &gt;= <span class="Constant">0</span>) adj = adj + (dec_point - n_bits);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* saturated addition exp + adj */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (adj &gt; <span class="Constant">0</span> &amp;&amp; exp &gt; <span class="Constant">INT_MAX</span> - adj)<br/></li>
<li>&nbsp; &nbsp; &nbsp; exp = <span class="Constant">INT_MAX</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (adj &lt; <span class="Constant">0</span> &amp;&amp; exp &lt; <span class="Constant">INT_MIN</span> - adj)<br/></li>
<li>&nbsp; &nbsp; &nbsp; exp = <span class="Constant">INT_MIN</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; exp = exp + adj;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Comment">/* Apply exponent if needed */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (exp != <span class="Constant">0</span>) f = ldexp(f, exp);<br/></li>
<li>&nbsp; <span class="Comment">/* Done! */<br/></li>
<li></span>&nbsp; *res = f;<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L374">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_float_of_string</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vs)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Type">char</span> parse_buffer[<span class="Constant">64</span>];<br/></li>
<li>&nbsp; <span class="Type">char</span> * buf, * dst, * end;<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *src;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> len;<br/></li>
<li>&nbsp; <span class="Type">int</span> sign;<br/></li>
<li>&nbsp; <span class="Type">double</span> d;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* Remove '_' characters before conversion */<br/></li>
<li></span>&nbsp; len = <a href="str.c.html#L31" title="ocaml/runtime/str.c:31">caml_string_length</a>(vs);<br/></li>
<li>&nbsp; buf = len &lt; <span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span>(parse_buffer) ? parse_buffer : <a href="memory.c.html#L550" title="ocaml/runtime/memory.c:550">caml_stat_alloc</a>(len + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; src = <a href="caml/mlvalues.h.html#L329" title="ocaml/runtime/caml/mlvalues.h:329">String_val</a>(vs);<br/></li>
<li>&nbsp; dst = buf;<br/></li>
<li>&nbsp; <span class="Statement">while</span> (len--) {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span> c = *src++;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c != <span class="Constant">'_'</span>) *dst++ = c;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; *dst = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (dst == buf) <span class="Statement">goto</span> <a href="startup_byt.c.html#L77" title="ocaml/runtime/startup_byt.c:77">error</a>;<br/></li>
<li>&nbsp; <span class="Comment">/* Check for hexadecimal FP constant */<br/></li>
<li></span>&nbsp; src = buf;<br/></li>
<li>&nbsp; sign = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (*src == <span class="Constant">'-'</span>) { sign = -<span class="Constant">1</span>; src++; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*src == <span class="Constant">'+'</span>) { src++; };<br/></li>
<li>&nbsp; <span class="Statement">if</span> (src[<span class="Constant">0</span>] == <span class="Constant">'0'</span> &amp;&amp; (src[<span class="Constant">1</span>] == <span class="Constant">'x'</span> || src[<span class="Constant">1</span>] == <span class="Constant">'X'</span>)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Convert using our hexadecimal FP parser */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L285" title="ocaml/runtime/floats.c:285">caml_float_of_hex</a>(src + <span class="Constant">2</span>, dst, &amp;d) == -<span class="Constant">1</span>) <span class="Statement">goto</span> <a href="startup_byt.c.html#L77" title="ocaml/runtime/startup_byt.c:77">error</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sign &lt; <span class="Constant">0</span>) d = -d;<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Convert using strtod */<br/></li>
<li></span><span class="PreProc">#if defined(HAS_STRTOD_L) &amp;&amp; defined(<a href="caml/config.h.html#L54" title="ocaml/runtime/caml/config.h:54">HAS_LOCALE</a>)<br/></li>
<li></span>&nbsp; &nbsp; d = <a href="#L59" title="ocaml/runtime/floats.c:59">strtod_l</a>((<span class="Type">const</span> <span class="Type">char</span> *) buf, &amp;end, <a href="#L112" title="ocaml/runtime/floats.c:112">caml_locale</a>);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L117" title="ocaml/runtime/floats.c:117">USE_LOCALE</a>;<br/></li>
<li>&nbsp; &nbsp; d = strtod((<span class="Type">const</span> <span class="Type">char</span> *) buf, &amp;end);<br/></li>
<li>&nbsp; &nbsp; <a href="#L118" title="ocaml/runtime/floats.c:118">RESTORE_LOCALE</a>;<br/></li>
<li><span class="PreProc">#endif</span> <span class="Comment">/* HAS_STRTOD_L */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (end != dst) <span class="Statement">goto</span> <a href="startup_byt.c.html#L77" title="ocaml/runtime/startup_byt.c:77">error</a>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (buf != parse_buffer) <a href="memory.c.html#L559" title="ocaml/runtime/memory.c:559">caml_stat_free</a>(buf);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(d);<br/></li>
<li> <span class="Statement"><a href="startup_byt.c.html#L77" title="ocaml/runtime/startup_byt.c:77">error</a></span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (buf != parse_buffer) <a href="memory.c.html#L559" title="ocaml/runtime/memory.c:559">caml_stat_free</a>(buf);<br/></li>
<li>&nbsp; <a href="fail_nat.c.html#L130" title="ocaml/runtime/fail_nat.c:130">caml_failwith</a>(<span class="Constant">&quot;float_of_string&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>; <span class="Comment">/* not reached */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L422">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_int_of_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L77" title="ocaml/runtime/caml/mlvalues.h:77">Val_long</a>((<a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a>) <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L427">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_float_of_int</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>((<span class="Type">double</span>) <a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(n));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L432">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_neg_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(- <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L437">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_abs_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(fabs(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L442">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_add_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f) + <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L447">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_sub_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f) - <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L452">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_mul_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f) * <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L457">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_div_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f) / <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L462">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_exp_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(exp(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L467">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_exp2</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> exp2(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> pow(<span class="Constant">2</span>, x);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L476">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_exp2_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L467" title="ocaml/runtime/floats.c:467">caml_exp2</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L481">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_trunc</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> trunc(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> (x &gt;= <span class="Constant">0.0</span>)? floor(x) : ceil(x);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L490">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_trunc_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L481" title="ocaml/runtime/floats.c:481">caml_trunc</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L495">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_round</span>(<span class="Type">double</span> f)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_WORKING_ROUND<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> round(f);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Type">union</span> { <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> i; <span class="Type">double</span> d; } u, pred_one_half; <span class="Comment">/* predecessor of 0.5 */<br/></li>
<li></span>&nbsp; <span class="Type">int</span> e;&nbsp; <span class="Comment">/* exponent */<br/></li>
<li></span>&nbsp; u.d = f;<br/></li>
<li>&nbsp; e = (u.i &gt;&gt; <span class="Constant">52</span>) &amp; <span class="Constant">0x7ff</span>; <span class="Comment">/* - 0x3ff for the actual exponent */<br/></li>
<li></span>&nbsp; pred_one_half.i = <span class="Constant">0x3FDFFFFFFFFFFFFF</span>; <span class="Comment">/* 0x1.FFFFFFFFFFFFFp-2 */<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="#L71" title="ocaml/runtime/floats.c:71">isfinite</a>(f) &amp;&amp; f != <span class="Constant">0.</span>) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (e &gt;= <span class="Constant">52</span> + <span class="Constant">0x3ff</span>) <span class="Statement">return</span> f; <span class="Comment">/* f is an integer already */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (f &gt; <span class="Constant">0.0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* If we added 0.5 instead of its predecessor, then the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; predecessor of 0.5 would be rounded to 1. instead of 0. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> floor(f + pred_one_half.d);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ceil(f - pred_one_half.d);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> f;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L520">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_round_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L495" title="ocaml/runtime/floats.c:495">caml_round</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L525">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_floor_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(floor(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L530">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_nextafter</span>(<span class="Type">double</span> x, <span class="Type">double</span> y)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L74" title="ocaml/runtime/floats.c:74">nextafter</a>(x, y);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L535">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_nextafter_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> x, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> y)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L530" title="ocaml/runtime/floats.c:530">caml_nextafter</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(x), <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(y)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef HAS_WORKING_FMA<br/></li>
<li><a id="L541">&#x200c;</a></span><span class="Type">union</span> <span class="linkable">double_as_int64</span> { <span class="Type">double</span> d; <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> i; };<br/></li>
<li><a id="L542">&#x200c;</a><span class="PreProc">#define <span class="linkable">IEEE754_DOUBLE_BIAS</span> </span><span class="Constant">0x3ff<br/></li>
<li><a id="L543">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IEEE_EXPONENT</span>(N) (((N) &gt;&gt; </span><span class="Constant">52</span><span class="PreProc">) &amp; </span><span class="Constant">0x7ff</span><span class="PreProc">)<br/></li>
<li><a id="L544">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IEEE_NEGATIVE</span>(N) ((N) &gt;&gt; </span><span class="Constant">63</span><span class="PreProc">)<br/></li>
<li></span><span class="Comment">//C99 hexa float literals cannot be used, use pow() instead.<br/></li>
<li><a id="L546">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">FL53</span>&nbsp; &nbsp; (pow(</span><span class="Constant">2</span><span class="PreProc">,</span><span class="Constant">53</span><span class="PreProc">)) </span><span class="Comment">//0x1p53<br/></li>
<li><a id="L547">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">FLM53</span>&nbsp;&nbsp; (pow(</span><span class="Constant">2</span><span class="PreProc">,-</span><span class="Constant">53</span><span class="PreProc">)) </span><span class="Comment">//0x1p-53<br/></li>
<li><a id="L548">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">FL54</span>&nbsp; &nbsp; (pow(</span><span class="Constant">2</span><span class="PreProc">,</span><span class="Constant">54</span><span class="PreProc">)) </span><span class="Comment">//0x1p54<br/></li>
<li><a id="L549">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">FLM54</span>&nbsp;&nbsp; (pow(</span><span class="Constant">2</span><span class="PreProc">,-</span><span class="Constant">54</span><span class="PreProc">)) </span><span class="Comment">//0x1p-54<br/></li>
<li><a id="L550">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">FL108</span>&nbsp;&nbsp; (pow(</span><span class="Constant">2</span><span class="PreProc">,</span><span class="Constant">108</span><span class="PreProc">)) </span><span class="Comment">//0x1p108<br/></li>
<li><a id="L551">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">FLM108</span>&nbsp; (pow(</span><span class="Constant">2</span><span class="PreProc">,-</span><span class="Constant">108</span><span class="PreProc">)) </span><span class="Comment">//0x1p-108<br/></li>
<li><a id="L552">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">FLM1074</span> (pow(</span><span class="Constant">2</span><span class="PreProc">,-</span><span class="Constant">1074</span><span class="PreProc">)) </span><span class="Comment">//0x1p-1074<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><a id="L555">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_fma</span>(<span class="Type">double</span> x, <span class="Type">double</span> y, <span class="Type">double</span> z)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_WORKING_FMA<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> fma(x, y, z);<br/></li>
<li><span class="PreProc">#else</span> <span class="Comment">// Emulation of FMA, from S. Boldo <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> G. Melquiond, &quot;Emulation<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">// of a FMA <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> Correctly Rounded Sums: Proved Algorithms Using<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">// Rounding to Odd,&quot; in IEEE Transactions on Computers, vol. 57,<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">// no. 4, pp. 462-471, April 2008. Special cases implementation<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">// comes from glibc's IEEE754 FMA emulation.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">// Only valid for double precision <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> round-to-nearest mode.<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Type">union</span> <a href="#L541" title="ocaml/runtime/floats.c:541">double_as_int64</a> u, v, w;<br/></li>
<li>&nbsp; <span class="Type">union</span> <a href="#L541" title="ocaml/runtime/floats.c:541">double_as_int64</a> ora;<br/></li>
<li>&nbsp; <span class="Type">double</span> mh, ml, xh, xl, yh, yl, t;<br/></li>
<li>&nbsp; <span class="Type">double</span> ah, al;<br/></li>
<li>&nbsp; <span class="Type">double</span> orah, oral;<br/></li>
<li>&nbsp; <span class="Type">double</span> t1, t2;<br/></li>
<li>&nbsp; <span class="Type">double</span> tiny;<br/></li>
<li>&nbsp; <span class="Type">int</span> <a href="ints.c.html#L458" title="ocaml/runtime/ints.c:458">neg</a>, adjust = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; u.d = x;<br/></li>
<li>&nbsp; v.d = y;<br/></li>
<li>&nbsp; w.d = z;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> ( <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) + <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i) &gt;= <span class="Constant">0x7FF</span> +<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <a href="#L542" title="ocaml/runtime/floats.c:542">IEEE754_DOUBLE_BIAS</a> - <span class="Constant">DBL_MANT_DIG<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; || <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) &gt;= <span class="Constant">0x7ff</span> - <span class="Constant">DBL_MANT_DIG<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; || <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i) &gt;= <span class="Constant">0x7ff</span> - <span class="Constant">DBL_MANT_DIG<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; || <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(w.i) &gt;= <span class="Constant">0x7ff</span> - <span class="Constant">DBL_MANT_DIG<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; || <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) + <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i) &lt;=<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L542" title="ocaml/runtime/floats.c:542">IEEE754_DOUBLE_BIAS</a> + <span class="Constant">DBL_MANT_DIG</span> )<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* If z is Inf, but x <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> y are finite, the result should be z<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; * rather than NaN. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(w.i) == <span class="Constant">0x7ff</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) != <span class="Constant">0x7ff</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i) != <span class="Constant">0x7ff</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (z + x) + y;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* If z is zero <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> x <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> y are nonzero, compute the result as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; x * y to avoid the wrong sign of a zero result if x * y<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; underflows to 0. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (z == <span class="Constant">0</span> &amp;&amp; x != <span class="Constant">0</span> &amp;&amp; y != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> x * y;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* If x <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> y <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> z is Inf/NaN, <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> if x * y is zero, compute as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; x * y + z.&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) == <span class="Constant">0x7ff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i) == <span class="Constant">0x7ff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(w.i) == <span class="Constant">0x7ff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || x == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || y == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> x * y + z;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* If fma will certainly overflow, compute as x * y. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) + <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt; <span class="Constant">0x7ff</span> + <a href="#L542" title="ocaml/runtime/floats.c:542">IEEE754_DOUBLE_BIAS</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> x * y;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* If x * y is less than 1/4 of DBL_TRUE_MIN, neither the result<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; nor whether there is underflow depends on its exact <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; only on its sign. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) + <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; <a href="#L542" title="ocaml/runtime/floats.c:542">IEEE754_DOUBLE_BIAS</a> - <span class="Constant">DBL_MANT_DIG</span> - <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ints.c.html#L458" title="ocaml/runtime/ints.c:458">neg</a> = <a href="#L544" title="ocaml/runtime/floats.c:544">IEEE_NEGATIVE</a>(u.i) ^ <a href="#L544" title="ocaml/runtime/floats.c:544">IEEE_NEGATIVE</a>(v.i) ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tiny = <a href="ints.c.html#L458" title="ocaml/runtime/ints.c:458">neg</a> ? -<a href="#L552" title="ocaml/runtime/floats.c:552">FLM1074</a> : <a href="#L552" title="ocaml/runtime/floats.c:552">FLM1074</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(w.i) &gt;= <span class="Constant">3</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> tiny + z;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Scaling up, adding TINY <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> scaling down produces the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; correct result, because in round-to-nearest mode adding<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; TINY has no effect <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> in other modes double rounding is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; harmless. But it may not produce required underflow<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exceptions. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v.d = z * <a href="#L548" title="ocaml/runtime/floats.c:548">FL54</a> + tiny;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> v.d * <a href="#L549" title="ocaml/runtime/floats.c:549">FLM54</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) + <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;= <span class="Constant">0x7ff</span> + <a href="#L542" title="ocaml/runtime/floats.c:542">IEEE754_DOUBLE_BIAS</a> - <span class="Constant">DBL_MANT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Compute 1p-53 times smaller result <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> multiply at the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; end.&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) &gt; <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x *= <a href="#L547" title="ocaml/runtime/floats.c:547">FLM53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y *= <a href="#L547" title="ocaml/runtime/floats.c:547">FLM53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* If x + y exponent is very large <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> z exponent is very small,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; it doesn't matter if we don't adjust it.&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(w.i) &gt; <span class="Constant">DBL_MANT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z *= <a href="#L547" title="ocaml/runtime/floats.c:547">FLM53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; adjust = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(w.i) &gt;= <span class="Constant">0x7ff</span> - <span class="Constant">DBL_MANT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Similarly. If z exponent is very large <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> x <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> y<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exponents are very small, adjust them up to avoid<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; spurious underflows, rather than down.&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) + <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;= <a href="#L542" title="ocaml/runtime/floats.c:542">IEEE754_DOUBLE_BIAS</a> + <span class="Constant">2</span> * <span class="Constant">DBL_MANT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) &gt; <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x *= <a href="#L550" title="ocaml/runtime/floats.c:550">FL108</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y *= <a href="#L550" title="ocaml/runtime/floats.c:550">FL108</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) &gt; <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) &gt; <span class="Constant">DBL_MANT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x *= <a href="#L547" title="ocaml/runtime/floats.c:547">FLM53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i) &gt; <span class="Constant">DBL_MANT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y *= <a href="#L547" title="ocaml/runtime/floats.c:547">FLM53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z *= <a href="#L547" title="ocaml/runtime/floats.c:547">FLM53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; adjust = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) &gt;= <span class="Constant">0x7ff</span> - <span class="Constant">DBL_MANT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x *= <a href="#L547" title="ocaml/runtime/floats.c:547">FLM53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y *= <a href="#L546" title="ocaml/runtime/floats.c:546">FL53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i) &gt;= <span class="Constant">0x7ff</span> - <span class="Constant">DBL_MANT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y *= <a href="#L547" title="ocaml/runtime/floats.c:547">FLM53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x *= <a href="#L546" title="ocaml/runtime/floats.c:546">FL53</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Comment">/* if (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) + <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i) &lt;=<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L542" title="ocaml/runtime/floats.c:542">IEEE754_DOUBLE_BIAS</a> + DBL_MANT_DIG) */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(u.i) &gt; <a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(v.i))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x *= <a href="#L550" title="ocaml/runtime/floats.c:550">FL108</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y *= <a href="#L550" title="ocaml/runtime/floats.c:550">FL108</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L543" title="ocaml/runtime/floats.c:543">IEEE_EXPONENT</a>(w.i) &lt;= <span class="Constant">4</span> * <span class="Constant">DBL_MANT_DIG</span> + <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z *= <a href="#L550" title="ocaml/runtime/floats.c:550">FL108</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; adjust = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* Ensure correct sign of exact 0 + 0.&nbsp; */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> ((x == <span class="Constant">0</span> || y == <span class="Constant">0</span>) &amp;&amp; z == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> x * y + z;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">// Error-free multiplication: mh + ml = x * y<br/></li>
<li></span>&nbsp; mh = x * y;<br/></li>
<li>&nbsp; t = x * <span class="Constant">134217729.0</span>;<br/></li>
<li>&nbsp; xh = t - (t - x);<br/></li>
<li>&nbsp; xl = x - xh;<br/></li>
<li>&nbsp; t = y * <span class="Constant">134217729.0</span>;<br/></li>
<li>&nbsp; yh = t - (t - y);<br/></li>
<li>&nbsp; yl = y - yh;<br/></li>
<li>&nbsp; ml = xl * yl - (((mh - xh * yh) - xl * yh) - xh * yl);<br/></li>
<li>&nbsp; <span class="Comment">// Error-free addition: ah + al = z + mh<br/></li>
<li></span>&nbsp; ah = z + mh;<br/></li>
<li>&nbsp; t = ah - z;<br/></li>
<li>&nbsp; al = (z - (ah - t)) + (mh - t);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* If the result is an exact zero, ensure it has the correct sign. */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (ah == <span class="Constant">0</span> &amp;&amp; ml == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> z + mh;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">// Normalize ah, al, ml.<br/></li>
<li></span>&nbsp; t1 = al + ml;<br/></li>
<li>&nbsp; t = t1 - al;<br/></li>
<li>&nbsp; t2 = (al - (t1 - t)) + (ml - t);<br/></li>
<li>&nbsp; al = t1;<br/></li>
<li>&nbsp; ml = t2;<br/></li>
<li>&nbsp; t1 = ah + al;<br/></li>
<li>&nbsp; t = t1 - ah;<br/></li>
<li>&nbsp; t2 = (ah - (t1 - t)) + (al - t);<br/></li>
<li>&nbsp; ah = t1;<br/></li>
<li>&nbsp; al = t2;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">// Odd-rounded addition: ora = al + ml.<br/></li>
<li></span>&nbsp; orah = al + ml;<br/></li>
<li>&nbsp; oral = (al - orah) + ml;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> ( oral != <span class="Constant">0.0</span> )<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; ora.d = orah;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ( !(ora.i &amp; <span class="Constant">1</span>) )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ( (oral &gt; <span class="Constant">0.0</span>) ^ (orah &lt; <span class="Constant">0.0</span>) )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ora.i++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ora.i--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; orah = ora.d;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">// Rounded addition: ra = ah + orah.<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> ( adjust &gt; <span class="Constant">0</span> )<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (ah + orah) * <a href="#L546" title="ocaml/runtime/floats.c:546">FL53</a>;<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> ( adjust &lt; <span class="Constant">0</span> )<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (ah + orah) * <a href="#L551" title="ocaml/runtime/floats.c:551">FLM108</a>;<br/></li>
<li>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> ah + orah;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L751">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_fma_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f1, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f2, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f3)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L555" title="ocaml/runtime/floats.c:555">caml_fma</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f1),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f2), <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f3)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L757">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_fmod_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f1, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f2)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(fmod(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f1), <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f2)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L762">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_frexp_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L270" title="ocaml/runtime/caml/memory.h:270">CAMLparam0</a> ();<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L376" title="ocaml/runtime/caml/memory.h:376">CAMLlocal1</a> (mantissa);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> res;<br/></li>
<li>&nbsp; <span class="Type">int</span> exponent;<br/></li>
<li><br/></li>
<li>&nbsp; mantissa = <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(frexp (<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f), &amp;exponent));<br/></li>
<li>&nbsp; res = <a href="alloc.c.html#L158" title="ocaml/runtime/alloc.c:158">caml_alloc_small</a>(<span class="Constant">2</span>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(res, <span class="Constant">0</span>) = mantissa;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(res, <span class="Constant">1</span>) = <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(exponent);<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a> (res);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">// Seems dumb but <a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> could not correspond to int type.<br/></li>
<li><a id="L777">&#x200c;</a></span><span class="Type">double</span> <span class="linkable">caml_ldexp_float_unboxed</span>(<span class="Type">double</span> f, <a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> i)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> ldexp(f, (<span class="Type">int</span>) i);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L783">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_ldexp_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> i)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(ldexp(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f), <a href="caml/mlvalues.h.html#L82" title="ocaml/runtime/caml/mlvalues.h:82">Int_val</a>(i)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L788">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_log_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(log(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L793">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_log10_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(log10(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L798">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_log2</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> log2(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> log(x) * <span class="Constant"><a href="#L79" title="ocaml/runtime/floats.c:79">M_LOG2E</a></span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L807">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_log2_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L798" title="ocaml/runtime/floats.c:798">caml_log2</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L812">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_modf_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L270" title="ocaml/runtime/caml/memory.h:270">CAMLparam0</a> ();<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L380" title="ocaml/runtime/caml/memory.h:380">CAMLlocal2</a> (quo, rem);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> res;<br/></li>
<li>&nbsp; <span class="Type">double</span> frem;<br/></li>
<li><br/></li>
<li>&nbsp; quo = <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(modf (<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f), &amp;frem));<br/></li>
<li>&nbsp; rem = <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(frem);<br/></li>
<li>&nbsp; res = <a href="alloc.c.html#L158" title="ocaml/runtime/alloc.c:158">caml_alloc_small</a>(<span class="Constant">2</span>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(res, <span class="Constant">0</span>) = quo;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(res, <span class="Constant">1</span>) = rem;<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a> (res);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L827">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_sqrt_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(sqrt(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L832">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_cbrt</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> cbrt(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">double</span> third = <span class="Constant">1.0</span> / <span class="Constant">3.0</span>;<br/></li>
<li>&nbsp; <span class="Type">double</span> res = exp(third * log(fabs(x)));<br/></li>
<li>&nbsp; <span class="Statement">return</span> (x &gt;= <span class="Constant">0</span>) ? res : -res;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L843">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_cbrt_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L832" title="ocaml/runtime/floats.c:832">caml_cbrt</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L848">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_power_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(pow(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f), <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L853">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_sin_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(sin(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L858">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_sinh_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(sinh(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L863">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_cos_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(cos(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L868">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_cosh_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(cosh(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L873">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_tan_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(tan(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L878">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_tanh_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(tanh(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L883">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_asin_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(asin(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L888">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_asinh</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> asinh(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> log(x + sqrt(x * x + <span class="Constant">1.0</span>));<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L897">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_asinh_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L888" title="ocaml/runtime/floats.c:888">caml_asinh</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L902">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_acos_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(acos(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L907">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_acosh</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> acosh(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> log(x + sqrt(x * x - <span class="Constant">1.0</span>));<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L916">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_acosh_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L907" title="ocaml/runtime/floats.c:907">caml_acosh</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L921">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_atan_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(atan(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L926">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_atanh</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> atanh(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">0.5</span> * log((<span class="Constant">1.0</span> + x) / (<span class="Constant">1.0</span> - x));<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L935">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_atanh_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L926" title="ocaml/runtime/floats.c:926">caml_atanh</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L940">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_atan2_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(atan2(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f), <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L945">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_ceil_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(ceil(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L950">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_hypot</span>(<span class="Type">double</span> x, <span class="Type">double</span> y)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> hypot(x, y);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Type">double</span> tmp, ratio;<br/></li>
<li>&nbsp; x = fabs(x); y = fabs(y);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (x != x) <span class="Comment">/* x is NaN */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> y &gt; <span class="Constant">DBL_MAX</span> ? y : x;&nbsp; <span class="Comment">/* PR#6321 */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (y != y) <span class="Comment">/* y is NaN */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> x &gt; <span class="Constant">DBL_MAX</span> ? x : y;&nbsp; <span class="Comment">/* PR#6321 */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (x &lt; y) { tmp = x; x = y; y = tmp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (x == <span class="Constant">0.0</span>) <span class="Statement">return</span> <span class="Constant">0.0</span>;<br/></li>
<li>&nbsp; ratio = y / x;<br/></li>
<li>&nbsp; <span class="Statement">return</span> x * sqrt(<span class="Constant">1.0</span> + ratio * ratio);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L968">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_hypot_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L950" title="ocaml/runtime/floats.c:950">caml_hypot</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f), <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* These emulations of expm1() <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> log1p() are due to William Kahan.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; See http://www.plunk.org/~hatch/rightway.php */<br/></li>
<li><a id="L975">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_expm1</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> expm1(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Type">double</span> u = exp(x);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (u == <span class="Constant">1.</span>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> x;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (u - <span class="Constant">1.</span> == -<span class="Constant">1.</span>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1.</span>;<br/></li>
<li>&nbsp; <span class="Statement">return</span> (u - <span class="Constant">1.</span>) * x / log(u);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L989">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_log1p</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> log1p(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Type">double</span> u = <span class="Constant">1.</span> + x;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (u == <span class="Constant">1.</span>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> x;<br/></li>
<li>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> log(u) * x / (u - <span class="Constant">1.</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L1002">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_expm1_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L975" title="ocaml/runtime/floats.c:975">caml_expm1</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L1007">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_log1p_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L989" title="ocaml/runtime/floats.c:989">caml_log1p</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef HAS_C99_FLOAT_OPS<br/></li>
<li><a id="L1013">&#x200c;</a></span><a href="caml/config.h.html#L42" title="ocaml/runtime/caml/config.h:42">Caml_inline</a> <span class="Type">double</span> <span class="linkable">simple_erf</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Comment">/* This algorithm for calculating the <a href="startup_byt.c.html#L77" title="ocaml/runtime/startup_byt.c:77">error</a> function is based on formula<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; 7.1.26 from the &quot;Handbook of Mathematical Functions&quot; by Abramowitz<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> Stegun.&nbsp; The implementation using Horner's method for evaluating the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; polynomial approximation is derived from Python code by John D. Cook. */<br/></li>
<li></span>&nbsp; <span class="Type">double</span> a1 =&nbsp; <span class="Constant">0.254829592</span>, a2 = -<span class="Constant">0.284496736</span>, a3 = <span class="Constant">1.421413741</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; a4 = -<span class="Constant">1.453152027</span>, a5 =&nbsp; <span class="Constant">1.061405429</span>, p&nbsp; = <span class="Constant">0.3275911</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; t, y;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Type">int</span> sign = (x &gt;= <span class="Constant">0</span>) ? <span class="Constant">1</span> : -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; x = fabs(x);<br/></li>
<li>&nbsp; t = <span class="Constant">1.0</span> / (<span class="Constant">1.0</span> + p * x);<br/></li>
<li>&nbsp; y = <span class="Constant">1.0</span> - (((((a5 *t&nbsp; + a4) * t) + a3) * t + a2) * t + a1) * t * exp(-x * x);<br/></li>
<li>&nbsp; <span class="Statement">return</span> sign * y;<br/></li>
<li>}<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><a id="L1031">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_erf</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> erf(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <a href="#L1013" title="ocaml/runtime/floats.c:1013">simple_erf</a>(x);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L1040">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_erf_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L1031" title="ocaml/runtime/floats.c:1031">caml_erf</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L1045">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_erfc</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> erfc(x);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">1.0</span> - <a href="#L1013" title="ocaml/runtime/floats.c:1013">simple_erf</a>(x);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L1054">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_erfc_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L1045" title="ocaml/runtime/floats.c:1045">caml_erfc</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L1059">&#x200c;</a><span class="Type">union</span> <span class="linkable">double_as_two_int32</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">double</span> d;<br/></li>
<li><span class="PreProc">#if defined(ARCH_BIG_ENDIAN) || (defined(__arm__) &amp;&amp; !defined(__ARM_EABI__))<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> { <span class="Type"><a href="caml/config.h.html#L126" title="ocaml/runtime/caml/config.h:126">uint32_t</a></span> h; <span class="Type"><a href="caml/config.h.html#L126" title="ocaml/runtime/caml/config.h:126">uint32_t</a></span> l; } i;<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> { <span class="Type"><a href="caml/config.h.html#L126" title="ocaml/runtime/caml/config.h:126">uint32_t</a></span> l; <span class="Type"><a href="caml/config.h.html#L126" title="ocaml/runtime/caml/config.h:126">uint32_t</a></span> h; } i;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><a id="L1068">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">double</span> <span class="linkable">caml_copysign</span>(<span class="Type">double</span> x, <span class="Type">double</span> y)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> copysign(x, y);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Type">union</span> <a href="#L1059" title="ocaml/runtime/floats.c:1059">double_as_two_int32</a> ux, uy;<br/></li>
<li>&nbsp; ux.d = x;<br/></li>
<li>&nbsp; uy.d = y;<br/></li>
<li>&nbsp; ux.i.h &amp;= <span class="Constant">0x7FFFFFFFU</span>;<br/></li>
<li>&nbsp; ux.i.h |= (uy.i.h &amp; <span class="Constant">0x80000000U</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> ux.d;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L1082">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_copysign_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L152" title="ocaml/runtime/floats.c:152">caml_copy_double</a>(<a href="#L1068" title="ocaml/runtime/floats.c:1068">caml_copysign</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f), <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L1087">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_signbit</span>(<span class="Type">double</span> x)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef HAS_C99_FLOAT_OPS<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L423" title="ocaml/runtime/caml/mlvalues.h:423">Val_bool</a>(signbit(x));<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Type">union</span> <a href="#L1059" title="ocaml/runtime/floats.c:1059">double_as_two_int32</a> ux;<br/></li>
<li>&nbsp; ux.d = x;<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L423" title="ocaml/runtime/caml/mlvalues.h:423">Val_bool</a>(ux.i.h &gt;&gt; <span class="Constant">31</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L1098">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_signbit_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L1087" title="ocaml/runtime/floats.c:1087">caml_signbit</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L1103">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_neq_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L423" title="ocaml/runtime/caml/mlvalues.h:423">Val_bool</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f) != <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L1108">&#x200c;</a><span class="PreProc">#define <span class="linkable">DEFINE_NAN_CMP</span>(op) (<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g) \<br/></li>
<li></span><span class="PreProc">{ \<br/></li>
<li></span><span class="PreProc">&nbsp; </span><span class="Statement">return</span><span class="PreProc"> <a href="caml/mlvalues.h.html#L423" title="ocaml/runtime/caml/mlvalues.h:423">Val_bool</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(f) op <a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(g)); \<br/></li>
<li></span><span class="PreProc">}<br/></li>
<li></span><br/></li>
<li><a id="L1113">&#x200c;</a><a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> <span class="linkable">caml_float_compare_unboxed</span>(<span class="Type">double</span> f, <span class="Type">double</span> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Comment">/* If one <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> both of f <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> g is NaN, order according to the convention<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; NaN = NaN <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> NaN &lt; x for all other floats x. */<br/></li>
<li></span>&nbsp; <span class="Comment">/* This branchless implementation is from GPR#164.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Note that [f == f] if <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> only if f is not NaN.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; We expand each subresult of the expression to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; avoid sign-extension on 64bit. GPR#2250.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; See also translation of Pcompare_floats in asmcomp/cmmgen.ml&nbsp; */<br/></li>
<li></span>&nbsp; <a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> res =<br/></li>
<li>&nbsp; &nbsp; (<a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a>)(f &gt; g) - (<a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a>)(f &lt; g) + (<a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a>)(f == f) - (<a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a>)(g == g);<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> caml_eq_float <a href="#L1108" title="ocaml/runtime/floats.c:1108">DEFINE_NAN_CMP</a>(==)<br/></li>
<li><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> caml_le_float <a href="#L1108" title="ocaml/runtime/floats.c:1108">DEFINE_NAN_CMP</a>(&lt;=)<br/></li>
<li><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> caml_lt_float <a href="#L1108" title="ocaml/runtime/floats.c:1108">DEFINE_NAN_CMP</a>(&lt;)<br/></li>
<li><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> caml_ge_float <a href="#L1108" title="ocaml/runtime/floats.c:1108">DEFINE_NAN_CMP</a>(&gt;=)<br/></li>
<li><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> caml_gt_float <a href="#L1108" title="ocaml/runtime/floats.c:1108">DEFINE_NAN_CMP</a>(&gt;)<br/></li>
<li><br/></li>
<li><a id="L1133">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_float_compare</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vf, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vg)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(<a href="#L1113" title="ocaml/runtime/floats.c:1113">caml_float_compare_unboxed</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(vf),<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(vg)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">enum</span> { FP_normal, FP_subnormal, FP_zero, FP_infinite, FP_nan };<br/></li>
<li><br/></li>
<li><a id="L1140">&#x200c;</a><a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_classify_float_unboxed</span>(<span class="Type">double</span> vd)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef ARCH_SIXTYFOUR<br/></li>
<li></span>&nbsp; <span class="Type">union</span> { <span class="Type">double</span> d; <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> i; } u;<br/></li>
<li>&nbsp; <span class="Type"><a href="caml/config.h.html#L128" title="ocaml/runtime/caml/config.h:128">uint64_t</a></span> n;<br/></li>
<li>&nbsp; <span class="Type"><a href="caml/config.h.html#L126" title="ocaml/runtime/caml/config.h:126">uint32_t</a></span> e;<br/></li>
<li><br/></li>
<li>&nbsp; u.d = vd;<br/></li>
<li>&nbsp; n = u.i &lt;&lt; <span class="Constant">1</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* shift sign bit off */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_zero);<br/></li>
<li>&nbsp; e = n &gt;&gt; <span class="Constant">53</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* extract exponent */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (e == <span class="Constant">0</span>) <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_subnormal);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (e == <span class="Constant">0x7FF</span>) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n &lt;&lt; <span class="Constant">11</span> == <span class="Constant">0</span>)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* shift exponent off */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_infinite);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_nan);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_normal);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Type">union</span> <a href="#L1059" title="ocaml/runtime/floats.c:1059">double_as_two_int32</a> u;<br/></li>
<li>&nbsp; <span class="Type"><a href="caml/config.h.html#L126" title="ocaml/runtime/caml/config.h:126">uint32_t</a></span> h, l;<br/></li>
<li><br/></li>
<li>&nbsp; u.d = vd;<br/></li>
<li>&nbsp; h = u.i.h;&nbsp; l = u.i.l;<br/></li>
<li>&nbsp; l = l | (h &amp; <span class="Constant">0xFFFFF</span>);<br/></li>
<li>&nbsp; h = h &amp; <span class="Constant">0x7FF00000</span>;<br/></li>
<li>&nbsp; <span class="Statement">if</span> ((h | l) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_zero);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (h == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_subnormal);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (h == <span class="Constant">0x7FF00000</span>) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (l == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_infinite);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_nan);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(FP_normal);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L1181">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_classify_float</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vd)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L1140" title="ocaml/runtime/floats.c:1140">caml_classify_float_unboxed</a>(<a href="caml/mlvalues.h.html#L339" title="ocaml/runtime/caml/mlvalues.h:339">Double_val</a>(vd));<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
