<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/runtime/backtrace.c - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/runtime/backtrace.c - ocaml</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L51">caml_backtrace_status</a></li>
<li><a href="#L236">caml_convert_debuginfo</a></li>
<li><a href="#L272">caml_convert_raw_backtrace</a></li>
<li><a href="#L263">caml_convert_raw_backtrace_slot</a></li>
<li><a href="#L351">caml_get_exception_backtrace</a></li>
<li><a href="#L155">caml_get_exception_raw_backtrace</a></li>
<li><a href="#L149">caml_ml_debug_info_status</a></li>
<li><a href="#L99">caml_print_exception_backtrace</a></li>
<li><a href="#L307">caml_raw_backtrace_length</a></li>
<li><a href="#L325">caml_raw_backtrace_next_slot</a></li>
<li><a href="#L312">caml_raw_backtrace_slot</a></li>
<li><a href="#L44">caml_record_backtrace</a></li>
<li><a href="#L33">caml_record_backtraces</a></li>
<li><a href="#L197">caml_restore_raw_backtrace</a></li>
<li><a href="#L64">print_location</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L16">CAML_INTERNALS</a></li>
<li><a href="#L233">Debuginfo_val</a></li>
<li><a href="#L232">Val_debuginfo</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/**************************************************************************/<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; Copyright 2000 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/**************************************************************************/<br/></li>
<li></span><br/></li>
<li><a id="L16">&#x200c;</a><span class="PreProc">#define <span class="linkable">CAML_INTERNALS</span><br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Stack backtrace for uncaught exceptions */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;stdio.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;stdlib.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;caml/alloc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/memory.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/backtrace.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/backtrace_prim.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/fail.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/debugger.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/startup.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Start <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> stop the backtrace machinery */<br/></li>
<li><a id="L33">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">void</span> <span class="linkable">caml_record_backtraces</span>(<span class="Type">int</span> flag)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">if</span> (flag != <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_active) {<br/></li>
<li>&nbsp; &nbsp; <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_active = flag;<br/></li>
<li>&nbsp; &nbsp; <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_pos = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="globroots.c.html#L129" title="ocaml/runtime/globroots.c:129">caml_modify_generational_global_root</a>(&amp;<a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_last_exn,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L44">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_record_backtrace</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> flag)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L33" title="ocaml/runtime/backtrace.c:33">caml_record_backtraces</a>(<a href="caml/mlvalues.h.html#L82" title="ocaml/runtime/caml/mlvalues.h:82">Int_val</a>(flag));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Return the <a href="caml/shared_heap.h.html#L54" title="ocaml/runtime/caml/shared_heap.h:54">status</a> of the backtrace machinery */<br/></li>
<li><a id="L51">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_backtrace_status</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vunit)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L423" title="ocaml/runtime/caml/mlvalues.h:423">Val_bool</a>(<a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_active);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Print location information -- same behavior as in Printexc<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; note that the test for compiler-inserted raises is slightly redundant:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; (!li-&gt;loc_valid &amp;&amp; li-&gt;loc_is_raise)<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="backtrace_nat.c.html#L278" title="ocaml/runtime/backtrace_nat.c:278">caml_debuginfo_location</a> guarantees that when li-&gt;loc_valid is<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; 0, then li-&gt;loc_is_raise is always 1, so the latter test is<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; useless. We kept it to keep code identical to the runtime/<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; implementation. */<br/></li>
<li><a id="L64">&#x200c;</a></span><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">print_location</span>(<span class="Type">struct</span> <a href="caml/backtrace_prim.h.html#L35" title="ocaml/runtime/caml/backtrace_prim.h:35">caml_loc_info</a> * li, <span class="Type">int</span> index)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Type">char</span> * info;<br/></li>
<li>&nbsp; <span class="Type">char</span> * inlined;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* Ignore compiler-inserted raise */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (!li-&gt;loc_valid &amp;&amp; li-&gt;loc_is_raise) <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> (li-&gt;loc_is_raise) {<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Initial raise if index == 0, re-raise otherwise */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (index == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; info = <span class="Constant">&quot;Raised at&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; info = <span class="Constant">&quot;Re-raised at&quot;</span>;<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (index == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; info = <span class="Constant">&quot;Raised by primitive operation at&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; info = <span class="Constant">&quot;Called from&quot;</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (li-&gt;loc_is_inlined) {<br/></li>
<li>&nbsp; &nbsp; inlined = <span class="Constant">&quot; (inlined)&quot;</span>;<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; inlined = <span class="Constant">&quot;&quot;</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (! li-&gt;loc_valid) {<br/></li>
<li>&nbsp; &nbsp; fprintf(<span class="Constant">stderr</span>, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> unknown location</span><span class="Special">%s\n</span><span class="Constant">&quot;</span>, info, inlined);<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; fprintf (<span class="Constant">stderr</span>, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> </span><span class="Special">%s</span><span class="Constant"> in file </span><span class="Special">\&quot;%s\&quot;%s</span><span class="Constant">, line </span><span class="Special">%d</span><span class="Constant">, characters </span><span class="Special">%d</span><span class="Constant">-</span><span class="Special">%d\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; info, li-&gt;loc_defname, li-&gt;loc_filename, inlined, li-&gt;loc_lnum,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; li-&gt;loc_startchr, li-&gt;loc_endchr);<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Print a backtrace */<br/></li>
<li><a id="L99">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">void</span> <span class="linkable">caml_print_exception_backtrace</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; <span class="Type">struct</span> <a href="caml/backtrace_prim.h.html#L35" title="ocaml/runtime/caml/backtrace_prim.h:35">caml_loc_info</a> li;<br/></li>
<li>&nbsp; <a href="caml/backtrace_prim.h.html#L49" title="ocaml/runtime/caml/backtrace_prim.h:49">debuginfo</a> dbg;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="backtrace_nat.c.html#L329" title="ocaml/runtime/backtrace_nat.c:329">caml_debug_info_available</a>()) {<br/></li>
<li>&nbsp; &nbsp; fprintf(<span class="Constant">stderr</span>, <span class="Constant">&quot;(Cannot print stack backtrace: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;no debug information available)</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_pos; i++) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (dbg = <a href="backtrace_nat.c.html#L219" title="ocaml/runtime/backtrace_nat.c:219">caml_debuginfo_extract</a>(<a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_buffer[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; dbg != <span class="Constant"><a href="caml/misc.h.html#L71" title="ocaml/runtime/caml/misc.h:71">NULL</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; dbg = <a href="backtrace_nat.c.html#L254" title="ocaml/runtime/backtrace_nat.c:254">caml_debuginfo_next</a>(dbg))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="backtrace_nat.c.html#L278" title="ocaml/runtime/backtrace_nat.c:278">caml_debuginfo_location</a>(dbg, &amp;li);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L64" title="ocaml/runtime/backtrace.c:64">print_location</a>(&amp;li, i);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* See also printexc.ml */<br/></li>
<li></span>&nbsp; <span class="Statement">switch</span> (<a href="backtrace_nat.c.html#L334" title="ocaml/runtime/backtrace_nat.c:334">caml_debug_info_status</a>()) {<br/></li>
<li>&nbsp; <span class="Statement">case</span> FILE_NOT_FOUND:<br/></li>
<li>&nbsp; &nbsp; fprintf(<span class="Constant">stderr</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;(Cannot print locations:</span><span class="Special">\n</span><span class="Constant"> &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;<a href="meta.c.html#L53" title="ocaml/runtime/meta.c:53">bytecode</a> executable program file not found)</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; <span class="Statement">case</span> BAD_BYTECODE:<br/></li>
<li>&nbsp; &nbsp; fprintf(<span class="Constant">stderr</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;(Cannot print locations:</span><span class="Special">\n</span><span class="Constant"> &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;<a href="meta.c.html#L53" title="ocaml/runtime/meta.c:53">bytecode</a> executable program file appears to be corrupt)</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; <span class="Statement">case</span> WRONG_MAGIC:<br/></li>
<li>&nbsp; &nbsp; fprintf(<span class="Constant">stderr</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;(Cannot print locations:</span><span class="Special">\n</span><span class="Constant"> &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;<a href="meta.c.html#L53" title="ocaml/runtime/meta.c:53">bytecode</a> executable program file has wrong magic number)</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; <span class="Statement">case</span> NO_FDS:<br/></li>
<li>&nbsp; &nbsp; fprintf(<span class="Constant">stderr</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;(Cannot print locations:</span><span class="Special">\n</span><span class="Constant"> &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;<a href="meta.c.html#L53" title="ocaml/runtime/meta.c:53">bytecode</a> executable program file cannot be opened;</span><span class="Special">\n</span><span class="Constant"> &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;-- too many open files. Try running with OCAMLRUNPARAM=<a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>=2)</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Return the <a href="caml/shared_heap.h.html#L54" title="ocaml/runtime/caml/shared_heap.h:54">status</a> of loading backtrace information (<a href="startup_byt.c.html#L77" title="ocaml/runtime/startup_byt.c:77">error</a> reporting in<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="meta.c.html#L53" title="ocaml/runtime/meta.c:53">bytecode</a>) */<br/></li>
<li><a id="L149">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_ml_debug_info_status</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> unit)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(<a href="backtrace_nat.c.html#L334" title="ocaml/runtime/backtrace_nat.c:334">caml_debug_info_status</a>());<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Get a copy of the latest backtrace */<br/></li>
<li><a id="L155">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_get_exception_raw_backtrace</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> unit)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L270" title="ocaml/runtime/caml/memory.h:270">CAMLparam0</a>();<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L376" title="ocaml/runtime/caml/memory.h:376">CAMLlocal1</a>(res);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* Beware: the allocations below may cause finalizers to be run, <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> another<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; backtrace---possibly of a different length---to be stashed (for example<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; if the finalizer raises then catches an exception).&nbsp; We choose to ignore<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; any such finalizer backtraces <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> return the original one. */<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_active ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_buffer == <span class="Constant"><a href="caml/misc.h.html#L71" title="ocaml/runtime/caml/misc.h:71">NULL</a></span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_pos == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; res = <a href="alloc.c.html#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a>(<span class="Constant">0</span>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L586" title="ocaml/runtime/caml/misc.h:586">backtrace_slot</a> saved_caml_backtrace_buffer[<a href="caml/backtrace_prim.h.html#L94" title="ocaml/runtime/caml/backtrace_prim.h:94">BACKTRACE_BUFFER_SIZE</a>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span> saved_caml_backtrace_pos;<br/></li>
<li>&nbsp; &nbsp; <a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; saved_caml_backtrace_pos = <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (saved_caml_backtrace_pos &gt; <a href="caml/backtrace_prim.h.html#L94" title="ocaml/runtime/caml/backtrace_prim.h:94">BACKTRACE_BUFFER_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; saved_caml_backtrace_pos = <a href="caml/backtrace_prim.h.html#L94" title="ocaml/runtime/caml/backtrace_prim.h:94">BACKTRACE_BUFFER_SIZE</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memcpy(saved_caml_backtrace_buffer, <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>-&gt;backtrace_buffer,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; saved_caml_backtrace_pos * <span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span>(<a href="caml/misc.h.html#L586" title="ocaml/runtime/caml/misc.h:586">backtrace_slot</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; res = <a href="alloc.c.html#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a>(saved_caml_backtrace_pos, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; saved_caml_backtrace_pos; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="memory.c.html#L207" title="ocaml/runtime/memory.c:207">caml_initialize</a>(&amp;<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(res, i),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="caml/backtrace_prim.h.html#L78" title="ocaml/runtime/caml/backtrace_prim.h:78">Val_backtrace_slot</a>(saved_caml_backtrace_buffer[i]));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a>(res);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Copy back a backtrace <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> exception to the global state.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; This function should be used only with Printexc.raw_backtrace */<br/></li>
<li></span><span class="Comment">/* noalloc (caml <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>): so no CAMLparam* <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a>* */<br/></li>
<li><a id="L197">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_restore_raw_backtrace</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> exn, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> backtrace)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> i;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> bt_size;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/domain_state.h.html#L34" title="ocaml/runtime/caml/domain_state.h:34">caml_domain_state</a>* domain_state = <a href="caml/domain_state.h.html#L62" title="ocaml/runtime/caml/domain_state.h:62">Caml_state</a>;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="globroots.c.html#L129" title="ocaml/runtime/globroots.c:129">caml_modify_generational_global_root</a> (&amp;domain_state-&gt;backtrace_last_exn, exn);<br/></li>
<li><br/></li>
<li>&nbsp; bt_size = <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(backtrace);<br/></li>
<li>&nbsp; <span class="Statement">if</span>(bt_size &gt; <a href="caml/backtrace_prim.h.html#L94" title="ocaml/runtime/caml/backtrace_prim.h:94">BACKTRACE_BUFFER_SIZE</a>){<br/></li>
<li>&nbsp; &nbsp; bt_size = <a href="caml/backtrace_prim.h.html#L94" title="ocaml/runtime/caml/backtrace_prim.h:94">BACKTRACE_BUFFER_SIZE</a>;<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* We don't allocate if the backtrace is empty (no -g <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> backtrace<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; not activated) */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span>(bt_size == <span class="Constant">0</span>){<br/></li>
<li>&nbsp; &nbsp; domain_state-&gt;backtrace_pos = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>;<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Comment">/* Allocate if needed <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> copy the backtrace buffer */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (domain_state-&gt;backtrace_buffer == <span class="Constant"><a href="caml/misc.h.html#L71" title="ocaml/runtime/caml/misc.h:71">NULL</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &amp;&amp; <a href="backtrace_nat.c.html#L72" title="ocaml/runtime/backtrace_nat.c:72">caml_alloc_backtrace_buffer</a>() == -<span class="Constant">1</span>){<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>;<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; domain_state-&gt;backtrace_pos = bt_size;<br/></li>
<li>&nbsp; <span class="Statement">for</span>(i=<span class="Constant">0</span>; i &lt; domain_state-&gt;backtrace_pos; i++){<br/></li>
<li>&nbsp; &nbsp; domain_state-&gt;backtrace_buffer[i] = <a href="caml/backtrace_prim.h.html#L79" title="ocaml/runtime/caml/backtrace_prim.h:79">Backtrace_slot_val</a>(<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(backtrace, i));<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L232">&#x200c;</a><span class="PreProc">#define <span class="linkable">Val_debuginfo</span>(bslot) (<a href="caml/mlvalues.h.html#L77" title="ocaml/runtime/caml/mlvalues.h:77">Val_long</a>((<a href="caml/config.h.html#L141" title="ocaml/runtime/caml/config.h:141">uintnat</a>)(bslot)&gt;&gt;</span><span class="Constant">1</span><span class="PreProc">))<br/></li>
<li><a id="L233">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">Debuginfo_val</span>(vslot) ((<a href="caml/backtrace_prim.h.html#L49" title="ocaml/runtime/caml/backtrace_prim.h:49">debuginfo</a>)(<a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(vslot) &lt;&lt; </span><span class="Constant">1</span><span class="PreProc">))<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Convert the raw backtrace to a data structure usable from OCaml */<br/></li>
<li><a id="L236">&#x200c;</a></span><span class="Type">static</span> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_convert_debuginfo</span>(<a href="caml/backtrace_prim.h.html#L49" title="ocaml/runtime/caml/backtrace_prim.h:49">debuginfo</a> dbg)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L270" title="ocaml/runtime/caml/memory.h:270">CAMLparam0</a>();<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L384" title="ocaml/runtime/caml/memory.h:384">CAMLlocal3</a>(p, fname, dname);<br/></li>
<li>&nbsp; <span class="Type">struct</span> <a href="caml/backtrace_prim.h.html#L35" title="ocaml/runtime/caml/backtrace_prim.h:35">caml_loc_info</a> li;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="backtrace_nat.c.html#L278" title="ocaml/runtime/backtrace_nat.c:278">caml_debuginfo_location</a>(dbg, &amp;li);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> (li.loc_valid) {<br/></li>
<li>&nbsp; &nbsp; fname = <a href="alloc.c.html#L214" title="ocaml/runtime/alloc.c:214">caml_copy_string</a>(li.loc_filename);<br/></li>
<li>&nbsp; &nbsp; dname = <a href="alloc.c.html#L214" title="ocaml/runtime/alloc.c:214">caml_copy_string</a>(li.loc_defname);<br/></li>
<li>&nbsp; &nbsp; p = <a href="alloc.c.html#L158" title="ocaml/runtime/alloc.c:158">caml_alloc_small</a>(<span class="Constant">7</span>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(p, <span class="Constant">0</span>) = <a href="caml/mlvalues.h.html#L423" title="ocaml/runtime/caml/mlvalues.h:423">Val_bool</a>(li.loc_is_raise);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(p, <span class="Constant">1</span>) = fname;<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(p, <span class="Constant">2</span>) = <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(li.loc_lnum);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(p, <span class="Constant">3</span>) = <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(li.loc_startchr);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(p, <span class="Constant">4</span>) = <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(li.loc_endchr);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(p, <span class="Constant">5</span>) = <a href="caml/mlvalues.h.html#L423" title="ocaml/runtime/caml/mlvalues.h:423">Val_bool</a>(li.loc_is_inlined);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(p, <span class="Constant">6</span>) = dname;<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; p = <a href="alloc.c.html#L158" title="ocaml/runtime/alloc.c:158">caml_alloc_small</a>(<span class="Constant">1</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(p, <span class="Constant">0</span>) = <a href="caml/mlvalues.h.html#L423" title="ocaml/runtime/caml/mlvalues.h:423">Val_bool</a>(li.loc_is_raise);<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a>(p);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L263">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_convert_raw_backtrace_slot</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> slot)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="backtrace_nat.c.html#L329" title="ocaml/runtime/backtrace_nat.c:329">caml_debug_info_available</a>())<br/></li>
<li>&nbsp; &nbsp; <a href="fail_nat.c.html#L130" title="ocaml/runtime/fail_nat.c:130">caml_failwith</a>(<span class="Constant">&quot;No debug information available&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="#L236" title="ocaml/runtime/backtrace.c:236">caml_convert_debuginfo</a>(<a href="#L233" title="ocaml/runtime/backtrace.c:233">Debuginfo_val</a>(slot)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Convert the raw backtrace to a data structure usable from OCaml */<br/></li>
<li><a id="L272">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_convert_raw_backtrace</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> bt)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L276" title="ocaml/runtime/caml/memory.h:276">CAMLparam1</a>(bt);<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L376" title="ocaml/runtime/caml/memory.h:376">CAMLlocal1</a>(array);<br/></li>
<li>&nbsp; <a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> i, index;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="backtrace_nat.c.html#L329" title="ocaml/runtime/backtrace_nat.c:329">caml_debug_info_available</a>())<br/></li>
<li>&nbsp; &nbsp; <a href="fail_nat.c.html#L130" title="ocaml/runtime/fail_nat.c:130">caml_failwith</a>(<span class="Constant">&quot;No debug information available&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>, index = <span class="Constant">0</span>; i &lt; <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(bt); ++i)<br/></li>
<li>&nbsp; {<br/></li>
<li>&nbsp; &nbsp; <a href="caml/backtrace_prim.h.html#L49" title="ocaml/runtime/caml/backtrace_prim.h:49">debuginfo</a> dbg;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (dbg = <a href="backtrace_nat.c.html#L219" title="ocaml/runtime/backtrace_nat.c:219">caml_debuginfo_extract</a>(<a href="caml/backtrace_prim.h.html#L79" title="ocaml/runtime/caml/backtrace_prim.h:79">Backtrace_slot_val</a>(<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(bt, i)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; dbg != <span class="Constant"><a href="caml/misc.h.html#L71" title="ocaml/runtime/caml/misc.h:71">NULL</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; dbg = <a href="backtrace_nat.c.html#L254" title="ocaml/runtime/backtrace_nat.c:254">caml_debuginfo_next</a>(dbg))<br/></li>
<li>&nbsp; &nbsp; &nbsp; index++;<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; array = <a href="alloc.c.html#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a>(index, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>, index = <span class="Constant">0</span>; i &lt; <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(bt); ++i)<br/></li>
<li>&nbsp; {<br/></li>
<li>&nbsp; &nbsp; <a href="caml/backtrace_prim.h.html#L49" title="ocaml/runtime/caml/backtrace_prim.h:49">debuginfo</a> dbg;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (dbg = <a href="backtrace_nat.c.html#L219" title="ocaml/runtime/backtrace_nat.c:219">caml_debuginfo_extract</a>(<a href="caml/backtrace_prim.h.html#L79" title="ocaml/runtime/caml/backtrace_prim.h:79">Backtrace_slot_val</a>(<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(bt, i)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; dbg != <span class="Constant"><a href="caml/misc.h.html#L71" title="ocaml/runtime/caml/misc.h:71">NULL</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; dbg = <a href="backtrace_nat.c.html#L254" title="ocaml/runtime/backtrace_nat.c:254">caml_debuginfo_next</a>(dbg))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/memory.h.html#L425" title="ocaml/runtime/caml/memory.h:425">Store_field</a>(array, index, <a href="#L236" title="ocaml/runtime/backtrace.c:236">caml_convert_debuginfo</a>(dbg));<br/></li>
<li>&nbsp; &nbsp; &nbsp; index++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a>(array);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L307">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_raw_backtrace_length</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> bt)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L81" title="ocaml/runtime/caml/mlvalues.h:81">Val_int</a>(<a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(bt));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L312">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_raw_backtrace_slot</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> bt, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> index)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/config.h.html#L141" title="ocaml/runtime/caml/config.h:141">uintnat</a> i;<br/></li>
<li>&nbsp; <a href="caml/backtrace_prim.h.html#L49" title="ocaml/runtime/caml/backtrace_prim.h:49">debuginfo</a> dbg;<br/></li>
<li><br/></li>
<li>&nbsp; i = <a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(index);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (i &gt;= <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(bt))<br/></li>
<li>&nbsp; &nbsp; <a href="fail_nat.c.html#L140" title="ocaml/runtime/fail_nat.c:140">caml_invalid_argument</a>(<span class="Constant">&quot;Printexc.get_raw_backtrace_slot: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;index out of bounds&quot;</span>);<br/></li>
<li>&nbsp; dbg = <a href="backtrace_nat.c.html#L219" title="ocaml/runtime/backtrace_nat.c:219">caml_debuginfo_extract</a>(<a href="caml/backtrace_prim.h.html#L79" title="ocaml/runtime/caml/backtrace_prim.h:79">Backtrace_slot_val</a>(<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(bt, i)));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L232" title="ocaml/runtime/backtrace.c:232">Val_debuginfo</a>(dbg);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L325">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_raw_backtrace_next_slot</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> slot)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/backtrace_prim.h.html#L49" title="ocaml/runtime/caml/backtrace_prim.h:49">debuginfo</a> dbg;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L276" title="ocaml/runtime/caml/memory.h:276">CAMLparam1</a>(slot);<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L376" title="ocaml/runtime/caml/memory.h:376">CAMLlocal1</a>(v);<br/></li>
<li><br/></li>
<li>&nbsp; dbg = <a href="#L233" title="ocaml/runtime/backtrace.c:233">Debuginfo_val</a>(slot);<br/></li>
<li>&nbsp; dbg = <a href="backtrace_nat.c.html#L254" title="ocaml/runtime/backtrace_nat.c:254">caml_debuginfo_next</a>(dbg);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> (dbg == <span class="Constant"><a href="caml/misc.h.html#L71" title="ocaml/runtime/caml/misc.h:71">NULL</a></span>)<br/></li>
<li>&nbsp; &nbsp; v = <a href="caml/mlvalues.h.html#L439" title="ocaml/runtime/caml/mlvalues.h:439">Val_none</a>;<br/></li>
<li>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; v = <a href="alloc.c.html#L378" title="ocaml/runtime/alloc.c:378">caml_alloc_some</a>(<a href="#L232" title="ocaml/runtime/backtrace.c:232">Val_debuginfo</a>(dbg));<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a>(v);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* the function below is deprecated: we previously returned directly<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the OCaml-usable representation, instead of the raw backtrace as an<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; abstract type, but this has a large performance overhead if you<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; store a lot of backtraces <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> print only some of them.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; It is not used by the Printexc library anymore, <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> anywhere else in<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the compiler, but we have kept it in case some user still depends<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; on it as an external.&nbsp; */<br/></li>
<li><a id="L351">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_get_exception_backtrace</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> unit)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L270" title="ocaml/runtime/caml/memory.h:270">CAMLparam0</a>();<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L384" title="ocaml/runtime/caml/memory.h:384">CAMLlocal3</a>(arr, res, backtrace);<br/></li>
<li>&nbsp; <a href="caml/config.h.html#L140" title="ocaml/runtime/caml/config.h:140">intnat</a> i;<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="backtrace_nat.c.html#L329" title="ocaml/runtime/backtrace_nat.c:329">caml_debug_info_available</a>()) {<br/></li>
<li>&nbsp; &nbsp; res = <a href="caml/mlvalues.h.html#L439" title="ocaml/runtime/caml/mlvalues.h:439">Val_none</a>;<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; backtrace = <a href="#L155" title="ocaml/runtime/backtrace.c:155">caml_get_exception_raw_backtrace</a>(<a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; arr = <a href="alloc.c.html#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a>(<a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(backtrace), <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(backtrace); i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/misc.h.html#L586" title="ocaml/runtime/caml/misc.h:586">backtrace_slot</a> slot = <a href="caml/backtrace_prim.h.html#L79" title="ocaml/runtime/caml/backtrace_prim.h:79">Backtrace_slot_val</a>(<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(backtrace, i));<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/backtrace_prim.h.html#L49" title="ocaml/runtime/caml/backtrace_prim.h:49">debuginfo</a> dbg = <a href="backtrace_nat.c.html#L219" title="ocaml/runtime/backtrace_nat.c:219">caml_debuginfo_extract</a>(slot);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/memory.h.html#L425" title="ocaml/runtime/caml/memory.h:425">Store_field</a>(arr, i, <a href="#L236" title="ocaml/runtime/backtrace.c:236">caml_convert_debuginfo</a>(dbg));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; res = <a href="alloc.c.html#L378" title="ocaml/runtime/alloc.c:378">caml_alloc_some</a>(arr);<br/></li>
<li>&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a>(res);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
