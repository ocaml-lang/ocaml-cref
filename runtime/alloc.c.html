<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/runtime/alloc.c - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/runtime/alloc.c - ocaml</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L33">caml_alloc</a></li>
<li><a href="#L108">caml_alloc_1</a></li>
<li><a href="#L113">caml_alloc_2</a></li>
<li><a href="#L118">caml_alloc_3</a></li>
<li><a href="#L123">caml_alloc_4</a></li>
<li><a href="#L128">caml_alloc_5</a></li>
<li><a href="#L134">caml_alloc_6</a></li>
<li><a href="#L140">caml_alloc_7</a></li>
<li><a href="#L146">caml_alloc_8</a></li>
<li><a href="#L152">caml_alloc_9</a></li>
<li><a href="#L224">caml_alloc_array</a></li>
<li><a href="#L286">caml_alloc_dummy</a></li>
<li><a href="#L300">caml_alloc_dummy_float</a></li>
<li><a href="#L293">caml_alloc_dummy_function</a></li>
<li><a href="#L306">caml_alloc_dummy_infix</a></li>
<li><a href="#L207">caml_alloc_final</a></li>
<li><a href="#L245">caml_alloc_float_array</a></li>
<li><a href="#L197">caml_alloc_initialized_string</a></li>
<li><a href="#L68">caml_alloc_shr_check_gc</a></li>
<li><a href="#L158">caml_alloc_small</a></li>
<li><a href="#L378">caml_alloc_some</a></li>
<li><a href="#L177">caml_alloc_string</a></li>
<li><a href="#L171">caml_alloc_tuple</a></li>
<li><a href="#L275">caml_convert_flag_list</a></li>
<li><a href="#L214">caml_copy_string</a></li>
<li><a href="#L270">caml_copy_string_array</a></li>
<li><a href="#L323">caml_update_dummy</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L16">CAML_INTERNALS</a></li>
<li><a href="#L93">Do_alloc_small</a></li>
<li><a href="#L81">Enter_gc_preserve_vals</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/**************************************************************************/<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Xavier Leroy <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> Damien Doligez, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><span class="Comment">/**************************************************************************/<br/></li>
<li></span><br/></li>
<li><a id="L16">&#x200c;</a><span class="PreProc">#define <span class="linkable">CAML_INTERNALS</span><br/></li>
<li></span><br/></li>
<li><span class="Comment">/* 1. Allocation functions doing the same work as the macros in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; case where [<a href="interp.c.html#L74" title="ocaml/runtime/interp.c:74">Setup_for_gc</a>] <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> [<a href="interp.c.html#L77" title="ocaml/runtime/interp.c:77">Restore_after_gc</a>] are no-ops.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; 2. Convenience functions related to allocation.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;stdarg.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/alloc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/custom.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/major_gc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/memory.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/mlvalues.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/fiber.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;caml/domain.h&quot;<br/></li>
<li></span><br/></li>
<li><a id="L33">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc</span> (<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> wosize, <a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> result;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> i;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (tag &lt; <span class="Constant">256</span>);<br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (tag != <a href="caml/mlvalues.h.html#L248" title="ocaml/runtime/caml/mlvalues.h:248">Infix_tag</a>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (wosize &lt;= <a href="caml/config.h.html#L221" title="ocaml/runtime/caml/config.h:221">Max_young_wosize</a>){<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (wosize == <span class="Constant">0</span>){<br/></li>
<li>&nbsp; &nbsp; &nbsp; result = <a href="caml/mlvalues.h.html#L419" title="ocaml/runtime/caml/mlvalues.h:419">Atom</a> (tag);<br/></li>
<li>&nbsp; &nbsp; }<span class="Statement">else</span>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/domain_state.h.html#L72" title="ocaml/runtime/caml/domain_state.h:72">Caml_check_caml_state</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/memory.h.html#L217" title="ocaml/runtime/caml/memory.h:217">Alloc_small</a> (result, wosize, tag, <a href="caml/memory.h.html#L199" title="ocaml/runtime/caml/memory.h:199">Alloc_small_enter_GC</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tag &lt; <a href="caml/mlvalues.h.html#L219" title="ocaml/runtime/caml/mlvalues.h:219">No_scan_tag</a>){<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; wosize; i++) <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a> (result, i) = <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; result = <a href="memory.c.html#L359" title="ocaml/runtime/memory.c:359">caml_alloc_shr</a> (wosize, tag);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tag &lt; <a href="caml/mlvalues.h.html#L219" title="ocaml/runtime/caml/mlvalues.h:219">No_scan_tag</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; wosize; i++) <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a> (result, i) = <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; result = <a href="minor_gc.c.html#L866" title="ocaml/runtime/minor_gc.c:866">caml_check_urgent_gc</a> (result);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* This is used by the native compiler for large block allocations.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; The resulting block can be filled with [<a href="memory.c.html#L149" title="ocaml/runtime/memory.c:149">caml_modify</a>], <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> [<a href="memory.c.html#L207" title="ocaml/runtime/memory.c:207">caml_initialize</a>],<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> direct writes for integer values <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> code pointers.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; If [tag == <a href="caml/mlvalues.h.html#L275" title="ocaml/runtime/caml/mlvalues.h:275">Closure_tag</a>], no GC must take place until field 1<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; of the block has been set to the correct &quot;arity &amp; start of environment&quot;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; information (issue #11482). */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef NATIVE_CODE<br/></li>
<li><a id="L68">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_shr_check_gc</span> (<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> wosize, <a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a>(tag &lt; <a href="caml/mlvalues.h.html#L219" title="ocaml/runtime/caml/mlvalues.h:219">No_scan_tag</a>);<br/></li>
<li>&nbsp; <a href="minor_gc.c.html#L866" title="ocaml/runtime/minor_gc.c:866">caml_check_urgent_gc</a> (<a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> result = <a href="memory.c.html#L359" title="ocaml/runtime/memory.c:359">caml_alloc_shr</a> (wosize, tag);<br/></li>
<li>&nbsp; <span class="Statement">for</span> (<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> i = <span class="Constant">0</span>; i &lt; wosize; i++) <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a> (result, i) = <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>;<br/></li>
<li>&nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Copy the values to be preserved to a different array.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; The original vals array never escapes, generating better code in<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the fast path. */<br/></li>
<li><a id="L81">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">Enter_gc_preserve_vals</span>(dom_st, wosize) </span><span class="Statement">do</span><span class="PreProc"> {&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="caml/memory.h.html#L270" title="ocaml/runtime/caml/memory.h:270">CAMLparam0</a>();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="caml/memory.h.html#L396" title="ocaml/runtime/caml/memory.h:396">CAMLlocalN</a>(vals_copy, (wosize));&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="PreProc"> (i = </span><span class="Constant">0</span><span class="PreProc">; i &lt; (wosize); i++) vals_copy[i] = vals[i];&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="caml/memory.h.html#L199" title="ocaml/runtime/caml/memory.h:199">Alloc_small_enter_GC</a>(dom_st, wosize);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="PreProc"> (i = </span><span class="Constant">0</span><span class="PreProc">; i &lt; (wosize); i++) vals[i] = vals_copy[i];&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="caml/memory.h.html#L404" title="ocaml/runtime/caml/memory.h:404">CAMLdrop</a>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; } </span><span class="Statement">while</span><span class="PreProc"> (</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* This has to be done with a macro, rather than an inline function, since<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; otherwise the wosize parameter to <a href="caml/memory.h.html#L396" title="ocaml/runtime/caml/memory.h:396">CAMLlocalN</a> expands to be a VLA, which<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; breaks MSVC. */<br/></li>
<li><a id="L93">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">Do_alloc_small</span>(wosize, tag, ...)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; <a href="caml/domain_state.h.html#L72" title="ocaml/runtime/caml/domain_state.h:72">Caml_check_caml_state</a>();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> v;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vals[wosize] = {</span><span class="Constant">__VA_ARGS__</span><span class="PreProc">};&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> i;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> ((tag) &lt; </span><span class="Constant">256</span><span class="PreProc">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; <a href="caml/memory.h.html#L217" title="ocaml/runtime/caml/memory.h:217">Alloc_small</a>(v, wosize, tag, <a href="#L81" title="ocaml/runtime/alloc.c:81">Enter_gc_preserve_vals</a>);&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; </span><span class="Statement">for</span><span class="PreProc"> (i = </span><span class="Constant">0</span><span class="PreProc">; i &lt; (wosize); i++) {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(v, i) = vals[i];&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; </span><span class="Statement">return</span><span class="PreProc"> v;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">}<br/></li>
<li></span><br/></li>
<li><a id="L108">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_1</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">1</span>, tag, a);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L113">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_2</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">2</span>, tag, a, <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L118">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_3</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> c)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">3</span>, tag, a, <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, c);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L123">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_4</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> c, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> d)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">4</span>, tag, a, <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, c, d);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L128">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_5</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> c, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> e)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">5</span>, tag, a, <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, c, d, e);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L134">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_6</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> c, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> e, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">6</span>, tag, a, <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, c, d, e, f);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L140">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_7</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> c, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> e, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">7</span>, tag, a, <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, c, d, e, f, g);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L146">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_8</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> c, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> e, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> h)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">8</span>, tag, a, <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, c, d, e, f, g, h);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L152">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_9</span> (<a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> a, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> c, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> e, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> f, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> g, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> h, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> i)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="#L93" title="ocaml/runtime/alloc.c:93">Do_alloc_small</a>(<span class="Constant">9</span>, tag, a, <a href="bigarray.c.html#L951" title="ocaml/runtime/bigarray.c:951">b</a>, c, d, e, f, g, h, i);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L158">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_small</span> (<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> wosize, <a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> result;<br/></li>
<li><br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (wosize &gt; <span class="Constant">0</span>);<br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (wosize &lt;= <a href="caml/config.h.html#L221" title="ocaml/runtime/caml/config.h:221">Max_young_wosize</a>);<br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (tag &lt; <span class="Constant">256</span>);<br/></li>
<li>&nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (tag != <a href="caml/mlvalues.h.html#L248" title="ocaml/runtime/caml/mlvalues.h:248">Infix_tag</a>);<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L217" title="ocaml/runtime/caml/memory.h:217">Alloc_small</a> (result, wosize, tag, <a href="caml/memory.h.html#L199" title="ocaml/runtime/caml/memory.h:199">Alloc_small_enter_GC</a>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* [n] is a number of words (fields) */<br/></li>
<li><a id="L171">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_tuple</span>(<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a>(n, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* [len] is a number of bytes (chars) */<br/></li>
<li><a id="L177">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_string</span> (<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> result;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> offset_index;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> wosize = (len + <span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span> (<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>)) / <span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span> (<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> (wosize &lt;= <a href="caml/config.h.html#L221" title="ocaml/runtime/caml/config.h:221">Max_young_wosize</a>) {<br/></li>
<li>&nbsp; &nbsp; <a href="caml/domain_state.h.html#L72" title="ocaml/runtime/caml/domain_state.h:72">Caml_check_caml_state</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="caml/memory.h.html#L217" title="ocaml/runtime/caml/memory.h:217">Alloc_small</a> (result, wosize, <a href="caml/mlvalues.h.html#L328" title="ocaml/runtime/caml/mlvalues.h:328">String_tag</a>, <a href="caml/memory.h.html#L199" title="ocaml/runtime/caml/memory.h:199">Alloc_small_enter_GC</a>);<br/></li>
<li>&nbsp; }<span class="Statement">else</span>{<br/></li>
<li>&nbsp; &nbsp; result = <a href="memory.c.html#L359" title="ocaml/runtime/memory.c:359">caml_alloc_shr</a> (wosize, <a href="caml/mlvalues.h.html#L328" title="ocaml/runtime/caml/mlvalues.h:328">String_tag</a>);<br/></li>
<li>&nbsp; &nbsp; result = <a href="minor_gc.c.html#L866" title="ocaml/runtime/minor_gc.c:866">caml_check_urgent_gc</a> (result);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a> (result, wosize - <span class="Constant">1</span>) = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; offset_index = <a href="caml/mlvalues.h.html#L181" title="ocaml/runtime/caml/mlvalues.h:181">Bsize_wsize</a> (wosize) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L315" title="ocaml/runtime/caml/mlvalues.h:315">Byte</a> (result, offset_index) = offset_index - len;<br/></li>
<li>&nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* [len] is a number of bytes (chars) */<br/></li>
<li><a id="L197">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_initialized_string</span> (<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> len, <span class="Type">const</span> <span class="Type">char</span> *p)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> result = <a href="#L177" title="ocaml/runtime/alloc.c:177">caml_alloc_string</a> (len);<br/></li>
<li>&nbsp; memcpy((<span class="Type">char</span> *)<a href="caml/mlvalues.h.html#L329" title="ocaml/runtime/caml/mlvalues.h:329">String_val</a>(result), p, len);<br/></li>
<li>&nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* [len] is a number of words.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; [mem] <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> [max] are relative (without unit).<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L207">&#x200c;</a></span><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_final</span> (<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> len, <a href="caml/alloc.h.html#L66" title="ocaml/runtime/caml/alloc.h:66">final_fun</a> fun,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> mem, <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> max)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="custom.c.html#L82" title="ocaml/runtime/custom.c:82">caml_alloc_custom</a>(<a href="custom.c.html#L156" title="ocaml/runtime/custom.c:156">caml_final_custom_operations</a>(fun),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len * <span class="Statement"><a href="caml/fiber.h.html#L65" title="ocaml/runtime/caml/fiber.h:65">sizeof</a></span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>), mem, max);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L214">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_copy_string</span>(<span class="Type">char</span> <span class="Type">const</span> *s)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> len;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> res;<br/></li>
<li><br/></li>
<li>&nbsp; len = strlen(s);<br/></li>
<li>&nbsp; res = <a href="#L197" title="ocaml/runtime/alloc.c:197">caml_alloc_initialized_string</a>(len, s);<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L224">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_array</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> (*funct)(<span class="Type">char</span> <span class="Type">const</span> *),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> <span class="Type">const</span> * <span class="Type">const</span>* arr)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L270" title="ocaml/runtime/caml/memory.h:270">CAMLparam0</a> ();<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> nbr, n;<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L380" title="ocaml/runtime/caml/memory.h:380">CAMLlocal2</a> (v, result);<br/></li>
<li><br/></li>
<li>&nbsp; nbr = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <span class="Statement">while</span> (arr[nbr] != <span class="Constant">0</span>) nbr++;<br/></li>
<li>&nbsp; result = <a href="#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a> (nbr, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; <span class="Statement">for</span> (n = <span class="Constant">0</span>; n &lt; nbr; n++) {<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* The two statements below must be separate because of evaluation<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; order (don't take the address &amp;<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(result, n) before<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; calling funct, which may cause a GC <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> move result). */<br/></li>
<li></span>&nbsp; &nbsp; v = funct(arr[n]);<br/></li>
<li>&nbsp; &nbsp; <a href="memory.c.html#L149" title="ocaml/runtime/memory.c:149">caml_modify</a>(&amp;<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(result, n), v);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a> (result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* [len] is a number of floats */<br/></li>
<li><a id="L245">&#x200c;</a></span><a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_float_array</span>(<a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> len)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef FLAT_FLOAT_ARRAY<br/></li>
<li></span>&nbsp; <a href="caml/domain_state.h.html#L72" title="ocaml/runtime/caml/domain_state.h:72">Caml_check_caml_state</a>();<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> wosize = len * <a href="caml/mlvalues.h.html#L337" title="ocaml/runtime/caml/mlvalues.h:337">Double_wosize</a>;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> result;<br/></li>
<li>&nbsp; <span class="Comment">/* For consistency with [<a href="array.c.html#L201" title="ocaml/runtime/array.c:201">caml_make_vect</a>], which can't tell whether it should<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; create a float array <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> not when the size is zero, the tag is set to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; zero when the size is zero. */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (wosize &lt;= <a href="caml/config.h.html#L221" title="ocaml/runtime/caml/config.h:221">Max_young_wosize</a>){<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (wosize == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L419" title="ocaml/runtime/caml/mlvalues.h:419">Atom</a>(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="caml/memory.h.html#L217" title="ocaml/runtime/caml/memory.h:217">Alloc_small</a> (result, wosize, <a href="caml/mlvalues.h.html#L349" title="ocaml/runtime/caml/mlvalues.h:349">Double_array_tag</a>, <a href="caml/memory.h.html#L199" title="ocaml/runtime/caml/memory.h:199">Alloc_small_enter_GC</a>);<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; result = <a href="memory.c.html#L359" title="ocaml/runtime/memory.c:359">caml_alloc_shr</a> (wosize, <a href="caml/mlvalues.h.html#L349" title="ocaml/runtime/caml/mlvalues.h:349">Double_array_tag</a>);<br/></li>
<li>&nbsp; &nbsp; result = <a href="minor_gc.c.html#L866" title="ocaml/runtime/minor_gc.c:866">caml_check_urgent_gc</a> (result);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> result;<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <a href="#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a> (len, <span class="Constant">0</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L270">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_copy_string_array</span>(<span class="Type">char</span> <span class="Type">const</span> * <span class="Type">const</span> * arr)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L224" title="ocaml/runtime/alloc.c:224">caml_alloc_array</a>(<a href="#L214" title="ocaml/runtime/alloc.c:214">caml_copy_string</a>, arr);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L275">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <span class="Type">int</span> <span class="linkable">caml_convert_flag_list</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> list, <span class="Type">const</span> <span class="Type">int</span> *flags)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Type">int</span> res = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (<span class="Comment">/*nothing*/</span>; list != <a href="caml/mlvalues.h.html#L434" title="ocaml/runtime/caml/mlvalues.h:434">Val_emptylist</a>; list = <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(list, <span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; res |= flags[<a href="caml/mlvalues.h.html#L82" title="ocaml/runtime/caml/mlvalues.h:82">Int_val</a>(<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(list, <span class="Constant">0</span>))];<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* For compiling let rec over values */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* [size] is a [<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>] representing number of words (fields) */<br/></li>
<li><a id="L286">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_dummy</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> wosize = <a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(size);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a> (wosize, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* [size] is a [<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>] representing number of words (fields) */<br/></li>
<li><a id="L293">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_dummy_function</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> size,<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> arity)<br/></li>
<li>{<br/></li>
<li>&nbsp; <span class="Comment">/* the arity argument is used by the js_of_ocaml runtime */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <a href="#L286" title="ocaml/runtime/alloc.c:286">caml_alloc_dummy</a>(size);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* [size] is a [<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>] representing number of floats. */<br/></li>
<li><a id="L300">&#x200c;</a></span><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_dummy_float</span> (<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> wosize = <a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(size) * <a href="caml/mlvalues.h.html#L337" title="ocaml/runtime/caml/mlvalues.h:337">Double_wosize</a>;<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a> (wosize, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L306">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_dummy_infix</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> vsize, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> voffset)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> wosize = <a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(vsize), offset = <a href="caml/mlvalues.h.html#L78" title="ocaml/runtime/caml/mlvalues.h:78">Long_val</a>(voffset);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> v = <a href="#L33" title="ocaml/runtime/alloc.c:33">caml_alloc</a>(wosize, <a href="caml/mlvalues.h.html#L275" title="ocaml/runtime/caml/mlvalues.h:275">Closure_tag</a>);<br/></li>
<li>&nbsp; <span class="Comment">/* The following choice of closure info causes the GC to skip<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; the whole block contents.&nbsp; This is correct since the dummy<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; block contains no pointers into the heap.&nbsp; However, the block<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; cannot be marshaled <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> hashed, because not all closinfo fields<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> infix header fields are correctly initialized. */<br/></li>
<li></span>&nbsp; <a href="caml/mlvalues.h.html#L277" title="ocaml/runtime/caml/mlvalues.h:277">Closinfo_val</a>(v) = <a href="caml/mlvalues.h.html#L286" title="ocaml/runtime/caml/mlvalues.h:286">Make_closinfo</a>(<span class="Constant">0</span>, wosize);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (offset &gt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; v += <a href="caml/mlvalues.h.html#L181" title="ocaml/runtime/caml/mlvalues.h:181">Bsize_wsize</a>(offset);<br/></li>
<li>&nbsp; &nbsp; (((<a href="caml/mlvalues.h.html#L58" title="ocaml/runtime/caml/mlvalues.h:58">header_t</a> *) (v)) [-<span class="Constant">1</span>]) = <a href="caml/gc.h.html#L32" title="ocaml/runtime/caml/gc.h:32">Make_header</a>(offset, <a href="caml/mlvalues.h.html#L248" title="ocaml/runtime/caml/mlvalues.h:248">Infix_tag</a>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> v;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L323">&#x200c;</a><a href="caml/misc.h.html#L124" title="ocaml/runtime/caml/misc.h:124">CAMLprim</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_update_dummy</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> dummy, <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> newval)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L60" title="ocaml/runtime/caml/mlvalues.h:60">mlsize_t</a> size, i;<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L61" title="ocaml/runtime/caml/mlvalues.h:61">tag_t</a> tag;<br/></li>
<li><br/></li>
<li>&nbsp; tag = <a href="caml/mlvalues.h.html#L199" title="ocaml/runtime/caml/mlvalues.h:199">Tag_val</a> (newval);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(dummy) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* Size-0 blocks are statically-allocated <a href="shared_heap.c.html#L656" title="ocaml/runtime/shared_heap.c:656">atoms</a>. We cannot<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mutate them, but there is no need:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - All <a href="shared_heap.c.html#L656" title="ocaml/runtime/shared_heap.c:656">atoms</a> used in the runtime to represent OCaml values<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; have tag 0 --- including empty flat float arrays, <a href="ints.c.html#L491" title="ocaml/runtime/ints.c:491">or</a> other<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; types that use a non-0 tag for non-atom blocks.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - The dummy was already created with tag 0.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; So doing nothing suffices. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a>(<a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(newval) == <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a>(<a href="caml/mlvalues.h.html#L199" title="ocaml/runtime/caml/mlvalues.h:199">Tag_val</a>(dummy) == <a href="caml/mlvalues.h.html#L199" title="ocaml/runtime/caml/mlvalues.h:199">Tag_val</a>(newval));<br/></li>
<li>&nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (tag == <a href="caml/mlvalues.h.html#L349" title="ocaml/runtime/caml/mlvalues.h:349">Double_array_tag</a>){<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (<a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(newval) == <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(dummy));<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (<a href="caml/mlvalues.h.html#L199" title="ocaml/runtime/caml/mlvalues.h:199">Tag_val</a>(dummy) != <a href="caml/mlvalues.h.html#L248" title="ocaml/runtime/caml/mlvalues.h:248">Infix_tag</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L210" title="ocaml/runtime/caml/mlvalues.h:210">Unsafe_store_tag_val</a>(dummy, <a href="caml/mlvalues.h.html#L349" title="ocaml/runtime/caml/mlvalues.h:349">Double_array_tag</a>);<br/></li>
<li>&nbsp; &nbsp; size = <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a> (newval) / <a href="caml/mlvalues.h.html#L337" title="ocaml/runtime/caml/mlvalues.h:337">Double_wosize</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; size; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="caml/mlvalues.h.html#L354" title="ocaml/runtime/caml/mlvalues.h:354">Store_double_flat_field</a> (dummy, i, <a href="caml/mlvalues.h.html#L353" title="ocaml/runtime/caml/mlvalues.h:353">Double_flat_field</a> (newval, i));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (tag == <a href="caml/mlvalues.h.html#L248" title="ocaml/runtime/caml/mlvalues.h:248">Infix_tag</a>) {<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> clos = newval - <a href="caml/mlvalues.h.html#L249" title="ocaml/runtime/caml/mlvalues.h:249">Infix_offset_hd</a>(<a href="caml/mlvalues.h.html#L157" title="ocaml/runtime/caml/mlvalues.h:157">Hd_val</a>(newval));<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (<a href="caml/mlvalues.h.html#L199" title="ocaml/runtime/caml/mlvalues.h:199">Tag_val</a>(clos) == <a href="caml/mlvalues.h.html#L275" title="ocaml/runtime/caml/mlvalues.h:275">Closure_tag</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (<a href="caml/mlvalues.h.html#L199" title="ocaml/runtime/caml/mlvalues.h:199">Tag_val</a>(dummy) == <a href="caml/mlvalues.h.html#L248" title="ocaml/runtime/caml/mlvalues.h:248">Infix_tag</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (<a href="caml/mlvalues.h.html#L250" title="ocaml/runtime/caml/mlvalues.h:250">Infix_offset_val</a>(dummy) == <a href="caml/mlvalues.h.html#L250" title="ocaml/runtime/caml/mlvalues.h:250">Infix_offset_val</a>(newval));<br/></li>
<li>&nbsp; &nbsp; dummy = dummy - <a href="caml/mlvalues.h.html#L250" title="ocaml/runtime/caml/mlvalues.h:250">Infix_offset_val</a>(dummy);<br/></li>
<li>&nbsp; &nbsp; size = <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(clos);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (size == <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(dummy));<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* It is safe to use [<a href="memory.c.html#L149" title="ocaml/runtime/memory.c:149">caml_modify</a>] to copy code pointers<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; from [clos] to [dummy], because the <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> being overwritten is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; an integer, <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> the new &quot;<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a>&quot; is a pointer outside the minor<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; heap. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; size; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="memory.c.html#L149" title="ocaml/runtime/memory.c:149">caml_modify</a> (&amp;<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(dummy, i), <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(clos, i));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (tag &lt; <a href="caml/mlvalues.h.html#L219" title="ocaml/runtime/caml/mlvalues.h:219">No_scan_tag</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (<a href="caml/mlvalues.h.html#L199" title="ocaml/runtime/caml/mlvalues.h:199">Tag_val</a>(dummy) != <a href="caml/mlvalues.h.html#L248" title="ocaml/runtime/caml/mlvalues.h:248">Infix_tag</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/mlvalues.h.html#L210" title="ocaml/runtime/caml/mlvalues.h:210">Unsafe_store_tag_val</a>(dummy, tag);<br/></li>
<li>&nbsp; &nbsp; size = <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(newval);<br/></li>
<li>&nbsp; &nbsp; <a href="caml/misc.h.html#L247" title="ocaml/runtime/caml/misc.h:247">CAMLassert</a> (size == <a href="caml/mlvalues.h.html#L174" title="ocaml/runtime/caml/mlvalues.h:174">Wosize_val</a>(dummy));<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* See comment above why this is safe even if [tag == <a href="caml/mlvalues.h.html#L275" title="ocaml/runtime/caml/mlvalues.h:275">Closure_tag</a>]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; <a href="ints.c.html#L488" title="ocaml/runtime/ints.c:488">and</a> some of the &quot;values&quot; being copied are actually code pointers. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; size; i++){<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="memory.c.html#L149" title="ocaml/runtime/memory.c:149">caml_modify</a> (&amp;<a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(dummy, i), <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(newval, i));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="caml/mlvalues.h.html#L431" title="ocaml/runtime/caml/mlvalues.h:431">Val_unit</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L378">&#x200c;</a><a href="caml/misc.h.html#L123" title="ocaml/runtime/caml/misc.h:123">CAMLexport</a> <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> <span class="linkable">caml_alloc_some</span>(<a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> v)<br/></li>
<li>{<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L276" title="ocaml/runtime/caml/memory.h:276">CAMLparam1</a>(v);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L57" title="ocaml/runtime/caml/mlvalues.h:57">value</a> some = <a href="#L158" title="ocaml/runtime/alloc.c:158">caml_alloc_small</a>(<span class="Constant">1</span>, <a href="caml/mlvalues.h.html#L441" title="ocaml/runtime/caml/mlvalues.h:441">Tag_some</a>);<br/></li>
<li>&nbsp; <a href="caml/mlvalues.h.html#L228" title="ocaml/runtime/caml/mlvalues.h:228">Field</a>(some, <span class="Constant">0</span>) = v;<br/></li>
<li>&nbsp; <a href="caml/memory.h.html#L419" title="ocaml/runtime/caml/memory.h:419">CAMLreturn</a>(some);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
