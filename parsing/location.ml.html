<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/parsing/location.ml - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/parsing/location.ml - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L189">absolute_path</a></li>
<li><a href="#L946">alert</a></li>
<li><a href="#L959">alert</a></li>
<li><a href="#L972">alert</a></li>
<li><a href="#L936">alert_reporter</a></li>
<li><a href="#L194">aux</a></li>
<li><a href="#L754">batch_mode_printer</a></li>
<li><a href="#L847">best_toplevel_printer</a></li>
<li><a href="#L241">capitalize</a></li>
<li><a href="#L244">comma</a></li>
<li><a href="#L26">curr</a></li>
<li><a href="#L928">default_alert_reporter</a></li>
<li><a href="#L856">default_report_printer</a></li>
<li><a href="#L908">default_warning_reporter</a></li>
<li><a href="#L965">deprecated_script_alert</a></li>
<li><a href="#L117">echo_eof</a></li>
<li><a href="#L238">endchar</a></li>
<li><a href="#L236">endline</a></li>
<li><a href="#L257">endline</a></li>
<li><a href="#L882">error</a></li>
<li><a href="#L981">error_of_exn</a></li>
<li><a href="#L987">error_of_exn</a></li>
<li><a href="#L749">error_style</a></li>
<li><a href="#L879">errorf</a></li>
<li><a href="#L353">extrema</a></li>
<li><a href="#L240">first</a></li>
<li><a href="#L919">formatter_for_warnings</a></li>
<li><a href="#L65">get_pos_info</a></li>
<li><a href="#L470">highlight_quote</a></li>
<li><a href="#L365">highlight_terminfo</a></li>
<li><a href="#L399">highlight_terminfo</a></li>
<li><a href="#L21">in_file</a></li>
<li><a href="#L446">infer_line_numbers</a></li>
<li><a href="#L32">init</a></li>
<li><a href="#L80">input_lexbuf</a></li>
<li><a href="#L79">input_name</a></li>
<li><a href="#L81">input_phrase_buffer</a></li>
<li><a href="#L720">is_dummy_loc</a></li>
<li><a href="#L348">is_end</a></li>
<li><a href="#L109">is_first_message</a></li>
<li><a href="#L24">is_none</a></li>
<li><a href="#L744">is_quotable_loc</a></li>
<li><a href="#L343">is_start</a></li>
<li><a href="#L476">iset</a></li>
<li><a href="#L534">line</a></li>
<li><a href="#L484">lines</a></li>
<li><a href="#L544">lines_around</a></li>
<li><a href="#L646">lines_around_from_current_input</a></li>
<li><a href="#L623">lines_around_from_file</a></li>
<li><a href="#L582">lines_around_from_lexbuf</a></li>
<li><a href="#L606">lines_around_from_phrasebuf</a></li>
<li><a href="#L563">loop</a></li>
<li><a href="#L333">mem</a></li>
<li><a href="#L876">mkerror</a></li>
<li><a href="#L73">mkloc</a></li>
<li><a href="#L74">mknoloc</a></li>
<li><a href="#L23">none</a></li>
<li><a href="#L101">num_loc_lines</a></li>
<li><a href="#L309">of_intervals</a></li>
<li><a href="#L516">pos</a></li>
<li><a href="#L823">pp_submsg_txt</a></li>
<li><a href="#L944">prerr_alert</a></li>
<li><a href="#L926">prerr_warning</a></li>
<li><a href="#L939">print_alert</a></li>
<li><a href="#L207">print_filename</a></li>
<li><a href="#L216">print_loc</a></li>
<li><a href="#L272">print_locs</a></li>
<li><a href="#L864">print_report</a></li>
<li><a href="#L921">print_warning</a></li>
<li><a href="#L1029">raise_errorf</a></li>
<li><a href="#L983">register_error_of_exn</a></li>
<li><a href="#L937">report_alert</a></li>
<li><a href="#L873">report_error</a></li>
<li><a href="#L1010">report_exception</a></li>
<li><a href="#L862">report_printer</a></li>
<li><a href="#L917">report_warning</a></li>
<li><a href="#L113">reset</a></li>
<li><a href="#L155">rewrite_absolute_path</a></li>
<li><a href="#L173">rewrite_find_all_existing_dirs</a></li>
<li><a href="#L160">rewrite_find_first_existing</a></li>
<li><a href="#L58">rhs_interval</a></li>
<li><a href="#L52">rhs_loc</a></li>
<li><a href="#L192">s</a></li>
<li><a href="#L122">separate_new_message</a></li>
<li><a href="#L149">setup_colors</a></li>
<li><a href="#L88">setup_terminal</a></li>
<li><a href="#L204">show_filename</a></li>
<li><a href="#L237">startchar</a></li>
<li><a href="#L235">startline</a></li>
<li><a href="#L256">startline</a></li>
<li><a href="#L86">status</a></li>
<li><a href="#L46">symbol_gloc</a></li>
<li><a href="#L40">symbol_rloc</a></li>
<li><a href="#L829">terminfo_toplevel_printer</a></li>
<li><a href="#L916">warning_reporter</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L304">bound</a></li>
<li><a href="#L871">error</a></li>
<li><a href="#L434">input_line</a></li>
<li><a href="#L68">loc</a></li>
<li><a href="#L699">report_printer</a></li>
<li><a href="#L18">t</a></li>
<li><a href="#L307">t</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">(**************************************************************************)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><br/></li>
<li><span class="Statement"><a href="ast_mapper.ml.html#L132" title="ocaml/parsing/ast_mapper.ml:132">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Lexing<br/></li>
<li></span><br/></li>
<li><a id="L18">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">t</span></span> <span class="Statement">=</span> <span class="PreProc">Warnings</span>.<span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">loc_start</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">loc_end</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">loc_ghost</span>: <span class="Type">bool</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L21">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">in_file</span></span> <span class="Statement">=</span> <span class="PreProc">Warnings</span>.<span class="ocamlLCIdentifier">ghost_loc_in_file<br/></li>
<li></span><br/></li>
<li><a id="L23">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">none</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L21" title="ocaml/parsing/location.ml:21">in_file</a></span> <span class="Constant">&quot;_none_&quot;<br/></li>
<li><a id="L24">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">is_none</span></span> <span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L951" title="ocaml/parsing/ast_mapper.ml:951">l</a></span> <span class="Statement">=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L951" title="ocaml/parsing/ast_mapper.ml:951">l</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L26">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">curr</span></span> <span class="ocamlLCIdentifier">lexbuf</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_start</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">lexbuf</span>.<span class="ocamlLCIdentifier">lex_start_p</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_end</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">lexbuf</span>.<span class="ocamlLCIdentifier">lex_curr_p</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_ghost</span> <span class="Statement">=</span> <span class="Constant">false<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L32">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">init</span></span> <span class="ocamlLCIdentifier">lexbuf</span> <span class="ocamlLCIdentifier">fname</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">lexbuf</span>.<span class="ocamlLCIdentifier">lex_curr_p</span> <span class="Statement">&lt;-</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pos_fname</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">fname</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pos_lnum</span> <span class="Statement">=</span> <span class="Constant">1</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pos_bol</span> <span class="Statement">=</span> <span class="Constant">0</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pos_cnum</span> <span class="Statement">=</span> <span class="Constant">0</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L40">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">symbol_rloc</span></span> <span class="Constant">()</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_start</span> <span class="Statement">=</span> <span class="PreProc">Parsing</span>.<span class="ocamlLCIdentifier">symbol_start_pos</span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_end</span> <span class="Statement">=</span> <span class="PreProc">Parsing</span>.<span class="ocamlLCIdentifier">symbol_end_pos</span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_ghost</span> <span class="Statement">=</span> <span class="Constant">false</span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L46">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">symbol_gloc</span></span> <span class="Constant">()</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_start</span> <span class="Statement">=</span> <span class="PreProc">Parsing</span>.<span class="ocamlLCIdentifier">symbol_start_pos</span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_end</span> <span class="Statement">=</span> <span class="PreProc">Parsing</span>.<span class="ocamlLCIdentifier">symbol_end_pos</span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_ghost</span> <span class="Statement">=</span> <span class="Constant">true</span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L52">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">rhs_loc</span></span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_start</span> <span class="Statement">=</span> <span class="PreProc">Parsing</span>.<span class="ocamlLCIdentifier">rhs_start_pos</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_end</span> <span class="Statement">=</span> <span class="PreProc">Parsing</span>.<span class="ocamlLCIdentifier">rhs_end_pos</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_ghost</span> <span class="Statement">=</span> <span class="Constant">false</span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L58">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">rhs_interval</span></span> <span class="ocamlLCIdentifier">m</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_start</span> <span class="Statement">=</span> <span class="PreProc">Parsing</span>.<span class="ocamlLCIdentifier">rhs_start_pos</span> <span class="ocamlLCIdentifier">m</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_end</span> <span class="Statement">=</span> <span class="PreProc">Parsing</span>.<span class="ocamlLCIdentifier">rhs_end_pos</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">loc_ghost</span> <span class="Statement">=</span> <span class="Constant">false</span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* return file, <a href="#L534" title="ocaml/parsing/location.ml:534">line</a>, <a href="ast_helper.ml.html#L42" title="ocaml/parsing/ast_helper.ml:42">char</a> from the given position *)<br/></li>
<li><a id="L65">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">get_pos_info</span></span> <span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span>.<span class="ocamlLCIdentifier">pos_fname</span>, <span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span>.<span class="ocamlLCIdentifier">pos_lnum</span>, <span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span>.<span class="ocamlLCIdentifier">pos_cnum</span> - <span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span>.<span class="ocamlLCIdentifier">pos_bol</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L68">&#x200c;</a><span class="Statement">type</span> '<span class="ocamlLCIdentifier">a</span> <span class="ocamlLCIdentifier"><span class="linkable">loc</span></span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">txt</span> : '<span class="ocamlLCIdentifier">a</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> : <span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L73">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">mkloc</span></span> <span class="ocamlLCIdentifier">txt</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">}<br/></li>
<li><a id="L74">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">mknoloc</span></span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L73" title="ocaml/parsing/location.ml:73">mkloc</a></span> <span class="ocamlLCIdentifier">txt</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* Input <a href="docstrings.mli.html#L106" title="ocaml/parsing/docstrings.mli:106">info</a> *)<br/></li>
<li></span><br/></li>
<li><a id="L79">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">input_name</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">&quot;_none_&quot;<br/></li>
<li><a id="L80">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">input_lexbuf</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="Constant">None</span> : <span class="ocamlLCIdentifier">lexbuf</span> <span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a></span><span class="Statement">)<br/></li>
<li><a id="L81">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">input_phrase_buffer</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="Constant">None</span> : <span class="PreProc">Buffer</span>.<span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span> <span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* Terminal <a href="docstrings.mli.html#L106" title="ocaml/parsing/docstrings.mli:106">info</a> *)<br/></li>
<li></span><br/></li>
<li><a id="L86">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">status</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="PreProc">Terminfo</span>.<span class="Constant">Uninitialised<br/></li>
<li></span><br/></li>
<li><a id="L88">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">setup_terminal</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L86" title="ocaml/parsing/location.ml:86">status</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="PreProc">Terminfo</span><span class="ocamlNone">.</span><span class="Constant">Uninitialised</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L86" title="ocaml/parsing/location.ml:86">status</a></span> <span class="Statement">:=</span> <span class="PreProc">Terminfo</span>.<span class="ocamlLCIdentifier">setup</span> <span class="ocamlLCIdentifier">stdout<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* The number of <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> already printed after input.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; This is used by [<a href="#L365" title="ocaml/parsing/location.ml:365">highlight_terminfo</a>] to identify the current position of the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; input in the terminal. This would not be possible without this information,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; since printing several warnings/errors adds <a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a> between the user input and<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; the bottom of the terminal.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; We also use for {!is_first_report}, see below.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li><a id="L101">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">num_loc_lines</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* We use [<a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a>] to determine if the <a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a> about to be<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; printed is the <a href="#L240" title="ocaml/parsing/location.ml:240">first</a> or a follow-up <a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a> of the current<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; &quot;batch&quot; -- contiguous reports without user input in between, for<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; example for the current toplevel phrase. We use this to print<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; a blank <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> between messages of the same batch.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li><a id="L109">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">is_first_message</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a></span> <span class="Statement">=</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* This is used by the toplevel to <a href="#L113" title="ocaml/parsing/location.ml:113">reset</a> [<a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a>] before each phrase *)<br/></li>
<li><a id="L113">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">reset</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a></span> <span class="Statement">:=</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* This is used by the toplevel *)<br/></li>
<li><a id="L117">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">echo_eof</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">print_newline</span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">incr</span> <span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* This is used by the toplevel and the <a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a> printers below. *)<br/></li>
<li><a id="L122">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">separate_new_message</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L109" title="ocaml/parsing/location.ml:109">is_first_message</a></span><span class="ocamlNone"> </span><span class="Constant">()</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">pp_print_newline</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">incr</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Code printing errors and warnings must be wrapped using this function, in<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; order to update [<a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a>].<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; [print_updating_num_loc_lines ppf f arg] is equivalent to calling [f ppf<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; arg], and additionally updates [<a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a>]. *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">print_updating_num_loc_lines</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">f</span> <span class="ocamlLCIdentifier">arg</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><a href="ast_mapper.ml.html#L132" title="ocaml/parsing/ast_mapper.ml:132">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Format</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">out_functions</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pp_get_formatter_out_functions</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">out_string</span> <span class="ocamlLCIdentifier"><a href="ast_helper.mli.html#L31" title="ocaml/parsing/ast_helper.mli:31">str</a></span> <span class="ocamlLCIdentifier">start</span> <span class="ocamlLCIdentifier">len</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier">count</span> <span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">start</span><span class="ocamlNone"> + </span><span class="ocamlLCIdentifier">len</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">c<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">get</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="ast_helper.mli.html#L31" title="ocaml/parsing/ast_helper.mli:31">str</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">'\n'</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">count</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">succ</span> <span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">succ</span> <span class="ocamlLCIdentifier">c</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier">count</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">succ</span> <span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">c</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a></span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a></span> + <span class="ocamlLCIdentifier">count</span> <span class="ocamlLCIdentifier">start</span> <span class="Constant">0</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">out_functions</span>.<span class="ocamlLCIdentifier">out_string</span> <span class="ocamlLCIdentifier"><a href="ast_helper.mli.html#L31" title="ocaml/parsing/ast_helper.mli:31">str</a></span> <span class="ocamlLCIdentifier">start</span> <span class="ocamlLCIdentifier">len</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pp_set_formatter_out_functions</span> <span class="ocamlLCIdentifier">ppf<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">out_functions</span> <span class="Statement">with</span> <span class="ocamlLCIdentifier">out_string</span> <span class="Statement">}</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">f</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">arg</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pp_print_flush</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pp_set_formatter_out_functions</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">out_functions<br/></li>
<li></span><br/></li>
<li><a id="L149">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">setup_colors</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Misc</span>.<span class="PreProc">Color</span>.<span class="ocamlLCIdentifier">setup</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">color<br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* Printing locations, e.g. 'File &quot;foo.ml&quot;, <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> 3, characters 10-12' *)<br/></li>
<li></span><br/></li>
<li><a id="L155">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">rewrite_absolute_path</span></span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">get_build_path_prefix_map</span> <span class="Constant">()</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">path<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L92" title="ocaml/parsing/ast_mapper.ml:92">map</a></span> <span class="Statement">-&gt;</span> <span class="PreProc">Build_path_prefix_map</span>.<span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L1028" title="ocaml/parsing/ast_mapper.ml:1028">rewrite</a></span> <span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L92" title="ocaml/parsing/ast_mapper.ml:92">map</a></span> <span class="ocamlLCIdentifier">path<br/></li>
<li></span><br/></li>
<li><a id="L160">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">rewrite_find_first_existing</span></span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">get_build_path_prefix_map</span> <span class="Constant">()</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Sys</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">file_exists</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">path</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">path<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">prefix_map</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="PreProc">Build_path_prefix_map</span>.<span class="ocamlLCIdentifier">rewrite_all</span> <span class="ocamlLCIdentifier">prefix_map</span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Sys</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">file_exists</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">path</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">path<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">matches</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Some</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">find</span> <span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">file_exists</span> <span class="ocamlLCIdentifier">matches</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L173">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">rewrite_find_all_existing_dirs</span></span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">ok</span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">=</span> <span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">file_exists</span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">&amp;&amp;</span> <span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">is_directory</span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">get_build_path_prefix_map</span> <span class="Constant">()</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ok</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">path</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">[</span><span class="ocamlLCIdentifier">path</span><span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Constant">[]<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">prefix_map</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="PreProc">Build_path_prefix_map</span>.<span class="ocamlLCIdentifier">rewrite_all</span> <span class="ocamlLCIdentifier">prefix_map</span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ok</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">path</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">[</span><span class="ocamlLCIdentifier">path</span><span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Constant">[]<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">matches</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">filter</span> <span class="ocamlLCIdentifier">ok</span> <span class="ocamlLCIdentifier">matches</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Statement">raise</span> <span class="Constant">Not_found<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">results</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">results<br/></li>
<li></span><br/></li>
<li><a id="L189">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">absolute_path</span></span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span> <span class="Statement">=</span> <span class="Comment">(* This function could go into Filename *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement"><a href="ast_mapper.ml.html#L132" title="ocaml/parsing/ast_mapper.ml:132">open</a></span><span class="ocamlNone"> </span><span class="PreProc">Filename</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span> <span class="Statement">=</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">is_relative</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">concat</span> <span class="Statement">(</span><span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">getcwd</span> <span class="Constant">()</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="Statement">)</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span> <span class="Statement">in<br/></li>
<li><a id="L192">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">s</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/parsing/location.ml:155">rewrite_absolute_path</a></span> <span class="ocamlLCIdentifier"><span class="linkable">s</span></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Now simplify . and .. components *)<br/></li>
<li><a id="L194">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">aux</span></span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">base</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">basename</span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">dir</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">dirname</span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">dir</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">dir<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">base</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">current_dir_name</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L194" title="ocaml/parsing/location.ml:194">aux</a></span> <span class="ocamlLCIdentifier">dir<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">base</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">parent_dir_name</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">dirname</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L194" title="ocaml/parsing/location.ml:194">aux</a></span> <span class="ocamlLCIdentifier">dir</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier">concat</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L194" title="ocaml/parsing/location.ml:194">aux</a></span> <span class="ocamlLCIdentifier">dir</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">base<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L194" title="ocaml/parsing/location.ml:194">aux</a></span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a><br/></li>
<li></span><br/></li>
<li><a id="L204">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">show_filename</span></span> <span class="ocamlLCIdentifier">file</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">absname</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="#L189" title="ocaml/parsing/location.ml:189">absolute_path</a></span> <span class="ocamlLCIdentifier">file</span> <span class="Statement">else</span> <span class="ocamlLCIdentifier">file<br/></li>
<li></span><br/></li>
<li><a id="L207">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">print_filename</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">file</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_print_string</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L204" title="ocaml/parsing/location.ml:204">show_filename</a></span> <span class="ocamlLCIdentifier">file</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Best-effort printing of the <a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a> describing a location, of the form<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; 'File &quot;foo.ml&quot;, <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> 3, characters 10-12'.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Some of the information (filename, <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> number or characters numbers) in the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; location might be invalid; in which <a href="parsetree.mli.html#L420" title="ocaml/parsing/parsetree.mli:420">case</a> we do not print it.<br/></li>
<li></span><span class="Comment"> *)<br/></li>
<li><a id="L216">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">print_loc</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L149" title="ocaml/parsing/location.ml:149">setup_colors</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">file_valid</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">&quot;_none_&quot;</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">(* This is a dummy placeholder, but we print it anyway to please editors<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; that <a href="longident.mli.html#L40" title="ocaml/parsing/longident.mli:40">parse</a> locations in <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a> messages (e.g. Emacs). *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">true<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">&quot;&quot;</span> <span class="Statement">|</span> <span class="Constant">&quot;//toplevel//&quot;</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">line_valid</span> <span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span> <span class="Statement">&gt;</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">chars_valid</span> <span class="Statement">~</span><span class="Identifier"><a href="#L237" title="ocaml/parsing/location.ml:237">startchar</a></span> <span class="Statement">~</span><span class="Identifier"><a href="#L238" title="ocaml/parsing/location.ml:238">endchar</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/parsing/location.ml:237">startchar</a></span> <span class="Statement">&lt;&gt;</span> -<span class="Constant">1</span> <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier"><a href="#L238" title="ocaml/parsing/location.ml:238">endchar</a></span> <span class="Statement">&lt;&gt;</span> -<span class="Constant">1</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">file</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* According to the comment in location.mli, if [pos_fname] is &quot;&quot;, we must<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; use [!<a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a>]. *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">loc_start</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pos_fname</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">&quot;&quot;</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_start</span>.<span class="ocamlLCIdentifier">pos_fname<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L235">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">startline</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_start</span>.<span class="ocamlLCIdentifier">pos_lnum</span> <span class="Statement">in<br/></li>
<li><a id="L236">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">endline</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_end</span>.<span class="ocamlLCIdentifier">pos_lnum</span> <span class="Statement">in<br/></li>
<li><a id="L237">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">startchar</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_start</span>.<span class="ocamlLCIdentifier">pos_cnum</span> - <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_start</span>.<span class="ocamlLCIdentifier">pos_bol</span> <span class="Statement">in<br/></li>
<li><a id="L238">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">endchar</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_end</span>.<span class="ocamlLCIdentifier">pos_cnum</span> - <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_end</span>.<span class="ocamlLCIdentifier">pos_bol</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li><a id="L240">&#x200c;</a>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">first</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">true</span> <span class="Statement">in<br/></li>
<li><a id="L241">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">capitalize</span></span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L240" title="ocaml/parsing/location.ml:240">first</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L240" title="ocaml/parsing/location.ml:240">first</a></span> <span class="Statement">:=</span> <span class="Constant">false</span><span class="Statement">;</span> <span class="PreProc">String</span>.<span class="ocamlLCIdentifier">capitalize_ascii</span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span> <span class="Statement">in<br/></li>
<li><a id="L244">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">comma</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L240" title="ocaml/parsing/location.ml:240">first</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">()</span> <span class="Statement">else</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;, &quot;</span> <span class="Statement">in<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@{&lt;<a href="#L68" title="ocaml/parsing/location.ml:68">loc</a>&gt;&quot;</span><span class="Statement">;<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">file_valid</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">file</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> \&quot;%a\&quot;&quot;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/parsing/location.ml:241">capitalize</a></span> <span class="Constant">&quot;file&quot;</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L207" title="ocaml/parsing/location.ml:207">print_filename</a></span> <span class="ocamlLCIdentifier">file</span><span class="Statement">;<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Comment">(* Print &quot;<a href="#L534" title="ocaml/parsing/location.ml:534">line</a> 1&quot; in the <a href="parsetree.mli.html#L420" title="ocaml/parsing/parsetree.mli:420">case</a> of a dummy <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> number. This is to please the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; existing setup of editors that <a href="longident.mli.html#L40" title="ocaml/parsing/longident.mli:40">parse</a> locations in <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a> messages (e.g.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; Emacs). *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L244" title="ocaml/parsing/location.ml:244">comma</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li><a id="L256">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">startline</span></span> <span class="Statement">=</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">line_valid</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><span class="linkable">startline</span></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><span class="linkable">startline</span></span> <span class="Statement">else</span> <span class="Constant">1</span> <span class="Statement">in<br/></li>
<li><a id="L257">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">endline</span></span> <span class="Statement">=</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">line_valid</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><span class="linkable">endline</span></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><span class="linkable">endline</span></span> <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="#L235" title="ocaml/parsing/location.ml:235">startline</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L235" title="ocaml/parsing/location.ml:235">startline</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L236" title="ocaml/parsing/location.ml:236">endline</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlEnd"> </span><span class="Constant">&quot;%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> %<a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a>&quot;</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/parsing/location.ml:241">capitalize</a></span><span class="ocamlEnd"> </span><span class="Constant">&quot;<a href="#L534" title="ocaml/parsing/location.ml:534">line</a>&quot;</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L235" title="ocaml/parsing/location.ml:235">startline</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlEnd"> </span><span class="Constant">&quot;%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> %<a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a>-%<a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a>&quot;</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/parsing/location.ml:241">capitalize</a></span><span class="ocamlEnd"> </span><span class="Constant">&quot;<a href="#L484" title="ocaml/parsing/location.ml:484">lines</a>&quot;</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L235" title="ocaml/parsing/location.ml:235">startline</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L236" title="ocaml/parsing/location.ml:236">endline</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end;<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">chars_valid</span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L237" title="ocaml/parsing/location.ml:237">startchar</a></span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L238" title="ocaml/parsing/location.ml:238">endchar</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L244" title="ocaml/parsing/location.ml:244">comma</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> %<a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a>-%<a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a>&quot;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L241" title="ocaml/parsing/location.ml:241">capitalize</a></span> <span class="Constant">&quot;characters&quot;</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L237" title="ocaml/parsing/location.ml:237">startchar</a></span> <span class="ocamlLCIdentifier"><a href="#L238" title="ocaml/parsing/location.ml:238">endchar</a><br/></li>
<li></span>&nbsp; <span class="Statement">);<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@}&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Print a <a href="#L244" title="ocaml/parsing/location.ml:244">comma</a>-separated <a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a> of locations *)<br/></li>
<li><a id="L272">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">print_locs</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">locs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_print_list</span> <span class="Statement">~</span><span class="Identifier">pp_sep</span>:<span class="Statement">(fun</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">()</span> <span class="Statement">-&gt;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;,@ &quot;</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L216" title="ocaml/parsing/location.ml:216">print_loc</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">locs<br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* An <a href="ast_helper.ml.html#L154" title="ocaml/parsing/ast_helper.ml:154">interval</a> set <a href="printast.mli.html#L31" title="ocaml/parsing/printast.mli:31">structure</a>; additionally, it stores user-provided information<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; at <a href="ast_helper.ml.html#L154" title="ocaml/parsing/ast_helper.ml:154">interval</a> boundaries.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The <a href="printast.mli.html#L27" title="ocaml/parsing/printast.mli:27">implementation</a> provided here is naive and assumes the number of intervals<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; to be small, but the <a href="printast.mli.html#L26" title="ocaml/parsing/printast.mli:26">interface</a> would allow for a more efficient<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="printast.mli.html#L27" title="ocaml/parsing/printast.mli:27">implementation</a> if needed.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Note: the <a href="printast.mli.html#L31" title="ocaml/parsing/printast.mli:31">structure</a> only stores maximal intervals (that therefore do not<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; overlap).<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> ISet</span><span class="ocamlPreDef"> : </span><span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="depend.ml.html#L28" title="ocaml/parsing/depend.ml:28">bound</a></span><span class="ocamlSig"> </span><span class="Statement">=</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="Statement">*</span><span class="ocamlSig"> </span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a><br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a><br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Comment">(* bounds are included *)<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L309" title="ocaml/parsing/location.ml:309">of_intervals</a></span><span class="ocamlSig"> : </span><span class="Statement">(</span><span class="ocamlSig">'</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="depend.ml.html#L28" title="ocaml/parsing/depend.ml:28">bound</a></span><span class="ocamlSig"> </span><span class="Statement">*</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="depend.ml.html#L28" title="ocaml/parsing/depend.ml:28">bound</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L333" title="ocaml/parsing/location.ml:333">mem</a></span><span class="ocamlSig"> : '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlSig">:</span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">bool<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">find_bound_in</span><span class="ocamlSig"> : '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">range</span><span class="ocamlSig">:</span><span class="Statement">(</span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span><span class="ocamlSig"> </span><span class="Statement">*</span><span class="ocamlSig"> </span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="depend.ml.html#L28" title="ocaml/parsing/depend.ml:28">bound</a></span><span class="ocamlSig"> </span><span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L343" title="ocaml/parsing/location.ml:343">is_start</a></span><span class="ocamlSig"> : '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlSig">:</span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a><br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L348" title="ocaml/parsing/location.ml:348">is_end</a></span><span class="ocamlSig"> : '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlSig">:</span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L353" title="ocaml/parsing/location.ml:353">extrema</a></span><span class="ocamlSig"> : '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Statement">(</span><span class="ocamlSig">'</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="depend.ml.html#L28" title="ocaml/parsing/depend.ml:28">bound</a></span><span class="ocamlSig"> </span><span class="Statement">*</span><span class="ocamlSig"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="depend.ml.html#L28" title="ocaml/parsing/depend.ml:28">bound</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a><br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><span class="Statement">=<br/></li>
<li></span><span class="PreProc">struct<br/></li>
<li><a id="L304">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">bound</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="Statement">*</span><span class="ocamlStruct"> </span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Comment">(* non overlapping intervals *)<br/></li>
<li><a id="L307">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlStruct">'</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="depend.ml.html#L28" title="ocaml/parsing/depend.ml:28">bound</a></span><span class="ocamlStruct"> </span><span class="Statement">*</span><span class="ocamlStruct"> '</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="depend.ml.html#L28" title="ocaml/parsing/depend.ml:28">bound</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a><br/></li>
<li></span><br/></li>
<li><a id="L309">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">of_intervals</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">intervals</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L92" title="ocaml/parsing/ast_mapper.ml:92">map</a></span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="Statement">(</span><span class="ocamlLCIdentifier">b</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">y</span><span class="Statement">))</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="Constant">[]</span><span class="ocamlStruct"> </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Statement">[((</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="Constant">`S</span><span class="Statement">);</span><span class="ocamlStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">b</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">y</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="Constant">`E</span><span class="Statement">)]<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">intervals<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|&gt;</span><span class="ocamlStruct"> </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="longident.ml.html#L26" title="ocaml/parsing/longident.ml:26">flatten</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|&gt;</span><span class="ocamlStruct"> </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">sort</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">((_</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">k</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">((_</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">y</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">k</span><span class="ocamlStruct">'</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* Make `S come before `E so that consecutive intervals get merged<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; together in the fold below *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">kn</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">function</span><span class="ocamlStruct"> </span><span class="Constant">`S</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">`E</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">1</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">compare</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">kn</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">k</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">y</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">kn</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">k</span><span class="ocamlStruct">'</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">nesting</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">acc</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">fold_left</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">nesting</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">acc</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">kind</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">kind</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">nesting</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">`S</span><span class="ocamlStruct">, </span><span class="Constant">`Outside</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">`Inside</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct">, </span><span class="Constant">0</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">acc<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">`S</span><span class="ocamlStruct">, </span><span class="Constant">`Inside</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">`Inside</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">n</span><span class="ocamlStruct">+</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">acc<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">`E</span><span class="ocamlStruct">, </span><span class="Constant">`Outside</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">assert</span><span class="ocamlStruct"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">`E</span><span class="ocamlStruct">, </span><span class="Constant">`Inside</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlStruct">, </span><span class="Constant">0</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">`Outside</span><span class="ocamlStruct">, </span><span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">a</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">::</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">acc</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">`E</span><span class="ocamlStruct">, </span><span class="Constant">`Inside</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">`Inside</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">n</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">acc<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">`Outside</span><span class="ocamlStruct">, </span><span class="Constant">[]</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">assert</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">nesting</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">`Outside</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">rev</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">acc<br/></li>
<li></span><br/></li>
<li><a id="L333">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">mem</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">exists</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">((_</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="Statement">(_</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">e</span><span class="Statement">))</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlStruct"> </span><span class="Statement">&lt;=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlStruct"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlStruct"> </span><span class="Statement">&lt;=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">e</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">find_bound_in</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier">range</span><span class="ocamlStruct">:</span><span class="Statement">(</span><span class="ocamlLCIdentifier">start</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">end_</span><span class="Statement">)</span><span class="ocamlStruct">&nbsp; </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">find_map</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="Statement">(</span><span class="ocamlLCIdentifier">b</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">y</span><span class="Statement">))</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">start</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">end_</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">start</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">end_</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">b</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">y</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a><br/></li>
<li></span><br/></li>
<li><a id="L343">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">is_start</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">find_map</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">((</span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="Statement">_)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a><br/></li>
<li></span><br/></li>
<li><a id="L348">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">is_end</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">find_map</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="Statement">(_</span><span class="ocamlStruct">, </span><span class="Statement">(</span><span class="ocamlLCIdentifier">b</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">y</span><span class="Statement">))</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">b</span><span class="ocamlStruct"> </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a><br/></li>
<li></span><br/></li>
<li><a id="L353">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">extrema</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">[]</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">fst</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">hd</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">snd</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">hd</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">rev</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="Statement">)))<br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* Toplevel: highlighting and quoting locations *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Highlight the locations using standout mode.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; If [locs] is empty, this function is a no-op.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li><a id="L365">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">highlight_terminfo</span></span> <span class="ocamlLCIdentifier">lb</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">locs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_print_flush</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">()</span><span class="Statement">;</span>&nbsp; <span class="Comment">(* avoid mixing Format and normal output *)<br/></li>
<li></span>&nbsp; <span class="Comment">(* Char 0 is at offset -lb.lex_abs_pos in lb.lex_buffer. *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos0</span> <span class="Statement">=</span> -<span class="ocamlLCIdentifier">lb</span>.<span class="ocamlLCIdentifier">lex_abs_pos</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Do nothing if the buffer does not contain the whole phrase. *)<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos0</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">raise</span> <span class="Constant">Exit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Comment">(* Count number of <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> in phrase *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pos0</span><span class="ocamlNone"> </span><span class="Statement">to</span> <span class="ocamlLCIdentifier">lb</span>.<span class="ocamlLCIdentifier">lex_buffer_len</span> - <span class="Constant">1</span> <span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Bytes</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">get</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">lb</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">lex_buffer</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">'\n'</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">incr</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span><span class="ocamlDo">&nbsp; </span><span class="Statement">done;<br/></li>
<li></span>&nbsp; <span class="Comment">(* If too many <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a>, give up *)<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="PreProc">Terminfo</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">num_lines</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">stdout</span><span class="ocamlNone"> - </span><span class="Constant">2</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">raise</span> <span class="Constant">Exit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Comment">(* Move cursor up that number of <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">flush</span> <span class="ocamlLCIdentifier">stdout</span><span class="Statement">;</span> <span class="PreProc">Terminfo</span>.<span class="ocamlLCIdentifier">backup</span> <span class="ocamlLCIdentifier">stdout</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Comment">(* Print the input, switching to standout for the location *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">bol</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">false</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">print_string</span> <span class="Constant">&quot;# &quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span> <span class="ocamlLCIdentifier">lb</span>.<span class="ocamlLCIdentifier">lex_buffer_len</span> - <span class="ocamlLCIdentifier">pos0</span> - <span class="Constant">1</span> <span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">bol</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">print_string</span><span class="ocamlDo"> </span><span class="Constant">&quot;&nbsp; &quot;</span><span class="Statement">;</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">bol</span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="Constant">false</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">exists</span><span class="ocamlNone"> </span><span class="Statement">(fun</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">loc_start</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pos_cnum</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">locs</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Terminfo</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">standout</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">stdout</span><span class="ocamlDo"> </span><span class="Constant">true</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">exists</span><span class="ocamlNone"> </span><span class="Statement">(fun</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="ocamlNone"> </span><span class="Statement">-&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">loc_end</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pos_cnum</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">locs</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Terminfo</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">standout</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">stdout</span><span class="ocamlDo"> </span><span class="Constant">false</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="PreProc">Bytes</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">get</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">lb</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">lex_buffer</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlDo"> + </span><span class="ocamlLCIdentifier">pos0</span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">print_char</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">bol</span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">c</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="Constant">'\n'</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlDo">&nbsp; </span><span class="Statement">done;<br/></li>
<li></span>&nbsp; <span class="Comment">(* Make sure standout mode is over *)<br/></li>
<li></span>&nbsp; <span class="PreProc">Terminfo</span>.<span class="ocamlLCIdentifier">standout</span> <span class="ocamlLCIdentifier">stdout</span> <span class="Constant">false</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Comment">(* Position cursor back to original location *)<br/></li>
<li></span>&nbsp; <span class="PreProc">Terminfo</span>.<span class="ocamlLCIdentifier">resume</span> <span class="ocamlLCIdentifier">stdout</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">flush</span> <span class="ocamlLCIdentifier">stdout<br/></li>
<li></span><br/></li>
<li><a id="L399">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">highlight_terminfo</span></span> <span class="ocamlLCIdentifier">lb</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">locs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">try</span> <span class="ocamlLCIdentifier"><a href="#L365" title="ocaml/parsing/location.ml:365">highlight_terminfo</a></span> <span class="ocamlLCIdentifier">lb</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">locs<br/></li>
<li></span>&nbsp; <span class="Statement">with</span> <span class="Constant">Exit</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Highlight the location by printing it again.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; There are two different styles for highlighting errors in &quot;dumb&quot; mode,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; depending if the <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a> fits on a single <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> or spans across several <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a>.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; For single-<a href="#L534" title="ocaml/parsing/location.ml:534">line</a> errors,<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; foo the_error bar<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; gets displayed as follows, where X is the <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> number:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; X | foo the_error bar<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ^^^^^^^^^<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">&nbsp;&nbsp; For multi-<a href="#L534" title="ocaml/parsing/location.ml:534">line</a> errors,<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; foo the_<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a> bar<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; gets displayed as:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp;&nbsp; X1 | ....the_<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; X2 | <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a>....<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; An ellipsis hides the middle <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> of the multi-<a href="#L534" title="ocaml/parsing/location.ml:534">line</a> <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a> if it has more<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; than [max_lines] <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a>.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; If [locs] is empty then this function is a no-op.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L434">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">input_line</span></span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a></span> : <span class="Type"><a href="printast.ml.html#L125" title="ocaml/parsing/printast.ml:125">string</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">start_pos</span> : <span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Takes a <a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a> of <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> with possibly missing <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> numbers.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; If the <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> numbers that are present are consistent with the number of <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; between them, then infer the intermediate <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> numbers.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; This is not always the <a href="parsetree.mli.html#L420" title="ocaml/parsing/parsetree.mli:420">case</a>, typically if lexer <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> directives are<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; involved... *)<br/></li>
<li><a id="L446">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">infer_line_numbers</span><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span>: <span class="Statement">(</span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span> <span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="#L434" title="ocaml/parsing/location.ml:434">input_line</a></span><span class="Statement">)</span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a></span><span class="Statement">)</span>:<br/></li>
<li>&nbsp; <span class="Statement">(</span><span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span> <span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a></span> <span class="Statement">*</span> <span class="ocamlLCIdentifier"><a href="#L434" title="ocaml/parsing/location.ml:434">input_line</a></span><span class="Statement">)</span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a><br/></li>
<li></span>&nbsp; <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier">offset</span>, <span class="ocamlLCIdentifier">consistent</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_left</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span>, <span class="ocamlLCIdentifier">offset</span>, <span class="ocamlLCIdentifier">consistent</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lnum</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">lnum</span>, <span class="ocamlLCIdentifier">offset</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span>, <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span>+<span class="Constant">1</span>, <span class="ocamlLCIdentifier">offset</span>, <span class="ocamlLCIdentifier">consistent</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">n</span>, <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span>+<span class="Constant">1</span>, <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span> - <span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier">consistent</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">n</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span>+<span class="Constant">1</span>, <span class="ocamlLCIdentifier">offset</span>, <span class="ocamlLCIdentifier">consistent</span> <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">m</span> + <span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)</span> <span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">None</span>, <span class="Constant">true</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">offset</span>, <span class="ocamlLCIdentifier">consistent</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">m</span>, <span class="Constant">true</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">mapi</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span> <span class="Statement">(_</span>, <span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">m</span> + <span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="Statement">))</span> <span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* [get_lines] must return the <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> to highlight, given starting and ending<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; positions.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; See [<a href="#L646" title="ocaml/parsing/location.ml:646">lines_around_from_current_input</a>] below for an instantiation of<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; [get_lines] that reads from the current input.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li><a id="L470">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">highlight_quote</span></span> <span class="ocamlLCIdentifier">ppf<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~(</span><span class="ocamlLCIdentifier">get_lines</span>: <span class="ocamlLCIdentifier">start_pos</span>:<span class="ocamlLCIdentifier">position</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">end_pos</span>:<span class="ocamlLCIdentifier">position</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L434" title="ocaml/parsing/location.ml:434">input_line</a></span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">?(</span><span class="Identifier">max_lines</span> <span class="Statement">=</span> <span class="Constant">10</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">highlight_tag<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">locs<br/></li>
<li></span>&nbsp; <span class="Statement">=<br/></li>
<li><a id="L476">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">iset</span></span> <span class="Statement">=</span> <span class="PreProc">ISet</span>.<span class="ocamlLCIdentifier"><a href="#L309" title="ocaml/parsing/location.ml:309">of_intervals</a></span> @@ <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">filter_map</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span>, <span class="ocamlLCIdentifier">e</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_start</span>, <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_end</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pos_cnum</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> -</span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">e</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pos_cnum</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> -</span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Constant">Some</span> <span class="Statement">((</span><span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span>, <span class="ocamlLCIdentifier"><a href="#L192" title="ocaml/parsing/location.ml:192">s</a></span>.<span class="ocamlLCIdentifier">pos_cnum</span><span class="Statement">)</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">e</span>, <span class="ocamlLCIdentifier">e</span>.<span class="ocamlLCIdentifier">pos_cnum</span> - <span class="Constant">1</span><span class="Statement">))<br/></li>
<li></span>&nbsp; <span class="Statement">)</span> <span class="ocamlLCIdentifier">locs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="PreProc">ISet</span>.<span class="ocamlLCIdentifier"><a href="#L353" title="ocaml/parsing/location.ml:353">extrema</a></span> <span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">((</span><span class="ocamlLCIdentifier">leftmost</span>, <span class="Statement">_)</span>, <span class="Statement">(</span><span class="ocamlLCIdentifier">rightmost</span>, <span class="Statement">_))</span> <span class="Statement">-&gt;<br/></li>
<li><a id="L484">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lines</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">get_lines</span> <span class="Statement">~</span><span class="Identifier">start_pos</span>:<span class="ocamlLCIdentifier">leftmost</span> <span class="Statement">~</span><span class="Identifier">end_pos</span>:<span class="ocamlLCIdentifier">rightmost<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L92" title="ocaml/parsing/ast_mapper.ml:92">map</a></span> <span class="Statement">(fun</span> <span class="Statement">({</span> <span class="ocamlLCIdentifier"><a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">start_pos</span> <span class="Statement">}</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">end_pos</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">start_pos</span> + <span class="PreProc">String</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a></span> - <span class="Constant">1</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">line_nb</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="PreProc">ISet</span>.<span class="ocamlLCIdentifier">find_bound_in</span> <span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span> <span class="Statement">~</span><span class="Identifier">range</span>:<span class="Statement">(</span><span class="ocamlLCIdentifier">start_pos</span>, <span class="ocamlLCIdentifier">end_pos</span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">p</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">p</span>.<span class="ocamlLCIdentifier">pos_lnum<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">line_nb</span>, <span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|&gt;</span> <span class="ocamlLCIdentifier"><a href="#L446" title="ocaml/parsing/location.ml:446">infer_line_numbers</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|&gt;</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L92" title="ocaml/parsing/ast_mapper.ml:92">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lnum</span>, <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">start_pos</span> <span class="Statement">})</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a></span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier">fold</span> <span class="Statement">~</span><span class="Identifier">some</span>:<span class="PreProc">Int</span>.<span class="ocamlLCIdentifier">to_string</span> <span class="Statement">~</span><span class="Identifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span>:<span class="Constant">&quot;&quot;</span> <span class="ocamlLCIdentifier">lnum</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">start_pos</span><span class="Statement">))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@[&lt;v&gt;&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">[(</span><span class="Constant">&quot;&quot;</span><span class="ocamlEnd">, </span><span class="Statement">_</span><span class="ocamlEnd">, </span><span class="Statement">_)]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">[(</span><span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">line_nb</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">line_start_cnum</span><span class="Statement">)]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* Single-<a href="#L534" title="ocaml/parsing/location.ml:534">line</a> <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a> *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlEnd"> </span><span class="Constant">&quot;%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> | %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a>@,&quot;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">line_nb</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlEnd"> </span><span class="Constant">&quot;%*<a href="#L192" title="ocaml/parsing/location.ml:192">s</a>&nbsp;&nbsp; &quot;</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">String</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">line_nb</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Constant">&quot;&quot;</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* Iterate up to [rightmost], which can be larger than the length of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; the <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> because we may point to a location after the end of the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="longident.ml.html#L28" title="ocaml/parsing/longident.ml:28">last</a> <a href="parse.ml.html#L22" title="ocaml/parsing/parse.ml:22">token</a> on the <a href="#L534" title="ocaml/parsing/location.ml:534">line</a>, for instance:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {[<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="parse.ml.html#L22" title="ocaml/parsing/parse.ml:22">token</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ^<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Did you forget ...<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ]} *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rightmost</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">pos_cnum</span><span class="ocamlEnd"> - </span><span class="ocamlLCIdentifier">line_start_cnum</span><span class="ocamlEnd"> - </span><span class="Constant">1</span><span class="ocamlEnd"> </span><span class="Statement">do<br/></li>
<li><a id="L516">&#x200c;</a></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><span class="linkable">pos</span></span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">line_start_cnum</span><span class="ocamlDo"> + </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">ISet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L343" title="ocaml/parsing/location.ml:343">is_start</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">None</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlDo"> </span><span class="Constant">&quot;@{&lt;%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a>&gt;&quot;</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">highlight_tag</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">ISet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L333" title="ocaml/parsing/location.ml:333">mem</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="PreProc">Format</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">pp_print_char</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlDo"> </span><span class="Constant">'^'<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlDo"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* For alignment purposes, align using a tab for each tab in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; source code *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="ocamlNone">.</span><span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="Statement">]</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">'\<a href="#L18" title="ocaml/parsing/location.ml:18">t</a>'</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="PreProc">Format</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">pp_print_char</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlEnd"> </span><span class="Constant">'\<a href="#L18" title="ocaml/parsing/location.ml:18">t</a>'<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="PreProc">Format</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">pp_print_char</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlEnd"> </span><span class="Constant">' '<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">ISet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L348" title="ocaml/parsing/location.ml:348">is_end</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">None</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlDo"> </span><span class="Constant">&quot;@}&quot;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlEnd"> </span><span class="Constant">&quot;@}@,&quot;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* Multi-<a href="#L534" title="ocaml/parsing/location.ml:534">line</a> <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a> *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Misc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">pp_two_columns</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">sep</span><span class="ocamlEnd">:</span><span class="Constant">&quot;|&quot;</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">max_lines</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ppf<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; @@ </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L92" title="ocaml/parsing/ast_mapper.ml:92">map</a></span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">line_nb</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">line_start_cnum</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li><a id="L534">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">line</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">String</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">mapi</span><span class="ocamlEnd"> </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">car</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">ISet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="#L333" title="ocaml/parsing/location.ml:333">mem</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L476" title="ocaml/parsing/location.ml:476">iset</a></span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone">:</span><span class="Statement">(</span><span class="ocamlLCIdentifier">line_start_cnum</span><span class="ocamlNone"> + </span><span class="ocamlLCIdentifier"><a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a></span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">car</span><span class="ocamlEnd"> </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Constant">'.'<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier">line_nb</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="#L534" title="ocaml/parsing/location.ml:534">line</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@]&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L544">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lines_around</span><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~(</span><span class="ocamlLCIdentifier">start_pos</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">)</span> <span class="Statement">~(</span><span class="ocamlLCIdentifier">end_pos</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~(</span><span class="ocamlLCIdentifier">seek</span>: <span class="Type"><a href="ast_helper.ml.html#L37" title="ocaml/parsing/ast_helper.ml:37">int</a></span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~(</span><span class="ocamlLCIdentifier">read_char</span>: <span class="Type">unit</span> <span class="Statement">-&gt;</span> <span class="Type"><a href="ast_helper.ml.html#L42" title="ocaml/parsing/ast_helper.ml:42">char</a></span> <span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a></span><span class="Statement">)</span>:<br/></li>
<li>&nbsp; <span class="ocamlLCIdentifier"><a href="#L434" title="ocaml/parsing/location.ml:434">input_line</a></span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a><br/></li>
<li></span>&nbsp; <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">seek</span> <span class="ocamlLCIdentifier">start_pos</span>.<span class="ocamlLCIdentifier">pos_bol</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">[]</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">bol</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">start_pos</span>.<span class="ocamlLCIdentifier">pos_bol</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cur</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier">start_pos</span>.<span class="ocamlLCIdentifier">pos_bol</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">b</span> <span class="Statement">=</span> <span class="PreProc">Buffer</span>.<span class="ocamlLCIdentifier">create</span> <span class="Constant">80</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">add_line</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">bol</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">cur</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Buffer</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">contents</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">b</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Buffer</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">clear</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">b</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">{</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="docstrings.mli.html#L127" title="ocaml/parsing/docstrings.mli:127">text</a></span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">start_pos</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">bol</span><span class="ocamlEnd"> </span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">bol</span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">cur<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L563">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">loop</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">bol</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">end_pos</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pos_cnum</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">read_char</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">(* end of input *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">add_line</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">incr</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cur</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">'\r'</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">'\n'</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">add_line</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="PreProc">Buffer</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add_char</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">b</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Try to get <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> from a lexbuf *)<br/></li>
<li><a id="L582">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lines_around_from_lexbuf</span><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~(</span><span class="ocamlLCIdentifier">start_pos</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">)</span> <span class="Statement">~(</span><span class="ocamlLCIdentifier">end_pos</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">lb</span>: <span class="ocamlLCIdentifier">lexbuf</span><span class="Statement">)</span>:<br/></li>
<li>&nbsp; <span class="ocamlLCIdentifier"><a href="#L434" title="ocaml/parsing/location.ml:434">input_line</a></span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a><br/></li>
<li></span>&nbsp; <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* Converts a global position to one that is relative to the lexing buffer *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">rel</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">n</span> - <span class="ocamlLCIdentifier">lb</span>.<span class="ocamlLCIdentifier">lex_abs_pos</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">rel</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">start_pos</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">pos_bol</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Comment">(* Do nothing if the buffer does not contain the input (because it has been<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; refilled while lexing it) *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ref</span><span class="ocamlEnd"> </span><span class="Constant">0</span><span class="ocamlEnd"> </span><span class="Statement">in</span><span class="ocamlEnd"> </span><span class="Comment">(* relative position *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">seek</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">rel</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">read_char</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">lb</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">lex_buffer_len</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Comment">(* end of buffer *)</span><span class="ocamlEnd"> </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Bytes</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">get</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">lb</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">lex_buffer</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">incr</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L544" title="ocaml/parsing/location.ml:544">lines_around</a></span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">start_pos</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">end_pos</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">seek</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">read_char<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Attempt to get <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> from the phrase buffer *)<br/></li>
<li><a id="L606">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lines_around_from_phrasebuf</span><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~(</span><span class="ocamlLCIdentifier">start_pos</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">)</span> <span class="Statement">~(</span><span class="ocamlLCIdentifier">end_pos</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">pb</span>: <span class="PreProc">Buffer</span>.<span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span><span class="Statement">)</span>:<br/></li>
<li>&nbsp; <span class="ocamlLCIdentifier"><a href="#L434" title="ocaml/parsing/location.ml:434">input_line</a></span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a><br/></li>
<li></span>&nbsp; <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">seek</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">read_char</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="PreProc">Buffer</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">pb</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Buffer</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">nth</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pb</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">incr</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L516" title="ocaml/parsing/location.ml:516">pos</a></span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">c<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L544" title="ocaml/parsing/location.ml:544">lines_around</a></span> <span class="Statement">~</span><span class="Identifier">start_pos</span> <span class="Statement">~</span><span class="Identifier">end_pos</span> <span class="Statement">~</span><span class="Identifier">seek</span> <span class="Statement">~</span><span class="Identifier">read_char<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Get <a href="#L484" title="ocaml/parsing/location.ml:484">lines</a> from a file *)<br/></li>
<li><a id="L623">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lines_around_from_file</span><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~(</span><span class="ocamlLCIdentifier">start_pos</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">)</span> <span class="Statement">~(</span><span class="ocamlLCIdentifier">end_pos</span>: <span class="ocamlLCIdentifier">position</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">filename</span>: <span class="Type"><a href="printast.ml.html#L125" title="ocaml/parsing/printast.ml:125">string</a></span><span class="Statement">)</span>:<br/></li>
<li>&nbsp; <span class="ocamlLCIdentifier"><a href="#L434" title="ocaml/parsing/location.ml:434">input_line</a></span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a><br/></li>
<li></span>&nbsp; <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">cin</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">open_in_bin</span> <span class="ocamlLCIdentifier">filename</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">read_char</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">try</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">input_char</span> <span class="ocamlLCIdentifier">cin</span><span class="Statement">)</span> <span class="Statement">with</span> <span class="Constant">End_of_file</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L544" title="ocaml/parsing/location.ml:544">lines_around</a></span> <span class="Statement">~</span><span class="Identifier">start_pos</span> <span class="Statement">~</span><span class="Identifier">end_pos</span> <span class="Statement">~</span><span class="Identifier">seek</span>:<span class="Statement">(</span><span class="ocamlLCIdentifier">seek_in</span> <span class="ocamlLCIdentifier">cin</span><span class="Statement">)</span> <span class="Statement">~</span><span class="Identifier">read_char<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier">cin</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span>&nbsp; <span class="Statement">with</span> <span class="Constant">Sys_error</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* A [get_lines] function for [<a href="#L470" title="ocaml/parsing/location.ml:470">highlight_quote</a>] that reads from the current<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; input.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; It <a href="#L240" title="ocaml/parsing/location.ml:240">first</a> tries to read from [!<a href="#L80" title="ocaml/parsing/location.ml:80">input_lexbuf</a>], then if that fails (because the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; lexbuf no longer contains the input we want), it reads from [!<a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a>]<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; directly *)<br/></li>
<li><a id="L646">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lines_around_from_current_input</span></span> <span class="Statement">~</span><span class="Identifier">start_pos</span> <span class="Statement">~</span><span class="Identifier">end_pos</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* Be a bit defensive, and do not try to <a href="ast_mapper.ml.html#L132" title="ocaml/parsing/ast_mapper.ml:132">open</a> one of the possible<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; [!<a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a>] values that we know do not denote valid filenames. *)<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">file_valid</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">&quot;//toplevel//&quot;</span> <span class="Statement">|</span> <span class="Constant">&quot;_none_&quot;</span> <span class="Statement">|</span> <span class="Constant">&quot;&quot;</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">from_file</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">file_valid</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L623" title="ocaml/parsing/location.ml:623">lines_around_from_file</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a></span> <span class="Statement">~</span><span class="Identifier">start_pos</span> <span class="Statement">~</span><span class="Identifier">end_pos<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">[]<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L80" title="ocaml/parsing/location.ml:80">input_lexbuf</a></span>, <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L81" title="ocaml/parsing/location.ml:81">input_phrase_buffer</a></span>, <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier">pb</span>, <span class="Constant">&quot;//toplevel//&quot;</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L606" title="ocaml/parsing/location.ml:606">lines_around_from_phrasebuf</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pb</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">start_pos</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">end_pos</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Comment">(* Could not read the input from the phrase buffer. This is likely<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; a sign that we were given a buggy location. *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">[]<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">lb</span>, <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L582" title="ocaml/parsing/location.ml:582">lines_around_from_lexbuf</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">lb</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">start_pos</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">end_pos</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Comment">(* The input is likely not in the lexbuf anymore *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">from_file</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a></span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L484" title="ocaml/parsing/location.ml:484">lines</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span>, <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">from_file</span> <span class="Constant">()<br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* Reporting errors and warnings *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span> <span class="Statement">=</span> <span class="Statement">(</span><span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span> <span class="Statement">?(</span><span class="Identifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L700" title="ocaml/parsing/pprintast.ml:700">fmt</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">kdprintf</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">-&gt;</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">})</span> <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L700" title="ocaml/parsing/pprintast.ml:700">fmt</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L192" title="ocaml/parsing/location.mli:192">report_kind</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Report_error<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Report_warning</span> <span class="Statement">of</span> <span class="Type"><a href="printast.ml.html#L125" title="ocaml/parsing/printast.ml:125">string</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Report_warning_as_error</span> <span class="Statement">of</span> <span class="Type"><a href="printast.ml.html#L125" title="ocaml/parsing/printast.ml:125">string</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Report_alert</span> <span class="Statement">of</span> <span class="Type"><a href="printast.ml.html#L125" title="ocaml/parsing/printast.ml:125">string</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Report_alert_as_error</span> <span class="Statement">of</span> <span class="Type"><a href="printast.ml.html#L125" title="ocaml/parsing/printast.ml:125">string</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">kind</span> : <span class="ocamlLCIdentifier"><a href="location.mli.html#L192" title="ocaml/parsing/location.mli:192">report_kind</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">main</span> : <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">sub</span> : <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a></span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L699">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">report_printer</span></span> <span class="Statement">=</span> <span class="Statement">{<br/></li>
<li></span>&nbsp; <span class="Comment">(* The entry point *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">;<br/></li>
<li></span><br/></li>
<li>&nbsp; <span class="ocamlLCIdentifier">pp_report_kind</span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L192" title="ocaml/parsing/location.mli:192">report_kind</a></span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pp_main_loc</span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pp_main_txt</span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pp_submsgs</span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a></span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pp_submsg</span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">pp_submsg_loc</span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L823" title="ocaml/parsing/location.ml:823">pp_submsg_txt</a></span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="Statement">(</span><span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">formatter</span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="Type">unit</span><span class="Statement">;<br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L720">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">is_dummy_loc</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Comment">(* Fixme: this should be just [<a href="#L68" title="ocaml/parsing/location.ml:68">loc</a>.loc_ghost] and the function should be<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; inlined below. However, currently, the compiler emits in some places ghost<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; locations with valid ranges that should still be printed. These locations<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; should be made non-ghost -- in the meantime we just check if the ranges are<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; valid. *)<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_start</span>.<span class="ocamlLCIdentifier">pos_cnum</span> <span class="Statement">=</span> -<span class="Constant">1</span> <span class="Statement">||</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_end</span>.<span class="ocamlLCIdentifier">pos_cnum</span> <span class="Statement">=</span> -<span class="Constant">1<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* It only makes sense to highlight (<a href="printast.ml.html#L160" title="ocaml/parsing/printast.ml:160">i</a>.e. quote or underline the corresponding<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; source code) locations that originate from the current input.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; As of now, this should only happen in the following cases:<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; - if dummy locs or ghost locs leak out of the compiler or a buggy ppx;<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; - more generally, if some code uses the compiler-libs API and feeds it<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; locations that do not match the current values of [!Location.<a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a>],<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; [!Location.<a href="#L80" title="ocaml/parsing/location.ml:80">input_lexbuf</a>];<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; - when calling the compiler on a .ml file that contains lexer <a href="#L534" title="ocaml/parsing/location.ml:534">line</a> directives<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; indicating an other file. This should happen relatively rarely in practice --<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; in particular this is not what happens when using -<a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a> or -ppx or a ppx<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; driver.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li><a id="L744">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">is_quotable_loc</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">not</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L720" title="ocaml/parsing/location.ml:720">is_dummy_loc</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_start</span>.<span class="ocamlLCIdentifier">pos_fname</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a><br/></li>
<li></span>&nbsp; <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>.<span class="ocamlLCIdentifier">loc_end</span>.<span class="ocamlLCIdentifier">pos_fname</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a><br/></li>
<li></span><br/></li>
<li><a id="L749">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">error_style</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier"><a href="#L749" title="ocaml/parsing/location.ml:749">error_style</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">setting</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">setting<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="PreProc">Misc</span>.<span class="PreProc">Error_style</span>.<span class="ocamlLCIdentifier">default_setting<br/></li>
<li></span><br/></li>
<li><a id="L754">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">batch_mode_printer</span></span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_loc</span> <span class="ocamlLCIdentifier">_self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="ast_helper.ml.html#L629" title="ocaml/parsing/ast_helper.ml:629">tag</a></span> <span class="Statement">=</span> <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span>.<span class="ocamlLCIdentifier">kind</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_warning_as_error</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_alert_as_error</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_error</span> <span class="Statement">-&gt;</span> <span class="Constant">&quot;<a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a>&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_warning</span> <span class="Statement">_<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_alert</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">&quot;warning&quot;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">highlight</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L749" title="ocaml/parsing/location.ml:749">error_style</a></span> <span class="Constant">()</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">Misc</span>.<span class="PreProc">Error_style</span>.<span class="Constant">Contextual</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L744" title="ocaml/parsing/location.ml:744">is_quotable_loc</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L470" title="ocaml/parsing/location.ml:470">highlight_quote</a></span> <span class="ocamlLCIdentifier">ppf<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">get_lines</span>:<span class="ocamlLCIdentifier"><a href="#L646" title="ocaml/parsing/location.ml:646">lines_around_from_current_input</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="ast_helper.ml.html#L629" title="ocaml/parsing/ast_helper.ml:629">tag</a></span> <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="PreProc">Misc</span>.<span class="PreProc">Error_style</span>.<span class="Constant">Short</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@[&lt;v&gt;%a:@ %a@]&quot;</span> <span class="ocamlLCIdentifier"><a href="#L216" title="ocaml/parsing/location.ml:216">print_loc</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">highlight</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_txt</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">=</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@[%<a href="#L18" title="ocaml/parsing/location.ml:18">t</a>@]&quot;</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L149" title="ocaml/parsing/location.ml:149">setup_colors</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L122" title="ocaml/parsing/location.ml:122">separate_new_message</a></span> <span class="ocamlLCIdentifier">ppf</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* Make sure we keep [<a href="#L101" title="ocaml/parsing/location.ml:101">num_loc_lines</a>] updated.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; The tabulation box is here to give submessage the <a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; to be aligned with the main message box<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">print_updating_num_loc_lines</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">()</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@[&lt;v&gt;%a%a%a: %a%a%a%a@]@.&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_open_tbox</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">self</span>.<span class="ocamlLCIdentifier">pp_main_loc</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span>.<span class="ocamlLCIdentifier">main</span>.<span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">self</span>.<span class="ocamlLCIdentifier">pp_report_kind</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span>.<span class="ocamlLCIdentifier">kind<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_set_tab</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">self</span>.<span class="ocamlLCIdentifier">pp_main_txt</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span>.<span class="ocamlLCIdentifier">main</span>.<span class="ocamlLCIdentifier">txt<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">self</span>.<span class="ocamlLCIdentifier">pp_submsgs</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span>.<span class="ocamlLCIdentifier">sub<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_close_tbox</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_report_kind</span> <span class="ocamlLCIdentifier">_self</span> <span class="Statement">_</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_error</span> <span class="Statement">-&gt;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@{&lt;<a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a>&gt;Error@}&quot;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_warning</span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">-&gt;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@{&lt;warning&gt;Warning@} %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a>&quot;</span> <span class="ocamlLCIdentifier">w<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_warning_as_error</span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@{&lt;<a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a>&gt;Error@} (warning %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a>)&quot;</span> <span class="ocamlLCIdentifier">w<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_alert</span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">-&gt;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@{&lt;warning&gt;Alert@} %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a>&quot;</span> <span class="ocamlLCIdentifier">w<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Report_alert_as_error</span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@{&lt;<a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a>&gt;Error@} (<a href="#L946" title="ocaml/parsing/location.ml:946">alert</a> %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a>)&quot;</span> <span class="ocamlLCIdentifier">w<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_main_loc</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pp_loc</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_main_txt</span> <span class="ocamlLCIdentifier">_self</span> <span class="Statement">_</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pp_txt</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">txt<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_submsgs</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">msgs</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="ast_iterator.ml.html#L113" title="ocaml/parsing/ast_iterator.ml:113">iter</a></span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@,%a&quot;</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">self</span>.<span class="ocamlLCIdentifier">pp_submsg</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)</span> <span class="ocamlLCIdentifier">msgs<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_submsg</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">}</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@[%a&nbsp; %a@]&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">self</span>.<span class="ocamlLCIdentifier">pp_submsg_loc</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">self</span>.<span class="ocamlLCIdentifier"><a href="#L823" title="ocaml/parsing/location.ml:823">pp_submsg_txt</a></span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">txt<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_submsg_loc</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">loc_ghost</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">pp_loc</span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L823">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">pp_submsg_txt</span></span> <span class="ocamlLCIdentifier">_self</span> <span class="Statement">_</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pp_txt</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pp_report_kind</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pp_main_loc</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pp_main_txt</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">pp_submsgs</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pp_submsg</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pp_submsg_loc</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L823" title="ocaml/parsing/location.ml:823">pp_submsg_txt</a></span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L829">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">terminfo_toplevel_printer</span></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">lb</span>: <span class="ocamlLCIdentifier">lexbuf</span><span class="Statement">)</span>: <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="ast_invariants.ml.html#L19" title="ocaml/parsing/ast_invariants.ml:19">err</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L149" title="ocaml/parsing/location.ml:149">setup_colors</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* Highlight all toplevel locations of the <a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a>, instead of displaying<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; the main location. Do it now instead of in [pp_main_loc], to avoid<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; messing with Format boxes. *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sub_locs</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L92" title="ocaml/parsing/ast_mapper.ml:92">map</a></span> <span class="Statement">(fun</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">;</span> <span class="Statement">_</span> <span class="Statement">}</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="ast_invariants.ml.html#L19" title="ocaml/parsing/ast_invariants.ml:19">err</a></span>.<span class="ocamlLCIdentifier">sub</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">all_locs</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="ast_invariants.ml.html#L19" title="ocaml/parsing/ast_invariants.ml:19">err</a></span>.<span class="ocamlLCIdentifier">main</span>.<span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">sub_locs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">locs_highlighted</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">filter</span> <span class="ocamlLCIdentifier"><a href="#L744" title="ocaml/parsing/location.ml:744">is_quotable_loc</a></span> <span class="ocamlLCIdentifier">all_locs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L365" title="ocaml/parsing/location.ml:365">highlight_terminfo</a></span> <span class="ocamlLCIdentifier">lb</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">locs_highlighted</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L754" title="ocaml/parsing/location.ml:754">batch_mode_printer</a></span>.<span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span> <span class="ocamlLCIdentifier">self</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="ast_invariants.ml.html#L19" title="ocaml/parsing/ast_invariants.ml:19">err</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_main_loc</span> <span class="Statement">_</span> <span class="Statement">_</span> <span class="Statement">_</span> <span class="Statement">_</span> <span class="Statement">=</span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pp_submsg_loc</span> <span class="Statement">_</span> <span class="Statement">_</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">loc_ghost</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;%a:@ &quot;</span> <span class="ocamlLCIdentifier"><a href="#L216" title="ocaml/parsing/location.ml:216">print_loc</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L754" title="ocaml/parsing/location.ml:754">batch_mode_printer</a></span> <span class="Statement">with</span> <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pp_main_loc</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">pp_submsg_loc</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L847">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">best_toplevel_printer</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L88" title="ocaml/parsing/location.ml:88">setup_terminal</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L86" title="ocaml/parsing/location.ml:86">status</a></span>, <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L80" title="ocaml/parsing/location.ml:80">input_lexbuf</a></span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="PreProc">Terminfo</span>.<span class="Constant">Good_term</span>, <span class="Constant">Some</span> <span class="ocamlLCIdentifier">lb</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L829" title="ocaml/parsing/location.ml:829">terminfo_toplevel_printer</a></span> <span class="ocamlLCIdentifier">lb<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span>, <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L754" title="ocaml/parsing/location.ml:754">batch_mode_printer</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Creates a printer for the current input *)<br/></li>
<li><a id="L856">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">default_report_printer</span></span> <span class="Constant">()</span> : <span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">&quot;//toplevel//&quot;</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L847" title="ocaml/parsing/location.ml:847">best_toplevel_printer</a></span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L754" title="ocaml/parsing/location.ml:754">batch_mode_printer</a><br/></li>
<li></span><br/></li>
<li><a id="L862">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">report_printer</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier"><a href="#L856" title="ocaml/parsing/location.ml:856">default_report_printer</a><br/></li>
<li></span><br/></li>
<li><a id="L864">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">print_report</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">printer</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L699" title="ocaml/parsing/location.ml:699">report_printer</a></span> <span class="Constant">()</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">printer</span>.<span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span> <span class="ocamlLCIdentifier">printer</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* Reporting errors *)<br/></li>
<li></span><br/></li>
<li><a id="L871">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">error</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a><br/></li>
<li></span><br/></li>
<li><a id="L873">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">report_error</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="ast_invariants.ml.html#L19" title="ocaml/parsing/ast_invariants.ml:19">err</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L864" title="ocaml/parsing/location.ml:864">print_report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="ast_invariants.ml.html#L19" title="ocaml/parsing/ast_invariants.ml:19">err</a><br/></li>
<li></span><br/></li>
<li><a id="L876">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">mkerror</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">sub</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">kind</span> <span class="Statement">=</span> <span class="Constant">Report_error</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">main</span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">};</span> <span class="ocamlLCIdentifier">sub</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L879">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">errorf</span></span> <span class="Statement">?(</span><span class="Identifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">)</span> <span class="Statement">?(</span><span class="Identifier">sub</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">kdprintf</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L876" title="ocaml/parsing/location.ml:876">mkerror</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">sub</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L882">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">error</span></span> <span class="Statement">?(</span><span class="Identifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">)</span> <span class="Statement">?(</span><span class="Identifier">sub</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">msg_str</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L876" title="ocaml/parsing/location.ml:876">mkerror</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">sub</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">-&gt;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_print_string</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">msg_str</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L329" title="ocaml/parsing/location.mli:329">error_of_printer</a></span> <span class="Statement">?(</span><span class="Identifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">)</span> <span class="Statement">?(</span><span class="Identifier">sub</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span> <span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L876" title="ocaml/parsing/location.ml:876">mkerror</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">sub</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="pprintast.ml.html#L166" title="ocaml/parsing/pprintast.ml:166">pp</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L332" title="ocaml/parsing/location.mli:332">error_of_printer_file</a></span> <span class="ocamlLCIdentifier">print</span> <span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="location.mli.html#L329" title="ocaml/parsing/location.mli:329">error_of_printer</a></span> <span class="Statement">~</span><span class="Identifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>:<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L21" title="ocaml/parsing/location.ml:21">in_file</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">print</span> <span class="ocamlLCIdentifier"><a href="printast.ml.html#L54" title="ocaml/parsing/printast.ml:54">x</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* Reporting warnings: generating a <a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a> from a warning number using the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; information in [Warnings] + convenience functions. *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">default_warning_alert_reporter</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier"><a href="ast_helper.ml.html#L48" title="ocaml/parsing/ast_helper.ml:48">mk</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>: <span class="ocamlLCIdentifier"><a href="#L18" title="ocaml/parsing/location.ml:18">t</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">w</span> : <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Inactive</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">`Active</span> <span class="Statement">{</span> <span class="PreProc">Warnings</span>.<span class="ocamlLCIdentifier">id</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">message</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">is_error</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">sub_locs</span> <span class="Statement">}</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">msg_of_str</span> <span class="ocamlLCIdentifier"><a href="ast_helper.mli.html#L31" title="ocaml/parsing/ast_helper.mli:31">str</a></span> <span class="Statement">=</span> <span class="Statement">fun</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">-&gt;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_print_string</span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="ast_helper.mli.html#L31" title="ocaml/parsing/ast_helper.mli:31">str</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">kind</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="ast_helper.ml.html#L48" title="ocaml/parsing/ast_helper.ml:48">mk</a></span> <span class="ocamlLCIdentifier">is_error</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">main</span> <span class="Statement">=</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">msg_of_str</span> <span class="ocamlLCIdentifier">message</span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sub</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier"><a href="ast_mapper.ml.html#L92" title="ocaml/parsing/ast_mapper.ml:92">map</a></span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>, <span class="ocamlLCIdentifier">sub_message</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">msg_of_str</span> <span class="ocamlLCIdentifier">sub_message</span> <span class="Statement">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">)</span> <span class="ocamlLCIdentifier">sub_locs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">Some</span> <span class="Statement">{</span> <span class="ocamlLCIdentifier">kind</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">main</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">sub</span> <span class="Statement">}<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L908">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">default_warning_reporter</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">default_warning_alert_reporter<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Warnings</span>.<span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">is_error</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_error</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">Report_warning_as_error</span> <span class="ocamlLCIdentifier">id<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">else</span> <span class="Constant">Report_warning</span> <span class="ocamlLCIdentifier">id<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L916">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">warning_reporter</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier"><a href="#L908" title="ocaml/parsing/location.ml:908">default_warning_reporter</a><br/></li>
<li><a id="L917">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">report_warning</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L916" title="ocaml/parsing/location.ml:916">warning_reporter</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">w<br/></li>
<li></span><br/></li>
<li><a id="L919">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">formatter_for_warnings</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">err_formatter<br/></li>
<li></span><br/></li>
<li><a id="L921">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">print_warning</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L917" title="ocaml/parsing/location.ml:917">report_warning</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L864" title="ocaml/parsing/location.ml:864">print_report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a><br/></li>
<li></span><br/></li>
<li><a id="L926">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">prerr_warning</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L921" title="ocaml/parsing/location.ml:921">print_warning</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L919" title="ocaml/parsing/location.ml:919">formatter_for_warnings</a></span> <span class="ocamlLCIdentifier">w<br/></li>
<li></span><br/></li>
<li><a id="L928">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">default_alert_reporter</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">default_warning_alert_reporter<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Warnings</span>.<span class="ocamlLCIdentifier"><a href="#L937" title="ocaml/parsing/location.ml:937">report_alert</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">is_error</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">is_error</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">Report_alert_as_error</span> <span class="ocamlLCIdentifier">id<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">else</span> <span class="Constant">Report_alert</span> <span class="ocamlLCIdentifier">id<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L936">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">alert_reporter</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="ocamlLCIdentifier"><a href="#L928" title="ocaml/parsing/location.ml:928">default_alert_reporter</a><br/></li>
<li><a id="L937">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">report_alert</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L936" title="ocaml/parsing/location.ml:936">alert_reporter</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">w<br/></li>
<li></span><br/></li>
<li><a id="L939">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">print_alert</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L937" title="ocaml/parsing/location.ml:937">report_alert</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L864" title="ocaml/parsing/location.ml:864">print_report</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L199" title="ocaml/parsing/location.mli:199">report</a><br/></li>
<li></span><br/></li>
<li><a id="L944">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">prerr_alert</span></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">w</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L939" title="ocaml/parsing/location.ml:939">print_alert</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L919" title="ocaml/parsing/location.ml:919">formatter_for_warnings</a></span> <span class="ocamlLCIdentifier">w<br/></li>
<li></span><br/></li>
<li><a id="L946">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">alert</span></span> <span class="Statement">?(</span><span class="Identifier">def</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">)</span> <span class="Statement">?(</span><span class="Identifier">use</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">)</span> <span class="Statement">~</span><span class="Identifier">kind</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">message</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L944" title="ocaml/parsing/location.ml:944">prerr_alert</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">{</span><span class="PreProc">Warnings</span>.<span class="ocamlLCIdentifier">kind</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">message</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">def</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">use</span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L305" title="ocaml/parsing/location.mli:305">deprecated</a></span> <span class="Statement">?</span><span class="Identifier">def</span> <span class="Statement">?</span><span class="Identifier">use</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">message</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L946" title="ocaml/parsing/location.ml:946">alert</a></span> <span class="Statement">?</span><span class="Identifier">def</span> <span class="Statement">?</span><span class="Identifier">use</span> <span class="Statement">~</span><span class="Identifier">kind</span>:<span class="Constant">&quot;<a href="location.mli.html#L305" title="ocaml/parsing/location.mli:305">deprecated</a>&quot;</span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">message<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L311" title="ocaml/parsing/location.mli:311">auto_include_alert</a></span> <span class="ocamlLCIdentifier">lib</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">message</span> <span class="Statement">=</span> <span class="PreProc">Printf</span>.<span class="ocamlLCIdentifier">sprintf</span> <span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; OCaml'<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> lib directory layout changed in 5.0. The %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> subdirectory has been \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; automatically added to the search path, but you should <a href="depend.ml.html#L86" title="ocaml/parsing/depend.ml:86">add</a> -I +%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> to the \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; command-<a href="#L534" title="ocaml/parsing/location.ml:534">line</a> to silence this <a href="#L946" title="ocaml/parsing/location.ml:946">alert</a> (e.g. by adding %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> to the <a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a> of \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; libraries in your dune file, or adding use_%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> to your _tags file for \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; ocamlbuild, or using -<a href="ast_helper.ml.html#L73" title="ocaml/parsing/ast_helper.ml:73">package</a> %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> for ocamlfind).&quot;</span> <span class="ocamlLCIdentifier">lib</span> <span class="ocamlLCIdentifier">lib</span> <span class="ocamlLCIdentifier">lib</span> <span class="ocamlLCIdentifier">lib</span> <span class="ocamlLCIdentifier">lib</span> <span class="Statement">in<br/></li>
<li><a id="L959">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">alert</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">{</span><span class="PreProc">Warnings</span>.<span class="ocamlLCIdentifier">kind</span><span class="Statement">=</span><span class="Constant">&quot;ocaml_deprecated_auto_include&quot;</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">use</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">def</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">message</span> <span class="Statement">=</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">asprintf</span> <span class="Constant">&quot;@[@\n%a@]&quot;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_print_text</span> <span class="ocamlLCIdentifier">message</span><span class="Statement">}<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L944" title="ocaml/parsing/location.ml:944">prerr_alert</a></span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span> <span class="ocamlLCIdentifier"><a href="#L946" title="ocaml/parsing/location.ml:946">alert</a><br/></li>
<li></span><br/></li>
<li><a id="L965">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">deprecated_script_alert</span></span> <span class="ocamlLCIdentifier">program</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">message</span> <span class="Statement">=</span> <span class="PreProc">Printf</span>.<span class="ocamlLCIdentifier">sprintf</span> <span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; Running %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> where the <a href="#L240" title="ocaml/parsing/location.ml:240">first</a> argument is an implicit basename with no \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; <a href="parsetree.mli.html#L61" title="ocaml/parsing/parsetree.mli:61">extension</a> (e.g. %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> script-file) is <a href="location.mli.html#L305" title="ocaml/parsing/location.mli:305">deprecated</a>. Either rename the script \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; (%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> script-file.ml) or qualify the basename (%<a href="#L192" title="ocaml/parsing/location.ml:192">s</a> ./script-file)&quot;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">program</span> <span class="ocamlLCIdentifier">program</span> <span class="ocamlLCIdentifier">program</span> <span class="ocamlLCIdentifier">program<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li><a id="L972">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">alert</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">{</span><span class="PreProc">Warnings</span>.<span class="ocamlLCIdentifier">kind</span><span class="Statement">=</span><span class="Constant">&quot;ocaml_deprecated_cli&quot;</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">use</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">;</span> <span class="ocamlLCIdentifier">def</span><span class="Statement">=</span><span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">message</span> <span class="Statement">=</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">asprintf</span> <span class="Constant">&quot;@[@\n%a@]&quot;</span> <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_print_text</span> <span class="ocamlLCIdentifier">message</span><span class="Statement">}<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L944" title="ocaml/parsing/location.ml:944">prerr_alert</a></span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span> <span class="ocamlLCIdentifier"><a href="#L946" title="ocaml/parsing/location.ml:946">alert</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(******************************************************************************)<br/></li>
<li></span><span class="Comment">(* Reporting errors on exceptions *)<br/></li>
<li></span><br/></li>
<li><a id="L981">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">error_of_exn</span></span> : <span class="Statement">(</span><span class="Type">exn</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a></span> <span class="Type"><a href="pprintast.ml.html#L203" title="ocaml/parsing/pprintast.ml:203">option</a></span><span class="Statement">)</span> <span class="Type"><a href="pprintast.ml.html#L184" title="ocaml/parsing/pprintast.ml:184">list</a></span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><a id="L983">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">register_error_of_exn</span></span> <span class="ocamlLCIdentifier">f</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L981" title="ocaml/parsing/location.ml:981">error_of_exn</a></span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier">f</span> <span class="Statement">::</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L981" title="ocaml/parsing/location.ml:981">error_of_exn</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">Already_displayed_error</span> <span class="Statement">=</span> <span class="PreProc">Warnings</span>.<span class="Constant">Errors<br/></li>
<li></span><br/></li>
<li><a id="L987">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">error_of_exn</span></span> <span class="Type">exn</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Type">exn</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Already_displayed_error</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Constant">`Already_displayed<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">f</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">rest</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">f</span> <span class="Type">exn</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier"><a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a></span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">`Ok</span> <span class="ocamlLCIdentifier"><a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span> <span class="ocamlLCIdentifier">rest<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L981" title="ocaml/parsing/location.ml:981">error_of_exn</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L983" title="ocaml/parsing/location.ml:983">register_error_of_exn</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Sys_error</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Some</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L879" title="ocaml/parsing/location.ml:879">errorf</a></span> <span class="Statement">~</span><span class="Identifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span>:<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L21" title="ocaml/parsing/location.ml:21">in_file</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L79" title="ocaml/parsing/location.ml:79">input_name</a></span><span class="Statement">)</span> <span class="Constant">&quot;I/O <a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a>: %<a href="#L192" title="ocaml/parsing/location.ml:192">s</a>&quot;</span> <span class="ocamlLCIdentifier"><a href="location.mli.html#L188" title="ocaml/parsing/location.mli:188">msg</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">external</span> <span class="ocamlLCIdentifier">reraise</span> : <span class="Type">exn</span> <span class="Statement">-&gt;</span> '<span class="ocamlLCIdentifier">a</span> <span class="Statement">=</span> <span class="Constant">&quot;%reraise&quot;<br/></li>
<li></span><br/></li>
<li><a id="L1010">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">report_exception</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="Type">exn</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span> <span class="ocamlLCIdentifier">n</span> <span class="Type">exn</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier"><a href="#L981" title="ocaml/parsing/location.ml:981">error_of_exn</a></span> <span class="Type">exn</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">None</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">reraise</span> <span class="Type">exn<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Constant">`Already_displayed</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="Constant">`Ok</span> <span class="ocamlLCIdentifier"><a href="ast_invariants.ml.html#L19" title="ocaml/parsing/ast_invariants.ml:19">err</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="attr_helper.mli.html#L41" title="ocaml/parsing/attr_helper.mli:41">report_error</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="ocamlLCIdentifier"><a href="ast_invariants.ml.html#L19" title="ocaml/parsing/ast_invariants.ml:19">err</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">exception</span> <span class="Type">exn</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">&gt;</span> <span class="Constant">0</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>-<span class="Constant">1</span><span class="Statement">)</span> <span class="Type">exn<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L563" title="ocaml/parsing/location.ml:563">loop</a></span> <span class="Constant">5</span> <span class="Type">exn<br/></li>
<li></span><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">Error</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="attr_helper.mli.html#L26" title="ocaml/parsing/attr_helper.mli:26">error</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L983" title="ocaml/parsing/location.ml:983">register_error_of_exn</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Error</span> <span class="ocamlLCIdentifier">e</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="ocamlLCIdentifier">e<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L1029">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">raise_errorf</span></span> <span class="Statement">?(</span><span class="Identifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L23" title="ocaml/parsing/location.ml:23">none</a></span><span class="Statement">)</span> <span class="Statement">?(</span><span class="Identifier">sub</span> <span class="Statement">=</span> <span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">kdprintf</span> <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">txt</span> <span class="Statement">-&gt;</span> <span class="Statement">raise</span> <span class="Statement">(</span><span class="Constant">Error</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L876" title="ocaml/parsing/location.ml:876">mkerror</a></span> <span class="ocamlLCIdentifier"><a href="#L68" title="ocaml/parsing/location.ml:68">loc</a></span> <span class="ocamlLCIdentifier">sub</span> <span class="ocamlLCIdentifier">txt</span><span class="Statement">)))<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
