<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/utils/diffing.ml - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/utils/diffing.ml - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L69">classify</a></li>
<li><a href="#L153">column</a></li>
<li><a href="#L262">construct_patch</a></li>
<li><a href="#L154">diff</a></li>
<li><a href="#L399">diff</a></li>
<li><a href="#L423">diff</a></li>
<li><a href="#L441">diff</a></li>
<li><a href="#L258">i_final</a></li>
<li><a href="#L152">line</a></li>
<li><a href="#L406">may_append</a></li>
<li><a href="#L150">opt_get</a></li>
<li><a href="#L44">prefix</a></li>
<li><a href="#L250">res</a></li>
<li><a href="#L281">select_best_proposition</a></li>
<li><a href="#L240">select_final_state</a></li>
<li><a href="#L157">shape</a></li>
<li><a href="#L251">shape</a></li>
<li><a href="#L156">state</a></li>
<li><a href="#L38">style</a></li>
<li><a href="#L416">test</a></li>
<li><a href="#L434">test</a></li>
<li><a href="#L396">update</a></li>
<li><a href="#L418">update</a></li>
<li><a href="#L436">update</a></li>
<li><a href="#L155">weight</a></li>
<li><a href="#L395">weight</a></li>
<li><a href="#L417">weight</a></li>
<li><a href="#L435">weight</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L63">change</a></li>
<li><a href="#L32">change_kind</a></li>
<li><a href="#L86">full_state</a></li>
<li><a href="#L141">shape</a></li>
<li><a href="#L143">t</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">(**************************************************************************)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Gabriel Radanne, projet Cambium, Inria Paris&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; Copyright 2020 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; All rights reserved.&nbsp; This <a href="profile.mli.html#L23" title="ocaml/utils/profile.mli:23">file</a> is distributed under the terms of&nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; the GNU Lesser General Public License <a href="config.common.ml.html#L20" title="ocaml/utils/config.common.ml:20">version</a> 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; special exception on linking described in the <a href="profile.mli.html#L23" title="ocaml/utils/profile.mli:23">file</a> LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><br/></li>
<li><span class="Statement">[</span>@@@<span class="ocamlLCIdentifier">warning</span> <span class="Constant">&quot;-16&quot;</span><span class="Statement">]<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* This module implements a modified <a href="config.common.ml.html#L20" title="ocaml/utils/config.common.ml:20">version</a> of Wagner-Fischer<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; See &lt;https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm&gt;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; for preliminary reading.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The main extensions is that:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - State is computed based on the optimal patch so far.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - The lists can be extended at each <a href="#L156" title="ocaml/utils/diffing.ml:156">state</a> computation.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; We <a href="load_path.ml.html#L109" title="ocaml/utils/load_path.ml:109">add</a> the constraint that extensions can only be in <a href="targetint.mli.html#L38" title="ocaml/utils/targetint.mli:38">one</a> side<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; (either the left or right list). This is enforced by the external API.<br/></li>
<li></span><br/></li>
<li><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(** Shared types *)<br/></li>
<li><a id="L32">&#x200c;</a></span><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">change_kind</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Deletion<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Insertion<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Modification<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Preservation<br/></li>
<li></span><br/></li>
<li><a id="L38">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">style</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Preservation</span> <span class="Statement">-&gt;</span> <span class="PreProc">Misc</span>.<span class="PreProc">Color</span>.<span class="Statement">[</span> <span class="Constant">FG</span> <span class="Constant">Green</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Deletion</span> <span class="Statement">-&gt;</span> <span class="PreProc">Misc</span>.<span class="PreProc">Color</span>.<span class="Statement">[</span> <span class="Constant">FG</span> <span class="Constant">Red</span><span class="Statement">;</span> <span class="Constant">Bold</span><span class="Statement">]<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Insertion</span> <span class="Statement">-&gt;</span> <span class="PreProc">Misc</span>.<span class="PreProc">Color</span>.<span class="Statement">[</span> <span class="Constant">FG</span> <span class="Constant">Red</span><span class="Statement">;</span> <span class="Constant">Bold</span><span class="Statement">]<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Modification</span> <span class="Statement">-&gt;</span> <span class="PreProc">Misc</span>.<span class="PreProc">Color</span>.<span class="Statement">[</span> <span class="Constant">FG</span> <span class="Constant">Magenta</span><span class="Statement">;</span> <span class="Constant">Bold</span><span class="Statement">]<br/></li>
<li></span><br/></li>
<li><a id="L44">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">prefix</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="strongly_connected_components.ml.html#L39" title="ocaml/utils/strongly_connected_components.ml:39">pos</a></span>, <span class="ocamlLCIdentifier">p</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sty</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L38" title="ocaml/utils/diffing.ml:38">style</a></span> <span class="ocamlLCIdentifier">p</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_open_stag</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">(</span><span class="PreProc">Misc</span>.<span class="PreProc">Color</span>.<span class="Constant">Style</span> <span class="ocamlLCIdentifier">sty</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;%i. &quot;</span> <span class="ocamlLCIdentifier"><a href="strongly_connected_components.ml.html#L39" title="ocaml/utils/strongly_connected_components.ml:39">pos</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">pp_close_stag</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">()<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">let</span> <span class="Statement">(let*)</span> <span class="Statement">=</span> <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier">bind<br/></li>
<li></span><span class="Statement">let</span> <span class="Statement">(let</span>+<span class="Statement">)</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">f</span> <span class="Statement">=</span> <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier"><a href="identifiable.ml.html#L37" title="ocaml/utils/identifiable.ml:37">map</a></span> <span class="ocamlLCIdentifier">f</span> <span class="ocamlLCIdentifier">x<br/></li>
<li></span><span class="Statement">let</span> <span class="Statement">(let*!)</span> <span class="ocamlLCIdentifier">x</span> <span class="ocamlLCIdentifier">f</span> <span class="Statement">=</span> <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier">iter</span> <span class="ocamlLCIdentifier">f</span> <span class="ocamlLCIdentifier">x<br/></li>
<li></span><br/></li>
<li><span class="Statement">module type </span><span class="PreProc">Defs</span> = <span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">left<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">right<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">eq<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a><br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a><br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><a id="L63">&#x200c;</a><span class="Statement">type</span> <span class="Statement">(</span>'<span class="ocamlLCIdentifier">left</span>,'<span class="ocamlLCIdentifier">right</span>,'<span class="ocamlLCIdentifier">eq</span>,'<span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><span class="linkable">change</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Delete</span> <span class="Statement">of</span> '<span class="ocamlLCIdentifier">left<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Insert</span> <span class="Statement">of</span> '<span class="ocamlLCIdentifier">right<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Keep</span> <span class="Statement">of</span> '<span class="ocamlLCIdentifier">left</span> <span class="Statement">*</span> '<span class="ocamlLCIdentifier">right</span> <span class="Statement">*</span>' <span class="ocamlLCIdentifier">eq<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Change</span> <span class="Statement">of</span> '<span class="ocamlLCIdentifier">left</span> <span class="Statement">*</span> '<span class="ocamlLCIdentifier">right</span> <span class="Statement">*</span> '<span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a><br/></li>
<li></span><br/></li>
<li><a id="L69">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">classify</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Delete</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Deletion<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Insert</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Insertion<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Change</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Modification<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Keep</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">Preservation<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Define</span><span class="ocamlModParam">(</span><span class="PreProc">D</span><span class="ocamlMPRestr">:</span><span class="PreProc">Defs</span><span class="ocamlModParam">)</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">D<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">nonrec</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.mli.html#L42" title="ocaml/utils/diffing_with_keys.mli:42">change</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">left</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">eq</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.mli.html#L42" title="ocaml/utils/diffing_with_keys.mli:42">change</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">patch</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.mli.html#L42" title="ocaml/utils/diffing_with_keys.mli:42">change</a></span><span class="ocamlStruct"> </span><span class="Type">list<br/></li>
<li></span><span class="Statement">module type </span><span class="PreProc">S</span><span class="ocamlStruct"> = </span><span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlSig">: </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">left</span><span class="ocamlSig"> </span><span class="Type">array</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlSig"> </span><span class="Type">array</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">patch<br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L86">&#x200c;</a><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">full_state</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">{<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct">: </span><span class="ocamlLCIdentifier">left</span><span class="ocamlStruct"> </span><span class="Type">array</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct">: </span><span class="ocamlLCIdentifier">right</span><span class="ocamlStruct"> </span><span class="Type">array</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct">: </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a><br/></li>
<li></span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* The matrix supporting our dynamic programming implementation.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; Each cell contains:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - The <a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a> and <a href="warnings.ml.html#L1077" title="ocaml/utils/warnings.ml:1077">its</a> <a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a><br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - The <a href="#L156" title="ocaml/utils/diffing.ml:156">state</a> computed so far<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - The lists, potentially extended locally.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; The matrix can also be reshaped.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><span class="Statement">module</span><span class="PreProc"> Matrix</span><span class="ocamlPreDef"> : </span><span class="PreProc">sig<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlSig"> </span><span class="Statement">=</span><span class="ocamlSig"> </span><span class="Statement">{</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlSig"> : </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlSig"> : </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">type</span><span class="ocamlSig">&nbsp; </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="profile.ml.html#L238" title="ocaml/utils/profile.ml:238">make</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig">&nbsp; </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a><br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">reshape</span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig">&nbsp; </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig">&nbsp; </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Comment">(** accessor functions *)<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig">&nbsp; </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.mli.html#L42" title="ocaml/utils/diffing_with_keys.mli:42">change</a></span><span class="ocamlSig"> </span><span class="Type">option<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L86" title="ocaml/utils/diffing.ml:86">full_state</a></span><span class="ocamlSig"> </span><span class="Type">option<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">left</span><span class="ocamlSig"> </span><span class="Type">option<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlSig"> </span><span class="Type">option<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">set</span><span class="ocamlSig"> :<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlSig">:</span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.mli.html#L42" title="ocaml/utils/diffing_with_keys.mli:42">change</a></span><span class="ocamlSig"> </span><span class="Type">option</span><span class="ocamlSig"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlSig">:</span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlSig">:</span><span class="ocamlLCIdentifier"><a href="#L86" title="ocaml/utils/diffing.ml:86">full_state</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="Type">unit<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Comment">(** the <a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a> when starting filling the matrix *)<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Comment">(** [<a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a> m i j] is the <a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a> as seen from the <a href="#L156" title="ocaml/utils/diffing.ml:156">state</a> at position (i,j)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; after some possible extensions<br/></li>
<li></span><span class="Comment">&nbsp; *)<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">shape_at</span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlSig"> </span><span class="Type">option<br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Comment">(** the maximal <a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a> on the whole matrix *)<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">real_shape</span><span class="ocamlSig"> : </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlSig">&nbsp; </span><span class="Comment">(** debugging printer *)<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="Statement">val[</span><span class="ocamlSig">@</span><span class="ocamlLCIdentifier">warning</span><span class="ocamlSig"> </span><span class="Constant">&quot;-32&quot;</span><span class="Statement">]</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">pp</span><span class="ocamlSig"> : </span><span class="PreProc">Format</span><span class="ocamlSig">.</span><span class="ocamlLCIdentifier">formatter</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="lazy_backtrack.mli.html#L16" title="ocaml/utils/lazy_backtrack.mli:16">t</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">unit<br/></li>
<li></span><br/></li>
<li><span class="PreProc">end</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">struct<br/></li>
<li></span><br/></li>
<li><a id="L141">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">shape</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> : </span><span class="Type">int</span><span class="ocamlStruct"> </span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> : </span><span class="Type">int</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><a id="L143">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">states</span><span class="ocamlStruct">: </span><span class="ocamlLCIdentifier"><a href="#L86" title="ocaml/utils/diffing.ml:86">full_state</a></span><span class="ocamlStruct"> </span><span class="Type">option</span><span class="ocamlStruct"> </span><span class="Type">array</span><span class="ocamlStruct"> </span><span class="Type">array</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct">: </span><span class="Type">int</span><span class="ocamlStruct"> </span><span class="Type">array</span><span class="ocamlStruct"> </span><span class="Type">array</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct">:&nbsp; </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.mli.html#L42" title="ocaml/utils/diffing_with_keys.mli:42">change</a></span><span class="ocamlStruct"> </span><span class="Type">option</span><span class="ocamlStruct"> </span><span class="Type">array</span><span class="ocamlStruct"> </span><span class="Type">array</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct">: </span><span class="Type">int</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct">: </span><span class="Type">int</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">}<br/></li>
<li><a id="L150">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">opt_get</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier"><a href="arg_helper.ml.html#L77" title="ocaml/utils/arg_helper.ml:77">length</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">unsafe_get</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Constant">None<br/></li>
<li><a id="L152">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">line</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">let*</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">states</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L150" title="ocaml/utils/diffing.ml:150">opt_get</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">line</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i<br/></li>
<li><a id="L153">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">column</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">let*</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">states</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L150" title="ocaml/utils/diffing.ml:150">opt_get</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">column</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j<br/></li>
<li><a id="L154">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">diff</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">diff</span></span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)<br/></li>
<li><a id="L155">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">weight</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">weight</span></span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)<br/></li>
<li><a id="L156">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">state</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">states</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)<br/></li>
<li><a id="L157">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">shape</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> </span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">set</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">&lt;-</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">states</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">&lt;-</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">&lt;-</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Constant">()<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">shape_at</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct">+ </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">states</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="arg_helper.ml.html#L77" title="ocaml/utils/arg_helper.ml:77">length</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="arg_helper.ml.html#L77" title="ocaml/utils/arg_helper.ml:77">length</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">real_shape</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ref</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ref</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlDo"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let*!</span><span class="ocamlDo"> </span><span class="Statement">{</span><span class="ocamlLCIdentifier">l</span><span class="Statement">;</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c</span><span class="Statement">}</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">shape_at</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">lines</span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">l</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">columns</span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> </span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="profile.ml.html#L238" title="ocaml/utils/profile.ml:238">make</a></span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> </span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">states</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">make_matrix</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> + </span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> + </span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">make_matrix</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> + </span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> + </span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="targetint.mli.html#L92" title="ocaml/utils/targetint.mli:92">max_int</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">make_matrix</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> + </span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> + </span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">lines</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">columns</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">reshape</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">lines</span><span class="ocamlStruct"> </span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">columns</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="misc.ml.html#L313" title="ocaml/utils/misc.ml:313">copy</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="arg_helper.ml.html#L40" title="ocaml/utils/arg_helper.ml:40">default</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="load_path.mli.html#L62" title="ocaml/utils/load_path.mli:62">init</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">1</span><span class="ocamlStruct">+</span><span class="ocamlLCIdentifier">lines</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="load_path.mli.html#L62" title="ocaml/utils/load_path.mli:62">init</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">1</span><span class="ocamlStruct">+</span><span class="ocamlLCIdentifier">columns</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(fun</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">lines</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">columns</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">a</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlStruct">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="arg_helper.ml.html#L40" title="ocaml/utils/arg_helper.ml:40">default</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">states</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="misc.ml.html#L313" title="ocaml/utils/misc.ml:313">copy</a></span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">states</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="misc.ml.html#L313" title="ocaml/utils/misc.ml:313">copy</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="targetint.mli.html#L92" title="ocaml/utils/targetint.mli:92">max_int</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="misc.ml.html#L313" title="ocaml/utils/misc.ml:313">copy</a></span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">lines</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">columns<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">}<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">pp</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">eprintf</span><span class="ocamlStruct"> </span><span class="Constant">&quot;Shape : %i, %i@.&quot;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlDo"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlDo"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">None</span><span class="ocamlDo"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlDo"> </span><span class="Constant">&quot;&nbsp; &nbsp; &quot;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Some</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlDo"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">sdiff</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="Statement">match</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlDo"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Insert</span><span class="ocamlDo"> </span><span class="Statement">_</span><span class="ocamlDo"> </span><span class="Statement">-&gt;</span><span class="ocamlDo"> </span><span class="Constant">&quot;\u{2190}&quot;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Delete</span><span class="ocamlDo"> </span><span class="Statement">_</span><span class="ocamlDo"> </span><span class="Statement">-&gt;</span><span class="ocamlDo"> </span><span class="Constant">&quot;\u{2191}&quot;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Keep</span><span class="ocamlDo"> </span><span class="Statement">_</span><span class="ocamlDo"> </span><span class="Statement">-&gt;</span><span class="ocamlDo"> </span><span class="Constant">&quot;\u{2196}&quot;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlDo"> </span><span class="Constant">Change</span><span class="ocamlDo"> </span><span class="Statement">_</span><span class="ocamlDo"> </span><span class="Statement">-&gt;</span><span class="ocamlDo"> </span><span class="Constant">&quot;\u{21F1}&quot;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">w</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlDo"> </span><span class="Constant">&quot;%<a href="ccomp.ml.html#L51" title="ocaml/utils/ccomp.ml:51">s</a>%i &quot;</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">sdiff</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">w<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Format</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">pp_print_newline</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">ppf</span><span class="ocamlDo"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">done<br/></li>
<li></span><br/></li>
<li><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* Building the patch.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; We first select the <a href="misc.ml.html#L575" title="ocaml/utils/misc.ml:575">best</a> final cell. A potential final cell<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; is a cell where the local <a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a> (i.e., the <a href="targetint.ml.html#L64" title="ocaml/utils/targetint.ml:64">size</a> of the strings) correspond<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; to <a href="warnings.ml.html#L1077" title="ocaml/utils/warnings.ml:1077">its</a> position in the matrix. In other words: it'<a href="ccomp.ml.html#L51" title="ocaml/utils/ccomp.ml:51">s</a> at the end of both <a href="warnings.ml.html#L1077" title="ocaml/utils/warnings.ml:1077">its</a><br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; strings. We select the final cell with the smallest <a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a>.<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; We then build the patch by walking backward from the final cell to the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; origin.<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><a id="L240">&#x200c;</a><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">select_final_state</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">maybe_final</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">shape_at</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">shape_here</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">shape_here</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">shape_here</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">best_state</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i0</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">j0</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">weigth0</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">weigth0</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i0</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">j0</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">weigth0</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li><a id="L250">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">res</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ref</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">0</span><span class="ocamlStruct">,</span><span class="Constant">0</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier"><a href="targetint.mli.html#L92" title="ocaml/utils/targetint.mli:92">max_int</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li><a id="L251">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">shape</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">shape</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">c</span><span class="ocamlDo"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">maybe_final</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L250" title="ocaml/utils/diffing.ml:250">res</a></span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">best_state</span><span class="ocamlDo"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L250" title="ocaml/utils/diffing.ml:250">res</a></span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlDo">,</span><span class="ocamlLCIdentifier">j</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">done<br/></li>
<li></span><span class="ocamlDo">&nbsp; </span><span class="Statement">done;<br/></li>
<li><a id="L258">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">i_final</span></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">j_final</span><span class="ocamlStruct">, </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L250" title="ocaml/utils/diffing.ml:250">res</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">assert</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L258" title="ocaml/utils/diffing.ml:258">i_final</a></span><span class="ocamlStruct"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">||</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j_final</span><span class="ocamlStruct"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L258" title="ocaml/utils/diffing.ml:258">i_final</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">j_final</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L262">&#x200c;</a><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">construct_patch</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="Statement">rec</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="strongly_connected_components.ml.html#L44" title="ocaml/utils/strongly_connected_components.ml:44">aux</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="arg_helper.ml.html#L95" title="ocaml/utils/arg_helper.ml:95">acc</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">j</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="arg_helper.ml.html#L95" title="ocaml/utils/arg_helper.ml:95">acc</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">assert</span><span class="ocamlStruct"> </span><span class="Constant">false<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">next</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Keep</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Change</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Delete</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">j</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Insert</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="strongly_connected_components.ml.html#L44" title="ocaml/utils/strongly_connected_components.ml:44">aux</a></span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="Statement">::</span><span class="ocamlLCIdentifier"><a href="arg_helper.ml.html#L95" title="ocaml/utils/arg_helper.ml:95">acc</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">next<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier"><a href="strongly_connected_components.ml.html#L44" title="ocaml/utils/strongly_connected_components.ml:44">aux</a></span><span class="ocamlStruct"> </span><span class="Constant">[]</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L240" title="ocaml/utils/diffing.ml:240">select_final_state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Computation of new cells *)<br/></li>
<li></span><br/></li>
<li><a id="L281">&#x200c;</a><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">select_best_proposition</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compare_proposition</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">curr</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">prop</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">curr</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">prop</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">o</span><span class="ocamlStruct"> </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">o</span><span class="ocamlStruct">, </span><span class="Constant">None</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">o<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">curr_m</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">curr_res</span><span class="Statement">)</span><span class="ocamlStruct">, </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L250" title="ocaml/utils/diffing.ml:250">res</a></span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">curr_m</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">curr_m</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">curr_res</span><span class="ocamlStruct"> </span><span class="Statement">else</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier"><a href="#L250" title="ocaml/utils/diffing.ml:250">res</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="PreProc">List</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">fold_left</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compare_proposition</span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">module type </span><span class="PreProc">Full_core</span><span class="ocamlStruct"> = </span><span class="PreProc">sig<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">update_result<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="Statement">type</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">update_state<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlSig">: </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.mli.html#L42" title="ocaml/utils/diffing_with_keys.mli:42">change</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Type">int<br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/utils/diffing.ml:416">test</a></span><span class="ocamlSig">: </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">left</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">right</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">eq</span><span class="ocamlSig">, </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="Statement">)</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="misc.ml.html#L592" title="ocaml/utils/misc.ml:592">result</a><br/></li>
<li></span><span class="ocamlSig">&nbsp; &nbsp; </span><span class="Statement">val</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier"><a href="#L396" title="ocaml/utils/diffing.ml:396">update</a></span><span class="ocamlSig">: </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.mli.html#L42" title="ocaml/utils/diffing_with_keys.mli:42">change</a></span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">update_state</span><span class="ocamlSig"> </span><span class="Statement">-&gt;</span><span class="ocamlSig"> </span><span class="ocamlLCIdentifier">update_result<br/></li>
<li></span><span class="ocamlSig">&nbsp; </span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Generic<br/></li>
<li></span><span class="ocamlPreDef">&nbsp; &nbsp; </span><span class="ocamlModParam">(</span><span class="PreProc">X</span><span class="ocamlMPRestr">:</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">Full_core<br/></li>
<li></span><span class="ocamlPreMPRestr">&nbsp; &nbsp;&nbsp; </span><span class="PreProc">with</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">type</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">update_result</span><span class="ocamlPreMPRestr"> </span><span class="ocamlMPRestr">:</span><span class="ocamlPreMPRestr">= </span><span class="PreProc"><a href="#L86" title="ocaml/utils/diffing.ml:86">full_state</a><br/></li>
<li></span><span class="ocamlPreMPRestr">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">and</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">type</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">update_state</span><span class="ocamlPreMPRestr"> </span><span class="ocamlMPRestr">:</span><span class="ocamlPreMPRestr">= </span><span class="PreProc"><a href="#L86" title="ocaml/utils/diffing.ml:86">full_state</a></span><span class="ocamlModParam">)</span><span class="ocamlPreDef"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">struct<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">X<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Comment">(* Boundary cell <a href="#L396" title="ocaml/utils/diffing.ml:396">update</a> *)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_column0</span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let*!</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let*!</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Delete</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">set</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct">:</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> + </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct">:</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L396" title="ocaml/utils/diffing.ml:396">update</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct">:</span><span class="Statement">(</span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_line0</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let*!</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let*!</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">Insert</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">set</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct">:</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> + </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct">:</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L396" title="ocaml/utils/diffing.ml:396">update</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">st</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct">:</span><span class="Statement">(</span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_inner_cell</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_proposition</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let*</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct">+ </span><span class="ocamlLCIdentifier">localstate</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> + </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">, </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">localstate</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">del</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">let</span><span class="ocamlStruct">+ </span><span class="ocamlLCIdentifier">x</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">in</span><span class="ocamlStruct"> </span><span class="Constant">Delete</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">compute_proposition</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">insert</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">let</span><span class="ocamlStruct">+ </span><span class="ocamlLCIdentifier">x</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in</span><span class="ocamlStruct"> </span><span class="Constant">Insert</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">compute_proposition</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">diag</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let*</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let*</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let*</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/utils/diffing.ml:416">test</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Ok</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">ok</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Keep</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">ok</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">Error</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">err</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="Constant">Change</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">err</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">compute_proposition</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct">-</span><span class="Constant">1</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let*!</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">newweight</span><span class="ocamlStruct">, </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">localstate</span><span class="Statement">)</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L281" title="ocaml/utils/diffing.ml:281">select_best_proposition</a></span><span class="ocamlStruct"> </span><span class="Statement">[</span><span class="ocamlLCIdentifier">diag</span><span class="Statement">;</span><span class="ocamlLCIdentifier">del</span><span class="Statement">;</span><span class="ocamlLCIdentifier">insert</span><span class="Statement">]<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L396" title="ocaml/utils/diffing.ml:396">update</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">localstate</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">set</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">tbl</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct">:</span><span class="ocamlLCIdentifier">newweight</span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct">:</span><span class="Statement">(</span><span class="Constant">Some</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_cell</span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">match</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">, </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">when</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlStruct"> </span><span class="Constant">None</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct">,</span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct">,</span><span class="ocamlLCIdentifier">j</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_line0</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct">,</span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_column0</span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">_</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_inner_cell</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">j<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Filling the matrix<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp;&nbsp; We fill the whole matrix, as in vanilla Wagner-Fischer.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; At this point, the lists in some states might have been extended.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; If any list have been extended, we need to reshape the matrix<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; and repeat the process<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">compute_matrix</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">state0</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="profile.ml.html#L238" title="ocaml/utils/profile.ml:238">make</a></span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">c</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">set</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L155" title="ocaml/utils/diffing.ml:155">weight</a></span><span class="ocamlStruct">:</span><span class="Constant">0</span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct">:</span><span class="ocamlLCIdentifier">state0</span><span class="ocamlStruct"> </span><span class="Statement">~</span><span class="Identifier"><a href="diffing_with_keys.ml.html#L200" title="ocaml/utils/diffing_with_keys.ml:200">diff</a></span><span class="ocamlStruct">:</span><span class="Constant">None</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="Statement">rec</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="profile.ml.html#L290" title="ocaml/utils/profile.ml:290">loop</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">new_shape</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">real_shape</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">new_shape</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">l</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">l</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">new_shape</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">c</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L141" title="ocaml/utils/diffing.ml:141">shape</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">c</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Matrix</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">reshape</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">new_shape</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">new_shape</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">l</span><span class="ocamlStruct"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">j</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">new_shape</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">c</span><span class="ocamlDo"> </span><span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">compute_cell</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">m</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">j<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">done<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; &nbsp; </span><span class="Statement">done;<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="profile.ml.html#L290" title="ocaml/utils/profile.ml:290">loop</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">m<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="ocamlLCIdentifier"><a href="profile.ml.html#L290" title="ocaml/utils/profile.ml:290">loop</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">m0<br/></li>
<li></span><span class="ocamlStruct"> </span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">module type </span><span class="PreProc">Parameters</span><span class="ocamlStruct"> = </span><span class="PreProc">Full_core</span><span class="ocamlStruct"> </span><span class="Statement">with</span><span class="ocamlStruct"> </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">update_state</span><span class="ocamlStruct"> </span><span class="Statement">:=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a><br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">module</span><span class="PreProc"> Simple</span><span class="ocamlModParam">(</span><span class="PreProc">X</span><span class="ocamlMPRestr">:</span><span class="PreProc">Parameters</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">with</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">type</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">update_result</span><span class="ocamlPreMPRestr"> </span><span class="ocamlMPRestr">:</span><span class="ocamlPreMPRestr">= </span><span class="PreProc"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlModParam">)</span><span class="ocamlPreDef"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">struct<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">module</span><span class="PreProc"> Internal</span><span class="ocamlPreDef"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Generic</span><span class="ocamlFuncWith">(</span><span class="PreProc">struct<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/utils/diffing.ml:416">test</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">X</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/utils/diffing.ml:416">test</a><br/></li>
<li><a id="L395">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">weight</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">X</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">weight</span><br/></li>
<li><a id="L396">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">update</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">X</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">update</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L399">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">diff</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">fullstate</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Internal</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">compute_matrix</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">fullstate<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L262" title="ocaml/utils/diffing.ml:262">construct_patch</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L406">&#x200c;</a><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">may_append</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">function<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="Statement">[||]</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">x<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">y</span><span class="ocamlStruct"> </span><span class="Statement">-&gt;</span><span class="ocamlStruct"> </span><span class="PreProc">Array</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">append</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">x</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">y<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">module</span><span class="PreProc"> Left_variadic<br/></li>
<li></span><span class="ocamlPreDef">&nbsp; &nbsp; &nbsp; </span><span class="ocamlModParam">(</span><span class="PreProc">X</span><span class="ocamlMPRestr">:</span><span class="PreProc">Parameters</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">with</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">type</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">update_result</span><span class="ocamlPreMPRestr"> </span><span class="ocamlMPRestr">:</span><span class="ocamlPreMPRestr">= </span><span class="PreProc"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlPreMPRestr"> * </span><span class="PreProc">left</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">array</span><span class="ocamlModParam">)</span><span class="ocamlPreDef"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">struct<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">X<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">module</span><span class="PreProc"> Internal</span><span class="ocamlPreDef"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Generic</span><span class="ocamlFuncWith">(</span><span class="PreProc">struct<br/></li>
<li><a id="L416">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">test</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">X</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">test</span><br/></li>
<li><a id="L417">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">weight</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">X</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">weight</span><br/></li>
<li><a id="L418">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">update</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">a</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L396" title="ocaml/utils/diffing.ml:396">update</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L406" title="ocaml/utils/diffing.ml:406">may_append</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L423">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">diff</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">fullstate</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Internal</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">compute_matrix</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">fullstate<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L262" title="ocaml/utils/diffing.ml:262">construct_patch</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; </span><span class="Statement">module</span><span class="PreProc"> Right_variadic<br/></li>
<li></span><span class="ocamlPreDef">&nbsp; &nbsp; &nbsp; </span><span class="ocamlModParam">(</span><span class="PreProc">X</span><span class="ocamlMPRestr">:</span><span class="PreProc">Parameters</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">with</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">type</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">update_result</span><span class="ocamlPreMPRestr"> </span><span class="ocamlMPRestr">:</span><span class="ocamlPreMPRestr">= </span><span class="PreProc"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlPreMPRestr"> * </span><span class="PreProc">right</span><span class="ocamlPreMPRestr"> </span><span class="PreProc">array</span><span class="ocamlModParam">)</span><span class="ocamlPreDef"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">struct<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">X<br/></li>
<li></span><br/></li>
<li><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">module</span><span class="PreProc"> Internal</span><span class="ocamlPreDef"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="PreProc">Generic</span><span class="ocamlFuncWith">(</span><span class="PreProc">struct<br/></li>
<li><a id="L434">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">test</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">X</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">test</span><br/></li>
<li><a id="L435">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">weight</span></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="PreProc">X</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><span class="linkable">weight</span><br/></li>
<li><a id="L436">&#x200c;</a></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">update</span></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlFuncStruct">, </span><span class="ocamlLCIdentifier">a</span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L396" title="ocaml/utils/diffing.ml:396">update</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="binutils.ml.html#L642" title="ocaml/utils/binutils.ml:642">d</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">{</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct"> </span><span class="Statement">with</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">;</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlFuncStruct"> </span><span class="Statement">=</span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier"><a href="#L406" title="ocaml/utils/diffing.ml:406">may_append</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">fs</span><span class="ocamlFuncStruct">.</span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlFuncStruct"> </span><span class="ocamlLCIdentifier">a</span><span class="ocamlFuncStruct"> </span><span class="Statement">}<br/></li>
<li></span><span class="ocamlFuncStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">end</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L441">&#x200c;</a><span class="ocamlStruct">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">diff</span></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="ocamlStruct"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">fullstate</span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Statement">{</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L152" title="ocaml/utils/diffing.ml:152">line</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L153" title="ocaml/utils/diffing.ml:153">column</a></span><span class="Statement">;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L156" title="ocaml/utils/diffing.ml:156">state</a></span><span class="ocamlStruct"> </span><span class="Statement">}</span><span class="ocamlStruct"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Internal</span><span class="ocamlStruct">.</span><span class="ocamlLCIdentifier">compute_matrix</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier">fullstate<br/></li>
<li></span><span class="ocamlStruct">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|&gt;</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><a href="#L262" title="ocaml/utils/diffing.ml:262">construct_patch</a><br/></li>
<li></span><span class="ocamlStruct">&nbsp; </span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="PreProc">end<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
