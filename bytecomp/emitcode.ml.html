<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/bytecomp/emitcode.ml - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/bytecomp/emitcode.ml - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L184">clear</a></li>
<li><a href="#L425">compunit</a></li>
<li><a href="#L325">emit</a></li>
<li><a href="#L199">emit_comp</a></li>
<li><a href="#L209">emit_instr</a></li>
<li><a href="#L192">init</a></li>
<li><a href="#L235">org</a></li>
<li><a href="#L283">org</a></li>
<li><a href="#L320">remerge_events</a></li>
<li><a href="#L404">to_file</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">(**************************************************************************)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Generation of <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> + relocation information *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Config<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Misc<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Asttypes<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Lambda<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Instruct<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Opcodes<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Cmo_format<br/></li>
<li></span><span class="Statement">module</span><span class="PreProc"> String</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Misc.Stdlib.String<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier"><a href="bytelibrarian.mli.html#L27" title="ocaml/bytecomp/bytelibrarian.mli:27">error</a></span> <span class="Statement">=</span> <span class="Constant">Not_compatible_32</span> <span class="Statement">of</span> <span class="Statement">(</span><span class="Type">string</span> <span class="Statement">*</span> <span class="Type">string</span><span class="Statement">)<br/></li>
<li></span><span class="Statement">exception</span> <span class="Constant">Error</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="bytelibrarian.mli.html#L27" title="ocaml/bytecomp/bytelibrarian.mli:27">error</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* marshal and possibly check 32bit compat *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="emitcode.mli.html#L53" title="ocaml/bytecomp/emitcode.mli:53">marshal_to_channel_with_possibly_32bit_compat</a></span> <span class="Statement">~</span><span class="Identifier">filename</span> <span class="Statement">~</span><span class="Identifier">kind</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">obj</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Marshal</span>.<span class="ocamlLCIdentifier">to_channel</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">obj<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">bytecode_compatible_32<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">then</span> <span class="Statement">[</span><span class="PreProc">Marshal</span>.<span class="Constant">Compat_32</span><span class="Statement">]</span> <span class="Statement">else</span> <span class="Constant">[]</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">with</span> <span class="Constant">Failure</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">raise</span> <span class="Statement">(</span><span class="Constant">Error</span> <span class="Statement">(</span><span class="Constant">Not_compatible_32</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">filename</span>, <span class="ocamlLCIdentifier">kind</span><span class="Statement">)))<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="bytelibrarian.mli.html#L35" title="ocaml/bytecomp/bytelibrarian.mli:35">report_error</a></span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">file</span>, <span class="ocamlLCIdentifier">kind</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Format</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;Generated %s %S cannot be used on a 32-bit platform&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">kind</span> <span class="ocamlLCIdentifier">file<br/></li>
<li></span><span class="Statement">let</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">register_error_of_exn<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Error</span> <span class="Statement">(</span><span class="Constant">Not_compatible_32</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1040" title="ocaml/bytecomp/bytegen.ml:1040">info</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">Some</span> <span class="Statement">(</span><span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">error_of_printer_file</span> <span class="ocamlLCIdentifier"><a href="bytelibrarian.mli.html#L35" title="ocaml/bytecomp/bytelibrarian.mli:35">report_error</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1040" title="ocaml/bytecomp/bytegen.ml:1040">info</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Buffering of <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span><span class="Statement">(</span><span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">create</span> <span class="Constant">0</span><span class="Statement">)<br/></li>
<li></span><span class="Statement">and</span> <span class="ocamlLCIdentifier">out_position</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">extend_buffer</span> <span class="ocamlLCIdentifier">needed</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">size</span> <span class="Statement">=</span> <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">length</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">new_size</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span><span class="Statement">(</span><span class="ocamlLCIdentifier">max</span> <span class="ocamlLCIdentifier">size</span> <span class="Constant">16</span><span class="Statement">)</span> <span class="Comment">(* we need new_size &gt; 0 *)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">while</span> <span class="ocamlLCIdentifier">needed</span> <span class="Statement">&gt;=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">new_size</span> <span class="Statement">do</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">new_size</span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="Constant">2</span><span class="ocamlDo"> </span><span class="Statement">*</span><span class="ocamlDo"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">new_size</span><span class="ocamlDo"> </span><span class="Statement">done;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">new_buffer</span> <span class="Statement">=</span> <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">create</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">new_size</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">blit</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Constant">0</span> <span class="ocamlLCIdentifier">new_buffer</span> <span class="Constant">0</span> <span class="Statement">(</span><span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">length</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier">new_buffer<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">out_word</span> <span class="ocamlLCIdentifier">b1</span> <span class="ocamlLCIdentifier">b2</span> <span class="ocamlLCIdentifier">b3</span> <span class="ocamlLCIdentifier">b4</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span><span class="ocamlNone">+</span><span class="Constant">3</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="PreProc">LongString</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">extend_buffer</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span>+<span class="Constant">3</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">set</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">unsafe_chr</span> <span class="ocamlLCIdentifier">b1</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">set</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span>+<span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">unsafe_chr</span> <span class="ocamlLCIdentifier">b2</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">set</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span>+<span class="Constant">2</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">unsafe_chr</span> <span class="ocamlLCIdentifier">b3</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">set</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span>+<span class="Constant">3</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">unsafe_chr</span> <span class="ocamlLCIdentifier">b4</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_position</span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span> + <span class="Constant">4<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opcode</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_word</span> <span class="ocamlLCIdentifier">opcode</span> <span class="Constant">0</span> <span class="Constant">0</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">AsInt<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">const_as_int</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_int</span> <span class="ocamlLCIdentifier">i</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">i<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_char</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">code</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Statement">raise</span> <span class="Constant">AsInt<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L549" title="ocaml/bytecomp/bytegen.ml:549">is_immed</a></span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="instruct.ml.html#L113" title="ocaml/bytecomp/instruct.ml:113">immed_min</a></span> <span class="Statement">&lt;=</span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">&amp;&amp;</span> <span class="ocamlLCIdentifier">i</span> <span class="Statement">&lt;=</span> <span class="ocamlLCIdentifier"><a href="instruct.mli.html#L134" title="ocaml/bytecomp/instruct.mli:134">immed_max</a><br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">is_immed_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L549" title="ocaml/bytecomp/bytegen.ml:549">is_immed</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">const_as_int</span> <span class="ocamlLCIdentifier">k</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">AsInt</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_word</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span> <span class="Statement">asr</span> <span class="Constant">8</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span> <span class="Statement">asr</span> <span class="Constant">16</span><span class="Statement">)</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">n</span> <span class="Statement">asr</span> <span class="Constant">24</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">out_const</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">out_int</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">const_as_int</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">AsInt</span> <span class="Statement">-&gt;</span> <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Emitcode.const_as_int&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">(* Handling of local labels and backpatching *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">type</span> <span class="ocamlLCIdentifier">label_definition</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Label_defined</span> <span class="Statement">of</span> <span class="Type">int<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Label_undefined</span> <span class="Statement">of</span> <span class="Statement">(</span><span class="Type">int</span> <span class="Statement">*</span> <span class="Type">int</span><span class="Statement">)</span> <span class="Type">list<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">label_table</span>&nbsp; <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">([|</span> <span class="Statement">|]</span> : <span class="ocamlLCIdentifier">label_definition</span> <span class="Type">array</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">extend_label_table</span> <span class="ocamlLCIdentifier">needed</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">size</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">label_table</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">new_size</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span><span class="Statement">(</span><span class="ocamlLCIdentifier">max</span> <span class="ocamlLCIdentifier">size</span> <span class="Constant">16</span><span class="Statement">)</span> <span class="Comment">(* we need new_size &gt; 0 *)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">while</span> <span class="ocamlLCIdentifier">needed</span> <span class="Statement">&gt;=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">new_size</span> <span class="Statement">do</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">new_size</span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="Constant">2</span><span class="ocamlDo"> </span><span class="Statement">*</span><span class="ocamlDo"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">new_size</span><span class="ocamlDo"> </span><span class="Statement">done;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">new_table</span> <span class="Statement">=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">new_size</span> <span class="Statement">(</span><span class="Constant">Label_undefined</span> <span class="Constant">[]</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">blit</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">label_table</span> <span class="Constant">0</span> <span class="ocamlLCIdentifier">new_table</span> <span class="Constant">0</span> <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">label_table</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">label_table</span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier">new_table<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">backpatch</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span>, <span class="ocamlLCIdentifier">orig</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">displ</span> <span class="Statement">=</span> <span class="Statement">(!</span><span class="ocamlLCIdentifier">out_position</span> - <span class="ocamlLCIdentifier">orig</span><span class="Statement">)</span> <span class="Statement">asr</span> <span class="Constant">2</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">set</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">unsafe_chr</span> <span class="ocamlLCIdentifier">displ</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">set</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span>+<span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">unsafe_chr</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">displ</span> <span class="Statement">asr</span> <span class="Constant">8</span><span class="Statement">));<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">set</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span>+<span class="Constant">2</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">unsafe_chr</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">displ</span> <span class="Statement">asr</span> <span class="Constant">16</span><span class="Statement">));<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">set</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span>+<span class="Constant">3</span><span class="Statement">)</span> <span class="Statement">(</span><span class="PreProc">Char</span>.<span class="ocamlLCIdentifier">unsafe_chr</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">displ</span> <span class="Statement">asr</span> <span class="Constant">24</span><span class="Statement">))<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">define_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">label_table</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">extend_label_table</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">(!</span><span class="ocamlLCIdentifier">label_table</span><span class="Statement">)</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Label_defined</span> <span class="Statement">_</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fatal_error</span> <span class="Constant">&quot;Emitcode.define_label&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Label_undefined</span> <span class="ocamlLCIdentifier">patchlist</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="ocamlLCIdentifier">backpatch</span> <span class="ocamlLCIdentifier">patchlist</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(!</span><span class="ocamlLCIdentifier">label_table</span><span class="Statement">)</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">)</span> <span class="Statement">&lt;-</span> <span class="Constant">Label_defined</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">out_label_with_orig</span> <span class="ocamlLCIdentifier">orig</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="PreProc">Array</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">label_table</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">extend_label_table</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="Statement">(!</span><span class="ocamlLCIdentifier">label_table</span><span class="Statement">)</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">)</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Label_defined</span> <span class="ocamlLCIdentifier">def</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_int</span><span class="Statement">((</span><span class="ocamlLCIdentifier">def</span> - <span class="ocamlLCIdentifier">orig</span><span class="Statement">)</span> <span class="Statement">asr</span> <span class="Constant">2</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Label_undefined</span> <span class="ocamlLCIdentifier">patchlist</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(!</span><span class="ocamlLCIdentifier">label_table</span><span class="Statement">)</span>.<span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">)</span> <span class="Statement">&lt;-<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">Label_undefined</span><span class="Statement">((!</span><span class="ocamlLCIdentifier">out_position</span>, <span class="ocamlLCIdentifier">orig</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">patchlist</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_int</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">out_label_with_orig</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Relocation information *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">reloc_info</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="Constant">[]</span> : <span class="Statement">(</span><span class="ocamlLCIdentifier">reloc_info</span> <span class="Statement">*</span> <span class="Type">int</span><span class="Statement">)</span> <span class="Type">list</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L49" title="ocaml/bytecomp/symtable.ml:49">enter</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1040" title="ocaml/bytecomp/bytegen.ml:1040">info</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">reloc_info</span> <span class="Statement">:=</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1040" title="ocaml/bytecomp/bytegen.ml:1040">info</a></span>, <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">reloc_info<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L80" title="ocaml/bytecomp/symtable.ml:80">slot_for_literal</a></span> <span class="ocamlLCIdentifier">sc</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L49" title="ocaml/bytecomp/symtable.ml:49">enter</a></span> <span class="Statement">(</span><span class="Constant">Reloc_literal</span> <span class="Statement">(</span><span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L148" title="ocaml/bytecomp/symtable.ml:148">transl_const</a></span> <span class="ocamlLCIdentifier">sc</span><span class="Statement">));<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_int</span> <span class="Constant">0<br/></li>
<li></span><span class="Statement">and</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L71" title="ocaml/bytecomp/symtable.ml:71">slot_for_getglobal</a></span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L49" title="ocaml/bytecomp/symtable.ml:49">enter</a></span> <span class="Statement">(</span><span class="Constant">Reloc_getglobal</span> <span class="ocamlLCIdentifier">id</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_int</span> <span class="Constant">0<br/></li>
<li></span><span class="Statement">and</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L77" title="ocaml/bytecomp/symtable.ml:77">slot_for_setglobal</a></span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L49" title="ocaml/bytecomp/symtable.ml:49">enter</a></span> <span class="Statement">(</span><span class="Constant">Reloc_setglobal</span> <span class="ocamlLCIdentifier">id</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_int</span> <span class="Constant">0<br/></li>
<li></span><span class="Statement">and</span> <span class="ocamlLCIdentifier">slot_for_c_prim</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L49" title="ocaml/bytecomp/symtable.ml:49">enter</a></span> <span class="Statement">(</span><span class="Constant">Reloc_primitive</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_int</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Debugging events *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">events</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="Constant">[]</span> : <span class="ocamlLCIdentifier"><a href="instruct.ml.html#L23" title="ocaml/bytecomp/instruct.ml:23">debug_event</a></span> <span class="Type">list</span><span class="Statement">)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">debug_dirs</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="PreProc">String</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L44" title="ocaml/bytecomp/symtable.ml:44">empty</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">record_event</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span>.<span class="ocamlLCIdentifier">ev_loc</span>.<span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">loc_start</span>.<span class="PreProc">Lexing</span>.<span class="ocamlLCIdentifier">pos_fname</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">abspath</span> <span class="Statement">=</span> <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">absolute_path</span> <span class="ocamlLCIdentifier">path</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">debug_dirs</span> <span class="Statement">:=</span> <span class="PreProc">String</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="PreProc">Filename</span>.<span class="ocamlLCIdentifier">dirname</span> <span class="ocamlLCIdentifier">abspath</span><span class="Statement">)</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">debug_dirs</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Filename</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">is_relative</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">path</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cwd</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Location</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">rewrite_absolute_path</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Sys</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">getcwd</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">debug_dirs</span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="PreProc">String</span><span class="ocamlEnd">.</span><span class="PreProc">Set</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cwd</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">debug_dirs</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span>.<span class="ocamlLCIdentifier">ev_pos</span> <span class="Statement">&lt;-</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">events</span> <span class="Statement">:=</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span> <span class="Statement">::</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">events<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Initialization *)<br/></li>
<li></span><br/></li>
<li><a id="L184">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">clear</span></span><span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_position</span> <span class="Statement">:=</span> <span class="Constant">0</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">label_table</span> <span class="Statement">:=</span> <span class="Statement">[||];<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">reloc_info</span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">debug_dirs</span> <span class="Statement">:=</span> <span class="PreProc">String</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L44" title="ocaml/bytecomp/symtable.ml:44">empty</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">events</span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">:=</span> <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">create</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><a id="L192">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">init</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L184" title="ocaml/bytecomp/emitcode.ml:184">clear</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">label_table</span> <span class="Statement">:=</span> <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">make</span> <span class="Constant">16</span> <span class="Statement">(</span><span class="Constant">Label_undefined</span> <span class="Constant">[]</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">out_buffer</span> <span class="Statement">:=</span> <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">create</span> <span class="Constant">1024<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Emission of one <a href="instruct.ml.html#L53" title="ocaml/bytecomp/instruct.ml:53">instruction</a> *)<br/></li>
<li></span><br/></li>
<li><a id="L199">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">emit_comp</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Ceq</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opEQ</span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cne</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opNEQ<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Clt</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opLTINT</span> <span class="Statement">|</span> <span class="Constant">Cle</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opLEINT<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Cgt</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGTINT</span> <span class="Statement">|</span> <span class="Constant">Cge</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGEINT<br/></li>
<li></span><br/></li>
<li><span class="Statement">and</span> <span class="ocamlLCIdentifier">emit_branch_comp</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Ceq</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBEQ</span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Cne</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBNEQ<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Clt</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBLTINT</span> <span class="Statement">|</span> <span class="Constant">Cle</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBLEINT<br/></li>
<li></span><span class="Statement">|</span> <span class="Constant">Cgt</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBGTINT</span> <span class="Statement">|</span> <span class="Constant">Cge</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBGEINT<br/></li>
<li></span><br/></li>
<li><a id="L209">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">emit_instr</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Klabel</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">define_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kacc</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">8</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opACC0</span> + <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opACC</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kenvacc</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="Constant">4<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opENVACC1</span> + <span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opENVACC</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPUSH<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpop</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPOP</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kassign</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opASSIGN</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush_retaddr</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPUSH_RETADDR</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kapply</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">4</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opAPPLY1</span> + <span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opAPPLY</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kappterm</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier">sz</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">4</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opAPPTERM1</span> + <span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">);</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">sz</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opAPPTERM</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">sz</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kreturn</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opRETURN</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Krestart</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opRESTART<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgrab</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGRAB</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kclosure</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span>, <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opCLOSURE</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kclosurerec</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L660" title="ocaml/bytecomp/bytegen.ml:660">lbls</a></span>, <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opCLOSUREREC</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L660" title="ocaml/bytecomp/bytegen.ml:660">lbls</a></span><span class="Statement">);</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;<br/></li>
<li><a id="L235">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">org</span></span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out_label_with_orig</span> <span class="ocamlLCIdentifier"><a href="#L235" title="ocaml/bytecomp/emitcode.ml:235">org</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L660" title="ocaml/bytecomp/bytegen.ml:660">lbls</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Koffsetclosure</span> <span class="ocamlLCIdentifier">ofs</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ofs</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> -</span><span class="Constant">3</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ofs</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ofs</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">3<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">opOFFSETCLOSURE0</span> + <span class="ocamlLCIdentifier">ofs</span> / <span class="Constant">3</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opOFFSETCLOSURE</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">ofs</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetglobal</span> <span class="ocamlLCIdentifier">q</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETGLOBAL</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L71" title="ocaml/bytecomp/symtable.ml:71">slot_for_getglobal</a></span> <span class="ocamlLCIdentifier">q<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ksetglobal</span> <span class="ocamlLCIdentifier">q</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opSETGLOBAL</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L77" title="ocaml/bytecomp/symtable.ml:77">slot_for_setglobal</a></span> <span class="ocamlLCIdentifier">q<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kconst</span> <span class="ocamlLCIdentifier">sc</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sc</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L549" title="ocaml/bytecomp/bytegen.ml:549">is_immed</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="Constant">3<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">opCONST0</span><span class="ocamlEnd"> + </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opCONSTINT</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_char</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opCONSTINT</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out_int</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Char</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">code</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Const_block</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="ocamlEnd">, </span><span class="Constant">[]</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opATOM0</span><span class="ocamlEnd"> </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opATOM</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opGETGLOBAL</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L80" title="ocaml/bytecomp/symtable.ml:80">slot_for_literal</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sc<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kmakeblock</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span>, <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opATOM0</span> <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opATOM</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">4</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opMAKEBLOCK1</span> + <span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">);</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opMAKEBLOCK</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetfield</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">4</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opGETFIELD0</span> + <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETFIELD</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ksetfield</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">4</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opSETFIELD0</span> + <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opSETFIELD</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kmakefloatblock</span><span class="Statement">(</span><span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opATOM0</span> <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opMAKEFLOATBLOCK</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetfloatfield</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETFLOATFIELD</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ksetfloatfield</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opSETFLOATFIELD</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kvectlength</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opVECTLENGTH<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetvectitem</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETVECTITEM<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ksetvectitem</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opSETVECTITEM<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetstringchar</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETSTRINGCHAR<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetbyteschar</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETBYTESCHAR<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ksetbyteschar</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opSETBYTESCHAR<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kbranch</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBRANCH</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kbranchif</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBRANCHIF</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kbranchifnot</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBRANCHIFNOT</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kstrictbranchif</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBRANCHIF</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kstrictbranchifnot</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBRANCHIFNOT</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kswitch</span><span class="Statement">(</span><span class="ocamlLCIdentifier">tbl_const</span>, <span class="ocamlLCIdentifier">tbl_block</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opSWITCH</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_int</span> <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">tbl_const</span> + <span class="Statement">(</span><span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">tbl_block</span> <span class="Statement">lsl</span> <span class="Constant">16</span><span class="Statement">));<br/></li>
<li><a id="L283">&#x200c;</a></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">org</span></span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out_label_with_orig</span> <span class="ocamlLCIdentifier"><a href="#L235" title="ocaml/bytecomp/emitcode.ml:235">org</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">tbl_const</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out_label_with_orig</span> <span class="ocamlLCIdentifier"><a href="#L235" title="ocaml/bytecomp/emitcode.ml:235">org</a></span><span class="Statement">)</span> <span class="ocamlLCIdentifier">tbl_block<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kboolnot</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBOOLNOT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpushtrap</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPUSHTRAP</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpoptrap</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPOPTRAP<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kraise</span> <span class="Constant">Raise_regular</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opRAISE<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kraise</span> <span class="Constant">Raise_reraise</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opRERAISE<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kraise</span> <span class="Constant">Raise_notrace</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opRAISE_NOTRACE<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kcheck_signals</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opCHECK_SIGNALS<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kccall</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span>, <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="Constant">5<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">opC_CALL1</span> + <span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">);</span> <span class="ocamlLCIdentifier">slot_for_c_prim</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opC_CALLN</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">slot_for_c_prim</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Knegint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opNEGINT</span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kaddint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opADDINT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Ksubint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opSUBINT</span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kmulint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opMULINT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kdivint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opDIVINT</span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kmodint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opMODINT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kandint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opANDINT</span>&nbsp; <span class="Statement">|</span> <span class="Constant">Korint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opORINT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kxorint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opXORINT</span>&nbsp; <span class="Statement">|</span> <span class="Constant">Klslint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opLSLINT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Klsrint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opLSRINT</span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kasrint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opASRINT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kintcomp</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="#L199" title="ocaml/bytecomp/emitcode.ml:199">emit_comp</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Koffsetint</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opOFFSETINT</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Koffsetref</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opOFFSETREF</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kisint</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opISINT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kisout</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opULTINT<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetmethod</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETMETHOD<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetpubmet</span> <span class="ocamlLCIdentifier">tag</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETPUBMET</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">tag</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="Constant">0<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetdynmet</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETDYNMET<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kevent</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">record_event</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kperform</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPERFORM<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kresume</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opRESUME<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kresumeterm</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opRESUMETERM</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kreperformterm</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opREPERFORMTERM</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kstop</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opSTOP<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Emission of a list of instructions. Include some peephole optimization. *)<br/></li>
<li></span><br/></li>
<li><a id="L320">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">remerge_events</span></span> <span class="ocamlLCIdentifier">ev1</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kevent</span> <span class="ocamlLCIdentifier">ev2</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Kevent</span> <span class="Statement">(</span><span class="PreProc">Bytegen</span>.<span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L253" title="ocaml/bytecomp/bytegen.ml:253">merge_events</a></span> <span class="ocamlLCIdentifier">ev1</span> <span class="ocamlLCIdentifier">ev2</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;</span> <span class="Constant">Kevent</span> <span class="ocamlLCIdentifier">ev1</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span><br/></li>
<li><a id="L325">&#x200c;</a><span class="Statement">let</span> <span class="Statement">rec</span> <span class="ocamlLCIdentifier"><span class="linkable">emit</span></span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">[]</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span>&nbsp; <span class="Comment">(* Peephole optimizations *)<br/></li>
<li></span><span class="Comment">(* optimization of integer tests *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span><span class="Statement">::</span><span class="Constant">Kconst</span> <span class="ocamlLCIdentifier">k</span><span class="Statement">::</span><span class="Constant">Kintcomp</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">::</span><span class="Constant">Kbranchif</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">::</span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">when</span> <span class="ocamlLCIdentifier">is_immed_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">emit_branch_comp</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span><span class="Statement">::</span><span class="Constant">Kconst</span> <span class="ocamlLCIdentifier">k</span><span class="Statement">::</span><span class="Constant">Kintcomp</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">::</span><span class="Constant">Kbranchifnot</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">::</span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">when</span> <span class="ocamlLCIdentifier">is_immed_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">emit_branch_comp</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">negate_integer_comparison</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="Comment">(* same for range tests *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span><span class="Statement">::</span><span class="Constant">Kconst</span> <span class="ocamlLCIdentifier">k</span><span class="Statement">::</span><span class="Constant">Kisout</span><span class="Statement">::</span><span class="Constant">Kbranchif</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">::</span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">when</span> <span class="ocamlLCIdentifier">is_immed_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBULTINT</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span><span class="Statement">::</span><span class="Constant">Kconst</span> <span class="ocamlLCIdentifier">k</span><span class="Statement">::</span><span class="Constant">Kisout</span><span class="Statement">::</span><span class="Constant">Kbranchifnot</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span><span class="Statement">::</span><span class="ocamlLCIdentifier">rem<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">when</span> <span class="ocamlLCIdentifier">is_immed_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opBUGEINT</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_const</span> <span class="ocamlLCIdentifier">k</span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out_label</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L621" title="ocaml/bytecomp/bytegen.ml:621">lbl</a></span> <span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier">rem<br/></li>
<li></span><span class="Comment">(* Some special case of push ; i ; ret generated by the match compiler *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Constant">Kacc</span> <span class="Constant">0</span> <span class="Statement">::</span> <span class="Constant">Kreturn</span> <span class="ocamlLCIdentifier">m</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="Statement">(</span><span class="Constant">Kreturn</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">m</span>-<span class="Constant">1</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)<br/></li>
<li></span><span class="Comment">(* General push then access scheme *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Constant">Kacc</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">8</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opPUSHACC0</span> + <span class="ocamlLCIdentifier">n</span><span class="Statement">)</span> <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPUSHACC</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Constant">Kenvacc</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">1</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">n</span><span class="ocamlNone"> </span><span class="Statement">&lt;</span><span class="ocamlNone"> </span><span class="Constant">4<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opPUSHENVACC1</span> + <span class="ocamlLCIdentifier">n</span> - <span class="Constant">1</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPUSHENVACC</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Constant">Koffsetclosure</span> <span class="ocamlLCIdentifier">ofs</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ofs</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> -</span><span class="Constant">3</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ofs</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">ofs</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">3<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">out</span><span class="Statement">(</span><span class="ocamlLCIdentifier">opPUSHOFFSETCLOSURE0</span> + <span class="ocamlLCIdentifier">ofs</span> / <span class="Constant">3</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPUSHOFFSETCLOSURE</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">ofs</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Constant">Kgetglobal</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">::</span> <span class="Constant">Kgetfield</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPUSHGETGLOBALFIELD</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L71" title="ocaml/bytecomp/symtable.ml:71">slot_for_getglobal</a></span> <span class="ocamlLCIdentifier">id</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Constant">Kgetglobal</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opPUSHGETGLOBAL</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L71" title="ocaml/bytecomp/symtable.ml:71">slot_for_getglobal</a></span> <span class="ocamlLCIdentifier">id</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Constant">Kconst</span> <span class="ocamlLCIdentifier">sc</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sc</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">when</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L549" title="ocaml/bytecomp/bytegen.ml:549">is_immed</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">&lt;=</span><span class="ocamlNone"> </span><span class="Constant">3<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">opPUSHCONST0</span><span class="ocamlEnd"> + </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opPUSHCONSTINT</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">i</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Const_base</span><span class="Statement">(</span><span class="Constant">Const_char</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opPUSHCONSTINT</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out_int</span><span class="Statement">(</span><span class="PreProc">Char</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">code</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Const_block</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="ocamlEnd">, </span><span class="Constant">[]</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opPUSHATOM0</span><span class="ocamlEnd"> </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opPUSHATOM</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">out_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">opPUSHGETGLOBAL</span><span class="Statement">;</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L80" title="ocaml/bytecomp/symtable.ml:80">slot_for_literal</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">sc<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Statement">(</span><span class="Constant">Kevent</span> <span class="Statement">({</span><span class="ocamlLCIdentifier">ev_kind</span> <span class="Statement">=</span> <span class="Constant">Event_before</span><span class="Statement">}</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span><span class="Statement">))</span> <span class="Statement">::<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Kgetglobal</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">instr1</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="Statement">(</span><span class="Constant">Kgetfield</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">instr2</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="Statement">(</span><span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">instr1</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">instr2</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L320" title="ocaml/bytecomp/emitcode.ml:320">remerge_events</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="Statement">(</span><span class="Constant">Kevent</span> <span class="Statement">({</span><span class="ocamlLCIdentifier">ev_kind</span> <span class="Statement">=</span> <span class="Constant">Event_before</span><span class="Statement">}</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span><span class="Statement">))</span> <span class="Statement">::<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">Kacc</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Kenvacc</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Koffsetclosure</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Kgetglobal</span> <span class="Statement">_</span> <span class="Statement">|</span> <span class="Constant">Kconst</span> <span class="Statement">_</span> <span class="Statement">as</span> <span class="ocamlLCIdentifier">instr</span><span class="Statement">)::<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="Statement">(</span><span class="Constant">Kpush</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">instr</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="#L320" title="ocaml/bytecomp/emitcode.ml:320">remerge_events</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L1020" title="ocaml/bytecomp/bytegen.ml:1020">ev</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Kgetglobal</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">::</span> <span class="Constant">Kgetfield</span> <span class="ocamlLCIdentifier">n</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">out</span> <span class="ocamlLCIdentifier">opGETGLOBALFIELD</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L71" title="ocaml/bytecomp/symtable.ml:71">slot_for_getglobal</a></span> <span class="ocamlLCIdentifier">id</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">out_int</span> <span class="ocamlLCIdentifier">n</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span>&nbsp; <span class="Comment">(* Default case *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">instr</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L209" title="ocaml/bytecomp/emitcode.ml:209">emit_instr</a></span> <span class="ocamlLCIdentifier">instr</span><span class="Statement">;</span> <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Emission to a file *)<br/></li>
<li></span><br/></li>
<li><a id="L404">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">to_file</span></span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">unit_name</span> <span class="ocamlLCIdentifier">objfile</span> <span class="Statement">~</span><span class="Identifier"><a href="symtable.mli.html#L43" title="ocaml/bytecomp/symtable.mli:43">required_globals</a></span> <span class="ocamlLCIdentifier">code</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="symtable.mli.html#L22" title="ocaml/bytecomp/symtable.mli:22">init</a></span><span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Fun</span>.<span class="ocamlLCIdentifier">protect</span> <span class="Statement">~</span><span class="Identifier">finally</span>:<span class="ocamlLCIdentifier"><a href="#L184" title="ocaml/bytecomp/emitcode.ml:184">clear</a></span> <span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">cmo_magic_number</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos_depl</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pos_out</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">output_binary_int</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">0</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos_code</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pos_out</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier">code</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">output</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Constant">0</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">pos_debug</span>, <span class="ocamlLCIdentifier">size_debug</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">debug</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">debug_dirs</span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="PreProc">String</span><span class="ocamlEnd">.</span><span class="PreProc">Set</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">add<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">dirname</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Location</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">absolute_path</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">objfile</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">!</span><span class="ocamlLCIdentifier">debug_dirs</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos_out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Marshal</span><span class="ocamlEnd">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">to_channel</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">events</span><span class="ocamlEnd"> </span><span class="Statement">[</span><span class="Constant">Compression</span><span class="Statement">]);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">Marshal</span><span class="ocamlEnd">.</span><span class="Statement">(</span><span class="ocamlLCIdentifier">to_channel</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">String</span><span class="ocamlEnd">.</span><span class="PreProc">Set</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">elements</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">debug_dirs</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">[</span><span class="Constant">Compression</span><span class="Statement">]);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">pos_out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> - </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L819" title="ocaml/bytecomp/bytegen.ml:819">p</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end</span> <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="Constant">0</span>, <span class="Constant">0</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li><a id="L425">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">compunit</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">{</span> <span class="ocamlLCIdentifier">cu_name</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">unit_name</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_pos</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pos_code</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_codesize</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_reloc</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">reloc_info</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_imports</span> <span class="Statement">=</span> <span class="PreProc">Env</span>.<span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L284" title="ocaml/bytecomp/bytepackager.ml:284">imports</a></span><span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_primitives</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="PreProc">Primitive</span>.<span class="ocamlLCIdentifier">byte_name<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">!</span><span class="PreProc">Translmod</span>.<span class="ocamlLCIdentifier">primitive_declarations</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_required_globals</span> <span class="Statement">=</span> <span class="PreProc">Ident</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">elements</span> <span class="ocamlLCIdentifier"><a href="symtable.mli.html#L43" title="ocaml/bytecomp/symtable.mli:43">required_globals</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_force_link</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">link_everything</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_debug</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pos_debug</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">cu_debugsize</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">size_debug</span> <span class="Statement">}</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">pos_compunit</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pos_out</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">(* Remove any cached abbreviation expansion before marshaling.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp;&nbsp; See doc-comment for [Types.abbrev_memo] *)<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Btype</span>.<span class="ocamlLCIdentifier">cleanup_abbrev</span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="emitcode.mli.html#L53" title="ocaml/bytecomp/emitcode.mli:53">marshal_to_channel_with_possibly_32bit_compat</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">filename</span>:<span class="ocamlLCIdentifier">objfile</span> <span class="Statement">~</span><span class="Identifier">kind</span>:<span class="Constant">&quot;<a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> unit&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">seek_out</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">pos_depl</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">output_binary_int</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">pos_compunit</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Emission to a memory block *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="emitcode.mli.html#L30" title="ocaml/bytecomp/emitcode.mli:30">to_memory</a></span> <span class="ocamlLCIdentifier">init_code</span> <span class="ocamlLCIdentifier">fun_code</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="symtable.mli.html#L22" title="ocaml/bytecomp/symtable.mli:22">init</a></span><span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Fun</span>.<span class="ocamlLCIdentifier">protect</span> <span class="Statement">~</span><span class="Identifier">finally</span>:<span class="ocamlLCIdentifier"><a href="#L184" title="ocaml/bytecomp/emitcode.ml:184">clear</a></span> <span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier">init_code</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier">fun_code</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">code</span> <span class="Statement">=</span> <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">create</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">blit</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Constant">0</span> <span class="ocamlLCIdentifier">code</span> <span class="Constant">0</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">reloc</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">reloc_info</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">events</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">events</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">code</span>, <span class="ocamlLCIdentifier">reloc</span>, <span class="ocamlLCIdentifier">events</span><span class="Statement">))<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Emission to a file for a packed library *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="emitcode.mli.html#L40" title="ocaml/bytecomp/emitcode.mli:40">to_packed_file</a></span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">code</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="symtable.mli.html#L22" title="ocaml/bytecomp/symtable.mli:22">init</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Fun</span>.<span class="ocamlLCIdentifier">protect</span> <span class="Statement">~</span><span class="Identifier">finally</span>:<span class="ocamlLCIdentifier"><a href="#L184" title="ocaml/bytecomp/emitcode.ml:184">clear</a></span> <span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L325" title="ocaml/bytecomp/emitcode.ml:325">emit</a></span> <span class="ocamlLCIdentifier">code</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">output</span> <span class="ocamlLCIdentifier"><a href="bytelink.ml.html#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_buffer</span> <span class="Constant">0</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">reloc</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">reloc_info</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">events</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">events</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">debug_dirs</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">debug_dirs</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">size</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier">out_position</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">size</span>, <span class="ocamlLCIdentifier">reloc</span>, <span class="ocamlLCIdentifier">events</span>, <span class="ocamlLCIdentifier">debug_dirs</span><span class="Statement">))<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
