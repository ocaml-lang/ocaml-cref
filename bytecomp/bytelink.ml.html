<!-- generated by the vscode.pl tool from vscoded.-->

<html>
 <head>
  <title>ocaml/bytecomp/bytelink.ml - ocaml</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

  <h1>ocaml/bytecomp/bytelink.ml - ocaml</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L58">add_ccobjs</a></li>
<li><a href="#L112">add_required</a></li>
<li><a href="#L616">append_bytecode</a></li>
<li><a href="#L100">badly_ordered_dependencies</a></li>
<li><a href="#L704">basename</a></li>
<li><a href="#L593">build_custom_runtime</a></li>
<li><a href="#L705">c_file</a></li>
<li><a href="#L187">check_consistency</a></li>
<li><a href="#L364">check_dlls</a></li>
<li><a href="#L214">clear_crc_interfaces</a></li>
<li><a href="#L24">compare</a></li>
<li><a href="#L183">crc_interfaces</a></li>
<li><a href="#L503">currpos</a></li>
<li><a href="#L220">debug_info</a></li>
<li><a href="#L598">debug_prefix_map</a></li>
<li><a href="#L697">exec_name</a></li>
<li><a href="#L609">exitcode</a></li>
<li><a href="#L211">extract_crc_interfaces</a></li>
<li><a href="#L626">fix_exec_name</a></li>
<li><a href="#L330">header</a></li>
<li><a href="#L185">implementations_defined</a></li>
<li><a href="#L335">inchan</a></li>
<li><a href="#L184">interfaces</a></li>
<li><a href="#L106">is_required</a></li>
<li><a href="#L54">lib_ccobjs</a></li>
<li><a href="#L55">lib_ccopts</a></li>
<li><a href="#L56">lib_dllibs</a></li>
<li><a href="#L634">link</a></li>
<li><a href="#L259">link_archive</a></li>
<li><a href="#L224">link_compunit</a></li>
<li><a href="#L275">link_file</a></li>
<li><a href="#L246">link_object</a></li>
<li><a href="#L98">missing_globals</a></li>
<li><a href="#L736">mode</a></li>
<li><a href="#L715">obj_file</a></li>
<li><a href="#L321">outchan</a></li>
<li><a href="#L320">outperm</a></li>
<li><a href="#L448">output_cds_file</a></li>
<li><a href="#L416">output_code_string</a></li>
<li><a href="#L414">output_code_string_counter</a></li>
<li><a href="#L435">output_data_string</a></li>
<li><a href="#L290">output_debug_info</a></li>
<li><a href="#L372">output_fun</a></li>
<li><a href="#L504">output_fun</a></li>
<li><a href="#L675">poc</a></li>
<li><a href="#L99">provided_globals</a></li>
<li><a href="#L102">record_badly_ordered_dependency</a></li>
<li><a href="#L121">remove_required</a></li>
<li><a href="#L759">report_error</a></li>
<li><a href="#L812">reset</a></li>
<li><a href="#L346">runtime</a></li>
<li><a href="#L347">runtime</a></li>
<li><a href="#L742">runtime_lib</a></li>
<li><a href="#L128">scan_file</a></li>
<li><a href="#L363">sharedobjs</a></li>
<li><a href="#L360">start_code</a></li>
<li><a href="#L720">temps</a></li>
<li><a href="#L342">toc_writer</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L29">error</a></li>
<li><a href="#L45">link_action</a></li>
<li><a href="#L23">t</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">(**************************************************************************)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; OCaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Xavier Leroy, projet Cristal, INRIA Rocquencourt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; Copyright 1996 Institut National de Recherche en Informatique et&nbsp; &nbsp;&nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp;&nbsp; en Automatique.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; All rights reserved.&nbsp; This file is distributed under the terms of&nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; the GNU Lesser General Public License version 2.1, with the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp;&nbsp; special exception on linking described in the file LICENSE.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *)<br/></li>
<li></span><span class="Comment">(**************************************************************************)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Link a set of .cmo files and produce a <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> executable. *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Misc<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Config<br/></li>
<li></span><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Cmo_format<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Dep</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">struct<br/></li>
<li><a id="L23">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">type</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">t</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="Type">string</span><span class="ocamlStruct"> </span><span class="Statement">*</span><span class="ocamlStruct"> </span><span class="Type">string<br/></li>
<li><a id="L24">&#x200c;</a></span><span class="ocamlStruct">&nbsp; </span><span class="Statement">let</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span></span><span class="ocamlStruct"> </span><span class="Statement">=</span><span class="ocamlStruct"> </span><span class="ocamlLCIdentifier"><span class="linkable">compare</span><br/></li>
<li></span><span class="PreProc">end<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> DepSet</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Set.Make</span> <span class="ocamlFuncWith">(</span><span class="PreProc">Dep</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L29">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">error</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">File_not_found</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">filepath<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Not_an_object_file</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">filepath<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Wrong_object_name</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">filepath<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Symbol_error</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">filepath</span> <span class="Statement">*</span> <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="bytelibrarian.mli.html#L27" title="ocaml/bytecomp/bytelibrarian.mli:27">error</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Inconsistent_import</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">modname</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">filepath</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">filepath<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Custom_runtime<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">File_exists</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">filepath<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Cannot_open_dll</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">filepath<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Required_module_unavailable</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">modname</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">modname<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Camlheader</span> <span class="Statement">of</span> <span class="Type">string</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">filepath<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Wrong_link_order</span> <span class="Statement">of</span> <span class="PreProc">DepSet</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Multiple_definition</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier">modname</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">filepath</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">filepath<br/></li>
<li></span><br/></li>
<li><span class="Statement">exception</span> <span class="Constant">Error</span> <span class="Statement">of</span> <span class="ocamlLCIdentifier"><a href="bytelibrarian.mli.html#L27" title="ocaml/bytecomp/bytelibrarian.mli:27">error</a><br/></li>
<li></span><br/></li>
<li><a id="L45">&#x200c;</a><span class="Statement">type</span> <span class="ocamlLCIdentifier"><span class="linkable">link_action</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Link_object</span> <span class="Statement">of</span> <span class="Type">string</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">compilation_unit<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Name of .cmo file and descriptor of the unit *)<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Link_archive</span> <span class="Statement">of</span> <span class="Type">string</span> <span class="Statement">*</span> <span class="ocamlLCIdentifier">compilation_unit</span> <span class="Type">list<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">(* Name of .cma file and descriptors of the units to be linked. *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Add C objects and options from a library descriptor *)<br/></li>
<li></span><span class="Comment">(* Ignore them if -noautolink or -use-<a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a> or -use-prim was given *)<br/></li>
<li></span><br/></li>
<li><a id="L54">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lib_ccobjs</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">[]<br/></li>
<li><a id="L55">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lib_ccopts</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">[]<br/></li>
<li><a id="L56">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">lib_dllibs</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><a id="L58">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_ccobjs</span></span> <span class="ocamlLCIdentifier">origin</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">no_auto_link</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">if<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">use_runtime</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">use_prims</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">lib_custom</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="PreProc">Clflags</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">custom_runtime</span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Constant">true</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L54" title="ocaml/bytecomp/bytelink.ml:54">lib_ccobjs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a></span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L54" title="ocaml/bytecomp/bytelink.ml:54">lib_ccobjs</a></span><span class="ocamlEnd"> @ </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L54" title="ocaml/bytecomp/bytelink.ml:54">lib_ccobjs</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">replace_origin</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Misc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">replace_substring</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">before</span><span class="ocamlEnd">:</span><span class="Constant">&quot;$CAMLORIGIN&quot;</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">after</span><span class="ocamlEnd">:</span><span class="ocamlLCIdentifier">origin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L55" title="ocaml/bytecomp/bytelink.ml:55">lib_ccopts</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">map</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">replace_origin</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a></span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L55" title="ocaml/bytecomp/bytelink.ml:55">lib_ccopts</a></span><span class="ocamlEnd"> @ </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L55" title="ocaml/bytecomp/bytelink.ml:55">lib_ccopts</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L56" title="ocaml/bytecomp/bytelink.ml:56">lib_dllibs</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a></span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="#L56" title="ocaml/bytecomp/bytelink.ml:56">lib_dllibs</a></span><span class="ocamlEnd"> @ </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L56" title="ocaml/bytecomp/bytelink.ml:56">lib_dllibs</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* A note on ccobj ordering:<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - Clflags.ccobjs is in reverse order w.<a href="bytegen.ml.html#L854" title="ocaml/bytecomp/bytegen.ml:854">r</a>.<a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a>. what was given on the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; ocamlc command line;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - <a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a>.<a href="#L54" title="ocaml/bytecomp/bytelink.ml:54">lib_ccobjs</a> is also in reverse order w.<a href="bytegen.ml.html#L854" title="ocaml/bytecomp/bytegen.ml:854">r</a>.<a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a>. what was given on the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; ocamlc -a command line when the library was created;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - Clflags.ccobjs is reversed just before calling the C compiler for the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; custom <a href="#L634" title="ocaml/bytecomp/bytelink.ml:634">link</a>;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - .cma files on the command line of ocamlc are scanned right to left;<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; - Before linking, we add <a href="#L54" title="ocaml/bytecomp/bytelink.ml:54">lib_ccobjs</a> after Clflags.ccobjs.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Thus, for ocamlc a.cma b.cma obj1 obj2<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; where a.cma was built with ocamlc -i ... obja1 obja2<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; and b.cma was built with ocamlc -i ... objb1 objb2<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; <a href="#L54" title="ocaml/bytecomp/bytelink.ml:54">lib_ccobjs</a> starts as [],<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; becomes objb2 objb1 when b.cma is scanned,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; then obja2 obja1 objb2 objb1 when a.cma is scanned.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Clflags.ccobjs was initially obj2 obj1.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; and is set to obj2 obj1 obja2 obja1 objb2 objb1.<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; Finally, the C compiler is given objb1 objb2 obja1 obja2 obj1 obj2,<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; which is what we need.&nbsp; (If b depends on a, a.cma must appear before<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; b.cma, but b's C libraries must appear before a's C libraries.)<br/></li>
<li></span><span class="Comment">*)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* First pass: determine which units are needed *)<br/></li>
<li></span><br/></li>
<li><a id="L98">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">missing_globals</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="PreProc">Ident</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L44" title="ocaml/bytecomp/symtable.ml:44">empty</a><br/></li>
<li><a id="L99">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">provided_globals</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="PreProc">Ident</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L44" title="ocaml/bytecomp/symtable.ml:44">empty</a><br/></li>
<li><a id="L100">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">badly_ordered_dependencies</span></span> : <span class="PreProc">DepSet</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="PreProc">DepSet</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L44" title="ocaml/bytecomp/symtable.ml:44">empty</a><br/></li>
<li></span><br/></li>
<li><a id="L102">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">record_badly_ordered_dependency</span></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">id</span>, <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">dep</span> <span class="Statement">=</span> <span class="Statement">((</span><span class="PreProc">Ident</span>.<span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="ocamlLCIdentifier">id</span><span class="Statement">)</span>, <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span>.<span class="ocamlLCIdentifier">cu_name</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L100" title="ocaml/bytecomp/bytelink.ml:100">badly_ordered_dependencies</a></span> <span class="Statement">:=</span> <span class="PreProc">DepSet</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">dep</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L100" title="ocaml/bytecomp/bytelink.ml:100">badly_ordered_dependencies</a><br/></li>
<li></span><br/></li>
<li><a id="L106">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">is_required</span></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">rel</span>, <span class="ocamlLCIdentifier">_pos</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">rel</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Reloc_setglobal</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Ident</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">mem</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/bytecomp/bytelink.ml:98">missing_globals</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">false<br/></li>
<li></span><br/></li>
<li><a id="L112">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">add_required</span></span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Ident</span><span class="ocamlNone">.</span><span class="PreProc">Set</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mem</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">id</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L99" title="ocaml/bytecomp/bytelink.ml:99">provided_globals</a></span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L102" title="ocaml/bytecomp/bytelink.ml:102">record_badly_ordered_dependency</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">id</span>, <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/bytecomp/bytelink.ml:98">missing_globals</a></span> <span class="Statement">:=</span> <span class="PreProc">Ident</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">id</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span>.<span class="ocamlLCIdentifier">cu_name</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/bytecomp/bytelink.ml:98">missing_globals</a><br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="ocamlLCIdentifier">add</span> <span class="Statement">(</span><span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L43" title="ocaml/bytecomp/symtable.mli:43">required_globals</a></span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span>.<span class="ocamlLCIdentifier">cu_reloc</span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span>.<span class="ocamlLCIdentifier">cu_required_globals<br/></li>
<li></span><br/></li>
<li><a id="L121">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">remove_required</span></span> <span class="Statement">(</span><span class="ocamlLCIdentifier">rel</span>, <span class="ocamlLCIdentifier">_pos</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="ocamlLCIdentifier">rel</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Reloc_setglobal</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/bytecomp/bytelink.ml:98">missing_globals</a></span> <span class="Statement">:=</span> <span class="PreProc">Ident</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier">remove</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/bytecomp/bytelink.ml:98">missing_globals</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L99" title="ocaml/bytecomp/bytelink.ml:99">provided_globals</a></span> <span class="Statement">:=</span> <span class="PreProc">Ident</span>.<span class="PreProc">Set</span>.<span class="ocamlLCIdentifier">add</span> <span class="ocamlLCIdentifier">id</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L99" title="ocaml/bytecomp/bytelink.ml:99">provided_globals</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">()<br/></li>
<li></span><br/></li>
<li><a id="L128">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">scan_file</span></span> <span class="ocamlLCIdentifier">obj_name</span> <span class="ocamlLCIdentifier">tolink</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">file_name</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Load_path</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L46" title="ocaml/bytecomp/symtable.ml:46">find</a></span> <span class="ocamlLCIdentifier">obj_name<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">with</span> <span class="Constant">Not_found</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">raise(</span><span class="Constant">Error</span><span class="Statement">(</span><span class="Constant">File_not_found</span> <span class="ocamlLCIdentifier">obj_name</span><span class="Statement">))</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">open_in_bin</span> <span class="ocamlLCIdentifier">file_name</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">buffer</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">really_input_string</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span> <span class="Statement">(</span><span class="PreProc">String</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">cmo_magic_number</span><span class="Statement">)</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">buffer</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cmo_magic_number</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Comment">(* This is a .cmo file. It must be linked in any case.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Read the relocation information to see which modules it<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; requires. *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">compunit_pos</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">input_binary_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="ocamlEnd"> </span><span class="Statement">in</span><span class="ocamlEnd">&nbsp; </span><span class="Comment">(* Go to descriptor *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">seek_in</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">compunit_pos</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">input_value</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="ocamlEnd"> : </span><span class="ocamlLCIdentifier">compilation_unit</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">close_in</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L112" title="ocaml/bytecomp/bytelink.ml:112">add_required</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">iter</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L121" title="ocaml/bytecomp/bytelink.ml:121">remove_required</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">cu_reloc</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Constant">Link_object</span><span class="Statement">(</span><span class="ocamlLCIdentifier">file_name</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">tolink<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">buffer</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">cma_magic_number</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Comment">(* This is an archive file. Each unit contained in it will be linked<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; in only if needed. *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos_toc</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">input_binary_int</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="ocamlEnd"> </span><span class="Statement">in</span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Comment">(* Go to table of contents *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">seek_in</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">pos_toc</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">toc</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">input_value</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="ocamlEnd"> : </span><span class="ocamlLCIdentifier">library</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">close_in</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L58" title="ocaml/bytecomp/bytelink.ml:58">add_ccobjs</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">dirname</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">file_name</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">toc</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">required</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">fold_right<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reqd</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">cu_force_link<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">link_everything<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">exists</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L106" title="ocaml/bytecomp/bytelink.ml:106">is_required</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">cu_reloc<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L112" title="ocaml/bytecomp/bytelink.ml:112">add_required</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">iter</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L121" title="ocaml/bytecomp/bytelink.ml:121">remove_required</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">cu_reloc</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reqd<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">end</span><span class="ocamlEnd"> </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">reqd</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">toc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">lib_units</span><span class="ocamlEnd"> </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Constant">Link_archive</span><span class="Statement">(</span><span class="ocamlLCIdentifier">file_name</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">required</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">tolink<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">raise(</span><span class="Constant">Error</span><span class="Statement">(</span><span class="Constant">Not_an_object_file</span> <span class="ocamlLCIdentifier">file_name</span><span class="Statement">))<br/></li>
<li></span>&nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">End_of_file</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="Statement">;</span> <span class="Statement">raise(</span><span class="Constant">Error</span><span class="Statement">(</span><span class="Constant">Not_an_object_file</span> <span class="ocamlLCIdentifier">file_name</span><span class="Statement">))<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="Statement">;</span> <span class="Statement">raise</span> <span class="ocamlLCIdentifier">x<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Second pass: <a href="#L634" title="ocaml/bytecomp/bytelink.ml:634">link</a> in the required units *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Consistency check between <a href="#L184" title="ocaml/bytecomp/bytelink.ml:184">interfaces</a> *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">module</span><span class="PreProc"> Consistbl</span><span class="ocamlPreDef"> </span><span class="Statement">=</span> <span class="PreProc">Consistbl.Make</span> <span class="ocamlFuncWith">(</span><span class="PreProc">Misc.Stdlib.String</span><span class="ocamlFuncWith">)<br/></li>
<li></span><br/></li>
<li><a id="L183">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">crc_interfaces</span></span> <span class="Statement">=</span> <span class="PreProc">Consistbl</span>.<span class="ocamlLCIdentifier">create</span> <span class="Constant">()<br/></li>
<li><a id="L184">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">interfaces</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="Constant">[]</span> : <span class="Type">string</span> <span class="Type">list</span><span class="Statement">)<br/></li>
<li><a id="L185">&#x200c;</a></span><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">implementations_defined</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="Constant">[]</span> : <span class="Statement">(</span><span class="Type">string</span> <span class="Statement">*</span> <span class="Type">string</span><span class="Statement">)</span> <span class="Type">list</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L187">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">check_consistency</span></span> <span class="ocamlLCIdentifier">file_name</span> <span class="ocamlLCIdentifier">cu</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">try<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">source</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">assoc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">cu</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">cu_name</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L185" title="ocaml/bytecomp/bytelink.ml:185">implementations_defined</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">raise</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Multiple_definition</span><span class="Statement">(</span><span class="ocamlLCIdentifier">cu</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">cu_name</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">file_name</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">source</span><span class="Statement">)));<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">with</span><span class="ocamlEnd"> </span><span class="Constant">Not_found</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; <span class="Statement">begin</span><span class="ocamlEnd"> </span><span class="Statement">try<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">iter<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">crco</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L184" title="ocaml/bytecomp/bytelink.ml:184">interfaces</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L184" title="ocaml/bytecomp/bytelink.ml:184">interfaces</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">crco</span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">None</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">crc</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="PreProc">Consistbl</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">check</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L183" title="ocaml/bytecomp/bytelink.ml:183">crc_interfaces</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">crc</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">file_name</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">cu</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">cu_imports<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">with</span><span class="ocamlEnd"> </span><span class="PreProc">Consistbl</span><span class="ocamlEnd">.</span><span class="Constant">Inconsistency</span><span class="ocamlEnd"> </span><span class="Statement">{<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">unit_name</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">inconsistent_source</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">user</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">original_source</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">auth</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">}</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">raise(</span><span class="Constant">Error</span><span class="Statement">(</span><span class="Constant">Inconsistent_import</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">user</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">auth</span><span class="Statement">)))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L185" title="ocaml/bytecomp/bytelink.ml:185">implementations_defined</a></span> <span class="Statement">:=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">cu</span>.<span class="ocamlLCIdentifier">cu_name</span>, <span class="ocamlLCIdentifier">file_name</span><span class="Statement">)</span> <span class="Statement">::</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L185" title="ocaml/bytecomp/bytelink.ml:185">implementations_defined</a><br/></li>
<li></span><br/></li>
<li><a id="L211">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">extract_crc_interfaces</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Consistbl</span>.<span class="ocamlLCIdentifier">extract</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L184" title="ocaml/bytecomp/bytelink.ml:184">interfaces</a></span> <span class="ocamlLCIdentifier"><a href="#L183" title="ocaml/bytecomp/bytelink.ml:183">crc_interfaces</a><br/></li>
<li></span><br/></li>
<li><a id="L214">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">clear_crc_interfaces</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Consistbl</span>.<span class="ocamlLCIdentifier"><a href="emitcode.ml.html#L184" title="ocaml/bytecomp/emitcode.ml:184">clear</a></span> <span class="ocamlLCIdentifier"><a href="#L183" title="ocaml/bytecomp/bytelink.ml:183">crc_interfaces</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L184" title="ocaml/bytecomp/bytelink.ml:184">interfaces</a></span> <span class="Statement">:=</span> <span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Record compilation events *)<br/></li>
<li></span><br/></li>
<li><a id="L220">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">debug_info</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Statement">(</span><span class="Constant">[]</span> : <span class="Statement">(</span><span class="Type">int</span> <span class="Statement">*</span> <span class="PreProc">Instruct</span>.<span class="ocamlLCIdentifier"><a href="instruct.ml.html#L23" title="ocaml/bytecomp/instruct.ml:23">debug_event</a></span> <span class="Type">list</span> <span class="Statement">*</span> <span class="Type">string</span> <span class="Type">list</span><span class="Statement">)</span> <span class="Type">list</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Link in a compilation unit *)<br/></li>
<li></span><br/></li>
<li><a id="L224">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">link_compunit</span></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span> <span class="ocamlLCIdentifier">file_name</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L187" title="ocaml/bytecomp/bytelink.ml:187">check_consistency</a></span> <span class="ocamlLCIdentifier">file_name</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">seek_in</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span>.<span class="ocamlLCIdentifier">cu_pos</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">code_block</span> <span class="Statement">=</span> <span class="PreProc">LongString</span>.<span class="ocamlLCIdentifier">input_bytes</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span>.<span class="ocamlLCIdentifier">cu_codesize</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L230" title="ocaml/bytecomp/symtable.ml:230">patch_object</a></span> <span class="ocamlLCIdentifier">code_block</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span>.<span class="ocamlLCIdentifier">cu_reloc</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">debug</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">cu_debug</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier">seek_in</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">cu_debug</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">debug_event_list</span><span class="ocamlEnd"> : </span><span class="PreProc">Instruct</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="instruct.ml.html#L23" title="ocaml/bytecomp/instruct.ml:23">debug_event</a></span><span class="ocamlEnd"> </span><span class="Type">list</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">input_value</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">debug_dirs</span><span class="ocamlEnd"> : </span><span class="Type">string</span><span class="ocamlEnd"> </span><span class="Type">list</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">input_value</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">file_path</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">dirname</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Location</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">absolute_path</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">file_name</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">debug_dirs</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">mem</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">file_path</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">debug_dirs<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">debug_dirs<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">file_path</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">debug_dirs</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L220" title="ocaml/bytecomp/bytelink.ml:220">debug_info</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">currpos_fun</span><span class="Constant">()</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">debug_event_list</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">debug_dirs</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L220" title="ocaml/bytecomp/bytelink.ml:220">debug_info</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; <span class="PreProc">Array</span>.<span class="ocamlLCIdentifier">iter</span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">code_block</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">link_everything</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L24" title="ocaml/bytecomp/symtable.mli:24">require_primitive</a></span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span>.<span class="ocamlLCIdentifier">cu_primitives<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Link in a .cmo file *)<br/></li>
<li></span><br/></li>
<li><a id="L246">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">link_object</span></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="ocamlLCIdentifier">file_name</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">open_in_bin</span> <span class="ocamlLCIdentifier">file_name</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L224" title="ocaml/bytecomp/bytelink.ml:224">link_compunit</a></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span> <span class="ocamlLCIdentifier">file_name</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L290" title="ocaml/bytecomp/bytepackager.ml:290">compunit</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a><br/></li>
<li></span>&nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">Symtable</span>.<span class="Constant">Error</span> <span class="ocamlLCIdentifier">msg</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span><span class="Statement">;</span> <span class="Statement">raise(</span><span class="Constant">Error</span><span class="Statement">(</span><span class="Constant">Symbol_error</span><span class="Statement">(</span><span class="ocamlLCIdentifier">file_name</span>, <span class="ocamlLCIdentifier">msg</span><span class="Statement">)))<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span><span class="Statement">;</span> <span class="Statement">raise</span> <span class="ocamlLCIdentifier">x<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Link in a .cma file *)<br/></li>
<li></span><br/></li>
<li><a id="L259">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">link_archive</span></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="ocamlLCIdentifier">file_name</span> <span class="ocamlLCIdentifier">units_required</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">open_in_bin</span> <span class="ocamlLCIdentifier">file_name</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">(fun</span> <span class="ocamlLCIdentifier">cu</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">file_name</span> <span class="Statement">^</span> <span class="Constant">&quot;(&quot;</span> <span class="Statement">^</span> <span class="ocamlLCIdentifier">cu</span>.<span class="ocamlLCIdentifier">cu_name</span> <span class="Statement">^</span> <span class="Constant">&quot;)&quot;</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">try<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L224" title="ocaml/bytecomp/bytelink.ml:224">link_compunit</a></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="ocamlLCIdentifier">cu<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">with</span> <span class="PreProc">Symtable</span>.<span class="Constant">Error</span> <span class="ocamlLCIdentifier">msg</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">raise(</span><span class="Constant">Error</span><span class="Statement">(</span><span class="Constant">Symbol_error</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span>, <span class="ocamlLCIdentifier">msg</span><span class="Statement">))))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">units_required</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a><br/></li>
<li></span>&nbsp; <span class="Statement">with</span> <span class="ocamlLCIdentifier">x</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span><span class="Statement">;</span> <span class="Statement">raise</span> <span class="ocamlLCIdentifier">x<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Link in a .cmo or .cma file *)<br/></li>
<li></span><br/></li>
<li><a id="L275">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">link_file</span></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">Link_object</span><span class="Statement">(</span><span class="ocamlLCIdentifier">file_name</span>, <span class="Type">unit</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L246" title="ocaml/bytecomp/bytelink.ml:246">link_object</a></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="ocamlLCIdentifier">file_name</span> <span class="Type">unit<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Link_archive</span><span class="Statement">(</span><span class="ocamlLCIdentifier">file_name</span>, <span class="ocamlLCIdentifier">units</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L259" title="ocaml/bytecomp/bytelink.ml:259">link_archive</a></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="ocamlLCIdentifier">file_name</span> <span class="ocamlLCIdentifier">units<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Output the debugging information *)<br/></li>
<li></span><span class="Comment">(* Format is:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &lt;int32&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; number of <a href="bytegen.ml.html#L992" title="ocaml/bytecomp/bytegen.ml:992">event</a> lists<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &lt;int32&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="bytegen.ml.html#L923" title="ocaml/bytecomp/bytegen.ml:923">offset</a> of first <a href="bytegen.ml.html#L992" title="ocaml/bytecomp/bytegen.ml:992">event</a> list<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &lt;output_value&gt;&nbsp;&nbsp; first <a href="bytegen.ml.html#L992" title="ocaml/bytecomp/bytegen.ml:992">event</a> list<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; ...<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &lt;int32&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="bytegen.ml.html#L923" title="ocaml/bytecomp/bytegen.ml:923">offset</a> of last <a href="bytegen.ml.html#L992" title="ocaml/bytecomp/bytegen.ml:992">event</a> list<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &lt;output_value&gt;&nbsp;&nbsp; last <a href="bytegen.ml.html#L992" title="ocaml/bytecomp/bytegen.ml:992">event</a> list *)<br/></li>
<li></span><br/></li>
<li><a id="L290">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">output_debug_info</span></span> <span class="ocamlLCIdentifier">oc</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">output_binary_int</span> <span class="ocamlLCIdentifier">oc</span> <span class="Statement">(</span><span class="PreProc">List</span>.<span class="ocamlLCIdentifier">length</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L220" title="ocaml/bytecomp/bytelink.ml:220">debug_info</a></span><span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">ofs</span>, <span class="ocamlLCIdentifier">evl</span>, <span class="ocamlLCIdentifier">debug_dirs</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">output_binary_int</span> <span class="ocamlLCIdentifier">oc</span> <span class="ocamlLCIdentifier">ofs</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">output_value</span> <span class="ocamlLCIdentifier">oc</span> <span class="ocamlLCIdentifier">evl</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">output_value</span> <span class="ocamlLCIdentifier">oc</span> <span class="ocamlLCIdentifier">debug_dirs</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L220" title="ocaml/bytecomp/bytelink.ml:220">debug_info</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L220" title="ocaml/bytecomp/bytelink.ml:220">debug_info</a></span> <span class="Statement">:=</span> <span class="Constant">[]<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Transform a file <a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a> into an absolute file <a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a> *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">make_absolute</span> <span class="ocamlLCIdentifier">file</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">Filename</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">is_relative</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">file</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier">file<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">rewrite_absolute_path<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="PreProc">Filename</span>.<span class="ocamlLCIdentifier">concat</span> <span class="Statement">(</span><span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">getcwd</span><span class="Constant">()</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">file</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Create a <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> executable file *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">link_bytecode</span> <span class="Statement">?</span><span class="Identifier">final_name</span> <span class="ocamlLCIdentifier">tolink</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span> <span class="ocamlLCIdentifier">standalone</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">final_name</span> <span class="Statement">=</span> <span class="PreProc">Option</span>.<span class="ocamlLCIdentifier">value</span> <span class="ocamlLCIdentifier">final_name</span> <span class="Statement">~</span><span class="Identifier">default</span>:<span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Comment">(* Avoid the case where the specified exec output file is the same as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; one of the objects to be linked *)<br/></li>
<li></span>&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Link_object</span><span class="Statement">(</span><span class="ocamlLCIdentifier">file_name</span>, <span class="Statement">_)</span> <span class="Statement">when</span> <span class="ocamlLCIdentifier">file_name</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">raise</span> <span class="Statement">(</span><span class="Constant">Error</span> <span class="Statement">(</span><span class="Constant">Wrong_object_name</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span><span class="Statement">));<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">()</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">tolink</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Comment">(* Remove the output file if it exists to avoid permission problems (PR#8354),<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; but don'<a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a> risk removing a special file (PR#11302). *)<br/></li>
<li></span>&nbsp; <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">remove_file</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span><span class="Statement">;<br/></li>
<li><a id="L320">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">outperm</span></span> <span class="Statement">=</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">with_runtime</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Constant">0o777</span> <span class="Statement">else</span> <span class="Constant">0o666</span> <span class="Statement">in<br/></li>
<li><a id="L321">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">outchan</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">open_out_gen</span> <span class="Statement">[</span><span class="Constant">Open_wronly</span><span class="Statement">;</span> <span class="Constant">Open_trunc</span><span class="Statement">;</span> <span class="Constant">Open_creat</span><span class="Statement">;</span> <span class="Constant">Open_binary</span><span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L320" title="ocaml/bytecomp/bytelink.ml:320">outperm</a></span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">try_finally<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">always</span>:<span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">close_out</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">exceptionally</span>:<span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">remove_file</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">standalone</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">with_runtime</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Comment">(* Copy the <a href="#L330" title="ocaml/bytecomp/bytelink.ml:330">header</a> *)<br/></li>
<li><a id="L330">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">header</span></span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">use_runtime</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Constant">&quot;camlheader_ur&quot;</span><span class="ocamlEnd"> </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Constant">&quot;camlheader&quot;</span><span class="ocamlEnd"> </span><span class="Statement">^</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">runtime_variant<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">try<br/></li>
<li><a id="L335">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">inchan</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">open_in_bin</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Load_path</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L46" title="ocaml/bytecomp/symtable.ml:46">find</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L330" title="ocaml/bytecomp/bytelink.ml:330">header</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">copy_file</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">close_in</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L335" title="ocaml/bytecomp/bytelink.ml:335">inchan</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Not_found</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">raise</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">File_not_found</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L330" title="ocaml/bytecomp/bytelink.ml:330">header</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">Sys_error</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">msg</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">raise</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Camlheader</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L330" title="ocaml/bytecomp/bytelink.ml:330">header</a></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">msg</span><span class="Statement">)))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end;<br/></li>
<li><a id="L342">&#x200c;</a></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">toc_writer</span></span> <span class="Statement">=</span> <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L45" title="ocaml/bytecomp/bytesections.mli:45">init_record</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The path to the <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> interpreter (in use_runtime <a href="#L736" title="ocaml/bytecomp/bytelink.ml:736">mode</a>) *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">use_runtime</span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">with_runtime</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">begin<br/></li>
<li><a id="L346">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">runtime</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">make_absolute</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">use_runtime</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L347">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">runtime</span></span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Comment">(* shebang mustn'<a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a> exceed 128 including the #! and \0 *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">length</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;</span><span class="ocamlNone"> </span><span class="Constant">125</span><span class="ocamlNone"> </span><span class="Statement">||</span><span class="ocamlNone"> </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">contains</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a></span><span class="ocamlNone"> </span><span class="Constant">' '</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">&quot;/bin/sh\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exec &quot;</span><span class="ocamlEnd"> </span><span class="Statement">^</span><span class="ocamlEnd"> </span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">quote</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a></span><span class="ocamlEnd"> </span><span class="Statement">^</span><span class="ocamlEnd"> </span><span class="Constant">&quot; \&quot;$0\&quot; \&quot;$@\&quot;&quot;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">output_string</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">output_char</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Constant">'\n'</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">Bytesections</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span><span class="ocamlEnd"> </span><span class="PreProc">Bytesections</span><span class="ocamlEnd">.</span><span class="PreProc">Name</span><span class="ocamlEnd">.</span><span class="Constant">RNTM<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> *)<br/></li>
<li><a id="L360">&#x200c;</a></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">start_code</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pos_out</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L22" title="ocaml/bytecomp/symtable.mli:22">init</a></span><span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L214" title="ocaml/bytecomp/bytelink.ml:214">clear_crc_interfaces</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li><a id="L363">&#x200c;</a></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">sharedobjs</span></span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">map</span> <span class="PreProc">Dll</span>.<span class="ocamlLCIdentifier"><a href="dll.mli.html#L19" title="ocaml/bytecomp/dll.mli:19">extract_dll_name</a></span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">dllibs</span> <span class="Statement">in<br/></li>
<li><a id="L364">&#x200c;</a></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">check_dlls</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">standalone</span> <span class="Statement">&amp;&amp;</span> <span class="PreProc">Config</span>.<span class="ocamlLCIdentifier">target</span> <span class="Statement">=</span> <span class="PreProc">Config</span>.<span class="ocamlLCIdentifier">host</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L364" title="ocaml/bytecomp/bytelink.ml:364">check_dlls</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Comment">(* Initialize the DLL machinery *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">Dll</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="dll.mli.html#L62" title="ocaml/bytecomp/dll.mli:62">init_compile</a></span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">no_std_include</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">Dll</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="dll.mli.html#L53" title="ocaml/bytecomp/dll.mli:53">add_path</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Load_path</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">get_paths</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">try</span><span class="ocamlEnd"> </span><span class="PreProc">Dll</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="dll.mli.html#L29" title="ocaml/bytecomp/dll.mli:29">open_dlls</a></span><span class="ocamlEnd"> </span><span class="PreProc">Dll</span><span class="ocamlEnd">.</span><span class="Constant">For_checking</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L363" title="ocaml/bytecomp/bytelink.ml:363">sharedobjs</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">with</span><span class="ocamlEnd"> </span><span class="Constant">Failure</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reason</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Statement">raise(</span><span class="Constant">Error</span><span class="Statement">(</span><span class="Constant">Cannot_open_dll</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">reason</span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end;<br/></li>
<li><a id="L372">&#x200c;</a></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">output_fun</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">output_bytes</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="Constant">()</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">pos_out</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> - <span class="ocamlLCIdentifier"><a href="#L360" title="ocaml/bytecomp/bytelink.ml:360">start_code</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L275" title="ocaml/bytecomp/bytelink.ml:275">link_file</a></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">tolink</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L364" title="ocaml/bytecomp/bytelink.ml:364">check_dlls</a></span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="PreProc">Dll</span>.<span class="ocamlLCIdentifier"><a href="dll.mli.html#L32" title="ocaml/bytecomp/dll.mli:32">close_all_dlls</a></span><span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The final STOP <a href="instruct.ml.html#L53" title="ocaml/bytecomp/instruct.ml:53">instruction</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_byte</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="PreProc">Opcodes</span>.<span class="ocamlLCIdentifier">opSTOP</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_byte</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">0</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">output_byte</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">0</span><span class="Statement">;</span> <span class="ocamlLCIdentifier">output_byte</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">0</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span> <span class="Constant">CODE</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* DLL stuff *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">standalone</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Comment">(* The extra search path for DLLs *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">output_string</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">concat_null_terminated</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">dllpaths</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">Bytesections</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span><span class="ocamlEnd"> </span><span class="Constant">DLPT</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Comment">(* The names of the DLLs *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">output_string</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">concat_null_terminated</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L363" title="ocaml/bytecomp/bytelink.ml:363">sharedobjs</a></span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">Bytesections</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span><span class="ocamlEnd"> </span><span class="Constant">DLLS<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The names of <a href="bytesections.mli.html#L83" title="ocaml/bytecomp/bytesections.mli:83">all</a> primitives *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L27" title="ocaml/bytecomp/symtable.mli:27">output_primitive_names</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span> <span class="Constant">PRIM</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The table of global data *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Emitcode</span>.<span class="ocamlLCIdentifier"><a href="emitcode.mli.html#L53" title="ocaml/bytecomp/emitcode.mli:53">marshal_to_channel_with_possibly_32bit_compat</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">~</span><span class="Identifier">filename</span>:<span class="ocamlLCIdentifier">final_name</span> <span class="Statement">~</span><span class="Identifier">kind</span>:<span class="Constant">&quot;<a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> executable&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">(</span><span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L25" title="ocaml/bytecomp/symtable.mli:25">initial_global_table</a></span><span class="Constant">()</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span> <span class="Constant">DATA</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The map of global identifiers *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L255" title="ocaml/bytecomp/symtable.ml:255">output_global_map</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span> <span class="Constant">SYMB</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* CRCs for modules *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_value</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L211" title="ocaml/bytecomp/bytelink.ml:211">extract_crc_interfaces</a></span><span class="Constant">()</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span> <span class="Constant">CRCS</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* Debug <a href="bytegen.ml.html#L1040" title="ocaml/bytecomp/bytegen.ml:1040">info</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">debug</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L290" title="ocaml/bytecomp/bytelink.ml:290">output_debug_info</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">Bytesections</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span><span class="ocamlEnd"> </span><span class="Constant">DBUG<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The table of contents and the trailer *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L52" title="ocaml/bytecomp/bytesections.mli:52">write_toc_and_trailer</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Output a string as a C array of unsigned ints *)<br/></li>
<li></span><br/></li>
<li><a id="L414">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">output_code_string_counter</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><a id="L416">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">output_code_string</span></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">code</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">len</span> <span class="Statement">=</span> <span class="PreProc">Bytes</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">code</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">while</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span> <span class="Statement">&lt;</span> <span class="ocamlLCIdentifier">len</span> <span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c1</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="PreProc">Char</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">code</span><span class="Statement">(</span><span class="PreProc">Bytes</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">get</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">code</span><span class="ocamlDo"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span><span class="Statement">)</span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c2</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="PreProc">Char</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">code</span><span class="Statement">(</span><span class="PreProc">Bytes</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">get</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">code</span><span class="ocamlDo"> </span><span class="Statement">(!</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span><span class="ocamlDo"> + </span><span class="Constant">1</span><span class="Statement">))</span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c3</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="PreProc">Char</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">code</span><span class="Statement">(</span><span class="PreProc">Bytes</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">get</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">code</span><span class="ocamlDo"> </span><span class="Statement">(!</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span><span class="ocamlDo"> + </span><span class="Constant">2</span><span class="Statement">))</span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c4</span><span class="ocamlDo"> </span><span class="Statement">=</span><span class="ocamlDo"> </span><span class="PreProc">Char</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">code</span><span class="Statement">(</span><span class="PreProc">Bytes</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">get</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">code</span><span class="ocamlDo"> </span><span class="Statement">(!</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span><span class="ocamlDo"> + </span><span class="Constant">3</span><span class="Statement">))</span><span class="ocamlDo"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span><span class="ocamlDo"> </span><span class="Statement">:=</span><span class="ocamlDo"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L985" title="ocaml/bytecomp/bytegen.ml:985">pos</a></span><span class="ocamlDo"> + </span><span class="Constant">4</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="PreProc">Printf</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlDo"> </span><span class="Constant">&quot;0x%02x%02x%02x%02x, &quot;</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c4</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c3</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c2</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">c1</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L54" title="ocaml/bytecomp/symtable.ml:54">incr</a></span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L414" title="ocaml/bytecomp/bytelink.ml:414">output_code_string_counter</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L414" title="ocaml/bytecomp/bytelink.ml:414">output_code_string_counter</a></span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">6</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">output_char</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Constant">'\n'</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="#L414" title="ocaml/bytecomp/bytelink.ml:414">output_code_string_counter</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span><span class="ocamlDo">&nbsp; </span><span class="Statement">done<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Output a string as a C string *)<br/></li>
<li></span><br/></li>
<li><a id="L435">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">output_data_string</span></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">data</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">counter</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">for</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">i</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">to</span> <span class="PreProc">String</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">data</span> - <span class="Constant">1</span> <span class="Statement">do<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="PreProc">Printf</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">fprintf</span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlDo"> </span><span class="Constant">&quot;%d, &quot;</span><span class="ocamlDo"> </span><span class="Statement">(</span><span class="PreProc">Char</span><span class="ocamlDo">.</span><span class="ocamlLCIdentifier">code</span><span class="Statement">(</span><span class="ocamlLCIdentifier">data</span><span class="ocamlDo">.</span><span class="Statement">[</span><span class="ocamlLCIdentifier">i</span><span class="Statement">]));<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="ocamlLCIdentifier"><a href="symtable.ml.html#L54" title="ocaml/bytecomp/symtable.ml:54">incr</a></span><span class="ocamlDo"> </span><span class="ocamlLCIdentifier">counter</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlDo">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier">counter</span><span class="ocamlNone"> </span><span class="Statement">&gt;=</span><span class="ocamlNone"> </span><span class="Constant">12</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlDo"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">output_string</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Constant">&quot;\n&quot;</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">counter</span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span><span class="ocamlDo">&nbsp; </span><span class="Statement">done<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Output a debug stub *)<br/></li>
<li></span><br/></li>
<li><a id="L448">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">output_cds_file</span></span> <span class="ocamlLCIdentifier">outfile</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">remove_file</span> <span class="ocamlLCIdentifier">outfile</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">open_out_gen</span> <span class="Statement">[</span><span class="Constant">Open_wronly</span><span class="Statement">;</span> <span class="Constant">Open_trunc</span><span class="Statement">;</span> <span class="Constant">Open_creat</span><span class="Statement">;</span> <span class="Constant">Open_binary</span><span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">0o777</span> <span class="ocamlLCIdentifier">outfile</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">try_finally<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">always</span>:<span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">close_out</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">exceptionally</span>:<span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">remove_file</span> <span class="ocamlLCIdentifier">outfile</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span> <span class="Statement">=</span> <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L45" title="ocaml/bytecomp/bytesections.mli:45">init_record</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The map of global identifiers *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L255" title="ocaml/bytecomp/symtable.ml:255">output_global_map</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span> <span class="Constant">SYMB</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* Debug <a href="bytegen.ml.html#L1040" title="ocaml/bytecomp/bytegen.ml:1040">info</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L290" title="ocaml/bytecomp/bytelink.ml:290">output_debug_info</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L48" title="ocaml/bytecomp/bytesections.mli:48">record</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span> <span class="Constant">DBUG</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The table of contents and the trailer *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L52" title="ocaml/bytecomp/bytesections.mli:52">write_toc_and_trailer</a></span> <span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L43" title="ocaml/bytecomp/bytesections.mli:43">toc_writer</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Output a <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> executable as a C file *)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Primitives declared in the included headers but re-declared in the<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; primitives table need to be guarded and not declared twice. *)<br/></li>
<li></span><span class="Statement">let</span> <span class="ocamlLCIdentifier">guarded_primitives</span> <span class="Statement">=</span> <span class="Statement">[<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">&quot;caml_get_public_method&quot;</span>, <span class="Constant">&quot;caml__get_public_method&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">&quot;caml_set_oo_id&quot;</span>, <span class="Constant">&quot;caml__set_oo_id&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="Statement">]<br/></li>
<li></span><br/></li>
<li><span class="Statement">let</span> <span class="ocamlLCIdentifier">link_bytecode_as_c</span> <span class="ocamlLCIdentifier">tolink</span> <span class="ocamlLCIdentifier">outfile</span> <span class="ocamlLCIdentifier">with_main</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">open_out</span> <span class="ocamlLCIdentifier">outfile</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Misc</span>.<span class="ocamlLCIdentifier">try_finally<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">always</span>:<span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">close_out</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">~</span><span class="Identifier">exceptionally</span>:<span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">remove_file</span> <span class="ocamlLCIdentifier">outfile</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(fun</span> <span class="Constant">()</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">#define CAML_INTERNALS\n\<br/></li>
<li></span><span class="Constant">#define CAMLDLLIMPORT\<br/></li>
<li></span><span class="Constant">\n\<br/></li>
<li></span><span class="Constant">\n#ifdef __cplusplus\<br/></li>
<li></span><span class="Constant">\nextern \&quot;C\&quot; {\<br/></li>
<li></span><span class="Constant">\n#endif&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">f</span>, <span class="ocamlLCIdentifier">f</span>'<span class="Statement">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Printf</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\n#define %s %s&quot;</span> <span class="ocamlLCIdentifier">f</span> <span class="ocamlLCIdentifier">f</span>'<span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">guarded_primitives</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">\n#include &lt;caml/mlvalues.h&gt;\<br/></li>
<li></span><span class="Constant">\n#include &lt;caml/startup.h&gt;\<br/></li>
<li></span><span class="Constant">\n#include &lt;caml/sys.h&gt;\<br/></li>
<li></span><span class="Constant">\n#include &lt;caml/misc.h&gt;\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(fun</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">f</span>, <span class="Statement">_)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Printf</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\n#undef %s&quot;</span> <span class="ocamlLCIdentifier">f</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">guarded_primitives</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\nstatic int caml_code[] = {\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L22" title="ocaml/bytecomp/symtable.mli:22">init</a></span><span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L214" title="ocaml/bytecomp/bytelink.ml:214">clear_crc_interfaces</a></span> <span class="Constant">()</span><span class="Statement">;<br/></li>
<li><a id="L503">&#x200c;</a></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">currpos</span></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">ref</span> <span class="Constant">0</span> <span class="Statement">in<br/></li>
<li><a id="L504">&#x200c;</a></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">output_fun</span></span> <span class="ocamlLCIdentifier">code</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L416" title="ocaml/bytecomp/bytelink.ml:416">output_code_string</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="ocamlLCIdentifier">code</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L503" title="ocaml/bytecomp/bytelink.ml:503">currpos</a></span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L503" title="ocaml/bytecomp/bytelink.ml:503">currpos</a></span> + <span class="PreProc">Bytes</span>.<span class="ocamlLCIdentifier">length</span> <span class="ocamlLCIdentifier">code<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">and</span> <span class="ocamlLCIdentifier">currpos_fun</span> <span class="Constant">()</span> <span class="Statement">=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L503" title="ocaml/bytecomp/bytelink.ml:503">currpos</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">iter</span> <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L275" title="ocaml/bytecomp/bytelink.ml:275">link_file</a></span> <span class="ocamlLCIdentifier"><a href="#L372" title="ocaml/bytecomp/bytelink.ml:372">output_fun</a></span> <span class="ocamlLCIdentifier">currpos_fun</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">tolink</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The final STOP <a href="instruct.ml.html#L53" title="ocaml/bytecomp/instruct.ml:53">instruction</a> *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Printf</span>.<span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\n0x%x};\n\n&quot;</span> <span class="PreProc">Opcodes</span>.<span class="ocamlLCIdentifier">opSTOP</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The table of global data *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;static char caml_data[] = {\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L435" title="ocaml/bytecomp/bytelink.ml:435">output_data_string</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="PreProc">Marshal</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L38" title="ocaml/bytecomp/bytesections.mli:38">to_string</a></span> <span class="Statement">(</span><span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L25" title="ocaml/bytecomp/symtable.mli:25">initial_global_table</a></span><span class="Constant">()</span><span class="Statement">)</span> <span class="Constant">[]</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\n};\n\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The sections *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">sections</span> : <span class="Statement">(</span><span class="Type">string</span> <span class="Statement">*</span> <span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L23" title="ocaml/bytecomp/bytesections.mli:23">t</a></span><span class="Statement">)</span> <span class="Type">list</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">[</span> <span class="PreProc">Bytesections</span>.<span class="PreProc">Name</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L38" title="ocaml/bytecomp/bytesections.mli:38">to_string</a></span> <span class="Constant">SYMB</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L258" title="ocaml/bytecomp/symtable.ml:258">data_global_map</a></span><span class="Constant">()</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="PreProc">Name</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L38" title="ocaml/bytecomp/bytesections.mli:38">to_string</a></span> <span class="Constant">PRIM</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier">repr</span><span class="Statement">(</span><span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L30" title="ocaml/bytecomp/symtable.mli:30">data_primitive_names</a></span><span class="Constant">()</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Bytesections</span>.<span class="PreProc">Name</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L38" title="ocaml/bytecomp/bytesections.mli:38">to_string</a></span> <span class="Constant">CRCS</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Obj</span>.<span class="ocamlLCIdentifier">repr</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L211" title="ocaml/bytecomp/bytelink.ml:211">extract_crc_interfaces</a></span><span class="Constant">()</span><span class="Statement">)</span> <span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;static char caml_sections[] = {\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier"><a href="#L435" title="ocaml/bytecomp/bytelink.ml:435">output_data_string</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">(</span><span class="PreProc">Marshal</span>.<span class="ocamlLCIdentifier"><a href="bytesections.mli.html#L38" title="ocaml/bytecomp/bytesections.mli:38">to_string</a></span> <span class="ocamlLCIdentifier">sections</span> <span class="Constant">[]</span><span class="Statement">);<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\n};\n\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The table of primitives *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="symtable.mli.html#L28" title="ocaml/bytecomp/symtable.mli:28">output_primitive_table</a></span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* The entry point *)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">with_main</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">output_string</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">\nint main_os(int argc, char_os **argv)\<br/></li>
<li></span><span class="Constant">\n{\<br/></li>
<li></span><span class="Constant">\n&nbsp; caml_byte_program_mode = COMPLETE_EXE;\<br/></li>
<li></span><span class="Constant">\n&nbsp; caml_startup_code(caml_code, sizeof(caml_code),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; caml_data, sizeof(caml_data),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; caml_sections, sizeof(caml_sections),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* pooling */ 0,\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; argv);\<br/></li>
<li></span><span class="Constant">\n&nbsp; caml_do_exit(0);\<br/></li>
<li></span><span class="Constant">\n&nbsp; return 0; /* not reached */\<br/></li>
<li></span><span class="Constant">\n}\n&quot;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">output_string</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span><span class="ocamlEnd"> </span><span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">\nvoid caml_startup(char_os ** argv)\<br/></li>
<li></span><span class="Constant">\n{\<br/></li>
<li></span><span class="Constant">\n&nbsp; caml_startup_code(caml_code, sizeof(caml_code),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; caml_data, sizeof(caml_data),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; caml_sections, sizeof(caml_sections),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* pooling */ 0,\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; argv);\<br/></li>
<li></span><span class="Constant">\n}\<br/></li>
<li></span><span class="Constant">\n\<br/></li>
<li></span><span class="Constant">\nvalue caml_startup_exn(char_os ** argv)\<br/></li>
<li></span><span class="Constant">\n{\<br/></li>
<li></span><span class="Constant">\n&nbsp; return caml_startup_code_exn(caml_code, sizeof(caml_code),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; caml_data, sizeof(caml_data),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; caml_sections, sizeof(caml_sections),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /* pooling */ 0,\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; argv);\<br/></li>
<li></span><span class="Constant">\n}\<br/></li>
<li></span><span class="Constant">\n\<br/></li>
<li></span><span class="Constant">\nvoid caml_startup_pooled(char_os ** argv)\<br/></li>
<li></span><span class="Constant">\n{\<br/></li>
<li></span><span class="Constant">\n&nbsp; caml_startup_code(caml_code, sizeof(caml_code),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; caml_data, sizeof(caml_data),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; caml_sections, sizeof(caml_sections),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* pooling */ 1,\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; argv);\<br/></li>
<li></span><span class="Constant">\n}\<br/></li>
<li></span><span class="Constant">\n\<br/></li>
<li></span><span class="Constant">\nvalue caml_startup_pooled_exn(char_os ** argv)\<br/></li>
<li></span><span class="Constant">\n{\<br/></li>
<li></span><span class="Constant">\n&nbsp; return caml_startup_code_exn(caml_code, sizeof(caml_code),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; caml_data, sizeof(caml_data),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; caml_sections, sizeof(caml_sections),\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /* pooling */ 1,\<br/></li>
<li></span><span class="Constant">\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; argv);\<br/></li>
<li></span><span class="Constant">\n}\n&quot;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="ocamlLCIdentifier">output_string</span> <span class="ocamlLCIdentifier"><a href="#L321" title="ocaml/bytecomp/bytelink.ml:321">outchan</a></span> <span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">\n#ifdef __cplusplus\<br/></li>
<li></span><span class="Constant">\n}\<br/></li>
<li></span><span class="Constant">\n#endif\n&quot;</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">);<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">with_main</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">debug</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L448" title="ocaml/bytecomp/bytelink.ml:448">output_cds_file</a></span> <span class="Statement">((</span><span class="PreProc">Filename</span>.<span class="ocamlLCIdentifier">chop_extension</span> <span class="ocamlLCIdentifier">outfile</span><span class="Statement">)</span> <span class="Statement">^</span> <span class="Constant">&quot;.cds&quot;</span><span class="Statement">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Build a custom <a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a> *)<br/></li>
<li></span><br/></li>
<li><a id="L593">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">build_custom_runtime</span></span> <span class="ocamlLCIdentifier">prim_name</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="#L742" title="ocaml/bytecomp/bytelink.ml:742">runtime_lib</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">with_runtime<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; </span><span class="Statement">then</span> <span class="Constant">&quot;&quot;<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Constant">&quot;-lcamlrun&quot;</span> <span class="Statement">^</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">runtime_variant</span> <span class="Statement">in<br/></li>
<li><a id="L598">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">debug_prefix_map</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Config</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">c_has_debug_prefix_map</span><span class="ocamlNone"> </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">keep_camlprimc_file</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">flag</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">[</span><span class="PreProc">Printf</span>.<span class="ocamlLCIdentifier">sprintf</span> <span class="Constant">&quot;-fdebug-prefix-map=%s=camlprim.<a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a>&quot;</span> <span class="ocamlLCIdentifier">prim_name</span><span class="Statement">]<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Ccomp</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">linker_is_flexlink</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;-<a href="#L634" title="ocaml/bytecomp/bytelink.ml:634">link</a>&quot;</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">flag<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">flag<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">[]</span> <span class="Statement">in<br/></li>
<li><a id="L609">&#x200c;</a></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">exitcode</span></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">std_include_flag</span> <span class="Constant">&quot;-I&quot;</span> <span class="Statement">^</span> <span class="Constant">&quot; &quot;</span> <span class="Statement">^</span> <span class="PreProc">Config</span>.<span class="ocamlLCIdentifier">bytecomp_c_libraries</span><span class="Statement">)<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="PreProc">Ccomp</span>.<span class="ocamlLCIdentifier">call_linker</span> <span class="PreProc">Ccomp</span>.<span class="Constant">Exe</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L598" title="ocaml/bytecomp/bytelink.ml:598">debug_prefix_map</a></span> @ <span class="Statement">[</span><span class="ocamlLCIdentifier">prim_name</span><span class="Statement">]</span> @ <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">rev</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">ccobjs</span> @ <span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L742" title="ocaml/bytecomp/bytelink.ml:742">runtime_lib</a></span><span class="Statement">])<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier"><a href="#L609" title="ocaml/bytecomp/bytelink.ml:609">exitcode</a></span> <span class="Statement">=</span> <span class="Constant">0<br/></li>
<li></span><br/></li>
<li><a id="L616">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">append_bytecode</span></span> <span class="ocamlLCIdentifier">bytecode_name</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">oc</span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">open_out_gen</span> <span class="Statement">[</span><span class="Constant">Open_wronly</span><span class="Statement">;</span> <span class="Constant">Open_append</span><span class="Statement">;</span> <span class="Constant">Open_binary</span><span class="Statement">]</span> <span class="Constant">0</span> <span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span> <span class="Statement">=</span> <span class="ocamlLCIdentifier">open_in_bin</span> <span class="ocamlLCIdentifier">bytecode_name</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">copy_file</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span> <span class="ocamlLCIdentifier">oc</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">close_in</span> <span class="ocamlLCIdentifier"><a href="symtable.ml.html#L298" title="ocaml/bytecomp/symtable.ml:298">ic</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier">close_out</span> <span class="ocamlLCIdentifier">oc<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Fix the <a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a> of the output file, if the C compiler changes it behind<br/></li>
<li></span><span class="Comment">&nbsp;&nbsp; our back. *)<br/></li>
<li></span><br/></li>
<li><a id="L626">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">fix_exec_name</span></span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">match</span> <span class="PreProc">Sys</span>.<span class="ocamlLCIdentifier">os_type</span> <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">&quot;Win32&quot;</span> <span class="Statement">|</span> <span class="Constant">&quot;Cygwin&quot;</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">String</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">contains</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="ocamlNone"> </span><span class="Constant">'.'</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="Statement">else</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="Statement">^</span> <span class="Constant">&quot;.exe&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a><br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Main entry point (build a custom <a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a> if needed) *)<br/></li>
<li></span><br/></li>
<li><a id="L634">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">link</span></span> <span class="ocamlLCIdentifier">objfiles</span> <span class="ocamlLCIdentifier">output_name</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">objfiles</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">match<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">nopervasives</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">output_c_object</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">output_complete_executable<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">with<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">true</span>, <span class="Statement">_</span>, <span class="Statement">_</span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">objfiles<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">false</span>, <span class="Constant">true</span>, <span class="Constant">false</span> <span class="Statement">-&gt;</span> <span class="Constant">&quot;stdlib.cma&quot;</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">objfiles<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">-&gt;</span> <span class="Constant">&quot;stdlib.cma&quot;</span> <span class="Statement">::</span> <span class="ocamlLCIdentifier">objfiles</span> @ <span class="Statement">[</span><span class="Constant">&quot;std_exit.cmo&quot;</span><span class="Statement">]<br/></li>
<li></span>&nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">tolink</span> <span class="Statement">=</span> <span class="PreProc">List</span>.<span class="ocamlLCIdentifier">fold_right</span> <span class="ocamlLCIdentifier"><a href="#L128" title="ocaml/bytecomp/bytelink.ml:128">scan_file</a></span> <span class="ocamlLCIdentifier">objfiles</span> <span class="Constant">[]</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">match</span><span class="ocamlEnd"> </span><span class="PreProc">Ident</span><span class="ocamlEnd">.</span><span class="PreProc">Map</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">bindings</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/bytecomp/bytelink.ml:98">missing_globals</a></span><span class="ocamlEnd"> </span><span class="Statement">with<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="Constant">()<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">|</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier">id</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">cu_name</span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="Statement">_</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">DepSet</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">is_empty</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L100" title="ocaml/bytecomp/bytelink.ml:100">badly_ordered_dependencies</a><br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">raise</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Required_module_unavailable</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Ident</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">id</span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">cu_name</span><span class="Statement">)))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">raise</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Wrong_link_order</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L100" title="ocaml/bytecomp/bytelink.ml:100">badly_ordered_dependencies</a></span><span class="Statement">))<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end;<br/></li>
<li></span>&nbsp; <span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">ccobjs</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">ccobjs</span> @ <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L54" title="ocaml/bytecomp/bytelink.ml:54">lib_ccobjs</a></span><span class="Statement">;</span> <span class="Comment">(* put user's libs last *)<br/></li>
<li></span>&nbsp; <span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">all_ccopts</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L55" title="ocaml/bytecomp/bytelink.ml:55">lib_ccopts</a></span> @ <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">all_ccopts</span><span class="Statement">;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">(* put user's opts first *)<br/></li>
<li></span>&nbsp; <span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">dllibs</span> <span class="Statement">:=</span> <span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L56" title="ocaml/bytecomp/bytelink.ml:56">lib_dllibs</a></span> @ <span class="Statement">!</span><span class="PreProc">Clflags</span>.<span class="ocamlLCIdentifier">dllibs</span><span class="Statement">;</span> <span class="Comment">(* put user's DLLs first *)<br/></li>
<li></span>&nbsp; <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">custom_runtime</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span>&nbsp; &nbsp; <span class="ocamlLCIdentifier">link_bytecode</span> <span class="ocamlLCIdentifier">tolink</span> <span class="ocamlLCIdentifier">output_name</span> <span class="Constant">true<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">output_c_object</span><span class="ocamlNone"> </span><span class="Statement">then</span> <span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">bytecode_name</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">temp_file</span><span class="ocamlEnd"> </span><span class="Constant">&quot;camlcode&quot;</span><span class="ocamlEnd"> </span><span class="Constant">&quot;&quot;</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">prim_name</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">keep_camlprimc_file</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">output_name</span><span class="ocamlEnd"> </span><span class="Statement">^</span><span class="ocamlEnd"> </span><span class="Constant">&quot;.camlprim.<a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a>&quot;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">temp_file</span><span class="ocamlEnd"> </span><span class="Constant">&quot;camlprim&quot;</span><span class="ocamlEnd"> </span><span class="Constant">&quot;.<a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a>&quot;</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="PreProc">Misc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">try_finally<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier">always</span><span class="ocamlEnd">:</span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">remove_file</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">bytecode_name</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">keep_camlprimc_file</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">remove_file</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">prim_name</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">link_bytecode</span><span class="ocamlEnd"> </span><span class="Statement">~</span><span class="Identifier">final_name</span><span class="ocamlEnd">:</span><span class="ocamlLCIdentifier">output_name</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">tolink</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">bytecode_name</span><span class="ocamlEnd"> </span><span class="Constant">false</span><span class="Statement">;<br/></li>
<li><a id="L675">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">poc</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">open_out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">prim_name</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Comment">(* note: builds will not be reproducible if the C code contains macros<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; such as __FILE__. *)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">output_string</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L675" title="ocaml/bytecomp/bytelink.ml:675">poc</a></span><span class="ocamlEnd"> </span><span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #ifdef __cplusplus\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; extern \&quot;C\&quot; {\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #endif\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #ifdef _WIN64\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #ifdef __MINGW32__\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; typedef long long value;\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #else\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; typedef __int64 value;\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #endif\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #else\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; typedef long value;\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #endif\n&quot;</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">Symtable</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier"><a href="symtable.mli.html#L28" title="ocaml/bytecomp/symtable.mli:28">output_primitive_table</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L675" title="ocaml/bytecomp/bytelink.ml:675">poc</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">output_string</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L675" title="ocaml/bytecomp/bytelink.ml:675">poc</a></span><span class="ocamlEnd"> </span><span class="Constant">&quot;\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #ifdef __cplusplus\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }\n\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #endif\n&quot;</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">close_out</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L675" title="ocaml/bytecomp/bytelink.ml:675">poc</a></span><span class="Statement">;<br/></li>
<li><a id="L697">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">exec_name</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L626" title="ocaml/bytecomp/bytelink.ml:626">fix_exec_name</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">output_name</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L593" title="ocaml/bytecomp/bytelink.ml:593">build_custom_runtime</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">prim_name</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">raise(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Constant">Custom_runtime</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">make_runtime</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L616" title="ocaml/bytecomp/bytelink.ml:616">append_bytecode</a></span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">bytecode_name</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L697" title="ocaml/bytecomp/bytelink.ml:697">exec_name</a><br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end</span> <span class="Statement">else</span> <span class="Statement">begin<br/></li>
<li><a id="L704">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">basename</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">remove_extension</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">output_name</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li><a id="L705">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">c_file</span></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">stable_name</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">output_complete_object<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">&amp;&amp;</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">Filename</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">check_suffix</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">output_name</span><span class="ocamlNone"> </span><span class="Constant">&quot;.<a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a>&quot;</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">temp_file</span><span class="ocamlEnd"> </span><span class="Constant">&quot;camlobj&quot;</span><span class="ocamlEnd"> </span><span class="Constant">&quot;.<a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a>&quot;</span><span class="ocamlEnd">, </span><span class="Constant">Some</span><span class="ocamlEnd"> </span><span class="Constant">&quot;camlobj.<a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a>&quot;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">f</span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L704" title="ocaml/bytecomp/bytelink.ml:704">basename</a></span><span class="ocamlEnd"> </span><span class="Statement">^</span><span class="ocamlEnd"> </span><span class="Constant">&quot;.<a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a>&quot;</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Sys</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">file_exists</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">f</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">raise(</span><span class="Constant">Error</span><span class="Statement">(</span><span class="Constant">File_exists</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">f</span><span class="Statement">));<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="ocamlLCIdentifier">f</span><span class="ocamlEnd">, </span><span class="Constant">None<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">end<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li><a id="L715">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">obj_file</span></span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">output_complete_object<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="PreProc">Filename</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">chop_extension</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L705" title="ocaml/bytecomp/bytelink.ml:705">c_file</a></span><span class="Statement">)</span><span class="ocamlEnd"> </span><span class="Statement">^</span><span class="ocamlEnd"> </span><span class="PreProc">Config</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">ext_obj<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L704" title="ocaml/bytecomp/bytelink.ml:704">basename</a></span><span class="ocamlEnd"> </span><span class="Statement">^</span><span class="ocamlEnd"> </span><span class="PreProc">Config</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">ext_obj<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">in<br/></li>
<li><a id="L720">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">temps</span></span><span class="ocamlEnd"> </span><span class="Statement">=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">ref</span><span class="ocamlEnd"> </span><span class="Constant">[]</span><span class="ocamlEnd"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; </span><span class="PreProc">Misc</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">try_finally<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">~</span><span class="Identifier">always</span><span class="ocamlEnd">:</span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;</span><span class="ocamlEnd"> </span><span class="PreProc">List</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">iter</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">remove_file</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L720" title="ocaml/bytecomp/bytelink.ml:720">temps</a></span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">(fun</span><span class="ocamlEnd"> </span><span class="Constant">()</span><span class="ocamlEnd"> </span><span class="Statement">-&gt;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">link_bytecode_as_c</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier">tolink</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L705" title="ocaml/bytecomp/bytelink.ml:705">c_file</a></span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">output_complete_executable</span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">output_complete_executable</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L720" title="ocaml/bytecomp/bytelink.ml:720">temps</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L705" title="ocaml/bytecomp/bytelink.ml:705">c_file</a></span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L720" title="ocaml/bytecomp/bytelink.ml:720">temps</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="#L593" title="ocaml/bytecomp/bytelink.ml:593">build_custom_runtime</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L705" title="ocaml/bytecomp/bytelink.ml:705">c_file</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">output_name</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">raise(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Constant">Custom_runtime</span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end</span><span class="ocamlEnd"> </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">Filename</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">check_suffix</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">output_name</span><span class="ocamlNone"> </span><span class="Constant">&quot;.<a href="bytegen.ml.html#L935" title="ocaml/bytecomp/bytegen.ml:935">c</a>&quot;</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L720" title="ocaml/bytecomp/bytelink.ml:720">temps</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L705" title="ocaml/bytecomp/bytelink.ml:705">c_file</a></span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L720" title="ocaml/bytecomp/bytelink.ml:720">temps</a></span><span class="Statement">;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Ccomp</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">compile_file</span><span class="ocamlNone"> </span><span class="Statement">~</span><span class="Identifier">output</span><span class="ocamlNone">:</span><span class="ocamlLCIdentifier"><a href="#L715" title="ocaml/bytecomp/bytelink.ml:715">obj_file</a></span><span class="ocamlNone"> </span><span class="Statement">?</span><span class="Identifier">stable_name</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L705" title="ocaml/bytecomp/bytelink.ml:705">c_file</a></span><span class="ocamlNone"> </span><span class="Statement">&lt;&gt;</span><span class="ocamlNone"> </span><span class="Constant">0</span><span class="ocamlNone"> </span><span class="Statement">then<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">raise(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Constant">Custom_runtime</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(</span><span class="PreProc">Filename</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">check_suffix</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">output_name</span><span class="ocamlNone"> </span><span class="PreProc">Config</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">ext_obj</span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">||<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">output_complete_object</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">begin<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier"><a href="#L720" title="ocaml/bytecomp/bytelink.ml:720">temps</a></span><span class="ocamlEnd"> </span><span class="Statement">:=</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><a href="#L715" title="ocaml/bytecomp/bytelink.ml:715">obj_file</a></span><span class="ocamlEnd"> </span><span class="Statement">::</span><span class="ocamlEnd"> </span><span class="Statement">!</span><span class="ocamlLCIdentifier"><a href="#L720" title="ocaml/bytecomp/bytelink.ml:720">temps</a></span><span class="Statement">;<br/></li>
<li><a id="L736">&#x200c;</a></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlEnd"> </span><span class="ocamlLCIdentifier"><span class="linkable">mode</span></span><span class="ocamlEnd">, </span><span class="ocamlLCIdentifier">c_libs</span><span class="ocamlEnd"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="PreProc">Filename</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">check_suffix</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">output_name</span><span class="ocamlNone"> </span><span class="PreProc">Config</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">ext_obj<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="PreProc">Ccomp</span><span class="ocamlEnd">.</span><span class="Constant">Partial</span><span class="ocamlEnd">, </span><span class="Constant">&quot;&quot;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">else</span><span class="ocamlEnd"> </span><span class="PreProc">Ccomp</span><span class="ocamlEnd">.</span><span class="Constant">MainDll</span><span class="ocamlEnd">, </span><span class="PreProc">Config</span><span class="ocamlEnd">.</span><span class="ocamlLCIdentifier">bytecomp_c_libraries<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">(<br/></li>
<li><a id="L742">&#x200c;</a></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">let</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><span class="linkable">runtime_lib</span></span><span class="ocamlNone"> </span><span class="Statement">=<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">if</span><span class="ocamlNone"> </span><span class="Statement">not</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">with_runtime<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">then</span><span class="ocamlNone"> </span><span class="Constant">&quot;&quot;<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">else</span><span class="ocamlNone"> </span><span class="Constant">&quot;-lcamlrun&quot;</span><span class="ocamlNone"> </span><span class="Statement">^</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">runtime_variant</span><span class="ocamlNone"> </span><span class="Statement">in<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="PreProc">Ccomp</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">call_linker</span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier"><a href="#L736" title="ocaml/bytecomp/bytelink.ml:736">mode</a></span><span class="ocamlNone"> </span><span class="ocamlLCIdentifier">output_name<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">([</span><span class="ocamlLCIdentifier"><a href="#L715" title="ocaml/bytecomp/bytelink.ml:715">obj_file</a></span><span class="Statement">]</span><span class="ocamlNone"> @ </span><span class="PreProc">List</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">rev</span><span class="ocamlNone"> </span><span class="Statement">!</span><span class="PreProc">Clflags</span><span class="ocamlNone">.</span><span class="ocamlLCIdentifier">ccobjs</span><span class="ocamlNone"> @ </span><span class="Statement">[</span><span class="ocamlLCIdentifier"><a href="#L742" title="ocaml/bytecomp/bytelink.ml:742">runtime_lib</a></span><span class="Statement">])<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="ocamlLCIdentifier">c_libs</span><span class="ocamlNone"> </span><span class="Statement">=</span><span class="ocamlNone"> </span><span class="Constant">0<br/></li>
<li></span><span class="ocamlNone">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">)</span><span class="ocamlNone"> </span><span class="Statement">then</span><span class="ocamlEnd"> </span><span class="Statement">raise</span><span class="ocamlEnd"> </span><span class="Statement">(</span><span class="Constant">Error</span><span class="ocamlEnd"> </span><span class="Constant">Custom_runtime</span><span class="Statement">);<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">end;<br/></li>
<li></span><span class="ocamlEnd">&nbsp; &nbsp; &nbsp; </span><span class="Statement">)<br/></li>
<li></span><span class="ocamlEnd">&nbsp; </span><span class="Statement">end<br/></li>
<li></span><br/></li>
<li><span class="Comment">(* Error report *)<br/></li>
<li></span><br/></li>
<li><span class="Statement">open</span><span class="ocamlNone"> </span><span class="PreProc">Format<br/></li>
<li></span><br/></li>
<li><a id="L759">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">report_error</span></span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">=</span> <span class="Statement">function<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">File_not_found</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;Cannot <a href="symtable.ml.html#L46" title="ocaml/bytecomp/symtable.ml:46">find</a> file %a&quot;</span> <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Not_an_object_file</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;The file %a is not a <a href="meta.ml.html#L19" title="ocaml/bytecomp/meta.ml:19">bytecode</a> object file&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Wrong_object_name</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;The output file %s has the wrong <a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a>. The extension implies\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \ an object file but the <a href="#L634" title="ocaml/bytecomp/bytelink.ml:634">link</a> step was requested&quot;</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Symbol_error</span><span class="Statement">(</span><span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a></span>, <span class="ocamlLCIdentifier">err</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;Error while linking %a:@ %a&quot;</span> <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier"><a href="bytepackager.ml.html#L91" title="ocaml/bytecomp/bytepackager.ml:91">name</a><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="PreProc">Symtable</span>.<span class="ocamlLCIdentifier"><a href="bytelibrarian.mli.html#L35" title="ocaml/bytecomp/bytelibrarian.mli:35">report_error</a></span> <span class="ocamlLCIdentifier">err<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Inconsistent_import</span><span class="Statement">(</span><span class="ocamlLCIdentifier">intf</span>, <span class="ocamlLCIdentifier">file1</span>, <span class="ocamlLCIdentifier">file2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;@[&lt;hov&gt;Files %a@ and %a@ \<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; make inconsistent assumptions over interface %s@]&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier">file1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier">file2<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">intf<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Custom_runtime</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;Error while building custom <a href="#L346" title="ocaml/bytecomp/bytelink.ml:346">runtime</a> system&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">File_exists</span> <span class="ocamlLCIdentifier">file</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;Cannot overwrite existing file %a&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier">file<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Cannot_open_dll</span> <span class="ocamlLCIdentifier">file</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;Error on dynamically loaded library: %a&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier">file<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Required_module_unavailable</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">s</span>, <span class="ocamlLCIdentifier">m</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;Module `%s' is unavailable (required by `%s')&quot;</span> <span class="ocamlLCIdentifier">s</span> <span class="ocamlLCIdentifier">m<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Camlheader</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">msg</span>, <span class="ocamlLCIdentifier"><a href="#L330" title="ocaml/bytecomp/bytelink.ml:330">header</a></span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;System <a href="bytelibrarian.mli.html#L27" title="ocaml/bytecomp/bytelibrarian.mli:27">error</a> while copying file %s: %s&quot;</span> <span class="ocamlLCIdentifier"><a href="#L330" title="ocaml/bytecomp/bytelink.ml:330">header</a></span> <span class="ocamlLCIdentifier">msg<br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Wrong_link_order</span> <span class="ocamlLCIdentifier">depset</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a></span> <span class="Statement">=</span> <span class="PreProc">DepSet</span>.<span class="ocamlLCIdentifier">elements</span> <span class="ocamlLCIdentifier">depset</span> <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">let</span> <span class="ocamlLCIdentifier">depends_on</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Statement">(</span><span class="ocamlLCIdentifier">dep</span>, <span class="ocamlLCIdentifier">depending</span><span class="Statement">)</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;%s depends on %s&quot;</span> <span class="ocamlLCIdentifier">depending</span> <span class="ocamlLCIdentifier">dep<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;@[&lt;hov 2&gt;Wrong <a href="#L634" title="ocaml/bytecomp/bytelink.ml:634">link</a> order: %a@]&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">(</span><span class="ocamlLCIdentifier">pp_print_list</span> <span class="Statement">~</span><span class="Identifier">pp_sep</span>:<span class="Statement">(fun</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">()</span> <span class="Statement">-&gt;</span> <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf</span> <span class="Constant">&quot;,@ &quot;</span><span class="Statement">)</span> <span class="ocamlLCIdentifier">depends_on</span><span class="Statement">)</span> <span class="ocamlLCIdentifier"><a href="bytegen.ml.html#L906" title="ocaml/bytecomp/bytegen.ml:906">l</a><br/></li>
<li></span>&nbsp; <span class="Statement">|</span> <span class="Constant">Multiple_definition</span><span class="Statement">(</span><span class="ocamlLCIdentifier">modname</span>, <span class="ocamlLCIdentifier">file1</span>, <span class="ocamlLCIdentifier">file2</span><span class="Statement">)</span> <span class="Statement">-&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">fprintf</span> <span class="ocamlLCIdentifier">ppf<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;@[&lt;hov&gt;Files %a@ and %a@ both define a module named %s@]&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier">file1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">print_filename</span> <span class="ocamlLCIdentifier">file2<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="ocamlLCIdentifier">modname<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Statement">let</span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">register_error_of_exn<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">(function<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Constant">Error</span> <span class="ocamlLCIdentifier">err</span> <span class="Statement">-&gt;</span> <span class="Constant">Some</span> <span class="Statement">(</span><span class="PreProc">Location</span>.<span class="ocamlLCIdentifier">error_of_printer_file</span> <span class="ocamlLCIdentifier"><a href="bytelibrarian.mli.html#L35" title="ocaml/bytecomp/bytelibrarian.mli:35">report_error</a></span> <span class="ocamlLCIdentifier">err</span><span class="Statement">)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">|</span> <span class="Statement">_</span> <span class="Statement">-&gt;</span> <span class="Constant">None<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">)<br/></li>
<li></span><br/></li>
<li><a id="L812">&#x200c;</a><span class="Statement">let</span> <span class="ocamlLCIdentifier"><span class="linkable">reset</span></span> <span class="Constant">()</span> <span class="Statement">=<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L54" title="ocaml/bytecomp/bytelink.ml:54">lib_ccobjs</a></span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L55" title="ocaml/bytecomp/bytelink.ml:55">lib_ccopts</a></span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L56" title="ocaml/bytecomp/bytelink.ml:56">lib_dllibs</a></span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L98" title="ocaml/bytecomp/bytelink.ml:98">missing_globals</a></span> <span class="Statement">:=</span> <span class="PreProc">Ident</span>.<span class="PreProc">Map</span>.<span class="ocamlLCIdentifier"><a href="symtable.ml.html#L44" title="ocaml/bytecomp/symtable.ml:44">empty</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="PreProc">Consistbl</span>.<span class="ocamlLCIdentifier"><a href="emitcode.ml.html#L184" title="ocaml/bytecomp/emitcode.ml:184">clear</a></span> <span class="ocamlLCIdentifier"><a href="#L183" title="ocaml/bytecomp/bytelink.ml:183">crc_interfaces</a></span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L185" title="ocaml/bytecomp/bytelink.ml:185">implementations_defined</a></span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L220" title="ocaml/bytecomp/bytelink.ml:220">debug_info</a></span> <span class="Statement">:=</span> <span class="Constant">[]</span><span class="Statement">;<br/></li>
<li></span>&nbsp; <span class="ocamlLCIdentifier"><a href="#L414" title="ocaml/bytecomp/bytelink.ml:414">output_code_string_counter</a></span> <span class="Statement">:=</span> <span class="Constant">0<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="index.html">Top Level</a></span>
 </p>

 </body>
</html>
